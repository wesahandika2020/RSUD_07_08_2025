<?php

defined('BASEPATH') or exit('No direct script access allowed');
require APPPATH . '/libraries/REST_Controller.php';

// FCB
require APPPATH . '/libraries/Redis.php';

use Restserver\Libraries\REST_Controller;

use function GuzzleHttp\json_decode;

/**
 * @package         CodeIgniter
 * @subpackage      Rest Server
 * @category        Controller
 * @author          Faiz Muhammad Syam
 * @license         Syams Corporation
 */
class Pelayanan extends REST_Controller
{

    function __construct()
    {
        parent::__construct();
        $this->limit = 10;
        $this->batas = 20;

        // FCB
        $this->redis = new CI_Redis();

        date_default_timezone_set('Asia/Jakarta');
        $this->datetime = date('Y-m-d H:i:s');
        $this->load->model('Pelayanan_model', 'm_pelayanan');
        $this->load->model('logs/Logs_model', 'm_m_logs');
        $this->load->model('vclaim_bpjs/Sep_v2_model', 'm_sep_v2');
        $this->load->model('booking_poliklinik/Booking_poliklinik_model', 'm_booking');
        $this->load->model('gizi/Gizi_model', 'm_gizi');
        $this->bpjs_config = $this->m_pelayanan->getConfigBPJSV2();
        $this->bpjs_configv2 = $this->m_pelayanan->getConfigBPJSVclaim2();

        $id_translucent = $this->session->userdata('id_translucent');
        if (empty($id_translucent)) :
            $this->response(array('error' => 'Anda belum login'), REST_Controller::HTTP_UNAUTHORIZED);
            exit();
        endif;

        $data_lis = $this->m_pelayanan->getLIS();

        $this->url = $data_lis->url;
        $this->user = $data_lis->user;
        $this->pass = $data_lis->pass;

        $this->bridgingBpjs = TRUE;
    }

    function get_layanan_pendaftaran_detail_get()
    {
        if (!$this->get('id')) :
            $this->response(NULL, REST_Controller::HTTP_BAD_REQUEST); // (400)
        endif;

        $this->load->model('pendaftaran/Pendaftaran_model', 'm_pendaftaran');

        $tipe = NULL;
        if ($this->get('tipe')) :
            $tipe = $this->get('tipe');
        endif;

        if ($tipe === 'cppt') :
            $data = $this->m_pendaftaran->getPendaftaranDetail($this->get('id', true), $this->get('id_layanan', true));
        elseif ($tipe === 'edukasi') :
            $data = $this->m_pendaftaran->getPendaftaranDetail($this->get('id', true), $this->get('id_layanan', true));
            // $data['edukasi'] = $this->m_pelayanan->getEdukasi($data['layanan']->id);
            // FEPDKT
            $data['edukasi'] = $this->m_pelayanan->getEdukasi($this->get('id'));
        else :
            $data = $this->m_pendaftaran->getPendaftaranDetail($this->get('id', true), $this->get('id_layanan', true));
            $data['anamnesa']     = $this->m_pelayanan->getAnamnesa($data['layanan']->id);
            $data['profil']       = $this->m_pelayanan->getProfilPasien($data['pasien']->id_pasien);
            $data['soap']         = $this->m_pelayanan->getSOAP($data['layanan']->id);
            $data['diagnosa']     = $this->m_pelayanan->getDiagnosaPemeriksaan($data['layanan']->id);
            $data['diagnosa_ruang_lain'] = $this->m_pelayanan->getDiagnosaPemeriksaanRuangLain($this->get('id', true), $data['layanan']->id);
            $data['tindakan']     = $this->m_pelayanan->getTindakanPemeriksaan($data['layanan']->id);
            $data['operasi']      = $this->m_pelayanan->getJadwalTindakanOperasi($data['layanan']->id);
            $data['bhp']          = $this->m_pelayanan->getBHPPemeriksaan($data['layanan']->id);
            $data['tindakan_bhp'] = $this->m_pelayanan->getTindakanPemeriksaanBHP($data['layanan']->id);
            $data['darah']        = $this->m_pelayanan->getOrderDarah($data['layanan']->id);
            $data['order_bimroh'] = $this->m_pelayanan->getOrderBimroh($data['layanan']->id);
            $data['order_talqin'] = $this->m_pelayanan->getOrderTalqin($data['layanan']->id);
            $data['subspesialis'] = $this->m_pelayanan->checkSubSpesialis((int)$data['layanan']->id_unit_layanan);
            $data['penjamin_pasien']     = $this->m_pelayanan->getPenjaminPasien($data['pasien']->id_pasien);
            $data['pkrt']          = $this->m_pelayanan->getPKRTPemeriksaan($data['layanan']->id);
        endif;

        if ($data) :
            $this->response($data, REST_Controller::HTTP_OK); // (200)
        endif;
    }

    // fungsi untuk mendapatkan detail layanan untuk pemulasaran jenazah
    function get_layanan_pendaftaran_detail_untuk_pemulasaran_get()
    {
        if (!$this->get('id')) :
            $this->response(NULL, REST_Controller::HTTP_BAD_REQUEST); // (400)
        endif;

        $this->load->model('pendaftaran/Pendaftaran_model', 'm_pendaftaran');

        $tipe = NULL;
        if ($this->get('tipe')) :
            $tipe = $this->get('tipe');
        endif;

        $data = $this->m_pendaftaran->getPendaftaranDetailUntukPemulasaran($this->get('id', true), $this->get('id_layanan', true));
        $data['diagnosa']     = $this->m_pelayanan->getDiagnosaPemeriksaanUntukPemulasaran($data['layanan']->id_pendaftaran);
        $data['asal_ruangan']  = $this->m_pelayanan->getAsalRuangan($this->get('id', true));

        if ($data) :
            $this->response($data, REST_Controller::HTTP_OK); // (200)
        endif;
    }

    function get_profil_pasien_get()
    {
        if (!$this->get('id')) :
            $this->response(NULL, REST_Controller::HTTP_BAD_REQUEST);
        endif;

        $data['data'] = $this->m_pelayanan->getProfilPasien($this->get('id'));
        $this->response($data, REST_Controller::HTTP_OK);
    }

    function update_profil_pasien_put()
    {
        if (!$this->put('id_profil_pasien')) :
            $this->response(array('status' => false, 'message' => 'Parameter tidak lengkap'), REST_Controller::HTTP_OK);
        endif;

        $id = $this->put('id_profil_pasien');

        $data = array(
            'is_potensi_komplain' => ($this->put('pasien_potensi_komplain') !== '' ? $this->put('pasien_potensi_komplain') : NULL),
            'is_pemilik_rs' => ($this->put('pasien_pemilik_rs') !== '' ? $this->put('pasien_pemilik_rs') : NULL),
            'is_pasien_pejabat' => ($this->put('pasien_pejabat') !== '' ? $this->put('pasien_pejabat') : NULL),
        );

        $response = $this->m_pelayanan->updateProfilPasien($data, $id);
        $this->response($response, REST_Controller::HTTP_OK);
    }

    function get_visitasi_get()
    {
        if (!$this->get('id', true)) :
            $this->response(NULL, REST_Controller::HTTP_BAD_REQUEST);
        endif;

        $data = $this->m_pelayanan->getVisitasiByID($this->get('id', true));
        $this->response($data, REST_Controller::HTTP_OK);
    }

    function getDataAlergiPasien_get()
    {
        if (!$this->get('id', true)) :
            $this->response(NULL, REST_Controller::HTTP_BAD_REQUEST);
        endif;

        $data = $this->m_pelayanan->getDataAlergiPasien($this->get('id', true));
        $this->response($data, REST_Controller::HTTP_OK);
    }

    function hapus_visitasi_delete($id)
    {
        $status = $this->m_pelayanan->deleteVisitasi($id);
        if ($status) :
            $response = array('status' => $status, 'message' => 'Berhasil menghapus visitasi!');
        else :
            $response = array('status' => $status, 'message' => 'Gagal menghapus visitasi!');
        endif;
        $this->response($response, REST_Controller::HTTP_OK);
    }

    function update_visitasi_put()
    {
        if (!$this->put('id', true)) :
            $this->response(array('status' => false), REST_Controller::HTTP_OK);
        endif;

        $data = array(
            'id' => $this->put('id', true),
            'tensi_sistolik' => $this->put('tensi_sistolik', true),
            'tensi_diastolik' => $this->put('tensi_diastolik', true),
            'nadi' => $this->put('nadi', true),
            'suhu' => $this->put('suhu', true),
            'nps' => $this->put('nafas', true),
            'rr' => $this->put('respirasi', true),
            'keluhan_utama' => $this->put('keluhan_utama', true),
            'keterangan' => $this->put('keterangan', true),
            'id_users' => $this->session->userdata('id_translucent'),
        );

        $status = $this->m_pelayanan->updateVisitasi($data);
        $this->response(array('status' => $status), REST_Controller::HTTP_OK);
    }

    private function start($page)
    {
        return (($page - 1) * $this->limit);
    }

    function tarif_pelayanan_auto_get()
    {
        $q = safe_get('q');
        $jenis_pemeriksaan = safe_get('jenis_pemeriksaan');
        $kelas = safe_get('kelas');
        $jenis_tindakan = safe_get('jenis_tindakan');
        $start = $this->start(safe_get('page'));
        $data = $this->m_pelayanan->getAutoTarifPelayananLab($q, $jenis_pemeriksaan, $jenis_tindakan, $kelas, $start, $this->limit);
        if ((safe_get('page') == 1) & ($q == '')) {
            $pilih[] = array(
                'id'             => '',
                'layanan'        => '',
                'instalasi'      => '',
                'jenis'          => '',
                'bobot'          => '',
                'total'          => '',
                'kelas'          => '',
            );
            $data['data'] = array_merge($pilih, $data['data']);
            $data['total'] += 1;
        }
        $this->response($data, REST_Controller::HTTP_OK);
    }

    function get_list_vital_sign_get($id_layanan_pendaftaran)
    {
        $data = $this->m_pelayanan->getAnamnesa($id_layanan_pendaftaran);
        $result['data'] = $data;
        $tensi_s = array();
        $tensi_d = array();
        $nadi = array();
        $suhu = array();
        $respirasi = array();
        $nafas = array();
        if (0 < count((array)$data)) :
            foreach ($data as $i => $value) :
                $result['waktu'][] = $value->waktu !== NULL ? datetimefmysql($value->waktu, true) : '';
                $tensi_s[] = (float) $value->tensi_sistolik;
                $tensi_d[] = (float) $value->tensi_diastolik;
                $nadi[] = (int) $value->nadi;
                $suhu[] = (int) $value->suhu;
                $nafas[] = (int) $value->nps;
                $respirasi[] = (int) $value->rr;
            endforeach;

            $result['title_tensi'] = 'Grafik Status Tekanan Darah Pasien';
            $result['title_nadi'] = 'Grafik Status Denyut Nadi Pasien';
            $result['title_suhu'] = 'Grafik Status Suhu Tubuh Pasien';
            $result['title_nafas'] = 'Grafik Status Nafas Pasien';
            $result['title_respirasi'] = 'Grafik Status Respirasi Pasien';
            $result['tensi'] = array(
                array('name' => 'Sistolik', 'stack' => 'Sistolik', 'data' => $tensi_s),
                array('name' => 'Diastolik', 'stack' => 'Diastolik', 'data' => $tensi_d)
            );
            $result['nadi'] = array(array('type' => 'spline', 'name' => 'Nadi', 'data' => $nadi));
            $result['suhu'] = array(array('type' => 'spline', 'name' => 'Suhu', 'data' => $suhu));
            $result['nafas'] = array(array('type' => 'spline', 'name' => 'Nafas', 'data' => $nafas));
            $result['respirasi'] = array(array('type' => 'spline', 'name' => 'Respirasi', 'data' => $respirasi));
        else :
            $result = NULL;
        endif;
        $this->response($result, REST_Controller::HTTP_OK);
    }

    function hapus_soap_delete($id)
    {
        $status = $this->m_pelayanan->deleteSOAP($id);
        if ($status) :
            $response = array('status' => $status, 'message' => 'Berhasil menghapus visitasi!');
        else :
            $response = array('status' => $status, 'message' => 'Gagal menghapus visitasi!');
        endif;
        $this->response($response, REST_Controller::HTTP_OK);
    }

    function get_soap_get()
    {
        if (!$this->get('id', true)) :
            $this->response(NULL, REST_Controller::HTTP_BAD_REQUEST);
        endif;

        $data = $this->m_pelayanan->getSOAPByID($this->get('id', true));
        $this->response($data, REST_Controller::HTTP_OK);
    }

    function get_history_edit_soap_get()
    {
        if (!$this->get('id', true)) :
            $this->response(NULL, REST_Controller::HTTP_BAD_REQUEST);
        endif;

        $data = $this->m_pelayanan->getHistorySOAPByID($this->get('id', true));
        $this->response($data, REST_Controller::HTTP_OK);
    }

    function get_history_edit_cppt_get()
    {
        if (!$this->get('id', true)) :
            $this->response(NULL, REST_Controller::HTTP_BAD_REQUEST);
        endif;

        $data = $this->m_pelayanan->getHistoryCPPTByID($this->get('id', true));
        $this->response($data, REST_Controller::HTTP_OK);
    }

    function update_soap_put()
    {
        if (!$this->put('id', true)) :
            $this->response(array('status' => false), REST_Controller::HTTP_OK);
        endif;

        $data = array(
            'id'            => $this->put('id', true),
            'subject'       => $this->put('subject', true),
            'objective'     => $this->put('objective', true),
            'assessment'    => $this->put('assessment', true),
            'plan'          => $this->put('plan', true),
            'keterangan'    => $this->put('keterangan', true),
            'id_users'      => $this->session->userdata('id_translucent'),
            'history_edit'  => '1',
        );

        $status = $this->m_pelayanan->updateSOAP($data);
        $this->response(array('status' => $status), REST_Controller::HTTP_OK);
    }

    function hapus_diagnosa_pemeriksaan_delete($id)
    {
        $this->m_pelayanan->deleteDiagnosaPemeriksaan($id);

        $response = array(
            'status' => true,
            'message' => 'Berhasil menghapus diagnosa'
        );

        $this->response($response, REST_Controller::HTTP_OK);
    }

    private function kirimProcedure($idTindakan)
    {

        $this->autentikasi_user_post();

        if ($idTindakan === null) {

            $cdecode = ["metaData" => ["code" => 201, "message" => 'ID Tindakan Tidak ada, harap refresh kembali']];
            return $cdecode;
            die();
        }

        $this->load->model('satu_sehat/Satu_sehat_model', 'sehat');

        $xKonfigurasi = $this->sehat->getConfigSatuSehat();

        $data = $this->sehat->cekTindakanPasien((int)$idTindakan);

        $idUser = $this->session->userdata('id_translucent');

        $getID = $this->sehat->aksesSatuSehat($idUser);

        $tokenBearer = $getID->token;

        $xKonfigurasi = $this->sehat->getConfigSatuSehat();

        $header = $this->sehat->authBearer($tokenBearer);

        if ($data->id_pengkodean !== null && $data->id_pengkodean !== '') {

            $idParams = $data->id_tindakan_satset;

            $url = $xKonfigurasi->apiurl . "Procedure/" . $idParams;

            $params = array(
                "resourceType" => "Procedure",
                "id" => $idParams,
                "status" => "not-done",
                "code" => array(
                    "coding" => [
                        array(
                            "system" => "http://hl7.org/fhir/sid/icd-9-cm",
                            "code" => $data->icd9,
                            "display" => $data->nama_icd
                        )
                    ]
                ),
                "subject" => array(
                    "reference" => "Patient/" . $data->ihsn,
                    "display" => $data->nama_pasien
                ),
                "encounter" => array(
                    "reference" => "Encounter/" . $data->id_encounter,
                    "display" => "Tindakan " . $data->nama . " " . $data->nama_pasien . " pada " . convertDateIndo($data->tanggal_layanan)
                )


            );

            $data_api = json_encode($params);

            $output = $this->sehat->putEncounter($url, $data_api, $header);

            if($output['result'] !== false){
                if ($output['respon'] === 200) {

                    $result = json_decode($output['result']);

                    date_default_timezone_set('Asia/Jakarta');

                    $xDetailData = ["kategori" => "Update Procedure", "no_rm" => $data->no_rm, "message" => json_encode($params), "jenis_data" => 'ok', "tanggal" => date('Y-m-d H:i:s'), "user" => $this->session->userdata('nama')];

                    $this->db->insert('sm_satu_sehat_log', $xDetailData);

                    $decode = ["metaData" => ["code" => 200, "message" => 'Integrasi Procedure Pasien Berhasil']];
                } else {

                    $result = json_decode($output['result']);

                    date_default_timezone_set('Asia/Jakarta');
                    $xDetailData = ["kategori" => "Update Procedure", "no_rm" => $data->no_rm, "message" => $output['result'], "jenis_data" => 'error', "tanggal" => date('Y-m-d H:i:s'), "user" => $this->session->userdata('nama'), "param" => json_encode($params)];
                    $this->db->insert('sm_satu_sehat_log', $xDetailData);
                    $decode = ["metaData" => ["code" => 202, "message" => $output['result']]];
                }

                return $decode;
            }
        }
    }

    function hapus_tindakan_pemeriksaan_delete($id, $jenis = NULL)
    {
        $response = array(
            'status' => false,
            'message' => 'Gagal menghapus tindakan'
        );

        if ($jenis !== NULL) :
            if ($jenis === 'Poliklinik') :
                $jenis = 'Tindakan';
            else :
                if ($jenis === 'Rawat Inap') :
                    $jenis = 'Rawat Inap';
                else :
                    if ($jenis === 'Intensive Care') :
                        $jenis = 'Intensive Care';
                    else :
                        if ($jenis === 'Pemulasaran Jenazah') :
                            $jenis = 'Pemulasaran Jenazah';
                        else :
                            $jenis = 'Tindakan';
                        endif;
                    endif;
                endif;
            endif;

            if ($jenis === 'Tindakan') :

                $this->load->model('satu_sehat/Satu_sehat_model', 'sehat');

                $data = $this->sehat->cekTindakanPasien((int)$id);

                $cekOnOff = $this->sehat->cekSatuSehatOnOff();

                if($cekOnOff->onoff === '1') :

                    if (isset($data->id_pengkodean)) :

                        if ($data->id_pengkodean !== null && $data->id_pengkodean !== '') :

                            $x = $this->kirimProcedure($id);

                        endif;

                    endif;

                endif;

            endif;

            $response = $this->m_pelayanan->deleteTindakanPemeriksaan($id, $jenis);

        else :
            $response = array(
                'status' => false,
                'message' => 'Gagal menghapus tindakan, parameter tidak lengkap'
            );
        endif;

        $this->response($response, REST_Controller::HTTP_OK);
    }

    function get_data_entri_keperawatan_get()
    {
        if (!$this->get('id')) :
            $this->response(NULL, REST_Controller::HTTP_BAD_REQUEST); // (400)
        endif;

        $this->load->model('pendaftaran/Pendaftaran_model', 'm_pendaftaran');
        $data = $this->m_pendaftaran->getPendaftaranDetail($this->get('id', true), $this->get('id_layanan', true));
        $data['profil'] = $this->m_pelayanan->getProfilPasien($data['pasien']->id_pasien);
        // RAKX
        // $data['masalah_rawat']  = $this->m_pelayanan->getMasalahRawat($this->get('id', true));
        $data['pengkajian_ulang']  = $this->m_pelayanan->getPengkajianUlang($this->get('id', true));
        $data['pemantauan_ulang']  = $this->m_pelayanan->getPemantauanUlang($this->get('id', true));
        $data['spiritual_pasien']  = $this->m_pelayanan->getSpiritualPasien($this->get('id', true));
        $data['pemantauan_sholat']  = $this->m_pelayanan->getPantauSholat($this->get('id', true));
        $data['surveilans']  = $this->m_pelayanan->getSurveilansPasien($this->get('id', true));
        $data['sirs_ruang_rawat']  = $this->m_pelayanan->getRuangRawat($this->get('id', true));
        $data['sirs_pemasangan_alat']  = $this->m_pelayanan->getPemasanganAlat($this->get('id', true));
        $data['sirs_pemakaian_antibiotika']  = $this->m_pelayanan->getPemakaianAntibiotika($this->get('id', true));
        $data['asesment_pra_bedah']  = $this->m_pelayanan->getAsessmenPraBedah($this->get('id_layanan', true));

        // AAAS jangan di hide ini penyebab ketika buka pelayanan eror 
        $data['assesmen_anestesi_sedasi']  = $this->m_pelayanan->getAssesmentAnestesi($this->get('id', true));
        // $data['transfer_pasien_intra_rumah_sakit']  = $this->m_pelayanan->getTransferPasienRumahSakit($this->get('id', true));

        $data['bukti_visit_dokter']  = $this->m_pelayanan->getBuktiVisitDokter($this->get('id', true));
        // $data['daftar_dokter_dpjp']  = $this->m_pelayanan->getDaftarDokterDPJP($this->get('id', true));
        // $data['catatan_operan_perawat_pagi']  = $this->m_pelayanan->getCatatanOperanPerawatPagi($this->get('id', true));
        // $data['catatan_operan_perawat_sore']  = $this->m_pelayanan->getCatatanOperanPerawatSore($this->get('id', true));
        // $data['catatan_operan_perawat_malam']  = $this->m_pelayanan->getCatatanOperanPerawatMalam($this->get('id', true));
        // RAKX
        // $data['rencana_keperawatan']  = $this->m_pelayanan->getRencanaKeperawatan($this->get('id', true));
        // CTKN
        // $data['catatan_tindakan_rawat']  = $this->m_pelayanan->getCatatanTindakanRawat($this->get('id', true));
        $data['pengkajian_ulang_resiko_jatuh_pasien_anak'] = $this->m_pelayanan->getPengkajianUlangResikoJatuhPasienAnak($this->get('id', true));
        // $data['pengkajian_ulang_resiko_jatuh_pasien_lansia'] = $this->m_pelayanan->getPengkajianUlangResikoJatuhPasienLansia($this->get('id', true));
        $data['upaya_pencegahan_risiko_jatuh_pasien_dewasa']  = $this->m_pelayanan->getUpayaPencegahanPasienDewasa($this->get('id', true));
        $data['upaya_pencegahan_risiko_jatuh_pasien_anak']  = $this->m_pelayanan->getUpayaPencegahanPasienAnak($this->get('id', true));
        $data['kontrol_kembali']  = $this->m_pelayanan->getKontrolKembali($data['layanan']->id);
        // $data['upaya_pencegahan_risiko_jatuh_pasien_lansia'] = $this->m_pelayanan->getUpayaPencegahanPasienLansia($this->get('id', true));
        $data['surgical_safety_ceklis']  = $this->m_pelayanan->getSurgicalSafetyCeklis($this->get('id', true));
        // UPRJPN
        // $data['upaya_pencegahan_risiko_jatuh_pada_neonatus'] = $this->m_pelayanan->getUpayaPencegahanResikoJatuhPadaNeonatus($this->get('id', true));


        // CPDPO 1 
        // $data['riwayat_pemakaian_obat'] = $this->m_pelayanan->getRiwayatPemakaianObat($this->get('id', true));
        // ILLIS 1
        // $data['riwayat_pemakaian_obat_infus'] = $this->m_pelayanan->getRiwayatPemakaianObatInfus($this->get('id', true));
        // WPT 1 
        // $data['waktu_pemberian_tanggal'] = $this->m_pelayanan->getWaktuPemberianTanggal($this->get('id', true));
        // IWPT 1 
        // $data['waktu_pemberian_tanggal_infus'] = $this->m_pelayanan->getWaktuPemberianTanggalInfus($this->get('id', true));


        // PKN 1
        // $data['pengawasan_khusus_neonatus'] = $this->m_pelayanan->getPengawasanKhususNeonatus($this->get('id', true));


        // MP-A
        // $data['monitoring_pasien_1']  = $this->m_pelayanan->getMonitoringPasien1($this->get('id', true));
        // // MPP-C 1 
        // $data['monitoring_pasien_2'] = $this->m_pelayanan->getMonitoringPasien2($this->get('id', true));
        // // data grafik monitoring
        // $data['grafik_monitoring'] = $this->m_pelayanan->getaGrafikMonitoring($this->get('id_layanan', true));


        $data['surveilans2']  = $this->m_pelayanan->getSurveilansPasien2($this->get('id', true), $this->get('id_layanan', true));
        // var_dump($data['surveilans']);die;
        $data['edukasi'] = $this->m_pelayanan->getEdukasi($this->get('id'));

        // ACEH
        $data['edukasi'] = $this->m_pelayanan->getEdukasi($this->get('id'));
        $data['persetujuan_umum'] = $this->m_pelayanan->getPersetujuanUmumById($this->get('id'));
        $data['ringkasan_riwayat_masuk_dan_keluar'] = $this->m_pelayanan->getRingkasanRiwayatMasukDanKeluarById($this->get('id'));

        $data['pengantar_rawat'] = $this->m_pelayanan->getSuratPengantarRawatById($this->get('id'));
        // $data['pengantar_rawat'] = $this->m_pelayanan->getSuratPengantarRawatById($this->get('id'), $this->m_pendaftaran->getPendaftaranDetail($this->get('id')));


        $data['tata_tertib'] = $this->m_pelayanan->getTataTertibById($this->get('id'));
        $data['persetujuan_rawat_inap'] = $this->m_pelayanan->getSuratPersetujuanRawatInap($this->get('id'), $this->m_pendaftaran->getPendaftaranDetail($this->get('id')));
        // ACEH

        // surgical luar kamar operasi
        $data['surgical_luar_kamar']  = $this->m_pelayanan->getLKO($this->get('id', true));
        // manajer pelayanan pasien
        $data['mpp'] = $this->m_pelayanan->getMpp($this->get('id'));
        // Resep_kacamata
        $data['rkm'] = $this->m_pelayanan->getRkm($this->get('id'));

        // Ambil no RM
        $noRM = $this->m_pelayanan->getNoRm($this->get('id', true));
        // grafik Length/height-for-age BOYS
        $data['grafik_length'] = $this->m_pelayanan->getGrafikLength($noRM);
        // grafik head circumference-for-age BOYS
        $data['grafik_head'] = $this->m_pelayanan->getGrafikHead($noRM);
        // grafik Weight-for-age BOYS
        $data['grafik_weight'] = $this->m_pelayanan->getGrafikWeight($noRM);
        // grafik BMI-for-age BOYS
        $data['grafik_bmi'] = $this->m_pelayanan->getGrafikBmi($noRM);
        // grafik Weight-for-height BOYS 2 to 5
        $data['grafik_wfh'] = $this->m_pelayanan->getGrafikWfh($noRM);
        // grafik Weight-for-length BOYS birth to 5
        $data['grafik_wfl'] = $this->m_pelayanan->getGrafikWfl($noRM);
        // grafik fenton pretern growth chart - boys
        $data['grafik_fpg'] = $this->m_pelayanan->getGrafikFpg($noRM);
        // grafik Length/height-for-age GIRL
        $data['grafik_length_girl'] = $this->m_pelayanan->getGrafikLengthGirl($noRM);
        // grafik head circumference-for-age GIRLS
        $data['grafik_head_girls'] = $this->m_pelayanan->getGrafikHeadGirls($noRM);
        // grafik Weight-for-height GIRLS 2 to 5
        $data['grafik_wfhg'] = $this->m_pelayanan->getGrafikWfhg($noRM);
        // grafik Weight-for-age GIRLS
        $data['grafik_weight_girls'] = $this->m_pelayanan->getGrafikWeightGirl($noRM);
        // grafik BMI-for-age GIRLS
        $data['grafik_bmi_girl'] = $this->m_pelayanan->getGrafikBmiGirl($noRM);
        // grafik Weight-for-height GIRLS birth to 5
        $data['grafik_wflg'] = $this->m_pelayanan->getGrafikWflg($noRM);
        // grafik fenton pretern growth chart - girl
        $data['grafik_fpgg'] = $this->m_pelayanan->getGrafikFpgg($noRM);
        // Kelaikan Bekerja
        $data['kb'] = $this->m_pelayanan->getKb($this->get('id_layanan'));
        // laporan kesehatan
        $data['lpk'] = $this->m_pelayanan->getLpk($this->get('id_layanan'));
        // Lembar Observasi
        $data['lo'] = $this->m_pelayanan->getLo($this->get('id_layanan'));
        // Ceklis Harian Akses Sentral
        $data['chas'] = $this->m_pelayanan->getChas($this->get('id_layanan'));
        // konsultasi gizi
        $data['kg'] = $this->m_gizi->getKonsulGizi($this->get('id'));
        // var_dump($data['ga']);die;
        // Gizi Dietetik
        $data['gd'] = $this->m_gizi->getGiziDietetik($this->get('id'));
        // Gizi Anak
        $data['ga'] = $this->m_gizi->getGiziAnak($this->get('id'));

        // ACEH
        $diagUtamaAwal = $this->m_pelayanan->getDiagnosaUtamaAwal($this->get('id', true));
        $diagManualAwal = $this->m_pelayanan->getDiagnosaManualAwal($this->get('id', true));
        $data['diagnosa_awal'] = isset($diagUtamaAwal[0]->nama) ? $diagUtamaAwal[0]->nama : $diagManualAwal[0]->nama ?? null;

        // $diagUtamaAkhir = $this->m_pelayanan->getDiagnosaUtamaAkhir($this->get('id', true));
        // $diagManualAkhir = $this->m_pelayanan->getDiagnosaManualAkhir($this->get('id', true));
        // $mergedArray = array_merge($diagUtamaAkhir, $diagManualAkhir);
        // usort($mergedArray, function ($a, $b) {
        //     if (is_array($a) && is_array($b)) {
        //         return $b['id_layanan_pendaftaran'] <=> $a['id_layanan_pendaftaran'];
        //     }
        //     return $b->id_layanan_pendaftaran <=> $a->id_layanan_pendaftaran;;
        // });
        // $data['diagnosa_akhir'] = $mergedArray[0]->nama ?? null;

        // $terapiResume1  = $this->m_pelayanan->getTerapiPulang($this->get('id_layanan'));
        // foreach ($terapiResume1 as $value) {
        //     $value->nama_obat = $value->barang_auto;
        // }

        // TAMBAHAN WH
        $data['diagnosa_utama'] = [];
            $diagnosa_utamas = $this->m_pelayanan->getDiagnosa($this->get('id', true));
        if (!empty($diagnosa_utamas)) {
            $data['diagnosa_utama'] = $diagnosa_utamas;
        }
        $data['ds_manual_utama'] = [];
            $ds_manual_utamas = $this->m_pelayanan->getDiagnosaManualUtama($this->get('id', true));
        if (!empty($ds_manual_utamas)) {
            $data['ds_manual_utama'] = $ds_manual_utamas;
        }
        $data['diagnosa_sekunder'] = [];
            $diagnosa_sekunders = $this->m_pelayanan->getDiagnosaSekunder($this->get('id', true));
        if (!empty($diagnosa_sekunders)) {
            $data['diagnosa_sekunder'] = $diagnosa_sekunders;
        }
        $data['ds_manual_sekunder'] = [];
            $ds_manual_sekunders = $this->m_pelayanan->getDiagnosaManualSekunder($this->get('id', true));
        if (!empty($ds_manual_sekunders)) {
            $data['ds_manual_sekunder'] = $ds_manual_sekunders;
        }

        $terapiResume1  = $this->m_pelayanan->getTerapiPulang($this->get('id_layanan'));
		foreach ($terapiResume1 as $value) {
			$value->nama_obat = $value->barang_auto;
		}

        $terapiResume2 = $this->m_pelayanan->getObatTerapiPulang($this->get('id_layanan', true));
        $data['terapi_pulang'] = array_merge($terapiResume2, $terapiResume1);
        // ACEH

        if ($data) :
            $this->response($data, REST_Controller::HTTP_OK); // (200)
        endif;
    }

    function get_detail_resume_keperawatan_get()
    {

        if (!$this->get('id') && !$this->get('id_layanan')) :
            $this->response(NULL, REST_Controller::HTTP_BAD_REQUEST); // (400)
        endif;

        $data['resume_keperawatan'] = $this->m_pelayanan->getResume($this->get('id'));
        $data['terapi_pulang']  = $this->m_pelayanan->getTerapiPulang($this->get('id_layanan'));
        $data['kontrol_kembali']  = $this->m_pelayanan->getKontrolKembali($this->get('id_layanan'));

        if ($data) :
            $this->response($data, REST_Controller::HTTP_OK); // (200)
        endif;
    }

    function get_detail_transfer_get()
    {

        if (!$this->get('id') && !$this->get('id_layanan')) :
            $this->response(NULL, REST_Controller::HTTP_BAD_REQUEST); // (400)
        endif;
        $data = $this->m_pelayanan->getDetailTrasnferPasien($this->get('id', true));
        if ($data) :
            $this->response($data, REST_Controller::HTTP_OK); // (200)
        endif;
    }

    function get_list_resume_keperawatan_get()
    {
        if (!$this->get('page', true)) :
            $this->response(NULL, REST_Controller::HTTP_BAD_REQUEST); // (400)
        endif;
        $limit = 5;
        $start  = ($this->get('page') - 1) * $limit;
        $search = [
            'keyword' => safe_get('keyword'),
            'waktu' => date2mysql(safe_get('waktu')),
            'id_pendaftaran'  => $this->get('id_pendaftaran', true),
        ];

        $data            = $this->m_pelayanan->getListResumeKeperawatan($limit, $start, $search);
        $data['page']    = (int) $this->get('page');
        $data['limit']   = $limit;

        if ($data) :
            $this->response($data, REST_Controller::HTTP_OK); // (200)
        endif;
    }

    function get_list_transfer_pasien_get()
    {
        if (!$this->get('page', true)) :
            $this->response(NULL, REST_Controller::HTTP_BAD_REQUEST); // (400)
        endif;
        $limit = 5;
        $start  = ($this->get('page') - 1) * $limit;
        $search = [
            'keyword' => safe_get('keyword'),
            'waktu' => date2mysql(safe_get('waktu')),
            'id_pendaftaran'  => $this->get('id_pendaftaran', true),
        ];

        $data            = $this->m_pelayanan->getTrasnferPasien($limit, $start, $search);
        $data['page']    = (int) $this->get('page');
        $data['limit']   = $limit;

        if ($data) :
            $this->response($data, REST_Controller::HTTP_OK); // (200)
        endif;
    }



    function hapus_ruang_rawat_delete($id)
    {
        $status = $this->m_pelayanan->deleteRuangRawat($id);
        if ($status) :
            $response = array('status' => $status, 'message' => 'Berhasil menghapus Ruang Rawat!');
        else :
            $response = array('status' => $status, 'message' => 'Gagal menghapus Ruang Rawat!');
        endif;
        $this->response($response, REST_Controller::HTTP_OK);
    }

    function hapus_data_pasang_delete($id)
    {
        $status = $this->m_pelayanan->deleteDataPasang($id);
        if ($status) :
            $response = array('status' => $status, 'message' => 'Berhasil menghapus Data Pasang!');
        else :
            $response = array('status' => $status, 'message' => 'Gagal menghapus Data Pasang!');
        endif;
        $this->response($response, REST_Controller::HTTP_OK);
    }

    function hapus_data_antibiotik_delete($id)
    {
        $status = $this->m_pelayanan->deleteDataAntibiotik($id);
        if ($status) :
            $response = array('status' => $status, 'message' => 'Berhasil menghapus Data Antibiotika!');
        else :
            $response = array('status' => $status, 'message' => 'Gagal menghapus Data Antibiotika!');
        endif;
        $this->response($response, REST_Controller::HTTP_OK);
    }

    function hapus_pantau_sholat_delete($id)
    {
        $status = $this->m_pelayanan->deletePantauanSholat($id);
        if ($status) :
            $response = array('status' => $status, 'message' => 'Berhasil menghapus Pemantauan!');
        else :
            $response = array('status' => $status, 'message' => 'Gagal menghapus Pemantauan!');
        endif;
        $this->response($response, REST_Controller::HTTP_OK);
    }

    function hapus_pemantauan_delete($id)
    {
        $status = $this->m_pelayanan->deletePemantauan($id);
        if ($status) :
            $response = array('status' => $status, 'message' => 'Berhasil menghapus Pemantauan!');
        else :
            $response = array('status' => $status, 'message' => 'Gagal menghapus Pemantauan!');
        endif;
        $this->response($response, REST_Controller::HTTP_OK);
    }

    function hapus_resume_delete($id)
    {
        $status = $this->m_pelayanan->deleteResumeKeperawatan($id);
        if ($status) :
            $response = array('status' => $status, 'message' => 'Berhasil menghapus Resume Keperawatan!');
        else :
            $response = array('status' => $status, 'message' => 'Gagal menghapus Resume Keperawatan!');
        endif;
        $this->response($response, REST_Controller::HTTP_OK);
    }

    function hapus_transfer_delete($id)
    {
        $status = $this->m_pelayanan->deleteResumeTransfer($id);
        if ($status) :
            $response = array('status' => $status, 'message' => 'Berhasil menghapus Transfer Pasien Intra Rumah Sakit!');
        else :
            $response = array('status' => $status, 'message' => 'Gagal menghapus Transfer Pasien Intra Rumah Sakit!');
        endif;
        $this->response($response, REST_Controller::HTTP_OK);
    }



    function hapus_terapi_pulang_delete($id)
    {
        $status = $this->m_pelayanan->deleteTerapiPulang($id);
        if ($status) :
            $response = array('status' => $status, 'message' => 'Berhasil menghapus Terapi Pulang!');
        else :
            $response = array('status' => $status, 'message' => 'Gagal menghapus Terapi Pulang!');
        endif;
        $this->response($response, REST_Controller::HTTP_OK);
    }



    function hapus_pengkajian_ulang_resiko_jatuh_pasien_anak_delete($id)
    {
        $status = $this->m_pelayanan->deletePengkajianUlangResikoJatuhPasienAnak($id);
        if ($status) :
            $response = array('status' => $status, 'message' => 'Berhasil menghapus Pengkajian Ulang Resiko Jatuh Pasien Anak!');
        else :
            $response = array('status' => $status, 'message' => 'Gagal menghapus Pengkajian Ulang Resiko Jatuh Pasien Anak!');
        endif;
        $this->response($response, REST_Controller::HTTP_OK);
    }

  

  











 

 

  

    function get_upaya_pencegahan_risiko_jatuh_pasien_anak_get()
    {
        if (!$this->get('id', true)) :
            $this->response(null, REST_Controller::HTTP_BAD_REQUEST);
        endif;

        $data = $this->m_pelayanan->getUpayaPencegahanResikoJatuhPasienAnakByID($this->get('id', true));
        $this->response($data, REST_Controller::HTTP_OK);
    }

    function update_upaya_pencegahan_risiko_jatuh_pasien_anak_put()
    {
        if (!$this->put('id', true)) :
            $this->response(array('status' => false), REST_Controller::HTTP_OK);
        endif;

        $tanggal_pengkajian = $this->put('uprjpa_tanggal_pengkajian', true);
        $tanggal_pengkajian = str_replace('/', '-', $tanggal_pengkajian);

        $tanggal_pengkajian = date('Y-m-d', strtotime($tanggal_pengkajian));
        $id_perawat_p       = $this->put('uprjpa_perawat_p', true);
        $id_perawat_s       = $this->put('uprjpa_perawat_s', true);
        $id_perawat_m       = $this->put('uprjpa_perawat_m', true);

        // Bel berfungsi dan mudah dijangkau
        $bel_p_ho = $this->put('uprjpa_bel_p_ho', true);
        $bel_p_10 = $this->put('uprjpa_bel_p_10', true);
        $bel_s_ho = $this->put('uprjpa_bel_s_ho', true);
        $bel_s_18 = $this->put('uprjpa_bel_s_18', true);
        $bel_m_ho = $this->put('uprjpa_bel_m_ho', true);
        $bel_m_23 = $this->put('uprjpa_bel_m_23', true);
        $bel_m_4  = $this->put('uprjpa_bel_m_4', true);

        // Roda tempat tidur terkunci
        $roda_p_ho = $this->put('uprjpa_roda_p_ho', true);
        $roda_p_10 = $this->put('uprjpa_roda_p_10', true);
        $roda_s_ho = $this->put('uprjpa_roda_s_ho', true);
        $roda_s_18 = $this->put('uprjpa_roda_s_18', true);
        $roda_m_ho = $this->put('uprjpa_roda_m_ho', true);
        $roda_m_23 = $this->put('uprjpa_roda_m_23', true);
        $roda_m_4  = $this->put('uprjpa_roda_m_4', true);

        // Posisikan tempat tidur pada posisi terendah
        $ptt_p_ho = $this->put('uprjpa_ptt_p_ho', true);
        $ptt_p_10 = $this->put('uprjpa_ptt_p_10', true);
        $ptt_s_ho = $this->put('uprjpa_ptt_s_ho', true);
        $ptt_s_18 = $this->put('uprjpa_ptt_s_18', true);
        $ptt_m_ho = $this->put('uprjpa_ptt_m_ho', true);
        $ptt_m_23 = $this->put('uprjpa_ptt_m_23', true);
        $ptt_m_4  = $this->put('uprjpa_ptt_m_4', true);

        // Pagar pengaman tempat tidur dinaikan
        $ppt_p_ho = $this->put('uprjpa_ppt_p_ho', true);
        $ppt_p_10 = $this->put('uprjpa_ppt_p_10', true);
        $ppt_s_ho = $this->put('uprjpa_ppt_s_ho', true);
        $ppt_s_18 = $this->put('uprjpa_ppt_s_18', true);
        $ppt_m_ho = $this->put('uprjpa_ppt_m_ho', true);
        $ppt_m_23 = $this->put('uprjpa_ppt_m_23', true);
        $ppt_m_4  = $this->put('uprjpa_ppt_m_4', true);

        // Penerang cukup
        $penerangan_p_ho = $this->put('uprjpa_penerangan_p_ho', true);
        $penerangan_p_10 = $this->put('uprjpa_penerangan_p_10', true);
        $penerangan_s_ho = $this->put('uprjpa_penerangan_s_ho', true);
        $penerangan_s_18 = $this->put('uprjpa_penerangan_s_18', true);
        $penerangan_m_ho = $this->put('uprjpa_penerangan_m_ho', true);
        $penerangan_m_23 = $this->put('uprjpa_penerangan_m_23', true);
        $penerangan_m_4  = $this->put('uprjpa_penerangan_m_4', true);

        // Pastikan alas kaki yang tidak licin untuk pasien yang dapat berjalan
        $alas_p_ho = $this->put('uprjpa_alas_p_ho', true);
        $alas_p_10 = $this->put('uprjpa_alas_p_10', true);
        $alas_s_ho = $this->put('uprjpa_alas_s_ho', true);
        $alas_s_18 = $this->put('uprjpa_alas_s_18', true);
        $alas_m_ho = $this->put('uprjpa_alas_m_ho', true);
        $alas_m_23 = $this->put('uprjpa_alas_m_23', true);
        $alas_m_4  = $this->put('uprjpa_alas_m_4', true);

        // Lantai kering dan tidak licin
        $lantai_p_ho = $this->put('uprjpa_lantai_p_ho', true);
        $lantai_p_10 = $this->put('uprjpa_lantai_p_10', true);
        $lantai_s_ho = $this->put('uprjpa_lantai_s_ho', true);
        $lantai_s_18 = $this->put('uprjpa_lantai_s_18', true);
        $lantai_m_ho = $this->put('uprjpa_lantai_m_ho', true);
        $lantai_m_23 = $this->put('uprjpa_lantai_m_23', true);
        $lantai_m_4  = $this->put('uprjpa_lantai_m_4', true);

        // Dekatkan alat-alat pasien
        $alat_p_ho = $this->put('uprjpa_alat_p_ho', true);
        $alat_p_10 = $this->put('uprjpa_alat_p_10', true);
        $alat_s_ho = $this->put('uprjpa_alat_s_ho', true);
        $alat_s_18 = $this->put('uprjpa_alat_s_18', true);
        $alat_m_ho = $this->put('uprjpa_alat_m_ho', true);
        $alat_m_23 = $this->put('uprjpa_alat_m_23', true);
        $alat_m_4  = $this->put('uprjpa_alat_m_4', true);

        // Edukasi pasien tentang efek samping obat yang diberikan
        $edukasi_p_ho = $this->put('uprjpa_edukasi_p_ho', true);
        $edukasi_p_10 = $this->put('uprjpa_edukasi_p_10', true);
        $edukasi_s_ho = $this->put('uprjpa_edukasi_s_ho', true);
        $edukasi_s_18 = $this->put('uprjpa_edukasi_s_18', true);
        $edukasi_m_ho = $this->put('uprjpa_edukasi_m_ho', true);
        $edukasi_m_23 = $this->put('uprjpa_edukasi_m_23', true);
        $edukasi_m_4  = $this->put('uprjpa_edukasi_m_4', true);

        // Tidak meninggalkan pasien di kamar mandi saat menggunakan commode
        $commode_p_ho = $this->put('uprjpa_commode_p_ho', true);
        $commode_p_10 = $this->put('uprjpa_commode_p_10', true);
        $commode_s_ho = $this->put('uprjpa_commode_s_ho', true);
        $commode_s_18 = $this->put('uprjpa_commode_s_18', true);
        $commode_m_ho = $this->put('uprjpa_commode_m_ho', true);
        $commode_m_23 = $this->put('uprjpa_commode_m_23', true);
        $commode_m_4  = $this->put('uprjpa_commode_m_4', true);

        // Pasang gelang khusus
        $gelang_p_ho = $this->put('uprjpa_gelang_p_ho', true);
        $gelang_p_10 = $this->put('uprjpa_gelang_p_10', true);
        $gelang_s_ho = $this->put('uprjpa_gelang_s_ho', true);
        $gelang_s_18 = $this->put('uprjpa_gelang_s_18', true);
        $gelang_m_ho = $this->put('uprjpa_gelang_m_ho', true);
        $gelang_m_23 = $this->put('uprjpa_gelang_m_23', true);
        $gelang_m_4  = $this->put('uprjpa_gelang_m_4', true);

        // Tempatkan pasien di kamar yang paling dekat dengan Nurse Station
        $station_p_ho = $this->put('uprjpa_station_p_ho', true);
        $station_p_10 = $this->put('uprjpa_station_p_10', true);
        $station_s_ho = $this->put('uprjpa_station_s_ho', true);
        $station_s_18 = $this->put('uprjpa_station_s_18', true);
        $station_m_ho = $this->put('uprjpa_station_m_ho', true);
        $station_m_23 = $this->put('uprjpa_station_m_23', true);
        $station_m_4  = $this->put('uprjpa_station_m_4', true);

        // Paraf
        $paraf_p_ho = $this->put('uprjpa_paraf_p_ho', true);
        $paraf_p_10 = $this->put('uprjpa_paraf_p_10', true);
        $paraf_s_ho = $this->put('uprjpa_paraf_s_ho', true);
        $paraf_s_18 = $this->put('uprjpa_paraf_s_18', true);
        $paraf_m_ho = $this->put('uprjpa_paraf_m_ho', true);
        $paraf_m_23 = $this->put('uprjpa_paraf_m_23', true);
        $paraf_m_4  = $this->put('uprjpa_paraf_m_4', true);

        $data = array(
            'id'                 => $this->put('id', true),
            'tanggal_pengkajian' => $tanggal_pengkajian,
            'id_perawat_p'       => $id_perawat_p !== '' ? $id_perawat_p : null,
            'id_perawat_s'       => $id_perawat_s !== '' ? $id_perawat_s : null,
            'id_perawat_m'       => $id_perawat_m !== '' ? $id_perawat_m : null,

            'bel_p_ho' => $bel_p_ho === 'on' ? 1 : 0,
            'bel_p_10' => $bel_p_10 === 'on' ? 1 : 0,
            'bel_s_ho' => $bel_s_ho === 'on' ? 1 : 0,
            'bel_s_18' => $bel_s_18 === 'on' ? 1 : 0,
            'bel_m_ho' => $bel_m_ho === 'on' ? 1 : 0,
            'bel_m_23' => $bel_m_23 === 'on' ? 1 : 0,
            'bel_m_4'  => $bel_m_4 === 'on' ? 1 : 0,

            'roda_p_ho' => $roda_p_ho === 'on' ? 1 : 0,
            'roda_p_10' => $roda_p_10 === 'on' ? 1 : 0,
            'roda_s_ho' => $roda_s_ho === 'on' ? 1 : 0,
            'roda_s_18' => $roda_s_18 === 'on' ? 1 : 0,
            'roda_m_ho' => $roda_m_ho === 'on' ? 1 : 0,
            'roda_m_23' => $roda_m_23 === 'on' ? 1 : 0,
            'roda_m_4'  => $roda_m_4 === 'on' ? 1 : 0,

            'ptt_p_ho' => $ptt_p_ho === 'on' ? 1 : 0,
            'ptt_p_10' => $ptt_p_10 === 'on' ? 1 : 0,
            'ptt_s_ho' => $ptt_s_ho === 'on' ? 1 : 0,
            'ptt_s_18' => $ptt_s_18 === 'on' ? 1 : 0,
            'ptt_m_ho' => $ptt_m_ho === 'on' ? 1 : 0,
            'ptt_m_23' => $ptt_m_23 === 'on' ? 1 : 0,
            'ptt_m_4'  => $ptt_m_4 === 'on' ? 1 : 0,

            'ppt_p_ho' => $ppt_p_ho === 'on' ? 1 : 0,
            'ppt_p_10' => $ppt_p_10 === 'on' ? 1 : 0,
            'ppt_s_ho' => $ppt_s_ho === 'on' ? 1 : 0,
            'ppt_s_18' => $ppt_s_18 === 'on' ? 1 : 0,
            'ppt_m_ho' => $ppt_m_ho === 'on' ? 1 : 0,
            'ppt_m_23' => $ppt_m_23 === 'on' ? 1 : 0,
            'ppt_m_4'  => $ppt_m_4 === 'on' ? 1 : 0,

            'penerangan_p_ho' => $penerangan_p_ho === 'on' ? 1 : 0,
            'penerangan_p_10' => $penerangan_p_10 === 'on' ? 1 : 0,
            'penerangan_s_ho' => $penerangan_s_ho === 'on' ? 1 : 0,
            'penerangan_s_18' => $penerangan_s_18 === 'on' ? 1 : 0,
            'penerangan_m_ho' => $penerangan_m_ho === 'on' ? 1 : 0,
            'penerangan_m_23' => $penerangan_m_23 === 'on' ? 1 : 0,
            'penerangan_m_4'  => $penerangan_m_4 === 'on' ? 1 : 0,

            'alas_p_ho' => $alas_p_ho === 'on' ? 1 : 0,
            'alas_p_10' => $alas_p_10 === 'on' ? 1 : 0,
            'alas_s_ho' => $alas_s_ho === 'on' ? 1 : 0,
            'alas_s_18' => $alas_s_18 === 'on' ? 1 : 0,
            'alas_m_ho' => $alas_m_ho === 'on' ? 1 : 0,
            'alas_m_23' => $alas_m_23 === 'on' ? 1 : 0,
            'alas_m_4'  => $alas_m_4 === 'on' ? 1 : 0,

            'lantai_p_ho' => $lantai_p_ho === 'on' ? 1 : 0,
            'lantai_p_10' => $lantai_p_10 === 'on' ? 1 : 0,
            'lantai_s_ho' => $lantai_s_ho === 'on' ? 1 : 0,
            'lantai_s_18' => $lantai_s_18 === 'on' ? 1 : 0,
            'lantai_m_ho' => $lantai_m_ho === 'on' ? 1 : 0,
            'lantai_m_23' => $lantai_m_23 === 'on' ? 1 : 0,
            'lantai_m_4'  => $lantai_m_4 === 'on' ? 1 : 0,

            'alat_p_ho' => $alat_p_ho === 'on' ? 1 : 0,
            'alat_p_10' => $alat_p_10 === 'on' ? 1 : 0,
            'alat_s_ho' => $alat_s_ho === 'on' ? 1 : 0,
            'alat_s_18' => $alat_s_18 === 'on' ? 1 : 0,
            'alat_m_ho' => $alat_m_ho === 'on' ? 1 : 0,
            'alat_m_23' => $alat_m_23 === 'on' ? 1 : 0,
            'alat_m_4'  => $alat_m_4 === 'on' ? 1 : 0,

            'edukasi_p_ho' => $edukasi_p_ho === 'on' ? 1 : 0,
            'edukasi_p_10' => $edukasi_p_10 === 'on' ? 1 : 0,
            'edukasi_s_ho' => $edukasi_s_ho === 'on' ? 1 : 0,
            'edukasi_s_18' => $edukasi_s_18 === 'on' ? 1 : 0,
            'edukasi_m_ho' => $edukasi_m_ho === 'on' ? 1 : 0,
            'edukasi_m_23' => $edukasi_m_23 === 'on' ? 1 : 0,
            'edukasi_m_4'  => $edukasi_m_4 === 'on' ? 1 : 0,

            'commode_p_ho' => $commode_p_ho === 'on' ? 1 : 0,
            'commode_p_10' => $commode_p_10 === 'on' ? 1 : 0,
            'commode_s_ho' => $commode_s_ho === 'on' ? 1 : 0,
            'commode_s_18' => $commode_s_18 === 'on' ? 1 : 0,
            'commode_m_ho' => $commode_m_ho === 'on' ? 1 : 0,
            'commode_m_23' => $commode_m_23 === 'on' ? 1 : 0,
            'commode_m_4'  => $commode_m_4 === 'on' ? 1 : 0,

            'gelang_p_ho' => $gelang_p_ho === 'on' ? 1 : 0,
            'gelang_p_10' => $gelang_p_10 === 'on' ? 1 : 0,
            'gelang_s_ho' => $gelang_s_ho === 'on' ? 1 : 0,
            'gelang_s_18' => $gelang_s_18 === 'on' ? 1 : 0,
            'gelang_m_ho' => $gelang_m_ho === 'on' ? 1 : 0,
            'gelang_m_23' => $gelang_m_23 === 'on' ? 1 : 0,
            'gelang_m_4'  => $gelang_m_4 === 'on' ? 1 : 0,

            'station_p_ho' => $station_p_ho === 'on' ? 1 : 0,
            'station_p_10' => $station_p_10 === 'on' ? 1 : 0,
            'station_s_ho' => $station_s_ho === 'on' ? 1 : 0,
            'station_s_18' => $station_s_18 === 'on' ? 1 : 0,
            'station_m_ho' => $station_m_ho === 'on' ? 1 : 0,
            'station_m_23' => $station_m_23 === 'on' ? 1 : 0,
            'station_m_4'  => $station_m_4 === 'on' ? 1 : 0,

            'paraf_p_ho' => $paraf_p_ho === 'on' ? 1 : 0,
            'paraf_p_10' => $paraf_p_10 === 'on' ? 1 : 0,
            'paraf_s_ho' => $paraf_s_ho === 'on' ? 1 : 0,
            'paraf_s_18' => $paraf_s_18 === 'on' ? 1 : 0,
            'paraf_m_ho' => $paraf_m_ho === 'on' ? 1 : 0,
            'paraf_m_23' => $paraf_m_23 === 'on' ? 1 : 0,
            'paraf_m_4'  => $paraf_m_4 === 'on' ? 1 : 0,

            'updated_at' => date('Y-m-d H:i:s', time()),
        );

        $status = $this->m_pelayanan->editUpayaPencegahanRisikoJatuhPasienAnak($data);
        $this->response(array('status' => $status), REST_Controller::HTTP_OK);
    }

    function hapus_upaya_pencegahan_risiko_jatuh_pasien_anak_delete($id)
    {
        $status = $this->m_pelayanan->deleteUpayaPencegahanRisikoJatuhPasienAnak($id);
        if ($status) :
            $response = array('status' => $status, 'message' => 'Berhasil menghapus Upaya Pencegahan Risiko Jatuh Pasien anak!');
        else :
            $response = array('status' => $status, 'message' => 'Gagal menghapus Upaya Pencegahan Risiko Jatuh Pasien anak!');
        endif;
        $this->response($response, REST_Controller::HTTP_OK);
    }









    function get_surgical_safety_ceklis_get()
    {
        if (!$this->get('id', true)) :
            $this->response(null, REST_Controller::HTTP_BAD_REQUEST);
        endif;

        $data = $this->m_pelayanan->getSurgicalSafetyCeklisByID($this->get('id', true));
        $this->response($data, REST_Controller::HTTP_OK);
    }

    function update_surgical_safety_ceklis_put()
    {
        if (!$this->put('id', true)) :
            $this->response(array('status' => false), REST_Controller::HTTP_OK);
        endif;

        $ssc_tanggal_sign_in = $this->put('ssc_tanggal_sign_in', true);
        if ($ssc_tanggal_sign_in !== '') {
            $ssc_tanggal_sign_in = str_replace('/', '-', $ssc_tanggal_sign_in);
            $ssc_tanggal_sign_in = date('Y-m-d H:i', strtotime($ssc_tanggal_sign_in));
        }

        $ssc_tanggal_time_out = $this->put('ssc_tanggal_time_out', true);
        if ($ssc_tanggal_time_out !== '') {
            $ssc_tanggal_time_out = str_replace('/', '-', $ssc_tanggal_time_out);
            $ssc_tanggal_time_out = date('Y-m-d H:i', strtotime($ssc_tanggal_time_out));
        }

        $ssc_tanggal_sign_out = $this->put('ssc_tanggal_sign_out', true);
        if ($ssc_tanggal_sign_out !== '') {
            $ssc_tanggal_sign_out = str_replace('/', '-', $ssc_tanggal_sign_out);
            $ssc_tanggal_sign_out = date('Y-m-d H:i', strtotime($ssc_tanggal_sign_out));
        }

        $ssc_tanggal_obat = $this->put('ssc_tanggal_obat', true);
        if ($ssc_tanggal_obat !== '') {
            $ssc_tanggal_obat = str_replace('/', '-', $ssc_tanggal_obat);
            $ssc_tanggal_obat = date('Y-m-d H:i', strtotime($ssc_tanggal_obat));
        }
        // $ssc_antibiotik_obat = $this->put('ssc_antibiotik_obat', true);
        // var_dump($ssc_antibiotik_obat);
        // die();


        $dataUpdateSurgicalSafetyCeklis = array(
            'user_surgical_safety_ceklis'           => $this->put('user_surgical_safety_ceklis', true),
            'id'                                    => $this->put('id', true),
            'ssc_tanggal_sign_in'                   => $ssc_tanggal_sign_in !== '' ? $ssc_tanggal_sign_in : null,
            'ssc_tanggal_time_out'                  => $ssc_tanggal_time_out !== '' ? $ssc_tanggal_time_out : null,
            'ssc_tanggal_sign_out'                  => $ssc_tanggal_sign_out !== '' ? $ssc_tanggal_sign_out : null,
            'ssc_tanggal_obat'                      => $ssc_tanggal_obat !== '' ? $ssc_tanggal_obat : null,
            'updated_at'                            => date('Y-m-d H:i:s'),

            // kiri nama untuk model dan database. contoh :     'ssc_gelang' 
            // kanan nama dari view. contoh :   => $this->put('ssc_gelang', true) !== null ? $this->put('ssc_gelang', true) : 0,

            // sign in
            'ssc_gelang'                            => $this->put('ssc_gelang', true) !== null ? $this->put('ssc_gelang', true) : 0,
            'ssc_informed'                          => $this->put('ssc_informed', true) !== null ? $this->put('ssc_informed', true) : 0,
            'ssc_dokter_bedah'                      => $this->put('ssc_dokter_bedah', true) !== null ? $this->put('ssc_dokter_bedah', true) : 0,
            'ssc_anestesi'                          => $this->put('ssc_anestesi', true) !== null ? $this->put('ssc_anestesi', true) : 0,
            'ssc_dokter_operator'                   => $this->put('ssc_dokter_operator', true) !== '' ? $this->put('ssc_dokter_operator', true) : null,
            'ssc_dokter_anestesi'                   => $this->put('ssc_dokter_anestesi', true) !== '' ? $this->put('ssc_dokter_anestesi', true) : null,
            'ssc_nama_tindakan'                     => $this->put('ssc_nama_tindakan', true),
            'ssc_lokasi'                            => $this->put('ssc_lokasi', true) !== null ? $this->put('ssc_lokasi', true) : null,
            'ssc_mesin_anestesi'                    => $this->put('ssc_mesin_anestesi', true) !== null ? $this->put('ssc_mesin_anestesi', true) : 0,
            'ssc_obat'                              => $this->put('ssc_obat', true) !== null ? $this->put('ssc_obat', true) : 0,
            'ssc_oximeter'                          => $this->put('ssc_oximeter', true) !== null ? $this->put('ssc_oximeter', true) : 0,
            'ssc_lab'                               => $this->put('ssc_lab', true) !== null ? $this->put('ssc_lab', true) : 0,
            'ssc_line'                              => $this->put('ssc_line', true) !== null ? $this->put('ssc_line', true) : 0,
            'ssc_tekanan_darah'                     => $this->put('ssc_tekanan_darah', true),
            'ssc_nadi'                              => $this->put('ssc_nadi', true),
            'ssc_pernafasan'                        => $this->put('ssc_pernafasan', true),
            'ssc_saturasi'                          => $this->put('ssc_saturasi', true),
            'ssc_suhu'                              => $this->put('ssc_suhu', true),
            'ssc_alergi'                            => $this->put('ssc_alergi', true) !== null ? $this->put('ssc_alergi', true) : null,
            'ssc_alergi_ket'                        => $this->put('ssc_alergi_ket', true),
            'ssc_aspirasi'                          => $this->put('ssc_aspirasi', true) !== null ? $this->put('ssc_aspirasi', true) : null,
            'ssc_pendarahan'                        => $this->put('ssc_pendarahan', true) !== null ? $this->put('ssc_pendarahan', true) : null,
            'ssc_rencana_anestesi'                  => $this->put('ssc_rencana_anestesi', true) !== null ? $this->put('ssc_rencana_anestesi', true) : null,
            'ssc_paraf_perawat_sign_in'             => $this->put('ssc_paraf_perawat_sign_in', true) !== null ? $this->put('ssc_paraf_perawat_sign_in', true) : 0,
            'ssc_perawat_sign_in'                   => $this->put('ssc_perawat_sign_in', true) !== '' ? $this->put('ssc_perawat_sign_in', true) : null,
            'ssc_paraf_dokter_anestesi_sign_in'     => $this->put('ssc_paraf_dokter_anestesi_sign_in', true) !== null ? $this->put('ssc_paraf_dokter_anestesi_sign_in', true) : 0,
            'ssc_dokter_anestesi_sign_in'           => $this->put('ssc_dokter_anestesi_sign_in', true) !== '' ? $this->put('ssc_dokter_anestesi_sign_in', true) : null,

            // time out
            'ssc_lengkap'                           => $this->put('ssc_lengkap', true) !== null ? $this->put('ssc_lengkap', true) : null,
            'ssc_alasan'                            => $this->put('ssc_alasan', true),
            'ssc_instrument'                        => $this->put('ssc_instrument', true) !== null ? $this->put('ssc_instrument', true) : 0,
            'ssc_kassa'                             => $this->put('ssc_kassa', true) !== null ? $this->put('ssc_kassa', true) : 0,
            'ssc_jarum'                             => $this->put('ssc_jarum', true) !== null ? $this->put('ssc_jarum', true) : 0,
            'ssc_tanggal_tindakan'                  => $this->put('ssc_tanggal_tindakan', true) !== null ? $this->put('ssc_tanggal_tindakan', true) : 0,
            'ssc_identitas_pasien'                  => $this->put('ssc_identitas_pasien', true) !== null ? $this->put('ssc_identitas_pasien', true) : 0,
            'ssc_nama_tindakan_time_out'            => $this->put('ssc_nama_tindakan_time_out', true) !== null ? $this->put('ssc_nama_tindakan_time_out', true) : 0,
            'ssc_prosedur_tindakan'                 => $this->put('ssc_prosedur_tindakan', true) !== null ? $this->put('ssc_prosedur_tindakan', true) : 0,
            'ssc_lokasi_tindakan'                   => $this->put('ssc_lokasi_tindakan', true) !== null ? $this->put('ssc_lokasi_tindakan', true) : 0,
            'ssc_consent'                           => $this->put('ssc_consent', true) !== null ? $this->put('ssc_consent', true) : 0,
            'ssc_premedikasi'                       => $this->put('ssc_premedikasi', true) !== null ? $this->put('ssc_premedikasi', true) : null,
            'ssc_premedikasi_obat'                  => $this->put('ssc_premedikasi_obat', true) !== '' ? $this->put('ssc_premedikasi_obat', true) : null,
            'ssc_antibiotik'                        => $this->put('ssc_antibiotik', true) !== null ? $this->put('ssc_antibiotik', true) : null,
            'ssc_antibiotik_obat'                   => $this->put('ssc_antibiotik_obat', true) !== '' ? $this->put('ssc_antibiotik_obat', true) : null,
            'ssc_antibiotik_dosis'                  => $this->put('ssc_antibiotik_dosis', true),
            'ssc_jam_antibiotik_obat'               => $this->put('ssc_jam_antibiotik_obat', true) !== '' ? $this->put('ssc_jam_antibiotik_obat', true) : null,
            'ssc_foto'                              => $this->put('ssc_foto', true) !== null ? $this->put('ssc_foto', true) : null,
            'ssc_implant'                           => $this->put('ssc_implant', true) !== null ? $this->put('ssc_implant', true) : null,
            'ssc_jenis'                             => $this->put('ssc_jenis', true) !== null ? $this->put('ssc_jenis', true) : null,
            'ssc_jenis_ket'                         => $this->put('ssc_jenis_ket', true),
            'ssc_paraf_perawat_time_out'            => $this->put('ssc_paraf_perawat_time_out', true) !== null ? $this->put('ssc_paraf_perawat_time_out', true) : 0,
            'ssc_perawat_time_out'                  => $this->put('ssc_perawat_time_out', true) !== '' ? $this->put('ssc_perawat_time_out', true) : null,
            'ssc_paraf_dokter_anestesi_time_out'    => $this->put('ssc_paraf_dokter_anestesi_time_out', true) !== null ? $this->put('ssc_paraf_dokter_anestesi_time_out', true) : 0,
            'ssc_dokter_anestesi_time_out'          => $this->put('ssc_dokter_anestesi_time_out', true) !== '' ? $this->put('ssc_dokter_anestesi_time_out', true) : null,

            // sign out
            'ssc_nama_tindakan_sign_out'            => $this->put('ssc_nama_tindakan_sign_out', true) !== null ? $this->put('ssc_nama_tindakan_sign_out', true) : 0,
            'ssc_instrument_sign_out'               => $this->put('ssc_instrument_sign_out', true) !== null ? $this->put('ssc_instrument_sign_out', true) : 0,
            'ssc_kassa_sign_out'                    => $this->put('ssc_kassa_sign_out', true) !== null ? $this->put('ssc_kassa_sign_out', true) : 0,
            'ssc_jarum_sign_out'                    => $this->put('ssc_jarum_sign_out', true) !== null ? $this->put('ssc_jarum_sign_out', true) : 0,
            'ssc_preparat'                          => $this->put('ssc_preparat', true) !== null ? $this->put('ssc_preparat', true) : null,
            'ssc_preparat_pa'                       => $this->put('ssc_preparat_pa', true) !== null ? $this->put('ssc_preparat_pa', true) : 0,
            'ssc_preparat_kultur'                   => $this->put('ssc_preparat_kultur', true) !== null ? $this->put('ssc_preparat_kultur', true) : 0,
            'ssc_preparat_sitologi'                 => $this->put('ssc_preparat_sitologi', true) !== null ? $this->put('ssc_preparat_sitologi', true) : 0,
            'ssc_formulir_permintaan'               => $this->put('ssc_formulir_permintaan', true) !== null ? $this->put('ssc_formulir_permintaan', true) : null,
            'ssc_lengkap_pasien'                    => $this->put('ssc_lengkap_pasien', true) !== null ? $this->put('ssc_lengkap_pasien', true) : null,
            'ssc_penjelasan_keluarga'               => $this->put('ssc_penjelasan_keluarga', true) !== null ? $this->put('ssc_penjelasan_keluarga', true) : null,
            'ssc_penjelasan_keluarga_ket'           => $this->put('ssc_penjelasan_keluarga_ket', true),
            'ssc_obat_operasi'                      => $this->put('ssc_obat_operasi', true) !== null ? $this->put('ssc_obat_operasi', true) : null,
            'ssc_obat_operasi_ya_alasan'            => $this->put('ssc_obat_operasi_ya_alasan', true),
            'ssc_obat_operasi_tidak_alasan'         => $this->put('ssc_obat_operasi_tidak_alasan', true),
            'ssc_kesadaran_sign_out'                => $this->put('ssc_kesadaran_sign_out', true),
            'ssc_tekanan_darah_sign_out'            => $this->put('ssc_tekanan_darah_sign_out', true),
            'ssc_nadi_sign_out'                     => $this->put('ssc_nadi_sign_out', true),
            'ssc_pernafasan_sign_out'               => $this->put('ssc_pernafasan_sign_out', true),
            'ssc_saturasi_sign_out'                 => $this->put('ssc_saturasi_sign_out', true),
            'ssc_suhu_sign_out'                     => $this->put('ssc_suhu_sign_out', true),
            'ssc_skala_nyeri_sign_out'              => $this->put('ssc_skala_nyeri_sign_out', true),
            'ssc_rembesan'                          => $this->put('ssc_rembesan', true) !== null ? $this->put('ssc_rembesan', true) : null,
            'ssc_paraf_perawat_sign_out'            => $this->put('ssc_paraf_perawat_sign_out', true) !== null ? $this->put('ssc_paraf_perawat_sign_out', true) : 0,
            'ssc_perawat_sign_out'                  => $this->put('ssc_perawat_sign_out', true) !== '' ? $this->put('ssc_perawat_sign_out', true) : null,
            'ssc_paraf_dokter_anestesi_sign_out'    => $this->put('ssc_paraf_dokter_anestesi_sign_out', true) !== null ? $this->put('ssc_paraf_dokter_anestesi_sign_out', true) : 0,
            'ssc_dokter_anestesi_sign_out'          => $this->put('ssc_dokter_anestesi_sign_out', true) !== '' ? $this->put('ssc_dokter_anestesi_sign_out', true) : null,

        );
        // untuk cek data yang di kirim
        // var_dump($dataUpdateSurgicalSafetyCeklis);
        // die();

        $status = $this->m_pelayanan->simpanUpdateSurgicalSafetyCeklis($dataUpdateSurgicalSafetyCeklis);
        $this->response(array('status' => $status), REST_Controller::HTTP_OK);
    }



















   





















    function hapus_surgical_safety_ceklis_delete($id)
    {
        $status = $this->m_pelayanan->deleteSurgicalSafetyCeklis($id);
        if ($status) :
            $response = array('status' => $status, 'message' => 'Berhasil menghapus Surgical Safety Ceklis!');
        else :
            $response = array('status' => $status, 'message' => 'Gagal menghapus Surgical Safety Ceklis!');
        endif;
        $this->response($response, REST_Controller::HTTP_OK);
    }

    function get_pengkajian_ulang_resiko_jatuh_pasien_anak_get()
    {
        if (!$this->get('id', true)) :
            $this->response(null, REST_Controller::HTTP_BAD_REQUEST);
        endif;

        $data = $this->m_pelayanan->getPengkajianUlangResikoJatuhPasienAnakByID($this->get('id', true));
        $this->response($data, REST_Controller::HTTP_OK);
    }

 

  



   










    function update_pengkajian_ulang_resiko_jatuh_pasien_anak_put()
    {
        if (!$this->put('id', true)) :
            $this->response(array('status' => false), REST_Controller::HTTP_OK);
        endif;

        $tanggal_pengkajian = $this->put('purja_tanggal_pengkajian', true);
        $tanggal_pengkajian = str_replace('/', '-', $tanggal_pengkajian);

        $tanggal_pengkajian = date('Y-m-d', strtotime($tanggal_pengkajian));
        $jumlah_skor        = $this->put('purjpa_jumlah_skor', true);
        $paraf              = $this->put('purjpa_paraf', true) ? 1 : 0;
        $perawat            = $this->put('purjpa_perawat', true);
        $umur               = $this->put('purjpa_umur', true);
        $jenis_kelamin      = $this->put('purjpa_jenis_kelamin', true);
        $diagnosis          = $this->put('purjpa_diagnosis', true);
        $gangguan_kognitif  = $this->put('purjpa_gangguan_kognitif', true);
        $faktor_lingkungan  = $this->put('purjpa_faktor_lingkungan', true);
        $respon_pembedahan  = $this->put('purjpa_respon_pembedahan', true);
        $penggunaan_obat    = $this->put('purjpa_penggunaan_obat', true);


        $data = array(
            'id'                         => $this->put('id', true),
            'tanggal_pengkajian'         => $tanggal_pengkajian,
            'jumlah_skor'                => $jumlah_skor,
            'paraf'                      => $paraf,
            'perawat'                    => $perawat,
            'umur'                       => $umur,
            'jenis_kelamin'              => $jenis_kelamin,
            'diagnosis'                  => $diagnosis,
            'gangguan_kognitif'          => $gangguan_kognitif,
            'faktor_lingkungan'          => $faktor_lingkungan,
            'respon_terhadap_pembedahan' => $respon_pembedahan,
            'penggunaan_obat_obatan'     => $penggunaan_obat,
            'updated_at'                 => date('Y-m-d H:i:s', time()),
        );

        $status = $this->m_pelayanan->editPengkajianResikoJatuhPasienAnak($data);
        $this->response(array('status' => $status), REST_Controller::HTTP_OK);
    }

 



























































 


    function hapus_bukti_visit_delete($id)
    {
        $status = $this->m_pelayanan->deleteBuktiVisitDokter($id);
        if ($status) :
            $response = array('status' => $status, 'message' => 'Berhasil menghapus Bukti Visit!');
        else :
            $response = array('status' => $status, 'message' => 'Gagal menghapus Bukti Visit!');
        endif;
        $this->response($response, REST_Controller::HTTP_OK);
    }



    // function hapus_catatan_operan_pagi_delete($id)
    // {
    //     $status = $this->m_pelayanan->deleteCatatanOperanPagi($id);
    //     if ($status) :
    //         $response = array('status' => $status, 'message' => 'Berhasil menghapus Bukti Visit!');
    //     else :
    //         $response = array('status' => $status, 'message' => 'Gagal menghapus Bukti Visit!');
    //     endif;
    //     $this->response($response, REST_Controller::HTTP_OK);
    // }

    // function hapus_catatan_operan_sore_delete($id)
    // {
    //     $status = $this->m_pelayanan->deleteCatatanOperanSore($id);
    //     if ($status) :
    //         $response = array('status' => $status, 'message' => 'Berhasil menghapus Bukti Visit!');
    //     else :
    //         $response = array('status' => $status, 'message' => 'Gagal menghapus Bukti Visit!');
    //     endif;
    //     $this->response($response, REST_Controller::HTTP_OK);
    // }

    // function hapus_catatan_operan_malam_delete($id)
    // {
    //     $status = $this->m_pelayanan->deleteCatatanOperanMalam($id);
    //     if ($status) :
    //         $response = array('status' => $status, 'message' => 'Berhasil menghapus Bukti Visit!');
    //     else :
    //         $response = array('status' => $status, 'message' => 'Gagal menghapus Bukti Visit!');
    //     endif;
    //     $this->response($response, REST_Controller::HTTP_OK);
    // }









    // // CTKN
    // function get_catatan_tindakan_keperawatan_nursenote_get(){
    //     if (!$this->get('id')) :
    //         $this->response(NULL, REST_Controller::HTTP_BAD_REQUEST); // (400)
    //     endif;
    //     $this->load->model('pendaftaran/Pendaftaran_model', 'm_pendaftaran');
    //     $data = $this->m_pendaftaran->getPendaftaranDetail($this->get('id', true), $this->get('id_layanan', true));
    //     $data['profil'] = $this->m_pelayanan->getProfilPasien($data['pasien']->id_pasien);      
    //     $data['catatan_tindakan_keperawatan_nursenote']  = $this->m_pelayanan->getCatatanTindakanRawat($this->get('id', true));
    //     if ($data) :
    //         $this->response($data, REST_Controller::HTTP_OK); // (200)
    //     endif;
    // }

    // // CTKN
    // function simpan_catatan_tindakan_keperawatan_nursenote_post(){
    
    //     $layanan = array('id' => safe_post('id_layanan_pendaftaran'));

    //     $ek_tanggal_catatan_tindakan = safe_post('ek_tanggal_catatan_tindakan');

    //     if ($ek_tanggal_catatan_tindakan) {

    //         $ek_tanggal_catatan_tindakan = safe_post('ek_tanggal_catatan_tindakan');

    //         $ek_tanggal_tindakan_satu = is_string($ek_tanggal_catatan_tindakan);

    //         if ($ek_tanggal_catatan_tindakan === "" || $ek_tanggal_catatan_tindakan === null) {

    //             $tanggal_catatan_tindakan = null;
    //         } else if (!is_array($ek_tanggal_catatan_tindakan)) {


    //             $tanggal_catatan_tindakan = null;
    //         } else if (empty($ek_tanggal_catatan_tindakan)) {


    //             $tanggal_catatan_tindakan = null;
    //         } else if ($ek_tanggal_tindakan_satu === true) {


    //             $tanggal_catatan_tindakan = null;
    //         } else {

    //             foreach ($ek_tanggal_catatan_tindakan as $key => $value) {

    //                 $date = new DateTime($value);
    //                 $new = $date->format('Y-m-d');


    //                 $tanggal_catatan_tindakan[$key] = $new;
    //             }
    //         }

    //         $ek_catatan_tindakan_keperawatan = safe_post('ek_catatan_tindakan_keperawatan');
    //         $ek_catatan_tindakan_keperawatan_filter = is_string($ek_catatan_tindakan_keperawatan);
    //         if ($ek_catatan_tindakan_keperawatan === "" || $ek_catatan_tindakan_keperawatan === null) {
    //             $catatan_tindakan_keperawatan = NULL;
    //         } else if (!is_array($ek_catatan_tindakan_keperawatan)) {
    //             $catatan_tindakan_keperawatan = NULL;
    //         } else if (empty($ek_catatan_tindakan_keperawatan)) {
    //             $catatan_tindakan_keperawatan = NULL;
    //         } else if ($ek_catatan_tindakan_keperawatan_filter === true) {
    //             $catatan_tindakan_keperawatan = NULL;
    //         } else {
    //             foreach ($ek_catatan_tindakan_keperawatan as $key => $value) {
    //                 $catatan_tindakan_keperawatan[$key] = $value;
    //             }
    //         }

    //         $ek_catatan_tindakan_keperawatan_manual = safe_post('ek_catatan_tindakan_keperawatan_manual');
    //         $ek_catatan_tindakan_keperawatan_manual_filter = is_string($ek_catatan_tindakan_keperawatan_manual);
    //         if ($ek_catatan_tindakan_keperawatan_manual === "" || $ek_catatan_tindakan_keperawatan_manual === null) {
    //             $catatan_tindakan_keperawatan_manual = NULL;
    //         } else if (!is_array($ek_catatan_tindakan_keperawatan_manual)) {
    //             $catatan_tindakan_keperawatan_manual = NULL;
    //         } else if (empty($ek_catatan_tindakan_keperawatan_manual)) {
    //             $catatan_tindakan_keperawatan_manual = NULL;
    //         } else if ($ek_catatan_tindakan_keperawatan_manual_filter === true) {
    //             $catatan_tindakan_keperawatan_manual = NULL;
    //         } else {
    //             foreach ($ek_catatan_tindakan_keperawatan_manual as $key => $value) {
    //                 $catatan_tindakan_keperawatan_manual[$key] = $value;
    //             }
    //         }

    //         $tanggal_catatan_tindakan_dibuat = safe_post('tanggal_catatan_tindakan_dibuat');
    //         $ek_tanggal_catatan_tindakan_dibuat = is_string($tanggal_catatan_tindakan_dibuat);

    //         if ($tanggal_catatan_tindakan_dibuat === "" || $tanggal_catatan_tindakan_dibuat === null) {

    //             $tanggal_tindakan = null;
    //         } else if (!is_array($tanggal_catatan_tindakan_dibuat)) {


    //             $tanggal_tindakan = null;
    //         } else if (empty($tanggal_catatan_tindakan_dibuat)) {


    //             $tanggal_tindakan = null;
    //         } else if ($ek_tanggal_catatan_tindakan_dibuat === true) {


    //             $tanggal_tindakan = null;
    //         } else {

    //             foreach ($tanggal_catatan_tindakan_dibuat as $key => $value) {

    //                 $date = new DateTime($value);
    //                 $new = $date->format('Y-m-d H:i:s');


    //                 $tanggal_tindakan[$key] = $new;
    //             }
    //         }

    //         //PAGI
    //         $ek_jam_pagi = safe_post('ek_jam_pagi');
    //         $catatan_jam_pagi = [];
    //         foreach ($ek_jam_pagi as $key => $value) {
    //             if (empty($value)) {
    //                 $catatan_jam_pagi[] = NULL;
    //                 continue;
    //             }
    //             $date = new DateTime($value);
    //             $new = $date->format('H:i:s');
    //             $catatan_jam_pagi[$key] = $new;
    //         }

    //         //SORE
    //         $ek_jam_sore = safe_post('ek_jam_sore');
    //         $catatan_jam_sore = [];
    //         foreach ($ek_jam_sore as $key => $value) {
    //             if (empty($value)) {
    //                 $catatan_jam_sore[] = NULL;
    //                 continue;
    //             }
    //             $date = new DateTime($value);
    //             $new = $date->format('H:i:s');
    //             $catatan_jam_sore[$key] = $new;
    //         }

    //         //MALAM
    //         $ek_jam_malam = safe_post('ek_jam_malam');
    //         $catatan_jam_malam = [];
    //         foreach ($ek_jam_malam as $key => $value) {
    //             if (empty($value)) {
    //                 $catatan_jam_malam[] = NULL;
    //                 continue;
    //             }
    //             $date = new DateTime($value);
    //             $new = $date->format('H:i:s');
    //             $catatan_jam_malam[$key] = $new;
    //         }


    //         $catatan_tindakan_keperawatan = array(
    //             'id_layanan_pendaftaran'                    => $layanan['id'],
    //             'ek_catatan_tindakan_keperawatan'           => $catatan_tindakan_keperawatan,
    //             'ek_catatan_tindakan_keperawatan_manual'    => $catatan_tindakan_keperawatan_manual,
    //             'ek_keterangan_catatan'                     => safe_post('ek_keterangan_catatan') !== '' ? safe_post('ek_keterangan_catatan') : NULL,
    //             'ek_tanggal_catatan_tindakan'               => $tanggal_catatan_tindakan,
    //             'ek_bismillah_pagi'                         => safe_post('ek_bismillah_pagi') !== '' ? safe_post('ek_bismillah_pagi') : NULL,
    //             'ek_cek_pagi'                               => safe_post('ek_cek_pagi') !== '' ? safe_post('ek_cek_pagi') : NULL,
    //             'ek_jam_pagi'                               => $catatan_jam_pagi,
    //             'ek_paraf_pagi'                             => safe_post('ek_paraf_pagi') !== '' ? safe_post('ek_paraf_pagi') : NULL,
    //             'ek_perawat_tindakan_pagi'                  => safe_post('ek_perawat_tindakan_pagi') !== '' ? safe_post('ek_perawat_tindakan_pagi') : NULL,
    //             'ek_hamdalah_pagi'                          => safe_post('ek_hamdalah_pagi') !== '' ? safe_post('ek_hamdalah_pagi') : NULL,
    //             'ek_bismillah_sore'                         => safe_post('ek_bismillah_sore') !== '' ? safe_post('ek_bismillah_sore') : NULL,
    //             'ek_cek_sore'                               => safe_post('ek_cek_sore') !== '' ? safe_post('ek_cek_sore') : NULL,
    //             'ek_jam_sore'                               => $catatan_jam_sore,
    //             'ek_paraf_sore'                             => safe_post('ek_paraf_sore') !== '' ? safe_post('ek_paraf_sore') : NULL,
    //             'ek_perawat_tindakan_sore'                  => safe_post('ek_perawat_tindakan_sore') !== '' ? safe_post('ek_perawat_tindakan_sore') : NULL,
    //             'ek_hamdalah_sore'                          => safe_post('ek_hamdalah_sore') !== '' ? safe_post('ek_hamdalah_sore') : NULL,
    //             'ek_bismillah_malam'                        => safe_post('ek_bismillah_malam') !== '' ? safe_post('ek_bismillah_malam') : NULL,
    //             'ek_cek_malam'                              => safe_post('ek_cek_malam') !== '' ? safe_post('ek_cek_malam') : NULL,
    //             'ek_jam_malam'                              => $catatan_jam_malam,
    //             'ek_perawat_tindakan_malam'                 => safe_post('ek_perawat_tindakan_malam') !== '' ? safe_post('ek_perawat_tindakan_malam') : NULL,
    //             'ek_hamdalah_malam'                         => safe_post('ek_hamdalah_malam') !== '' ? safe_post('ek_hamdalah_malam') : NULL,
    //             'ek_paraf_malam'                            => safe_post('ek_paraf_malam') !== '' ? safe_post('ek_paraf_malam') : NULL,
    //             'ek_operator_catatan_tindakan'              => safe_post('ek_operator_catatan_tindakan') !== '' ? safe_post('ek_operator_catatan_tindakan') : NULL,
    //             'created_date'                              => $tanggal_tindakan,
    //         );

    //         $this->m_pelayanan->updateCatatanTindakanKeperawatan($catatan_tindakan_keperawatan, false);
    //     } else {

    //         $keg_tindakan_keperawatan = safe_post('keg_tindakan_keperawatan');

    //         if (!empty($keg_tindakan_keperawatan)) {

    //             $respon = ['show' => '2', 'status' => false, 'message' => 'Kegiatan Tindakan Keperawatan Belum ditambahkan', 'id' => '#nurse-note'];
    //         }
    //     }

    //     if (!empty($respon)) {

    //         $response = $respon;
    //     } else {

    //         $response = null;
    //     }

    
    //     if ($this->db->trans_status() === false) :
    //         $this->db->trans_rollback();
    //         $status = false;
    //     else :
    //         $this->db->trans_commit();
    //         $status = true;
    //     endif;

    //     $message = array(
    //         'status' => $status,
    //         'token'  => $this->security->get_csrf_hash(),
    //         'id'     => $layanan['id'],
    //         'respon' => $response,
    //     );

    //     $this->response($message, REST_Controller::HTTP_OK);
    // }

    // // CTKN tdk ada perubahan
    // function update_catatan_tindakan_keperawatan_put(){
    //     if (!$this->put('id', true)) :
    //         $this->response(array('status' => false), REST_Controller::HTTP_OK);
    //     endif;

    //     $ek_jam_pagi = $this->put('ek_jam_pagi', true);

    //     if ($ek_jam_pagi === "" || $ek_jam_pagi === null) {

    //         $catatan_pagi = null;
    //     } else if (empty($ek_jam_pagi)) {


    //         $catatan_pagi = null;
    //     } else {

    //         $date = new DateTime($ek_jam_pagi);
    //         $new = $date->format('H:i:s');
    //         $catatan_pagi = $new;
    //     }

    //     $ek_jam_sore = $this->put('ek_jam_sore', true);

    //     if ($ek_jam_sore === "" || $ek_jam_sore === null) {

    //         $catatan_sore = null;
    //     } else if (empty($ek_jam_sore)) {


    //         $catatan_sore = null;
    //     } else {

    //         $date = new DateTime($ek_jam_sore);
    //         $new = $date->format('H:i:s');
    //         $catatan_sore = $new;
    //     }

    //     $ek_jam_malam = $this->put('ek_jam_malam', true);

    //     if ($ek_jam_malam === "" || $ek_jam_malam === null) {

    //         $catatan_malam = null;
    //     } else if (empty($ek_jam_malam)) {


    //         $catatan_malam = null;
    //     } else {

    //         $date = new DateTime($ek_jam_malam);
    //         $new = $date->format('H:i:s');
    //         $catatan_malam = $new;
    //     }


    //     $ek_tanggal_catatan_tindakan = $this->put('ek_tanggal_catatan_tindakan');

    //     if ($ek_tanggal_catatan_tindakan === "" || $ek_tanggal_catatan_tindakan === null) {

    //         $tanggal_tindakan = null;
    //     } else if (empty($ek_tanggal_catatan_tindakan)) {


    //         $tanggal_tindakan = null;
    //     } else {

    //         $varctind = explode("/", $ek_tanggal_catatan_tindakan);
    //         $var_tindakan = "$varctind[2]-$varctind[1]-$varctind[0]";

    //         $date = new DateTime($var_tindakan);
    //         $new = $date->format('Y-m-d');

    //         $tanggal_tindakan = $new;
    //     }

    //     $created_tanggal_catatan_tindakan = $this->put('updated_date');

    //     if ($created_tanggal_catatan_tindakan === "" || $created_tanggal_catatan_tindakan === null) {

    //         $tanggal_tindakan_created = null;
    //     } else if (empty($created_tanggal_catatan_tindakan)) {


    //         $tanggal_tindakan_created = null;
    //     } else {

    //         $date = new DateTime($created_tanggal_catatan_tindakan);
    //         $new = $date->format('Y-m-d H:i:s');

    //         $tanggal_tindakan_created = $new;
    //     }

    //     $ek_edit_bismillah_pagi = $this->put('ek_bismillah_pagi', true);

    //     if ($ek_edit_bismillah_pagi !== NULL) {

    //         $bismillah_pagi = 1;
    //     } else {

    //         $bismillah_pagi = 0;
    //     }

    //     $ek_edit_cek_pagi = $this->put('ek_cek_pagi', true);

    //     if ($ek_edit_cek_pagi !== NULL) {

    //         $cek_pagi = 1;
    //     } else {

    //         $cek_pagi = 0;
    //     }

    //     $ek_edit_paraf_pagi = $this->put('ek_paraf_pagi', true);

    //     if ($ek_edit_paraf_pagi !== NULL) {

    //         $paraf_pagi = 1;
    //     } else {

    //         $paraf_pagi = 0;
    //     }

    //     $ek_edit_hamdalah_pagi = $this->put('ek_hamdalah_pagi', true);

    //     if ($ek_edit_hamdalah_pagi !== NULL) {

    //         $hamdalah_pagi = 1;
    //     } else {

    //         $hamdalah_pagi = 0;
    //     }

    //     $ek_edit_bismillah_sore = $this->put('ek_bismillah_sore', true);

    //     if ($ek_edit_bismillah_sore !== NULL) {

    //         $bismillah_sore = 1;
    //     } else {

    //         $bismillah_sore = 0;
    //     }

    //     $ek_edit_cek_sore = $this->put('ek_cek_sore', true);

    //     if ($ek_edit_cek_sore !== NULL) {

    //         $cek_sore = 1;
    //     } else {

    //         $cek_sore = 0;
    //     }

    //     $ek_edit_paraf_sore = $this->put('ek_paraf_sore', true);

    //     if ($ek_edit_paraf_sore !== NULL) {

    //         $paraf_sore = 1;
    //     } else {

    //         $paraf_sore = 0;
    //     }

    //     $ek_edit_hamdalah_sore = $this->put('ek_hamdalah_sore', true);

    //     if ($ek_edit_hamdalah_sore !== NULL) {

    //         $hamdalah_sore = 1;
    //     } else {

    //         $hamdalah_sore = 0;
    //     }

    //     $ek_edit_bismillah_malam = $this->put('ek_bismillah_malam', true);

    //     if ($ek_edit_bismillah_malam !== NULL) {

    //         $bismillah_malam = 1;
    //     } else {

    //         $bismillah_malam = 0;
    //     }

    //     $ek_edit_cek_malam = $this->put('ek_cek_malam', true);

    //     if ($ek_edit_cek_malam !== NULL) {

    //         $cek_malam = 1;
    //     } else {

    //         $cek_malam = 0;
    //     }

    //     $ek_edit_paraf_malam = $this->put('ek_paraf_malam', true);

    //     if ($ek_edit_paraf_malam !== NULL) {

    //         $paraf_malam = 1;
    //     } else {

    //         $paraf_malam = 0;
    //     }

    //     $ek_edit_hamdalah_malam = $this->put('ek_hamdalah_malam', true);

    //     if ($ek_edit_hamdalah_malam !== NULL) {

    //         $hamdalah_malam = 1;
    //     } else {

    //         $hamdalah_malam = 0;
    //     }

    //     $ek_edit_perawat_tindakan_pagi = $this->put('ek_perawat_tindakan_pagi', true);

    //     if ($ek_edit_perawat_tindakan_pagi !== '') {

    //         $perawat_pagi = $this->put('ek_perawat_tindakan_pagi', true);
    //     } else {

    //         $perawat_pagi = 442;
    //     }

    //     $ek_edit_perawat_tindakan_sore = $this->put('ek_perawat_tindakan_sore', true);

    //     if ($ek_edit_perawat_tindakan_sore !== '') {

    //         $perawat_sore = $this->put('ek_perawat_tindakan_sore', true);
    //     } else {

    //         $perawat_sore = 442;
    //     }

    //     $ek_edit_perawat_tindakan_malam = $this->put('ek_perawat_tindakan_malam', true);

    //     if ($ek_edit_perawat_tindakan_malam !== '') {

    //         $perawat_malam = $this->put('ek_perawat_tindakan_malam', true);
    //     } else {

    //         $perawat_malam = 442;
    //     }

    //     if ($this->put('catatan_cek_tindakan_manual', true) == "on") {
    //         $catatan_tindakan_keperawatan = NULL;
    //         $catatan_tindakan_keperawatan_manual = $this->put('catatan_tindakan_keperawatan_manual', true);
    //     } else {
    //         $catatan_tindakan_keperawatan = $this->put('catatan_tindakan_keperawatan', true);
    //         $catatan_tindakan_keperawatan_manual = NULL;
    //     }

    //     $data = array(
    //         'id' => $this->put('id', true),
    //         'ek_catatan_tindakan_keperawatan' => $catatan_tindakan_keperawatan,
    //         'ek_catatan_tindakan_keperawatan_manual' => $catatan_tindakan_keperawatan_manual,
    //         'ek_tanggal_catatan_tindakan' => $tanggal_tindakan,
    //         'ek_keterangan_catatan' => $this->put('ek_keterangan_catatan', true),
    //         'ek_bismillah_pagi' => $bismillah_pagi,
    //         'ek_cek_pagi' => $cek_pagi,
    //         'ek_jam_pagi' => $catatan_pagi,
    //         'ek_paraf_pagi' => $paraf_pagi,
    //         'ek_perawat_tindakan_pagi' => $perawat_pagi,
    //         'ek_hamdalah_pagi' => $hamdalah_pagi,
    //         'ek_bismillah_sore' => $bismillah_sore,
    //         'ek_cek_sore' => $cek_sore,
    //         'ek_jam_sore' => $catatan_sore,
    //         'ek_paraf_sore' => $paraf_sore,
    //         'ek_perawat_tindakan_sore' => $perawat_sore,
    //         'ek_hamdalah_sore' => $hamdalah_sore,
    //         'ek_bismillah_malam' => $bismillah_malam,
    //         'ek_cek_malam' => $cek_malam,
    //         'ek_jam_malam' => $catatan_malam,
    //         'ek_paraf_malam' => $paraf_malam,
    //         'ek_perawat_tindakan_malam' => $perawat_malam,
    //         'ek_hamdalah_malam' => $hamdalah_malam,
    //         'id_users' => $this->put('user_account', true),
    //         'updated_date' => date("Y-m-d H:i:s"),
    //     );

    //     $status = $this->m_pelayanan->editCatatanTindakanKeperawatan($data);
    //     $this->response(array('status' => $status), REST_Controller::HTTP_OK);
    // }

    // // CTKN tdk ada perubahan
    // function get_catatan_tindakan_keperawatan_get(){
    //     if (!$this->get('id', true)) :
    //         $this->response(NULL, REST_Controller::HTTP_BAD_REQUEST);
    //     endif;

    //     $data = $this->m_pelayanan->getCatatanTindakanKeperawatanByID($this->get('id', true));
    //     $this->response($data, REST_Controller::HTTP_OK);
    // }

    // // CTKN tdk ada perubahan
    // function hapus_catatan_tindakan_keperawatan_delete($id){
    //     $status = $this->m_pelayanan->deleteCatatanTindakanKeperawatan($id);
    //     if ($status) :
    //         $response = array('status' => $status, 'message' => 'Berhasil menghapus Catatan Tindakan Keperawatan!');
    //     else :
    //         $response = array('status' => $status, 'message' => 'Gagal menghapus Catatan Tindakan Keperawatan!');
    //     endif;
    //     $this->response($response, REST_Controller::HTTP_OK);
    // }

    // // CTKN tdk ada perubahan
    // function catatan_tindakan_keperawatan_get(){
    //     $q = safe_get('q');
    //     $start = $this->start(safe_get('page'));
    //     $data = $this->m_pelayanan->getCatatanTindakanKeperawatan($q, $start, $this->limit);
    //     if ((safe_get('page') == 1) & ($q == '')) {
    //         $pilih[] = array(
    //             'id' => '',
    //             'nama' => ' ',
    //         );

    //         $data['data'] = array_merge($pilih, $data['data']);
    //         $data['total'] += 1;
    //     }
    //     $this->response($data, REST_Controller::HTTP_OK);
    // }


    // CTKN
    function get_catatan_tindakan_keperawatan_nursenote_get(){
        if (!$this->get('id')) :
            $this->response(NULL, REST_Controller::HTTP_BAD_REQUEST); // (400)
        endif;
        $this->load->model('pendaftaran/Pendaftaran_model', 'm_pendaftaran');
        $data = $this->m_pendaftaran->getPendaftaranDetail($this->get('id', true), $this->get('id_layanan', true));
        $data['profil'] = $this->m_pelayanan->getProfilPasien($data['pasien']->id_pasien);     
        $data['catatan_tindakan_keperawatan_nursenote']  = $this->m_pelayanan->getCatatanTindakanRawat($this->get('id', true));
        if ($data) :
            $this->response($data, REST_Controller::HTTP_OK); // (200)
        endif;
    }

    // CTKN
    function simpan_catatan_tindakan_keperawatan_nursenote_post() {
        function formatJam($jam) {
            if (empty($jam) || !is_string($jam)) return null;
            $jam = trim($jam);
            if (preg_match('/^\d{1,2}$/', $jam)) {
                return str_pad($jam, 2, '0', STR_PAD_LEFT) . ':00';
            }
            if (preg_match('/^\d{1,2}:\d{2}$/', $jam)) {
                $parts = explode(':', $jam);
                $h = str_pad($parts[0], 2, '0', STR_PAD_LEFT);
                $m = str_pad($parts[1], 2, '0', STR_PAD_LEFT);
                return "$h:$m";
            }
            return null;
        }

        function safeInt($val) {
            return ($val === '' || $val === null) ? null : (int) $val;
        }

        $layanan = array('id' => safe_post('id_layanan_pendaftaran'));

        foreach (safe_post('ek_tanggal_catatan_tindakan') as $i => $tanggal) {
            $data = array(
                'id_pendaftaran'         => safeInt(safe_post('id_pendaftaran')),
                'id_layanan_pendaftaran' => safeInt(safe_post('id_layanan_pendaftaran')),

                'ek_tanggal_catatan_tindakan' => implode('-', array_reverse(explode('/', $tanggal))),
                'ek_catatan_tindakan_keperawatan'      => safeInt(safe_post('ek_catatan_tindakan_keperawatan')[$i] ?? null),
                'ek_catatan_tindakan_keperawatan_manual' => safe_post('ek_catatan_tindakan_keperawatan_manual')[$i] ?? null,
                'ek_keterangan_catatan'                => safe_post('ek_keterangan_catatan')[$i] ?? null,

                'ek_jam_pagi'  => formatJam(safe_post('ek_jam_pagi')[$i] ?? null),
                'ek_jam_sore'  => formatJam(safe_post('ek_jam_sore')[$i] ?? null),
                'ek_jam_malam' => formatJam(safe_post('ek_jam_malam')[$i] ?? null),

                'ek_perawat_tindakan_pagi'  => safeInt(safe_post('ek_perawat_tindakan_pagi')[$i] ?? null),
                'ek_perawat_tindakan_sore'  => safeInt(safe_post('ek_perawat_tindakan_sore')[$i] ?? null),
                'ek_perawat_tindakan_malam' => safeInt(safe_post('ek_perawat_tindakan_malam')[$i] ?? null),

                'ek_bismillah_pagi'  => (safe_post('ek_bismillah_pagi')[$i] ?? 'false') === 'true' ? 1 : 0,
                'ek_cek_pagi'        => (safe_post('ek_cek_pagi')[$i] ?? 'false') === 'true' ? 1 : 0,
                'ek_paraf_pagi'      => (safe_post('ek_paraf_pagi')[$i] ?? 'false') === 'true' ? 1 : 0,
                'ek_hamdalah_pagi'   => (safe_post('ek_hamdalah_pagi')[$i] ?? 'false') === 'true' ? 1 : 0,

                'ek_bismillah_sore'  => (safe_post('ek_bismillah_sore')[$i] ?? 'false') === 'true' ? 1 : 0,
                'ek_cek_sore'        => (safe_post('ek_cek_sore')[$i] ?? 'false') === 'true' ? 1 : 0,
                'ek_paraf_sore'      => (safe_post('ek_paraf_sore')[$i] ?? 'false') === 'true' ? 1 : 0,
                'ek_hamdalah_sore'   => (safe_post('ek_hamdalah_sore')[$i] ?? 'false') === 'true' ? 1 : 0,

                'ek_bismillah_malam' => (safe_post('ek_bismillah_malam')[$i] ?? 'false') === 'true' ? 1 : 0,
                'ek_cek_malam'       => (safe_post('ek_cek_malam')[$i] ?? 'false') === 'true' ? 1 : 0,
                'ek_paraf_malam'     => (safe_post('ek_paraf_malam')[$i] ?? 'false') === 'true' ? 1 : 0,
                'ek_hamdalah_malam'  => (safe_post('ek_hamdalah_malam')[$i] ?? 'false') === 'true' ? 1 : 0,

                'id_users'     => safeInt(safe_post('user_pengkajian')[$i] ?? null),
                'created_date' => date('Y-m-d H:i:s'),
                'updated_date' => date('Y-m-d H:i:s'),
            );

            $this->m_pelayanan->insertCatatanTindakanKeperawatan($data);
        }

        $message = array(
            'status' => true,
            'token'  => $this->security->get_csrf_hash(),
            'id'     => $layanan['id'],
            'respon' => null,
        );

        $this->response($message, REST_Controller::HTTP_OK);
    }

    // CTKN
    function get_catatan_tindakan_keperawatan_get(){
        if (!$this->get('id', true)) :
            $this->response(NULL, REST_Controller::HTTP_BAD_REQUEST);
        endif;

        $data = $this->m_pelayanan->getCatatanTindakanKeperawatanByID($this->get('id', true));
        $this->response($data, REST_Controller::HTTP_OK);
    }
    
    // CTKN
    function update_catatan_tindakan_keperawatan_post(){
        $id = $this->input->post('id', true);
        if (!$id) {
            return $this->response(['status' => false, 'message' => 'ID tidak ditemukan!'], REST_Controller::HTTP_BAD_REQUEST);
        }

        $ek_tanggal_catatan_tindakan = str_replace('/', '-', $this->input->post('ek_tanggal_catatan_tindakan', true));
        $ek_tanggal_catatan_tindakan = date('Y-m-d', strtotime($ek_tanggal_catatan_tindakan));

        $data = [
            'id'                                        => $id,
            'ek_tanggal_catatan_tindakan'               => $ek_tanggal_catatan_tindakan,
            'ek_perawat_tindakan_pagi'                  => $this->input->post('ek_perawat_tindakan_pagi', true) ?: null,
            'ek_perawat_tindakan_sore'                  => $this->input->post('ek_perawat_tindakan_sore', true) ?: null,
            'ek_perawat_tindakan_malam'                 => $this->input->post('ek_perawat_tindakan_malam', true) ?: null,
            'ek_catatan_tindakan_keperawatan'           => $this->input->post('ek_catatan_tindakan_keperawatan', true) ?: null,
            'ek_catatan_tindakan_keperawatan_manual'    => $this->input->post('ek_catatan_tindakan_keperawatan_manual', true) ?: null,
            'ek_keterangan_catatan'                     => $this->input->post('ek_keterangan_catatan', true) ?: null,
            'ek_jam_pagi'                               => $this->input->post('ek_jam_pagi', true) ?: null,
            'ek_jam_sore'                               => $this->input->post('ek_jam_sore', true) ?: null,
            'ek_jam_malam'                              => $this->input->post('ek_jam_malam', true) ?: null,
            'updated_date'                              => date('Y-m-d H:i:s'),
            'id_users'                                  => $this->session->userdata('id_translucent'),
            'updated_by'                                => $this->input->post('updated_by', true) ?: '-',
        ];

        // Daftar semua checkbox
        $checkboxes = [
            'ek_bismillah_pagi','ek_cek_pagi','ek_paraf_pagi','ek_hamdalah_pagi',
            'ek_bismillah_sore','ek_cek_sore','ek_paraf_sore','ek_hamdalah_sore',
            'ek_bismillah_malam','ek_cek_malam','ek_paraf_malam','ek_hamdalah_malam',        
        ];

        foreach ($checkboxes as $field) {
            $data[$field] = $this->input->post($field) === 'on' ? 1 : 0;
        }

        $status = $this->m_pelayanan->editCatatanTindakanKeperawatan($data);
        return $this->response(['status' => $status], REST_Controller::HTTP_OK);
    }

    // CTKN LOGS
    function hapus_catatan_tindakan_keperawatan_delete($id) {
        $method = $this->input->post('_method');
        $deleted_by = $this->input->post('deleted_by'); // now string: nama

        if ($method !== 'DELETE') {
            return $this->response([
                'status' => false,
                'message' => 'Metode tidak diizinkan!'
            ], REST_Controller::HTTP_METHOD_NOT_ALLOWED);
        }

        if (empty($deleted_by)) {
            return $this->response([
                'status' => false,
                'message' => 'User penghapus tidak terdeteksi!'
            ], REST_Controller::HTTP_BAD_REQUEST);
        }

        // Kirim ke model
        $status = $this->m_pelayanan->deleteCatatanTindakanKeperawatan($id, $deleted_by);

        $response = [
            'status' => $status,
            'message' => $status ? 'Berhasil menghapus Data!' : 'Gagal menghapus Data!'
        ];

        $this->response($response, REST_Controller::HTTP_OK);
    }

    // CTKN UNTUK DIAGNOSA
    function catatan_tindakan_keperawatan_get(){
        $q = safe_get('q');
        $start = $this->start(safe_get('page'));
        $data = $this->m_pelayanan->getCatatanTindakanKeperawatan($q, $start, $this->limit);
        if ((safe_get('page') == 1) & ($q == '')) {
            $pilih[] = array(
                'id' => '',
                'nama' => ' ',
            );
            $data['data'] = array_merge($pilih, $data['data']);
            $data['total'] += 1;
        }
        $this->response($data, REST_Controller::HTTP_OK);
    }



    function get_terapi_pulang_get()
    {
        if (!$this->get('id', true)) :
            $this->response(NULL, REST_Controller::HTTP_BAD_REQUEST);
        endif;

        $data = $this->m_pelayanan->getTerapiPulangByID($this->get('id', true));
        $this->response($data, REST_Controller::HTTP_OK);
    }



    function update_terapi_pulang_put()
    {
        if (!$this->put('id', true)) :
            $this->response(array('status' => false), REST_Controller::HTTP_OK);
        endif;

        $ek_nol = $this->put('ek_jam_pemberian', true);

        if ($ek_nol === "" || $ek_nol === null) {

            $terapi_nol = null;
        } else {

            $date = new DateTime($ek_nol);
            $new = $date->format('H:i:s');
            $terapi_nol = $new;
        }

        $ek_satu = $this->put('ek_jam_pemberian_satu', true);

        if ($ek_satu === "" || $ek_satu === null) {

            $terapi_satu = null;
        } else {

            $date = new DateTime($ek_satu);
            $new = $date->format('H:i:s');
            $terapi_satu = $new;
        }

        $ek_dua = $this->put('ek_jam_pemberian_dua', true);

        if ($ek_dua === "" || $ek_dua === null) {

            $terapi_dua = null;
        } else {

            $date = new DateTime($ek_dua);
            $new = $date->format('H:i:s');
            $terapi_dua = $new;
        }

        $ek_tiga = $this->put('ek_jam_pemberian_tiga', true);

        if ($ek_tiga === "" || $ek_tiga === null) {

            $terapi_tiga = null;
        } else {

            $date = new DateTime($ek_tiga);
            $new = $date->format('H:i:s');
            $terapi_tiga = $new;
        }


        $ek_empat = $this->put('ek_jam_pemberian_empat', true);

        if ($ek_empat === "" || $ek_empat === null) {

            $terapi_empat = null;
        } else {

            $date = new DateTime($ek_empat);
            $new = $date->format('H:i:s');
            $terapi_empat = $new;
        }

        $ek_lima = $this->put('ek_jam_pemberian_lima', true);

        if ($ek_lima === "" || $ek_lima === null) {

            $terapi_lima = null;
        } else {

            $date = new DateTime($ek_lima);
            $new = $date->format('H:i:s');
            $terapi_lima = $new;
        }

        $data = array(
            'id' => $this->put('id', true),
            'obat' => $this->put('obat', true),
            'jumlah_obat' => $this->put('jumlah_obat', true),
            'dosis' => $this->put('dosis', true),
            'frekuensi' => $this->put('frekuensi', true),
            'cara_pemberian' => $this->put('cara_pemberian', true),
            'ek_jam_pemberian' => $terapi_nol,
            'ek_jam_pemberian_satu' => $terapi_satu,
            'ek_jam_pemberian_dua' => $terapi_dua,
            'ek_jam_pemberian_tiga' => $terapi_tiga,
            'ek_jam_pemberian_empat' => $terapi_empat,
            'ek_jam_pemberian_lima' => $terapi_lima,
            'petunjuk_khusus' => $this->put('petunjuk_khusus', true),
            'id_users' => $this->put('user_account', true),
            'created_date' => $this->put('created_date', true),
        );

        $status = $this->m_pelayanan->editTerapiPulang($data);
        $this->response(array('status' => $status), REST_Controller::HTTP_OK);
    }

    function get_kontrol_kembali_get()
    {
        if (!$this->get('id', true)) :
            $this->response(NULL, REST_Controller::HTTP_BAD_REQUEST);
        endif;

        $data = $this->m_pelayanan->getKontrolKembaliByID($this->get('id', true));

        $this->response($data, REST_Controller::HTTP_OK);
    }

    function hapus_kontrol_kembali_delete($id)
    {
        $status = $this->m_pelayanan->deleteKontrolKembali($id);
        if ($status) :
            $response = array('status' => $status, 'message' => 'Berhasil menghapus Terapi Pulang!');
        else :
            $response = array('status' => $status, 'message' => 'Gagal menghapus Terapi Pulang!');
        endif;
        $this->response($response, REST_Controller::HTTP_OK);
    }

    function update_kontrol_kembali_put()
    {
        if (!$this->put('id', true)) :
            $this->response(array('status' => false), REST_Controller::HTTP_OK);
        endif;


        $ek_kontrol_dokter = $this->put('ek_kontrol_dokter', true);
        if ($ek_kontrol_dokter === "" || $ek_kontrol_dokter === null) {

            $ek_dokter = null;
        } else {

            $entri_ek_kontrol_dokter = datetime2mysql($ek_kontrol_dokter);
            $date = new DateTime($entri_ek_kontrol_dokter);
            $new = $date->format('Y-m-d H:i:s');
            $ek_dokter = $new;
        }

        $data = array(
            'id'                => $this->put('id', true),
            'tanggal'           => $ek_dokter,
            'id_ek_nama_dokter' => $this->put('ek_nama_dokter', true),
            'user'              => $this->put('user_account', true),
            'created_date'      => $this->put('created_date', true),
        );

        $status = $this->m_pelayanan->editKontrolKembali($data);
        $this->response(array('status' => $status), REST_Controller::HTTP_OK);
    }

 
 


    // RAKX
    function get_data_rencana_asuhan_keperawatan_get(){
        if (!$this->get('id')) :
            $this->response(NULL, REST_Controller::HTTP_BAD_REQUEST); // (400)
        endif;
        $this->load->model('pendaftaran/Pendaftaran_model', 'm_pendaftaran');
        $data = $this->m_pendaftaran->getPendaftaranDetail($this->get('id', true), $this->get('id_layanan', true));
        $data['profil']         = $this->m_pelayanan->getProfilPasien($data['pasien']->id_pasien);
        $data['masalah_keperawatan']  = $this->m_pelayanan->getMasalahRawat($this->get('id', true));
        $data['rencana_tindakan_keperawatan']  = $this->m_pelayanan->getRencanaKeperawatan($this->get('id', true));
        if ($data) :
            $this->response($data, REST_Controller::HTTP_OK); // (200)
        endif;
    }

    // RAKX
    function simpan_entri_rencana_asuhan_keperawatan_post(){
        $layanan = array('id' => safe_post('id_layanan_pendaftaran'));

        $rencana_tindakan_keperawatan = safe_post('rencana_tindakan_keperawatan');

        if ($rencana_tindakan_keperawatan) {

            $tanggal_tindakan_satu = safe_post('tanggal_tindakan_satu');
            $ek_tanggal_tindakan_satu = is_string($tanggal_tindakan_satu);

            if ($tanggal_tindakan_satu === "" || $tanggal_tindakan_satu === null) {

                $tanggal_dibuat_rencana = null;
            } else if (!is_array($tanggal_tindakan_satu)) {


                $tanggal_dibuat_rencana = null;
            } else if (empty($tanggal_tindakan_satu)) {


                $tanggal_dibuat_rencana = null;
            } else if ($ek_tanggal_tindakan_satu === true) {


                $tanggal_dibuat_rencana = null;
            } else {

                foreach ($tanggal_tindakan_satu as $key => $value) {

                    $date = new DateTime($value);
                    $new = $date->format('Y-m-d');


                    $tanggal_dibuat_rencana[$key] = $new;
                }
            }

            $tanggal_rencana_dibuat = safe_post('tanggal_rencana_dibuat');
            $ek_tanggal_rencana_dibuat = is_string($tanggal_rencana_dibuat);

            if ($tanggal_rencana_dibuat === "" || $tanggal_rencana_dibuat === null) {

                $tanggal_rencana = null;
            } else if (!is_array($tanggal_rencana_dibuat)) {


                $tanggal_rencana = null;
            } else if (empty($tanggal_rencana_dibuat)) {


                $tanggal_rencana = null;
            } else if ($ek_tanggal_rencana_dibuat === true) {


                $tanggal_rencana = null;
            } else {

                foreach ($tanggal_rencana_dibuat as $key => $value) {

                    $date = new DateTime($value);
                    $new = $date->format('Y-m-d H:i:s');


                    $tanggal_rencana[$key] = $new;
                }
            }

            $rncn_tind_keperawatan = array(
                'id_layanan_pendaftaran'        => $layanan['id'],
                'tanggal_tindakan_satu'         => $tanggal_dibuat_rencana,
                'jam_tindakan'                  => safe_post('jam_tindakan') !== '' ? safe_post('jam_tindakan') : NULL,
                'rencana_tindakan_keperawatan'  => safe_post('rencana_tindakan_keperawatan') !== '' ? safe_post('rencana_tindakan_keperawatan') : NULL,
                'rencana_tindakan_lainya'       => safe_post('rencana_tindakan_lainya') !== '' ? safe_post('rencana_tindakan_lainya') : NULL,
                'keterangan'                    => safe_post('ek_keterangan_tambahan') !== '' ? safe_post('ek_keterangan_tambahan') : NULL,
                'ek_waktu_pagi'                 => safe_post('ek_waktu_pagi') !== '' ? safe_post('ek_waktu_pagi') : NULL,
                'ek_waktu_siang'                => safe_post('ek_waktu_siang') !== '' ? safe_post('ek_waktu_siang') : NULL,
                'ek_waktu_malam'                => safe_post('ek_waktu_malam') !== '' ? safe_post('ek_waktu_malam') : NULL,
                'ek_operator_rencana_tindakan'  => safe_post('ek_operator_rencana_tindakan') !== '' ? safe_post('ek_operator_rencana_tindakan') : NULL,
                'created_date'                  => $tanggal_rencana,
            );

            $this->m_pelayanan->updateRencanaTindakanKeperawatan($rncn_tind_keperawatan, false);
        } else {

            $rencana_tindakan = safe_post('rencana_tindakan');

            if (!empty($rencana_tindakan)) {

                $respon = ['show' => '1', 'status' => false, 'message' => 'Rencana Tindakan Keperawatan Belum ditambahkan', 'id' => '#rencana-tindakan-keperawatan'];
            }
        }

        $masalah_keperawatan = safe_post('masalah_keperawatan');

        if ($masalah_keperawatan) {

            $tanggal_masalah_dibuat = safe_post('tanggal_masalah_dibuat');

            $ek_tanggal_masalah_dibuat = is_string($tanggal_masalah_dibuat);

            if ($tanggal_masalah_dibuat === "" || $tanggal_masalah_dibuat === null) {

                $tanggal_dibuat_masalah = null;
            } else if (!is_array($tanggal_masalah_dibuat)) {


                $tanggal_dibuat_masalah = null;
            } else if (empty($tanggal_masalah_dibuat)) {


                $tanggal_dibuat_masalah = null;
            } else if ($ek_tanggal_masalah_dibuat === true) {


                $tanggal_dibuat_masalah = null;
            } else {

                foreach ($tanggal_masalah_dibuat as $key => $value) {

                    $date = new DateTime($value);
                    $new = $date->format('Y-m-d H:i:s');


                    $tanggal_dibuat_masalah[$key] = $new;
                }
            }

            $tanggal_dimulai = safe_post('tanggal_mulai');

            $ek_tanggal_dimulai = is_string($tanggal_dimulai);

            if ($tanggal_dimulai === "" || $tanggal_dimulai === null) {

                $tanggal_mulai_awal = null;
            } else if (!is_array($tanggal_dimulai)) {


                $tanggal_mulai_awal = null;
            } else if (empty($tanggal_dimulai)) {


                $tanggal_mulai_awal = null;
            } else if ($ek_tanggal_dimulai === true) {


                $tanggal_mulai_awal = null;
            } else {

                foreach ($tanggal_dimulai as $key => $value) {

                    $date = new DateTime($value);
                    $new = $date->format('Y-m-d H:i:s');


                    $tanggal_mulai_awal[$key] = $new;
                }
            }

            $tanggal_diakhiri = safe_post('tanggal_selesai');

            $ek_tanggal_diakhiri = is_string($tanggal_diakhiri);

            if ($tanggal_diakhiri === "" || $tanggal_diakhiri === null) {

                $tanggal_mulai_akhir = null;
            } else if (!is_array($tanggal_diakhiri)) {


                $tanggal_mulai_akhir = null;
            } else if (empty($tanggal_diakhiri)) {


                $tanggal_mulai_akhir = null;
            } else if ($ek_tanggal_diakhiri === true) {


                $tanggal_mulai_akhir = null;
            } else {

                foreach ($tanggal_diakhiri as $key => $value) {

                    $date = new DateTime($value);
                    $new = $date->format('Y-m-d H:i:s');


                    $tanggal_mulai_akhir[$key] = $new;
                }
            }

            $mslh_keperawatan = array(
                'id_layanan_pendaftaran'   => $layanan['id'],
                'masalah_keperawatan'      => safe_post('masalah_keperawatan') !== '' ? safe_post('masalah_keperawatan') : NULL,
                'tanggal_mulai'            => $tanggal_mulai_awal,
                'tanggal_selesai'          => $tanggal_mulai_akhir,
                'id_users'                 => safe_post('ek_operator_masalah') !== '' ? safe_post('ek_operator_masalah') : NULL,
                'created_date'             => $tanggal_dibuat_masalah,
            );

            $this->m_pelayanan->updateMasalahKeperawatan($mslh_keperawatan);
         } else {

            $masalah_keperawatan = safe_post('ek_masalah_keperawatan');

            if (!empty($masalah_keperawatan)) {

                $respon = ['show' => '1', 'status' => false, 'message' => 'Data Asuhan Keperawatan Belum ditambahkan', 'id' => '#data-asuhan-keperawatan'];
            }
        }

        if (!empty($respon)) {

            $response = $respon;
        } else {

            $response = null;
        }


        if ($this->db->trans_status() === false) :
            $this->db->trans_rollback();
            $status = false;
        else :
            $this->db->trans_commit();
            $status = true;
        endif;

        $message = array(
            'status' => $status,
            'token'  => $this->security->get_csrf_hash(),
            'id'     => $layanan['id'],
            'respon' => $response,
        );

        $this->response($message, REST_Controller::HTTP_OK);
    }

    // RAKX
    function update_masalah_keperawatan_put(){
        if (!$this->put('id', true)) :
            $this->response(array('status' => false), REST_Controller::HTTP_OK);
        endif;


        $edit_tanggal_mulai = $this->put('edit_tanggal_mulai', true);
        if ($edit_tanggal_mulai === "" || $edit_tanggal_mulai === null) {

            $tanggal_mulai = null;
        } else {

            $entri_new = datetime2mysql($edit_tanggal_mulai);
            $date_new = new DateTime($entri_new);
            $new = $date_new->format('Y-m-d H:i:s');
            $tanggal_mulai = $new;
        }

        $edit_tanggal_selesai = $this->put('edit_tanggal_selesai', true);
        if ($edit_tanggal_selesai === "" || $edit_tanggal_selesai === null) {

            $tanggal_selesai = null;
        } else {

            $entri_last = datetime2mysql($edit_tanggal_selesai);
            $last_date = new DateTime($entri_last);
            $last = $last_date->format('Y-m-d H:i:s');
            $tanggal_selesai = $last;
        }

        $data = array(
            'id'                    => $this->put('id', true),
            'tanggal_mulai'         => $tanggal_mulai,
            'tanggal_selesai'       => $tanggal_selesai,
            'masalah_keperawatan'   => $this->put('masalah_keperawatan', true),
            'updated_date'          => $this->put('waktu_masalah', true),
            'id_users'              => $this->put('user_masalah', true),
        );

        $status = $this->m_pelayanan->editMasalahKeperawatan($data);
        $this->response(array('status' => $status), REST_Controller::HTTP_OK);
    }

    // RAKX
    function get_masalah_rawat_get(){
        if (!$this->get('id', true)) :
            $this->response(NULL, REST_Controller::HTTP_BAD_REQUEST);
        endif;

        $data = $this->m_pelayanan->getMasalahRawatByID($this->get('id', true));

        $this->response($data, REST_Controller::HTTP_OK);
    }

    // RAKX
    function hapus_masalah_rawat_delete($id){
        $status = $this->m_pelayanan->deleteMasalahRawat($id);
        if ($status) :
            $response = array('status' => $status, 'message' => 'Berhasil menghapus Masalah Keperawatan!');
        else :
            $response = array('status' => $status, 'message' => 'Gagal menghapus Masalah Keperawatan!');
        endif;
        $this->response($response, REST_Controller::HTTP_OK);
    }

    // RAKX
    function hapus_rencana_tindakan_keperawatan_delete($id){
        $status = $this->m_pelayanan->deleteRencanaTINDK($id);
        if ($status) :
            $response = array('status' => $status, 'message' => 'Berhasil menghapus Rencana Tindakan!');
        else :
            $response = array('status' => $status, 'message' => 'Gagal menghapus Rencana Tindakan!');
        endif;
        $this->response($response, REST_Controller::HTTP_OK);
    }

















    function cekDate($show, $id, $message, $form)
    {
        // ekspresi reguler untuk mencocokkan format tanggal yang dibutuhkan

        date_default_timezone_set('Asia/Jakarta');

        $layanan = array('id' => safe_post('id_layanan_pendaftaran'));

        if ($form !== '') {

            if (is_array($form)) {

                foreach ($form as $key => $value) {

                    $regs = preg_match("/^(\d{1,2})[\/](\d{1,2})[\/](\d{4})$/", $value);

                    if ($regs === 0) {

                        if ($id !== '') {

                            $respon = ['show' => $show, 'status' => false, 'message' => $message . ', format tanggal yang benar dd/mm/yyyy', 'id' => $id];

                            $status = false;

                            $message = array(
                                'status' => $status,
                                'token'  => $this->security->get_csrf_hash(),
                                'id'     => $layanan['id'],
                                'respon' => $respon,
                            );

                            $this->response($message, REST_Controller::HTTP_CREATED);

                            return false;
                        } else {

                            $respon = ['show' => $show, 'status' => false, 'message' => $message . ', format tanggal yang benar dd/mm/yyyy'];

                            $status = false;

                            $message = array(
                                'status' => $status,
                                'token'  => $this->security->get_csrf_hash(),
                                'id'     => $layanan['id'],
                                'respon' => $respon,
                            );

                            $this->response($message, REST_Controller::HTTP_CREATED);

                            return false;
                        }
                    } else {

                        $var1 = explode("/", $value);

                        $fungsi_tanggal = (int)$var1[0];
                        $fungsi_bulan = (int)$var1[1];
                        $fungsi_tahun = (int)$var1[2];

                        if ($fungsi_tanggal < 1 || $fungsi_tanggal > 31) {

                            if ($id !== '') {

                                $respon = ['show' => $show, 'status' => false, 'message' => 'Nilai tidak valid untuk tanggal: ' . $fungsi_tanggal, 'id' => $id];
                            } else {

                                $respon = ['show' => $show, 'status' => false, 'message' => 'Nilai tidak valid untuk tanggal: ' . $fungsi_tanggal];
                            }

                            $status = false;

                            $message = array(
                                'status' => $status,
                                'token'  => $this->security->get_csrf_hash(),
                                'id'     => $layanan['id'],
                                'respon' => $respon,
                            );

                            $this->response($message, REST_Controller::HTTP_CREATED);

                            return false;
                        } else if ($fungsi_bulan < 1 || $fungsi_bulan > 12) {

                            if ($id !== '') {

                                $respon = ['show' => $show, 'status' => false, 'message' => 'Nilai tidak valid untuk bulan: ' . $fungsi_bulan, 'id' => $id];
                            } else {

                                $respon = ['show' => $show, 'status' => false, 'message' => 'Nilai tidak valid untuk bulan: ' . $fungsi_bulan];
                            }

                            $status = false;

                            $message = array(
                                'status' => $status,
                                'token'  => $this->security->get_csrf_hash(),
                                'id'     => $layanan['id'],
                                'respon' => $respon,
                            );

                            $this->response($message, REST_Controller::HTTP_CREATED);

                            return false;
                        } else if ($fungsi_tahun < (date('Y')) - 1 || $fungsi_tahun > (date('Y')) + 1) {

                            if ($id !== '') {

                                $respon = ['show' => $show, 'status' => false, 'message' => 'Nilai tidak valid untuk tahun: ' . $fungsi_tahun . ' - harus antara ' . ((date('Y')) - 1) . ' dan ' . ((date('Y')) + 1), 'id' => $id];
                            } else {

                                $respon = ['show' => $show, 'status' => false, 'message' => 'Nilai tidak valid untuk tahun: ' . $fungsi_tahun . ' - harus antara ' . ((date('Y')) - 1) . ' dan ' . ((date('Y')) + 1)];
                            }

                            $status = false;

                            $message = array(
                                'status' => $status,
                                'token'  => $this->security->get_csrf_hash(),
                                'id'     => $layanan['id'],
                                'respon' => $respon,
                            );

                            $this->response($message, REST_Controller::HTTP_CREATED);

                            return false;
                        } else {

                            return true;
                        }
                    }
                }
            } else {

                $regs = preg_match("/^(\d{1,2})[\/](\d{1,2})[\/](\d{4})$/", $form);

                if ($regs === 0) {

                    if ($id !== '') {

                        $respon = ['show' => $show, 'status' => false, 'message' => $message . ', format tanggal yang benar dd/mm/yyyy', 'id' => $id];

                        $status = false;

                        $message = array(
                            'status' => $status,
                            'token'  => $this->security->get_csrf_hash(),
                            'id'     => $layanan['id'],
                            'respon' => $respon,
                        );

                        $this->response($message, REST_Controller::HTTP_CREATED);

                        return false;
                    } else {

                        $respon = ['show' => $show, 'status' => false, 'message' => $message . ', tidak sesuai, format tanggal yang benar dd/mm/yyyy'];

                        $status = false;

                        $message = array(
                            'status' => $status,
                            'token'  => $this->security->get_csrf_hash(),
                            'id'     => $layanan['id'],
                            'respon' => $respon,
                        );

                        $this->response($message, REST_Controller::HTTP_CREATED);

                        return false;
                    }
                } else {

                    $var1 = explode("/", $form);

                    $fungsi_tanggal = (int)$var1[0];
                    $fungsi_bulan = (int)$var1[1];
                    $fungsi_tahun = (int)$var1[2];

                    if ($fungsi_tanggal < 1 || $fungsi_tanggal > 31) {

                        if ($id !== '') {

                            $respon = ['show' => $show, 'status' => false, 'message' => 'Nilai tidak valid untuk tanggal: ' . $fungsi_tanggal, 'id' => $id];
                        } else {

                            $respon = ['show' => $show, 'status' => false, 'message' => 'Nilai tidak valid untuk tanggal: ' . $fungsi_tanggal];
                        }

                        $status = false;

                        $message = array(
                            'status' => $status,
                            'token'  => $this->security->get_csrf_hash(),
                            'id'     => $layanan['id'],
                            'respon' => $respon,
                        );

                        $this->response($message, REST_Controller::HTTP_CREATED);

                        return false;
                    } else if ($fungsi_bulan < 1 || $fungsi_bulan > 12) {

                        if ($id !== '') {

                            $respon = ['show' => $show, 'status' => false, 'message' => 'Nilai tidak valid untuk bulan: ' . $fungsi_bulan, 'id' => $id];
                        } else {

                            $respon = ['show' => $show, 'status' => false, 'message' => 'Nilai tidak valid untuk bulan: ' . $fungsi_bulan];
                        }

                        $status = false;

                        $message = array(
                            'status' => $status,
                            'token'  => $this->security->get_csrf_hash(),
                            'id'     => $layanan['id'],
                            'respon' => $respon,
                        );

                        $this->response($message, REST_Controller::HTTP_CREATED);

                        return false;
                    } else if ($fungsi_tahun < (date('Y')) - 1 || $fungsi_tahun > (date('Y')) + 1) {

                        if ($id !== '') {

                            $respon = ['show' => $show, 'status' => false, 'message' => 'Nilai tidak valid untuk tahun: ' . $fungsi_tahun . ' - harus antara ' . ((date('Y')) - 1) . ' dan ' . ((date('Y')) + 1), 'id' => $id];
                        } else {

                            $respon = ['show' => $show, 'status' => false, 'message' => 'Nilai tidak valid untuk tahun: ' . $fungsi_tahun . ' - harus antara ' . ((date('Y')) - 1) . ' dan ' . ((date('Y')) + 1)];
                        }

                        $status = false;

                        $message = array(
                            'status' => $status,
                            'token'  => $this->security->get_csrf_hash(),
                            'id'     => $layanan['id'],
                            'respon' => $respon,
                        );

                        $this->response($message, REST_Controller::HTTP_CREATED);

                        return false;
                    } else {

                        return true;
                    }
                }
            }
        } else {

            return true;
        }
    }

    function cekDateTime($show, $id, $message, $form)
    {
        // ekspresi reguler untuk mencocokkan format tanggal yang dibutuhkan

        date_default_timezone_set('Asia/Jakarta');

        $layanan = array('id' => safe_post('id_layanan_pendaftaran'));


        if ($form !== '') {

            if (is_array($form)) {

                foreach ($form as $key => $value) {

                    $regs = preg_match("/^(\d{1,2})[\/](\d{1,2})[\/](\d{4})[\ ](\d{1,2})[\:](\d{1,2})$/", $value);

                    if ($regs === 0) {

                        if ($id !== '') {

                            $respon = ['show' => $show, 'status' => false, 'message' => $message . ', format tanggal yang benar dd/mm/yyyy hh:mm', 'id' => $id];

                            $status = false;

                            $message = array(
                                'status' => $status,
                                'token'  => $this->security->get_csrf_hash(),
                                'id'     => $layanan['id'],
                                'respon' => $respon,
                            );

                            $this->response($message, REST_Controller::HTTP_CREATED);

                            return false;
                        } else {

                            $respon = ['show' => $show, 'status' => false, 'message' => $message . ', format tanggal yang benar dd/mm/yyyy hh:mm'];

                            $status = false;

                            $message = array(
                                'status' => $status,
                                'token'  => $this->security->get_csrf_hash(),
                                'id'     => $layanan['id'],
                                'respon' => $respon,
                            );

                            $this->response($message, REST_Controller::HTTP_CREATED);

                            return false;
                        }
                    } else {

                        $var1 = explode(" ", $value);

                        $var2 = explode("/", $var1[0]);

                        $var3 = explode(":", $var1[1]);

                        $fungsi_tanggal = (int)$var2[0];
                        $fungsi_bulan = (int)$var2[1];
                        $fungsi_tahun = (int)$var2[2];
                        $fungsi_jam = (int)$var3[0];
                        $fungsi_menit = (int)$var3[1];

                        if ($fungsi_tanggal < 1 || $fungsi_tanggal > 31) {

                            if ($id !== '') {

                                $respon = ['show' => $show, 'status' => false, 'message' => 'Nilai tidak valid untuk tanggal: ' . $fungsi_tanggal, 'id' => $id];
                            } else {

                                $respon = ['show' => $show, 'status' => false, 'message' => 'Nilai tidak valid untuk tanggal: ' . $fungsi_tanggal];
                            }

                            $status = false;

                            $message = array(
                                'status' => $status,
                                'token'  => $this->security->get_csrf_hash(),
                                'id'     => $layanan['id'],
                                'respon' => $respon,
                            );

                            $this->response($message, REST_Controller::HTTP_CREATED);

                            return false;
                        } else if ($fungsi_bulan < 1 || $fungsi_bulan > 12) {

                            if ($id !== '') {

                                $respon = ['show' => $show, 'status' => false, 'message' => 'Nilai tidak valid untuk bulan: ' . $fungsi_bulan, 'id' => $id];
                            } else {

                                $respon = ['show' => $show, 'status' => false, 'message' => 'Nilai tidak valid untuk bulan: ' . $fungsi_bulan];
                            }

                            $status = false;

                            $message = array(
                                'status' => $status,
                                'token'  => $this->security->get_csrf_hash(),
                                'id'     => $layanan['id'],
                                'respon' => $respon,
                            );

                            $this->response($message, REST_Controller::HTTP_CREATED);

                            return false;
                        } else if ($fungsi_tahun < (date('Y')) - 1 || $fungsi_tahun > (date('Y')) + 1) {

                            if ($id !== '') {

                                $respon = ['show' => $show, 'status' => false, 'message' => 'Nilai tidak valid untuk tahun: ' . $fungsi_tahun . ' - harus antara ' . ((date('Y')) - 1) . ' dan ' . ((date('Y')) + 1), 'id' => $id];
                            } else {

                                $respon = ['show' => $show, 'status' => false, 'message' => 'Nilai tidak valid untuk tahun: ' . $fungsi_tahun . ' - harus antara ' . ((date('Y')) - 1) . ' dan ' . ((date('Y')) + 1)];
                            }

                            $status = false;

                            $message = array(
                                'status' => $status,
                                'token'  => $this->security->get_csrf_hash(),
                                'id'     => $layanan['id'],
                                'respon' => $respon,
                            );

                            $this->response($message, REST_Controller::HTTP_CREATED);

                            return false;
                        } else if ($fungsi_jam < 0 || $fungsi_jam > 23) {

                            if ($id !== '') {

                                $respon = ['show' => $show, 'status' => false, 'message' => 'Nilai tidak valid untuk jam: ' . $fungsi_jam, 'id' => $id];
                            } else {

                                $respon = ['show' => $show, 'status' => false, 'message' => 'Nilai tidak valid untuk jam: ' . $fungsi_jam];
                            }

                            $status = false;

                            $message = array(
                                'status' => $status,
                                'token'  => $this->security->get_csrf_hash(),
                                'id'     => $layanan['id'],
                                'respon' => $respon,
                            );

                            $this->response($message, REST_Controller::HTTP_CREATED);

                            return false;
                        } else if ($fungsi_menit < 0 || $fungsi_menit > 59) {

                            if ($id !== '') {

                                $respon = ['show' => $show, 'status' => false, 'message' => 'Nilai tidak valid untuk menit: ' . $fungsi_menit, 'id' => $id];
                            } else {

                                $respon = ['show' => $show, 'status' => false, 'message' => 'Nilai tidak valid untuk menit: ' . $fungsi_menit];
                            }

                            $status = false;

                            $message = array(
                                'status' => $status,
                                'token'  => $this->security->get_csrf_hash(),
                                'id'     => $layanan['id'],
                                'respon' => $respon,
                            );

                            $this->response($message, REST_Controller::HTTP_CREATED);

                            return false;
                        } else {

                            return true;
                        }
                    }
                }
            } else {

                $regs = preg_match("/^(\d{1,2})[\/](\d{1,2})[\/](\d{4})[\ ](\d{1,2})[\:](\d{1,2})$/", $form);

                if ($regs === 0) {

                    if ($id !== '') {

                        $respon = ['show' => $show, 'status' => false, 'message' => $message . ', format tanggal yang benar dd/mm/yyyy hh:mm', 'id' => $id];

                        $status = false;

                        $message = array(
                            'status' => $status,
                            'token'  => $this->security->get_csrf_hash(),
                            'id'     => $layanan['id'],
                            'respon' => $respon,
                        );

                        $this->response($message, REST_Controller::HTTP_CREATED);

                        return false;
                    } else {

                        $respon = ['show' => $show, 'status' => false, 'message' => $message . ', format tanggal yang benar dd/mm/yyyy hh:mm'];

                        $status = false;

                        $message = array(
                            'status' => $status,
                            'token'  => $this->security->get_csrf_hash(),
                            'id'     => $layanan['id'],
                            'respon' => $respon,
                        );

                        $this->response($message, REST_Controller::HTTP_CREATED);

                        return false;
                    }
                } else {

                    $var1 = explode(" ", $form);

                    $var2 = explode("/", $var1[0]);

                    $var3 = explode(":", $var1[1]);

                    $fungsi_tanggal = (int)$var2[0];
                    $fungsi_bulan = (int)$var2[1];
                    $fungsi_tahun = (int)$var2[2];
                    $fungsi_jam = (int)$var3[0];
                    $fungsi_menit = (int)$var3[1];

                    if ($fungsi_tanggal < 1 || $fungsi_tanggal > 31) {

                        if ($id !== '') {

                            $respon = ['show' => $show, 'status' => false, 'message' => 'Nilai tidak valid untuk tanggal: ' . $fungsi_tanggal, 'id' => $id];
                        } else {

                            $respon = ['show' => $show, 'status' => false, 'message' => 'Nilai tidak valid untuk tanggal: ' . $fungsi_tanggal];
                        }

                        $status = false;

                        $message = array(
                            'status' => $status,
                            'token'  => $this->security->get_csrf_hash(),
                            'id'     => $layanan['id'],
                            'respon' => $respon,
                        );

                        $this->response($message, REST_Controller::HTTP_CREATED);

                        return false;
                    } else if ($fungsi_bulan < 1 || $fungsi_bulan > 12) {

                        if ($id !== '') {

                            $respon = ['show' => $show, 'status' => false, 'message' => 'Nilai tidak valid untuk bulan: ' . $fungsi_bulan, 'id' => $id];
                        } else {

                            $respon = ['show' => $show, 'status' => false, 'message' => 'Nilai tidak valid untuk bulan: ' . $fungsi_bulan];
                        }

                        $status = false;

                        $message = array(
                            'status' => $status,
                            'token'  => $this->security->get_csrf_hash(),
                            'id'     => $layanan['id'],
                            'respon' => $respon,
                        );

                        $this->response($message, REST_Controller::HTTP_CREATED);

                        return false;
                    } else if ($fungsi_tahun < (date('Y')) - 1 || $fungsi_tahun > (date('Y')) + 1) {

                        if ($id !== '') {

                            $respon = ['show' => $show, 'status' => false, 'message' => 'Nilai tidak valid untuk tahun: ' . $fungsi_tahun . ' - harus antara ' . ((date('Y')) - 1) . ' dan ' . ((date('Y')) + 1), 'id' => $id];
                        } else {

                            $respon = ['show' => $show, 'status' => false, 'message' => 'Nilai tidak valid untuk tahun: ' . $fungsi_tahun . ' - harus antara ' . ((date('Y')) - 1) . ' dan ' . ((date('Y')) + 1)];
                        }

                        $status = false;

                        $message = array(
                            'status' => $status,
                            'token'  => $this->security->get_csrf_hash(),
                            'id'     => $layanan['id'],
                            'respon' => $respon,
                        );

                        $this->response($message, REST_Controller::HTTP_CREATED);

                        return false;
                    } else if ($fungsi_jam < 0 || $fungsi_jam > 23) {

                        if ($id !== '') {

                            $respon = ['show' => $show, 'status' => false, 'message' => 'Nilai tidak valid untuk jam: ' . $fungsi_jam, 'id' => $id];
                        } else {

                            $respon = ['show' => $show, 'status' => false, 'message' => 'Nilai tidak valid untuk jam: ' . $fungsi_jam];
                        }

                        $status = false;

                        $message = array(
                            'status' => $status,
                            'token'  => $this->security->get_csrf_hash(),
                            'id'     => $layanan['id'],
                            'respon' => $respon,
                        );

                        $this->response($message, REST_Controller::HTTP_CREATED);

                        return false;
                    } else if ($fungsi_menit < 0 || $fungsi_menit > 59) {

                        if ($id !== '') {

                            $respon = ['show' => $show, 'status' => false, 'message' => 'Nilai tidak valid untuk menit: ' . $fungsi_menit, 'id' => $id];
                        } else {

                            $respon = ['show' => $show, 'status' => false, 'message' => 'Nilai tidak valid untuk menit: ' . $fungsi_menit];
                        }

                        $status = false;

                        $message = array(
                            'status' => $status,
                            'token'  => $this->security->get_csrf_hash(),
                            'id'     => $layanan['id'],
                            'respon' => $respon,
                        );

                        $this->response($message, REST_Controller::HTTP_CREATED);

                        return false;
                    } else {

                        return true;
                    }
                }
            }
        } else {

            return true;
        }
    }

    function simpan_entri_keperawatan_post()
    {

        $layanan = array('id' => safe_post('id_layanan_pendaftaran'));

        $ek_tanggal_penerima = safe_post('ek_tanggal_verifikasi_penerima');
        $ek_tanggal_perawat = safe_post('ek_tanggal_ttd_perawat');
        $ek_tanggal_dokter = safe_post('ek_tanggal_verifikasi_dokter');

        $tanggal_selesai = safe_post('sirs_tanggal_selesai');
        $si_tanggal_mulai = safe_post('sirs_tanggal_mulai');
        $waktu_pslp_petugas = safe_post('plsp_tanggal_ttd_petugas');

        $cekTanggal = $this->cekDate('6', '', 'Tanggal Mulai pada A. Tempat di Rawat', $si_tanggal_mulai);

        if ($cekTanggal === false) {

            return false;

            exit();
        }

        $cekTanggalSelesai = $this->cekDate('6', '', 'Tanggal Selesai pada A. Tempat di Rawat', $tanggal_selesai);

        if ($cekTanggalSelesai === false) {

            return false;

            exit();
        }

        $cekTanggalPerawat = $this->cekDateTime('0', '#data-kontrol-kembali', 'Tanggal dan Jam Perawat yang merawat', $ek_tanggal_perawat);

        if ($cekTanggalPerawat === false) {

            return false;

            exit();
        }

        $cekTanggalDokter = $this->cekDateTime('0', '#data-kontrol-kembali', 'Tanggal dan Jam Dokter yang merawat', $ek_tanggal_dokter);

        if ($cekTanggalDokter === false) {

            return false;

            exit();
        }

        $cekTanggalPenerima = $this->cekDateTime('0', '#data-kontrol-kembali', 'Tanggal dan Jam Penerima', $ek_tanggal_penerima);

        if ($cekTanggalPenerima === false) {

            return false;

            exit();
        }

        $cekWaktuPSLPPetugas = $this->cekDateTime('5', '', 'Tanggal dan Jam Petugas Pengkajian Lanjutan Spiritual Pasien', $waktu_pslp_petugas);

        if ($cekWaktuPSLPPetugas === false) {

            return false;

            exit();
        }




        $this->db->trans_begin();

        $rk_id_layanan = array('id' => safe_post('rk_id_layanan_pendaftaran'));

        $id_rk = array('id' => safe_post('id_rk'));

        $id = $layanan['id'];

        $resume_keperawatan = array(
            'id_layanan_pendaftaran'            => $layanan['id'],
            'waktu'                             => $this->datetime,
            'ruang_resume_keperawatan'          => safe_post('ruang_resume_keperawatan') !== '' ? safe_post('ruang_resume_keperawatan') : NULL,
            'ek_diagnosa_masuk'                 => safe_post('rk_diagnosa_masuk') !== '' ? safe_post('rk_diagnosa_masuk') : NULL,
            'ek_diagnosa_keluar'                => safe_post('rk_diagnosa_keluar') !== '' ? safe_post('rk_diagnosa_keluar') : NULL,
            'ek_tensi_sis'                      => safe_post('ek_tensi_sis') !== '' ? safe_post('ek_tensi_sis') : NULL,
            'ek_tensi_dis'                      => safe_post('rk_tensi_dis') !== '' ? safe_post('rk_tensi_dis') : NULL,
            'ek_suhu'                           => safe_post('ek_suhu') !== '' ? safe_post('ek_suhu') : NULL,
            'ek_nadi'                           => safe_post('ek_nadi') !== '' ? safe_post('ek_nadi') : NULL,
            'ek_pernafasan'                     => safe_post('ek_pernafasan') !== '' ? safe_post('ek_pernafasan') : NULL,
            'diet_khusus'                       => json_encode(array(
                'diet_khusus' => safe_post('diet_khusus'),
                'sm_diet_khusus' => safe_post('sm_diet_khusus'),
            )),
            'batasan_cairan'                    => json_encode(array(
                'batasan_cairan' => safe_post('batasan_cairan'),
                'sm_batasan_cairan' => safe_post('sm_batasan_cairan'),
            )),
            'diet_oral'                         => safe_post('diet_oral') !== '' ? safe_post('diet_oral') : NULL,
            'diet_ngt'                          => safe_post('diet_ngt') !== '' ? safe_post('diet_ngt') : NULL,

            'bab'                               => safe_post('bab') !== '' ? safe_post('bab') : NULL,
            'bak'                               => safe_post('bak') !== '' ? safe_post('bak') : NULL,
            'bak_kateter'                       => (safe_post('bak_kateter') !== '' ? datetime2mysql(safe_post('bak_kateter')) : NULL),
            'luka'                              => safe_post('luka_operasi') !== '' ? safe_post('luka_operasi') : NULL,
            'luka_operasi_cairan'               => safe_post('sm_cairan_luka') !== '' ? safe_post('sm_cairan_luka') : NULL,
            'mobilisasi'                        => safe_post('mobilisasi') !== '' ? safe_post('mobilisasi') : NULL,
            'alat_bantu'                        => safe_post('alat_bantu') !== '' ? safe_post('alat_bantu') : NULL,
            'alat_bantu_lain'                   => safe_post('alat_bantu_lain') !== '' ? safe_post('alat_bantu_lain') : NULL,
            'edukasi'                           => json_encode(array(
                'edukasi_penyakit' => safe_post('edukasi_penyakit'),
                'edukasi_perawatan' => safe_post('edukasi_perawatan'),
                'edukasi_dirumah' => safe_post('edukasi_dirumah'),
                'edukasi_ibubayi' => safe_post('edukasi_ibubayi'),
                'edukasi_nyeri' => safe_post('edukasi_nyeri'),
                'edukasi_lingkungan' => safe_post('edukasi_lingkungan'),
                'edukasi_kb' => safe_post('edukasi_kb'),
                'edukasi_rehabilitas' => safe_post('edukasi_rehabilitas'),
                'edukasi_lain' => safe_post('edukasi_lain'),
                'edukasi_lain_input' => safe_post('edukasi_lain_input'),
            )),
            'diagnosa_perawat'                  => safe_post('diagnosa_perawat') !== '' ? safe_post('diagnosa_perawat') : NULL,
            'diagnosa_perawat_satu'             => safe_post('diagnosa_perawat_satu') !== '' ? safe_post('diagnosa_perawat_satu') : NULL,
            'anjuran_perawat'                   => safe_post('anjuran_perawat') !== '' ? safe_post('anjuran_perawat') : NULL,
            'anjuran_perawat_satu'              => safe_post('anjuran_perawat_satu') !== '' ? safe_post('anjuran_perawat_satu') : NULL,
            'anjuran_perawat_dua'               => safe_post('anjuran_perawat_dua') !== '' ? safe_post('anjuran_perawat_dua') : NULL,
            'anjuran_perawat_tiga'              => safe_post('anjuran_perawat_tiga') !== '' ? safe_post('anjuran_perawat_tiga') : NULL,
            'kontraksi'                         => safe_post('kontraksi') !== '' ? safe_post('kontraksi') : NULL,
            'fundus'                            => safe_post('fundus_uteri') !== '' ? safe_post('fundus_uteri') : NULL,
            'vulva'                             => safe_post('vulva') !== '' ? safe_post('vulva') : NULL,
            'perineum'                          => safe_post('perineum') !== '' ? safe_post('perineum') : NULL,
            'lochaea'                           => safe_post('lochaea') !== '' ? safe_post('lochaea') : NULL,
            'warna'                             => safe_post('warna_lochaea') !== '' ? safe_post('warna_lochaea') : NULL,
            'bau_lochaea'                       => safe_post('bau_lochaea') !== '' ? safe_post('bau_lochaea') : NULL,
            'hasil_lab'                         => safe_post('hasil_lab') !== '' ? safe_post('hasil_lab') : NULL,
            'ekg'                               => safe_post('ekg') !== '' ? safe_post('ekg') : NULL,
            'rontgen'                           => safe_post('foto_rontgen') !== '' ? safe_post('foto_rontgen') : NULL,
            'mri'                               => safe_post('mri') !== '' ? safe_post('mri') : NULL,
            'ct_scan'                           => safe_post('ct_scan') !== '' ? safe_post('ct_scan') : NULL,
            'usg'                               => safe_post('usg') !== '' ? safe_post('usg') : NULL,
            'surat_kontrol'                     => safe_post('surat_kontrol') !== '' ? safe_post('surat_kontrol') : NULL,
            'resume'                            => safe_post('resume_medis') !== '' ? safe_post('resume_medis') : NULL,
            'hasil_satu'                        => safe_post('hasil_satu') !== '' ? safe_post('hasil_satu') : NULL,
            'surat_asuransi'                    => safe_post('surat_asuransi') !== '' ? safe_post('surat_asuransi') : NULL,
            'hasil_dua'                         => safe_post('hasil_dua') !== '' ? safe_post('hasil_dua') : NULL,
            'summary'                           => safe_post('summary_pasien') !== '' ? safe_post('summary_pasien') : NULL,
            'hasil_tiga'                        => safe_post('hasil_tiga') !== '' ? safe_post('hasil_tiga') : NULL,
            'suket_lahir'                       => safe_post('suket_lahir') !== '' ? safe_post('suket_lahir') : NULL,
            'hasil_empat'                       => safe_post('hasil_empat') !== '' ? safe_post('hasil_empat') : NULL,
            'bayi_diserahkan'                   => safe_post('bayi_diserahkan') !== '' ? safe_post('bayi_diserahkan') : NULL,
            'hasil_lima'                        => safe_post('hasil_lima') !== '' ? safe_post('hasil_lima') : NULL,
            'lain_lain'                         => safe_post('lain_lain') !== '' ? safe_post('lain_lain') : NULL,
            'id_perawat_medis'                  => safe_post('perawat_medis') !== '' ? safe_post('perawat_medis') : NULL,
            'id_verifikasi_dokter'              => safe_post('verifikasi_dokter') !== '' ? safe_post('verifikasi_dokter') : NULL,
            'id_users'                          => safe_post('id_users') !== '' ? safe_post('id_users') : NULL,
        );

        if ($id_rk['id'] !== '') {

            if ($layanan['id'] === $rk_id_layanan['id']) {

                $id_resume = $id_rk['id'];

                $id_layanan =  $this->db->select("srk.id, srk.ek_ttd_pasien, srk.penerima, srk.ek_tanggal_ttd_perawat, srk.ek_ttd_perawat, srk.ek_tanggal_verifikasi_dokter, srk.ek_ttd_verifikasi_dokter, srk.ek_tanggal_verifikasi_penerima")
                    ->from('sm_resume_keperawatan as srk')
                    ->where('srk.id', $id_resume, true)
                    ->get()
                    ->row();

                if ($id_layanan->ek_tanggal_verifikasi_dokter !== NULL) :
                    $resume_keperawatan['ek_tanggal_verifikasi_dokter'] = $id_layanan->ek_tanggal_verifikasi_dokter;
                else :
                    $resume_keperawatan['ek_tanggal_verifikasi_dokter'] = (safe_post('ek_tanggal_verifikasi_dokter') !== '' ? datetime2mysql(safe_post('ek_tanggal_verifikasi_dokter')) : NULL);
                endif;

                if ($id_layanan->ek_ttd_verifikasi_dokter !== NULL) :
                    $resume_keperawatan['ek_ttd_verifikasi_dokter'] = $id_layanan->ek_ttd_verifikasi_dokter;
                else :
                    $resume_keperawatan['ek_ttd_verifikasi_dokter'] = safe_post('ek_ttd_verifikasi_dokter') !== '' ? safe_post('ek_ttd_verifikasi_dokter') : NULL;
                endif;

                if ($id_layanan->ek_ttd_perawat !== NULL) :
                    $resume_keperawatan['ek_ttd_perawat'] = $id_layanan->ek_ttd_perawat;
                else :
                    $resume_keperawatan['ek_ttd_perawat'] = safe_post('ek_ttd_perawat') !== '' ? safe_post('ek_ttd_perawat') : NULL;
                endif;

                if ($id_layanan->ek_tanggal_ttd_perawat !== NULL) :
                    $resume_keperawatan['ek_tanggal_ttd_perawat'] = $id_layanan->ek_tanggal_ttd_perawat;
                else :
                    $resume_keperawatan['ek_tanggal_ttd_perawat'] = (safe_post('ek_tanggal_ttd_perawat') !== '' ? datetime2mysql(safe_post('ek_tanggal_ttd_perawat')) : NULL);
                endif;

                if ($id_layanan->ek_tanggal_verifikasi_penerima !== NULL) :
                    $resume_keperawatan['ek_tanggal_verifikasi_penerima'] = $id_layanan->ek_tanggal_verifikasi_penerima;
                else :
                    $resume_keperawatan['ek_tanggal_verifikasi_penerima'] = (safe_post('ek_tanggal_verifikasi_penerima') !== '' ? datetime2mysql(safe_post('ek_tanggal_verifikasi_penerima')) : NULL);
                endif;

                if ($id_layanan->penerima !== NULL) :
                    $resume_keperawatan['penerima'] = $id_layanan->penerima;
                else :
                    $resume_keperawatan['penerima'] = safe_post('verifikasi_penerima') !== '' ? safe_post('verifikasi_penerima') : NULL;
                endif;

                if ($id_layanan->ek_ttd_pasien !== NULL) :
                    $resume_keperawatan['ek_ttd_pasien'] = $id_layanan->ek_ttd_pasien;
                else :
                    $resume_keperawatan['ek_ttd_pasien'] = safe_post('ek_ttd_pasien') !== '' ? safe_post('ek_ttd_pasien') : NULL;
                endif;

                $resume_keperawatan['updated_date'] = $this->datetime;

                $this->db->where('id', $id_resume)->update('sm_resume_keperawatan', $resume_keperawatan);
            } else {

                $id_resume = $id_rk['id'];

                $rk['updated_date'] = $this->datetime;

                $this->db->where('id', $id_resume)->update('sm_resume_keperawatan', $rk);
            }
        } else {

            if ($resume_keperawatan['ek_suhu'] !== null) {

                $resume_keperawatan['ek_tanggal_ttd_perawat'] = (safe_post('ek_tanggal_ttd_perawat') !== '' ? datetime2mysql(safe_post('ek_tanggal_ttd_perawat')) : NULL);

                $resume_keperawatan['ek_ttd_perawat'] = safe_post('ek_ttd_perawat') !== '' ? safe_post('ek_ttd_perawat') : NULL;
                $resume_keperawatan['ek_tanggal_verifikasi_dokter'] = (safe_post('ek_tanggal_verifikasi_dokter') !== '' ? datetime2mysql(safe_post('ek_tanggal_verifikasi_dokter')) : NULL);

                $resume_keperawatan['ek_ttd_verifikasi_dokter'] = safe_post('ek_ttd_verifikasi_dokter') !== '' ? safe_post('ek_ttd_verifikasi_dokter') : NULL;
                $resume_keperawatan['ek_tanggal_verifikasi_penerima'] = (safe_post('ek_tanggal_verifikasi_penerima') !== '' ? datetime2mysql(safe_post('ek_tanggal_verifikasi_penerima')) : NULL);

                $resume_keperawatan['penerima'] = safe_post('verifikasi_penerima') !== '' ? safe_post('verifikasi_penerima') : NULL;
                $resume_keperawatan['ek_ttd_pasien'] = safe_post('ek_ttd_pasien') !== '' ? safe_post('ek_ttd_pasien') : NULL;

                $this->m_pelayanan->updateResumeKeperawatan($resume_keperawatan);
            }
        }







        // APBT
        $checkDataAsessmentPraBedah = array(
            'id_layanan_pendaftaran'            => $layanan['id'],
            'id_pendaftaran'                    => safe_post('id_pendaftaran'),
            'id_users'                          => $this->session->userdata('id_translucent'),
            'id_apbt'                           => safe_post('id_apbt'),

            'tanggal_waktu'                     => $this->datetime,
            // 'tanggal_waktu'                  => (safe_post('tanggal_waktu_asessment') !== '' ? datetime2mysql(safe_post('tanggal_waktu_asessment')) : NULL),
            'apb_suhu'                          => safe_post('apb_suhu') !== '' ? safe_post('apb_suhu') : NULL,
            'apb_pernafasan'                    => safe_post('apb_pernafasan') !== '' ? safe_post('apb_pernafasan') : NULL,
            'apb_bb'                            => safe_post('apb_berat_badan') !== '' ? safe_post('apb_berat_badan') : NULL,
            'apb_nadi'                          => safe_post('apb_nadi') !== '' ? safe_post('apb_nadi') : NULL,
            'apb_tensi_sis'                     => safe_post('apb_tensi_sis') !== '' ? safe_post('apb_tensi_sis') : NULL,
            'apb_tensi_dis'                     => safe_post('apb_tensi_dis') !== '' ? safe_post('apb_tensi_dis') : NULL,
            'apb_riwayat_alergi'                => safe_post('apb_riwayat_alergi') !== '' ? safe_post('apb_riwayat_alergi') : NULL,
            'apb_ket_riwayat_alergi'            => safe_post('apb_ket_riwayat_alergi') !== '' ? safe_post('apb_ket_riwayat_alergi') : NULL,
            'apb_keluhan_utama'                 => safe_post('apb_keluhan_utama') !== '' ? safe_post('apb_keluhan_utama') : NULL,
            'apb_rps'                           => safe_post('apb_rps') !== '' ? safe_post('apb_rps') : NULL,
            'apb_riwayat_penyakit_terdahulu'    => safe_post('apb_rpt') !== '' ? safe_post('apb_rpt') : NULL,
            'pemeriksaan_fisik'                 => safe_post('apb_pemeriksaan_fisik') !== '' ? safe_post('apb_pemeriksaan_fisik') : NULL,
            'pemeriksaan_banding'               => safe_post('apb_pemeriksaan_banding') !== '' ? safe_post('apb_pemeriksaan_banding') : NULL,
            'labolatorium'                      => safe_post('apb_laboratorium') !== '' ? safe_post('apb_laboratorium') : NULL,
            'diagnosa_pra_bedah'                => safe_post('apb_diagnosis') !== '' ? safe_post('apb_diagnosis') : NULL,
            'diagnosis_banding'                 => safe_post('apb_diagnosis_banding') !== '' ? safe_post('apb_diagnosis_banding') : NULL,
            'permasalahan'                      => safe_post('apb_permasalahan') !== '' ? safe_post('apb_permasalahan') : NULL,
            'apb_rawat_inap'                    => safe_post('apb_rawat_inap') !== '' ? safe_post('apb_rawat_inap') : NULL,
            'apb_rawat_inap_indikasi'           => safe_post('apb_rawat_inap_indikasi') !== '' ? safe_post('apb_rawat_inap_indikasi') : NULL,
            'is_pasien'                         => safe_post('apb_pasien') !== '' ? safe_post('apb_pasien') : NULL,
            'is_keluarga'                       => safe_post('apb_keluarga') !== '' ? safe_post('apb_keluarga') : NULL,
            'hubungan_keluarga'                 => safe_post('apb_riwayat_hk') !== '' ? safe_post('apb_riwayat_hk') : NULL,
            'nama_keluarga'                     => safe_post('apb_keluarga_keterangan') !== '' ? safe_post('apb_keluarga_keterangan') : NULL,
            'is_edukasi'                        => safe_post('apb_tidak_edukasi') !== '' ? safe_post('apb_tidak_edukasi') : NULL,
            'alasan_edukasi'                    => safe_post('apb_keterangan_edukasi') !== '' ? safe_post('apb_keterangan_edukasi') : NULL,
            // 'apb_tanggal_dokter_dpjp'            => (safe_post('apb_tanggal_verifiaksi_dokter_dpjp') !== '' ? datetime2mysql(safe_post('apb_tanggal_verifiaksi_dokter_dpjp')) : NULL),
            // 'apb_tanggal_pasien'             => (safe_post('apb_tanggal_verifiaksi_pasien') !== '' ? datetime2mysql(safe_post('apb_tanggal_verifiaksi_pasien')) : NULL),
            'apb_tanggal_dokter_dpjp'           => $this->datetime,
            'apb_tanggal_pasien'                => $this->datetime,
            'id_dokter_dpjp'                    => safe_post('apb_dokter_dpjp') !== '' ? safe_post('apb_dokter_dpjp') : NULL,
            'apb_pasien'                        => safe_post('apb_pasien_asesment') !== '' ? safe_post('apb_pasien_asesment') : NULL,
            'apb_verifikasi_dokter_dpjp'        => safe_post('apb_ttd_dokter_dpjp') !== '' ? safe_post('apb_ttd_dokter_dpjp') : NULL,
            'apb_verifikasi_pasien'             => safe_post('apb_ttd_pasien_dpjp') !== '' ? safe_post('apb_ttd_pasien_dpjp') : NULL,
            'apb_rencana_operasi'               => safe_post('apb_rto') !== '' ? safe_post('apb_rto') : NULL,
            'apb_status_nutrisi'                => safe_post('apb_status_nutrisi') !== '' ? safe_post('apb_status_nutrisi') : NULL,
            'apb_status_nutrisi'                => safe_post('apb_status_nutrisi') !== '' ? safe_post('apb_status_nutrisi') : NULL,
            'apb_status_nutrisi'                => safe_post('apb_status_nutrisi') !== '' ? safe_post('apb_status_nutrisi') : NULL,
            'apb_rawat_inap'                    => safe_post('rawat_inap') !== '' ? safe_post('rawat_inap') : NULL,
            'apb_indikasi_ranap'               => safe_post('apb_indikasi_ranap') !== '' ? safe_post('apb_indikasi_ranap') : NULL,
        );

        $sign = $this->db->select('apb.tanggal_waktu, apb_tanggal_dokter_dpjp, apb_tanggal_pasien, apb_verifikasi_dokter_dpjp, apb_verifikasi_pasien')
            ->from('sm_asessmen_pra_bedah as apb')
            ->where('apb.id_pendaftaran', $layanan['id'])
            ->get()
            ->row();

        if (isset($sign)) :
            if ($sign->tanggal_waktu !== NULL) :
                $checkDataAsessmentPraBedah['tanggal_waktu'] = $sign->tanggal_waktu;
            else :
                $checkDataAsessmentPraBedah['tanggal_waktu'] = (safe_post('tanggal_waktu_asessment') !== '' ? datetime2mysql(safe_post('tanggal_waktu_asessment')) : NULL);
            endif;
            if ($sign->apb_tanggal_dokter_dpjp !== NULL) :
                $checkDataAsessmentPraBedah['apb_tanggal_dokter_dpjp'] = $sign->apb_tanggal_dokter_dpjp;
            else :
                $checkDataAsessmentPraBedah['apb_tanggal_dokter_dpjp'] = (safe_post('apb_tanggal_verifiaksi_dokter_dpjp') !== '' ? datetime2mysql(safe_post('apb_tanggal_verifiaksi_dokter_dpjp')) : NULL);
            endif;
            if ($sign->apb_tanggal_pasien !== NULL) :
                $checkDataAsessmentPraBedah['apb_tanggal_pasien'] = $sign->apb_tanggal_pasien;
            else :
                $checkDataAsessmentPraBedah['apb_tanggal_pasien'] = (safe_post('apb_tanggal_verifiaksi_pasien') !== '' ? datetime2mysql(safe_post('apb_tanggal_verifiaksi_pasien')) : NULL);
            endif;

            if ($sign->apb_verifikasi_dokter_dpjp !== NULL) :
                $checkDataAsessmentPraBedah['apb_verifikasi_dokter_dpjp'] = $sign->apb_verifikasi_dokter_dpjp;
            else :
                $checkDataAsessmentPraBedah['apb_verifikasi_dokter_dpjp'] = (safe_post('apb_ttd_dokter_dpjp') !== '' ? safe_post('apb_ttd_dokter_dpjp') : NULL);
            endif;
            if ($sign->apb_verifikasi_pasien !== NULL) :
                $checkDataAsessmentPraBedah['apb_verifikasi_pasien'] = $sign->apb_verifikasi_pasien;
            else :
                $checkDataAsessmentPraBedah['apb_verifikasi_pasien'] = (safe_post('apb_ttd_pasien_dpjp') !== '' ? safe_post('apb_ttd_pasien_dpjp') : NULL);
            endif;
        endif;
        $this->m_pelayanan->updateAssesmentPraBedah($checkDataAsessmentPraBedah);






        $pengkajian_lanjutan = array(
            'id_layanan_pendaftaran'            => $layanan['id'],
            'anamnesis_pasien_terima'           => safe_post('pasien_terima') !== '' ? safe_post('pasien_terima') : NULL,
            'anamnesis_pasien_tabah'            => safe_post('pasien_tabah') !== '' ? safe_post('pasien_tabah') : NULL,
            'anamnesis_pasien_sabar'            => safe_post('pasien_sabar') !== '' ? safe_post('pasien_sabar') : NULL,
            'anamnesis_keluarga_terima'         => safe_post('keluarga_terima') !== '' ? safe_post('keluarga_terima') : NULL,
            'anamnesis_keluarga_tabah'          => safe_post('keluarga_tabah') !== '' ? safe_post('keluarga_tabah') : NULL,
            'anamnesis_keluarga_sabar'          => safe_post('keluarga_sabar') !== '' ? safe_post('keluarga_sabar') : NULL,
            'anamnesis_ekspresi_senyum'         => safe_post('ekspresi_senyum') !== '' ? safe_post('ekspresi_senyum') : NULL,
            'anamnesis_ekspresi_ikut'           => safe_post('ekspresi_mengikuti') !== '' ? safe_post('ekspresi_mengikuti') : NULL,
            'anamnesis_ekspresi_nasihat'        => safe_post('ekspresi_nasihat') !== '' ? safe_post('ekspresi_nasihat') : NULL,
            'anamnesis_ekspresi_semangat'       => safe_post('ekspresi_semangat') !== '' ? safe_post('ekspresi_semangat') : NULL,
            'anamnesis_ekspresi_pasrah'         => safe_post('ekspresi_pasrah') !== '' ? safe_post('ekspresi_pasrah') : NULL,
            'anamnesis_penilaian'               => safe_post('penilaian_satu_positif') !== '' ? safe_post('penilaian_satu_positif') : NULL,
            'kesimpulan_kiri'                   => safe_post('kesimpulan_kiri') !== '' ? safe_post('kesimpulan_kiri') : NULL,
            'pemeriksaan_pasien_sebelum'        => safe_post('pasien_belum_disiplin') !== '' ? safe_post('pasien_belum_disiplin') : NULL,
            'pemeriksaan_pasien_sesudah'        => safe_post('pasien_sudah_disiplin') !== '' ? safe_post('pasien_sudah_disiplin') : NULL,
            'pemeriksaan_keluarga_belum'        => safe_post('keluarga_belum_disiplin') !== '' ? safe_post('keluarga_belum_disiplin') : NULL,
            'pemeriksaan_keluarga_sudah'        => safe_post('keluarga_sudah_disiplin') !== '' ? safe_post('keluarga_sudah_disiplin') : NULL,
            'pemeriksaan_media_bersuci'         => safe_post('keluarga_media_wudhu') !== '' ? safe_post('keluarga_media_wudhu') : NULL,
            'pemeriksaan_keluarga'              => json_encode(array(
                'keluarga_hafalan_alfatihah' => safe_post('keluarga_hafalan_alfatihah'),
                'keluarga_hafalan_rukuk' => safe_post('keluarga_hafalan_rukuk'),
                'keluarga_hafalan_sujud' => safe_post('keluarga_hafalan_sujud'),
                'keluarga_hafalan_tasyahud' => safe_post('keluarga_hafalan_tasyahud'),

            )),
            'pemeriksaan_penilaian'         => safe_post('penilaian_dua_positif') !== '' ? safe_post('penilaian_dua_positif') : NULL,
            'kesimpulan_kanan'                  => safe_post('kesimpulan_kanan') !== '' ? safe_post('kesimpulan_kanan') : NULL,
            'rencana_terapi'                    => json_encode(array(
                'rencana_motivasi' => safe_post('rencana_motivasi'),
                'pendampingan_umum' => safe_post('pendampingan_umum'),
                'fiqih_pasien' => safe_post('fiqih_pasien'),
                'pendampingan_khusus' => safe_post('pendampingan_khusus'),
                'fiqih_wanita' => safe_post('fiqih_wanita'),
                'ruqyah_syariyah' => safe_post('ruqyah_syariyah'),
                'bimbingan_doa' => safe_post('bimbingan_doa'),
                'terapi_tahajud' => safe_post('terapi_tahajud'),
                'bimbingan_membaca' => safe_post('bimbingan_membaca'),
                'terapi_dzikir' => safe_post('terapi_dzikir'),
                'motivasi_keluarga' => safe_post('motivasi_keluarga'),
                'manajemen_nyeri' => safe_post('manajemen_nyeri'),
                'anjuran_sedekah' => safe_post('anjuran_sedekah'),
            )),
            'perawat_terapi'                    => safe_post('perawat_terapi') !== '' ? safe_post('perawat_terapi') : NULL,
            'id_users'                          => safe_post('id_users') !== '' ? safe_post('id_users') : NULL,
        );

        $id_spiritual_pasien =  $this->db->select("ssp.id, ssp.ttd_petugas, ssp.plsp_tanggal_ttd_petugas")
            ->from('sm_spiritual_pasien as ssp')
            ->where('ssp.id_layanan_pendaftaran', $id, true)
            ->get()
            ->row();

        if (isset($id_spiritual_pasien)) {

            $id_ssp = $id_spiritual_pasien->id;

            if ($id_spiritual_pasien->ttd_petugas !== NULL) :
                $pengkajian_lanjutan['ttd_petugas'] = $id_spiritual_pasien->ttd_petugas;
            else :
                $pengkajian_lanjutan['ttd_petugas'] = safe_post('ttd_petugas') !== '' ? safe_post('ttd_petugas') : NULL;
            endif;

            if ($id_spiritual_pasien->plsp_tanggal_ttd_petugas !== NULL) :
                $pengkajian_lanjutan['plsp_tanggal_ttd_petugas'] = $id_spiritual_pasien->plsp_tanggal_ttd_petugas;
            else :
                $pengkajian_lanjutan['plsp_tanggal_ttd_petugas'] = (safe_post('plsp_tanggal_ttd_petugas') !== '' ? datetime2mysql(safe_post('plsp_tanggal_ttd_petugas')) : NULL);
            endif;

            $pengkajian_lanjutan['updated_date'] = $this->datetime;

            $this->db->where('id', $id_ssp)->update('sm_spiritual_pasien', $pengkajian_lanjutan);
        } else {

            $pengkajian_lanjutan['plsp_tanggal_ttd_petugas'] = (safe_post('plsp_tanggal_ttd_petugas') !== '' ? datetime2mysql(safe_post('plsp_tanggal_ttd_petugas')) : NULL);

            $pengkajian_lanjutan['ttd_petugas'] = safe_post('ttd_petugas') !== '' ? safe_post('ttd_petugas') : NULL;

            $this->m_pelayanan->updatePengkajianLanjutan($pengkajian_lanjutan);
        }

        $pslw_tanggal_pemantauan = safe_post('tanggal_pemantauan');


        if ($pslw_tanggal_pemantauan) {

            $pslw_tanggal = is_string($pslw_tanggal_pemantauan);

            if ($pslw_tanggal_pemantauan === "" || $pslw_tanggal_pemantauan === null) {

                $pslw_pemantauan = null;
            } else if (!is_array($pslw_tanggal_pemantauan)) {


                $pslw_pemantauan = null;
            } else if (empty($pslw_tanggal_pemantauan)) {


                $pslw_pemantauan = null;
            } else if ($pslw_tanggal === true) {


                $pslw_pemantauan = null;
            } else {

                foreach ($pslw_tanggal_pemantauan as $key => $value) {

                    $date = new DateTime($value);
                    $new = $date->format('Y-m-d H:i:s');


                    $pslw_pemantauan[$key] = $new;
                }
            }



            $pemantauan_sholat = array(
                'id_layanan_pendaftaran'            => $layanan['id'],
                'tanggal_pemantauan'                => $pslw_pemantauan,
                'sholat_subuh'                      => safe_post('sholat_subuh') !== '' ? safe_post('sholat_subuh') : NULL,
                'sholat_dzuhur'                     => safe_post('sholat_dzuhur') !== '' ? safe_post('sholat_dzuhur') : NULL,
                'sholat_ashar'                      => safe_post('sholat_ashar') !== '' ? safe_post('sholat_ashar') : NULL,
                'sholat_maghrib'                    => safe_post('sholat_maghrib') !== '' ? safe_post('sholat_maghrib') : NULL,
                'sholat_isya'                       => safe_post('sholat_isya') !== '' ? safe_post('sholat_isya') : NULL,
                'petugas_pemantau'                  => safe_post('petugas_pemantau') !== '' ? safe_post('petugas_pemantau') : NULL,
                'user_pantau'                       => safe_post('user_pantau') !== '' ? safe_post('user_pantau') : NULL,
            );


            $this->m_pelayanan->updatePemantauanSholat($pemantauan_sholat);
        } else {

            $slw_tanggal_pemantauan = safe_post('pslw_tanggal_pemantauan');

            if (!empty($slw_tanggal_pemantauan)) {

                $respon = ['show' => '5', 'status' => false, 'message' => 'Pemantauan Shalat Lima Waktu Selama di RS Belum ditambahkan', 'id' => '#data-pemantauan-shalat'];
            }
        }

        $ssc_tanggal_sign_in = safe_post('ssc_tanggal_sign_in');
        $ssc_tanggal_time_out = safe_post('ssc_tanggal_time_out');
        $ssc_tanggal_sign_out = safe_post('ssc_tanggal_sign_out');
        if ($ssc_tanggal_sign_in || $ssc_tanggal_time_out || $ssc_tanggal_sign_out) {

            $surgicalCeklis = array(
                'id_layanan_pendaftaran'                => $layanan['id'],
                'id_pendaftaran'                        => safe_post('id_pendaftaran'),
                'ssc_tanggal_sign_in'                   => safe_post('ssc_tanggal_sign_in'),
                'ssc_tanggal_time_out'                  => safe_post('ssc_tanggal_time_out'),
                'ssc_tanggal_sign_out'                  => safe_post('ssc_tanggal_sign_out'),
                'user_surgical_safety_ceklis'           => safe_post('user_surgical_safety_ceklis')         !== '' ? safe_post('user_surgical_safety_ceklis') : NULL,

                // sign in
                'ssc_gelang'                            => safe_post('ssc_gelang')                          !== '' ? safe_post('ssc_gelang') : NULL,
                'ssc_informed'                          => safe_post('ssc_informed')                        !== '' ? safe_post('ssc_informed') : NULL,
                'ssc_dokter_bedah'                      => safe_post('ssc_dokter_bedah')                    !== '' ? safe_post('ssc_dokter_bedah') : NULL,
                'ssc_anestesi'                          => safe_post('ssc_anestesi')                        !== '' ? safe_post('ssc_anestesi') : NULL,
                'ssc_dokter_operator'                   => safe_post('ssc_dokter_operator')                 !== '' ? safe_post('ssc_dokter_operator') : NULL,
                'ssc_dokter_anestesi'                   => safe_post('ssc_dokter_anestesi')                 !== '' ? safe_post('ssc_dokter_anestesi') : NULL,
                'ssc_nama_tindakan'                     => safe_post('ssc_nama_tindakan')                   !== '' ? safe_post('ssc_nama_tindakan') : NULL,
                'ssc_lokasi'                            => safe_post('ssc_lokasi')                          !== '' ? safe_post('ssc_lokasi') : NULL,
                'ssc_mesin_anestesi'                    => safe_post('ssc_mesin_anestesi')                  !== '' ? safe_post('ssc_mesin_anestesi') : NULL,
                'ssc_obat'                              => safe_post('ssc_obat')                            !== '' ? safe_post('ssc_obat') : NULL,
                'ssc_oximeter'                          => safe_post('ssc_oximeter')                        !== '' ? safe_post('ssc_oximeter') : NULL,
                'ssc_lab'                               => safe_post('ssc_lab')                             !== '' ? safe_post('ssc_lab') : NULL,
                'ssc_line'                              => safe_post('ssc_line')                            !== '' ? safe_post('ssc_line') : NULL,
                'ssc_tekanan_darah'                     => safe_post('ssc_tekanan_darah')                   !== '' ? safe_post('ssc_tekanan_darah') : NULL,
                'ssc_nadi'                              => safe_post('ssc_nadi')                            !== '' ? safe_post('ssc_nadi') : NULL,
                'ssc_pernafasan'                        => safe_post('ssc_pernafasan')                      !== '' ? safe_post('ssc_pernafasan') : NULL,
                'ssc_saturasi'                          => safe_post('ssc_saturasi')                        !== '' ? safe_post('ssc_saturasi') : NULL,
                'ssc_suhu'                              => safe_post('ssc_suhu')                            !== '' ? safe_post('ssc_suhu') : NULL,
                'ssc_alergi'                            => safe_post('ssc_alergi')                          !== '' ? safe_post('ssc_alergi') : NULL,
                'ssc_alergi_ket'                        => safe_post('ssc_alergi_ket')                      !== '' ? safe_post('ssc_alergi_ket') : NULL,
                'ssc_aspirasi'                          => safe_post('ssc_aspirasi')                        !== '' ? safe_post('ssc_aspirasi') : NULL,
                'ssc_pendarahan'                        => safe_post('ssc_pendarahan')                      !== '' ? safe_post('ssc_pendarahan') : NULL,
                'ssc_rencana_anestesi'                  => safe_post('ssc_rencana_anestesi')                !== '' ? safe_post('ssc_rencana_anestesi') : NULL,
                'ssc_paraf_perawat_sign_in'             => safe_post('ssc_paraf_perawat_sign_in')           !== '' ? safe_post('ssc_paraf_perawat_sign_in') : NULL,
                'ssc_perawat_sign_in'                   => safe_post('ssc_perawat_sign_in')                 !== '' ? safe_post('ssc_perawat_sign_in') : NULL,
                'ssc_paraf_dokter_anestesi_sign_in'     => safe_post('ssc_paraf_dokter_anestesi_sign_in')   !== '' ? safe_post('ssc_paraf_dokter_anestesi_sign_in') : NULL,
                'ssc_dokter_anestesi_sign_in'           => safe_post('ssc_dokter_anestesi_sign_in')         !== '' ? safe_post('ssc_dokter_anestesi_sign_in') : NULL,

                // time out
                'ssc_lengkap'                           => safe_post('ssc_lengkap')                         !== '' ? safe_post('ssc_lengkap') : NULL,
                'ssc_alasan'                            => safe_post('ssc_alasan')                          !== '' ? safe_post('ssc_alasan') : NULL,
                'ssc_instrument'                        => safe_post('ssc_instrument')                      !== '' ? safe_post('ssc_instrument') : NULL,
                'ssc_kassa'                             => safe_post('ssc_kassa')                           !== '' ? safe_post('ssc_kassa') : NULL,
                'ssc_jarum'                             => safe_post('ssc_jarum')                           !== '' ? safe_post('ssc_jarum') : NULL,
                'ssc_tanggal_tindakan'                  => safe_post('ssc_tanggal_tindakan')                !== '' ? safe_post('ssc_tanggal_tindakan') : NULL,
                'ssc_identitas_pasien'                  => safe_post('ssc_identitas_pasien')                !== '' ? safe_post('ssc_identitas_pasien') : NULL,
                'ssc_nama_tindakan_time_out'            => safe_post('ssc_nama_tindakan_time_out')          !== '' ? safe_post('ssc_nama_tindakan_time_out') : NULL,
                'ssc_prosedur_tindakan'                 => safe_post('ssc_prosedur_tindakan')               !== '' ? safe_post('ssc_prosedur_tindakan') : NULL,
                'ssc_lokasi_tindakan'                   => safe_post('ssc_lokasi_tindakan')                 !== '' ? safe_post('ssc_lokasi_tindakan') : NULL,
                'ssc_consent'                           => safe_post('ssc_consent')                         !== '' ? safe_post('ssc_consent') : NULL,
                'ssc_premedikasi'                       => safe_post('ssc_premedikasi')                     !== '' ? safe_post('ssc_premedikasi') : NULL,
                'ssc_premedikasi_obat'                  => safe_post('ssc_premedikasi_obat')                !== '' ? safe_post('ssc_premedikasi_obat') : NULL,
                'ssc_tanggal_obat'                      => safe_post('ssc_tanggal_obat')                    !== '' ? safe_post('ssc_tanggal_obat') : NULL,
                'ssc_antibiotik'                        => safe_post('ssc_antibiotik')                      !== '' ? safe_post('ssc_antibiotik') : NULL,
                'ssc_antibiotik_obat'                   => safe_post('ssc_antibiotik_obat')                 !== '' ? safe_post('ssc_antibiotik_obat') : NULL,
                'ssc_antibiotik_dosis'                  => safe_post('ssc_antibiotik_dosis')                !== '' ? safe_post('ssc_antibiotik_dosis') : NULL,
                'ssc_jam_antibiotik_obat'               => safe_post('ssc_jam_antibiotik_obat')             !== '' ? safe_post('ssc_jam_antibiotik_obat') : NULL,
                'ssc_foto'                              => safe_post('ssc_foto')                            !== '' ? safe_post('ssc_foto') : NULL,
                'ssc_implant'                           => safe_post('ssc_implant')                         !== '' ? safe_post('ssc_implant') : NULL,
                'ssc_jenis'                             => safe_post('ssc_jenis')                           !== '' ? safe_post('ssc_jenis') : NULL,
                'ssc_jenis_ket'                         => safe_post('ssc_jenis_ket')                       !== '' ? safe_post('ssc_jenis_ket') : NULL,
                'ssc_paraf_perawat_time_out'            => safe_post('ssc_paraf_perawat_time_out')          !== '' ? safe_post('ssc_paraf_perawat_time_out') : NULL,
                'ssc_perawat_time_out'                  => safe_post('ssc_perawat_time_out')                !== '' ? safe_post('ssc_perawat_time_out') : NULL,
                'ssc_paraf_dokter_anestesi_time_out'    => safe_post('ssc_paraf_dokter_anestesi_time_out')  !== '' ? safe_post('ssc_paraf_dokter_anestesi_time_out') : NULL,
                'ssc_dokter_anestesi_time_out'          => safe_post('ssc_dokter_anestesi_time_out')        !== '' ? safe_post('ssc_dokter_anestesi_time_out') : NULL,

                // sign out
                'ssc_nama_tindakan_sign_out'            => safe_post('ssc_nama_tindakan_sign_out')          !== '' ? safe_post('ssc_nama_tindakan_sign_out') : NULL,
                'ssc_instrument_sign_out'               => safe_post('ssc_instrument_sign_out')             !== '' ? safe_post('ssc_instrument_sign_out') : NULL,
                'ssc_kassa_sign_out'                    => safe_post('ssc_kassa_sign_out')                  !== '' ? safe_post('ssc_kassa_sign_out') : NULL,
                'ssc_jarum_sign_out'                    => safe_post('ssc_jarum_sign_out')                  !== '' ? safe_post('ssc_jarum_sign_out') : NULL,
                'ssc_preparat'                          => safe_post('ssc_preparat')                        !== '' ? safe_post('ssc_preparat') : NULL,
                'ssc_preparat_pa'                       => safe_post('ssc_preparat_pa')                     !== '' ? safe_post('ssc_preparat_pa') : NULL,
                'ssc_preparat_kultur'                   => safe_post('ssc_preparat_kultur')                 !== '' ? safe_post('ssc_preparat_kultur') : NULL,
                'ssc_preparat_sitologi'                 => safe_post('ssc_preparat_sitologi')               !== '' ? safe_post('ssc_preparat_sitologi') : NULL,
                'ssc_formulir_permintaan'               => safe_post('ssc_formulir_permintaan')             !== '' ? safe_post('ssc_formulir_permintaan') : NULL,
                'ssc_lengkap_pasien'                    => safe_post('ssc_lengkap_pasien')                  !== '' ? safe_post('ssc_lengkap_pasien') : NULL,
                'ssc_penjelasan_keluarga'               => safe_post('ssc_penjelasan_keluarga')             !== '' ? safe_post('ssc_penjelasan_keluarga') : NULL,
                'ssc_penjelasan_keluarga_ket'           => safe_post('ssc_penjelasan_keluarga_ket')         !== '' ? safe_post('ssc_penjelasan_keluarga_ket') : NULL,
                'ssc_obat_operasi'                      => safe_post('ssc_obat_operasi')                    !== '' ? safe_post('ssc_obat_operasi') : NULL,
                'ssc_obat_operasi_ya_alasan'            => safe_post('ssc_obat_operasi_ya_alasan')          !== '' ? safe_post('ssc_obat_operasi_ya_alasan') : NULL,
                'ssc_obat_operasi_tidak_alasan'         => safe_post('ssc_obat_operasi_tidak_alasan')       !== '' ? safe_post('ssc_obat_operasi_tidak_alasan') : NULL,
                'ssc_kesadaran_sign_out'                => safe_post('ssc_kesadaran_sign_out')              !== '' ? safe_post('ssc_kesadaran_sign_out') : NULL,
                'ssc_tekanan_darah_sign_out'            => safe_post('ssc_tekanan_darah_sign_out')          !== '' ? safe_post('ssc_tekanan_darah_sign_out') : NULL,
                'ssc_nadi_sign_out'                     => safe_post('ssc_nadi_sign_out')                   !== '' ? safe_post('ssc_nadi_sign_out') : NULL,
                'ssc_pernafasan_sign_out'               => safe_post('ssc_pernafasan_sign_out')             !== '' ? safe_post('ssc_pernafasan_sign_out') : NULL,
                'ssc_saturasi_sign_out'                 => safe_post('ssc_saturasi_sign_out')               !== '' ? safe_post('ssc_saturasi_sign_out') : NULL,
                'ssc_suhu_sign_out'                     => safe_post('ssc_suhu_sign_out')                   !== '' ? safe_post('ssc_suhu_sign_out') : NULL,
                'ssc_skala_nyeri_sign_out'              => safe_post('ssc_skala_nyeri_sign_out')            !== '' ? safe_post('ssc_skala_nyeri_sign_out') : NULL,
                'ssc_rembesan'                          => safe_post('ssc_rembesan')                        !== '' ? safe_post('ssc_rembesan') : NULL,
                'ssc_paraf_perawat_sign_out'            => safe_post('ssc_paraf_perawat_sign_out')          !== '' ? safe_post('ssc_paraf_perawat_sign_out') : NULL,
                'ssc_perawat_sign_out'                  => safe_post('ssc_perawat_sign_out')                !== '' ? safe_post('ssc_perawat_sign_out') : NULL,
                'ssc_paraf_dokter_anestesi_sign_out'    => safe_post('ssc_paraf_dokter_anestesi_sign_out')  !== '' ? safe_post('ssc_paraf_dokter_anestesi_sign_out') : NULL,
                'ssc_dokter_anestesi_sign_out'          => safe_post('ssc_dokter_anestesi_sign_out')        !== '' ? safe_post('ssc_dokter_anestesi_sign_out') : NULL,
            );
            // untuk cek data yang di kirim
            // var_dump($surgicalCeklis);
            // die();
            $this->m_pelayanan->insertSurgicalSafetyCeklis($surgicalCeklis);
        } else {
            $ssc_tanggal_sign_in = safe_post('ssc_tanggal_sign_in');
            $ssc_tanggal_time_out = safe_post('ssc_tanggal_time_out');
            $ssc_tanggal_sign_out = safe_post('ssc_tanggal_sign_out');
            if (!empty($ssc_tanggal_sign_in || $ssc_tanggal_time_out || $ssc_tanggal_sign_out)) {
                $respon = ['show' => '5', 'status' => false, 'message' => 'Surgical Safety Ceklis Belum ditambahkan', 'id' => '#data-surgical-safety-ceklis'];
            }
        }




        // CPDPO 5
        // $tanggal_rpo    = safe_post('tanggal_rpo');
        // $tangggal_rpo   = safe_post('tangggal_rpo');
        // $pencegahan_date_rpo    = safe_post('pencegahan_date_rpo');
        // $id_pendaftaran         = safe_post('id_pendaftaran');
        // if (!empty($pencegahan_date_rpo)) {
        //     $riwayat_pemakaian_obat = array(
        //         'id_pendaftaran'         => $id_pendaftaran,
        //         'id_layanan_pendaftaran' => $layanan['id'],
        //         'id_user'                => safe_post('user_pengkajian') !== '' ? safe_post('user_pengkajian') : null,
        //         'tanggal_rpo'            => safe_post('tanggal_rpo') !== '' ? safe_post('tanggal_rpo') : null,
        //         'tangggal_rpo'           => safe_post('tangggal_rpo') !== '' ? safe_post('tangggal_rpo') : null,
        //         'nama_obat_rpo'          => safe_post('nama_obat_rpo') !== '' ? safe_post('nama_obat_rpo') : null,
        //         'dokter_1_rpo'           => safe_post('dokter_1_rpo') !== '' ? safe_post('dokter_1_rpo') : null,
        //         'dokter_2_rpo'           => safe_post('dokter_2_rpo') !== '' ? safe_post('dokter_2_rpo') : null,
        //         'rute_rpo'               => safe_post('rute_rpo') !== '' ? safe_post('rute_rpo') : null,
        //         'dosis_rpo'              => safe_post('dosis_rpo') !== '' ? safe_post('dosis_rpo') : null,
        //         'frekuensi_rpo'          => safe_post('frekuensi_rpo') !== '' ? safe_post('frekuensi_rpo') : null,
        //         'eso_rpo'                => safe_post('eso_rpo') !== '' ? safe_post('eso_rpo') : null,
        //         'r_farmasi_rpo'          => safe_post('r_farmasi_rpo') !== '' ? safe_post('r_farmasi_rpo') : null,
        //         'alergii_ob'             => safe_post('alergii_ob') !== '' ? safe_post('alergii_ob') : null,
        //         'alergii'                => safe_post('alergii') !== '' ? safe_post('alergii') : null,
        //         'date_created'           => safe_post('pencegahan_date_rpo') !== '' ? safe_post('pencegahan_date_rpo') : null,
        //     );
        //     //  var_dump($riwayat_pemakaian_obat);
        //     $this->m_pelayanan->insertRiwayatPemakaianObat($riwayat_pemakaian_obat);
        // }


        // ILLIS 5
        // $tanggal_rpoo   = safe_post('tanggal_rpoo');
        // $tangggal_rpoo  = safe_post('tangggal_rpoo');
        // $pencegahan_date_rpo_infus    = safe_post('pencegahan_date_rpo_infus');
        // $id_pendaftaran         = safe_post('id_pendaftaran');
        // if (!empty($pencegahan_date_rpo_infus)) {
        //     $riwayat_pemakaian_obat_infus = array(
        //         'id_pendaftaran'         => $id_pendaftaran,
        //         'id_layanan_pendaftaran' => $layanan['id'],
        //         'id_user'                => safe_post('user_pengkajian') !== '' ? safe_post('user_pengkajian') : null,
        //         'tanggal_rpoo'           => safe_post('tanggal_rpoo') !== '' ? safe_post('tanggal_rpoo') : null,
        //         'tangggal_rpoo'          => safe_post('tangggal_rpoo') !== '' ? safe_post('tangggal_rpoo') : null,
        //         'nama_obat_rpoo'         => safe_post('nama_obat_rpoo') !== '' ? safe_post('nama_obat_rpoo') : null,
        //         'dokter_1_rpoo'          => safe_post('dokter_1_rpoo') !== '' ? safe_post('dokter_1_rpoo') : null,
        //         'dokter_2_rpoo'          => safe_post('dokter_2_rpoo') !== '' ? safe_post('dokter_2_rpoo') : null,
        //         'rute_rpoo'              => safe_post('rute_rpoo') !== '' ? safe_post('rute_rpoo') : null,
        //         'dosis_rpoo'             => safe_post('dosis_rpoo') !== '' ? safe_post('dosis_rpoo') : null,
        //         'frekuensi_rpoo'         => safe_post('frekuensi_rpoo') !== '' ? safe_post('frekuensi_rpoo') : null,
        //         'eso_rpoo'               => safe_post('eso_rpoo') !== '' ? safe_post('eso_rpoo') : null,
        //         'r_farmasi_rpoo'         => safe_post('r_farmasi_rpoo') !== '' ? safe_post('r_farmasi_rpoo') : null,
        //         'alergiii'                => safe_post('alergiii') !== '' ? safe_post('alergiii') : null,
        //         'alergii_obb'                => safe_post('alergii_obb') !== '' ? safe_post('alergii_obb') : null,
        //         'date_created'           => safe_post('pencegahan_date_rpo_infus') !== '' ? safe_post('pencegahan_date_rpo_infus') : null,
        //     );
        //     //  var_dump($riwayat_pemakaian_obat);
        //     $this->m_pelayanan->insertRiwayatPemakaianObatInfus($riwayat_pemakaian_obat_infus);
        // }


        // WPT 5
        // $tanggal_wpt    = safe_post('tanggal_wpt');
        // $pencegahan_date_wpt    = safe_post('pencegahan_date_wpt');
        // $id_pendaftaran         = safe_post('id_pendaftaran');
        // if (!empty($pencegahan_date_wpt)) {
        //     $waktu_pemberian_tanggal = array(
        //         'id_pendaftaran'         => $id_pendaftaran,
        //         'id_layanan_pendaftaran' => $layanan['id'],
        //         'id_user'                => safe_post('user_pengkajian') !== '' ? safe_post('user_pengkajian') : null,
        //         'tanggal_wpt'            => safe_post('tanggal_wpt') !== '' ? safe_post('tanggal_wpt') : null,
        //         'hari_wpt'               => safe_post('hari_wpt') !== '' ? safe_post('hari_wpt') : null,
        //         'jam_wpt'                => safe_post('jam_wpt') !== '' ? safe_post('jam_wpt') : null,
        //         'perawat_1_wpt'          => safe_post('perawat_1_wpt') !== '' ? safe_post('perawat_1_wpt') : null,
        //         'pasien_keluarga_wpt'    => safe_post('pasien_keluarga_wpt') !== '' ? safe_post('pasien_keluarga_wpt') : null,
        //         'pagi_wpt'               => safe_post('pagi_wpt') !== '' ? safe_post('pagi_wpt') : null,
        //         'siang_wpt'              => safe_post('siang_wpt')  !== '' ? safe_post('siang_wpt') : null,
        //         'sore_wpt'               => safe_post('sore_wpt')  !== '' ? safe_post('sore_wpt') : null,
        //         'malam_wpt'              => safe_post('malam_wpt')  !== '' ? safe_post('malam_wpt') : null,
        //         'date_created'           => safe_post('pencegahan_date_wpt') !== '' ? safe_post('pencegahan_date_wpt') : null,
        //     );
        //     //  var_dump($waktu_pemberian_tanggal);die;
        //     $this->m_pelayanan->insertWaktuPemberianTanggal($waktu_pemberian_tanggal);
        // }


        // IWPT 5
        // $tanggal_wptt   = safe_post('tanggal_wptt');
        // $pencegahan_date_wptt_infus    = safe_post('pencegahan_date_wptt_infus');
        // $id_pendaftaran                = safe_post('id_pendaftaran');
        // if (!empty($pencegahan_date_wptt_infus)) {
        //     $waktu_pemberian_tanggal_infus = array(
        //         'id_pendaftaran'         => $id_pendaftaran,
        //         'id_layanan_pendaftaran' => $layanan['id'],
        //         'id_user'                => safe_post('user_pengkajian') !== '' ? safe_post('user_pengkajian') : null,
        //         'tanggal_wptt'           => safe_post('tanggal_wptt') !== '' ? safe_post('tanggal_wptt') : null,
        //         'hari_wptt'              => safe_post('hari_wptt') !== '' ? safe_post('hari_wptt') : null,
        //         'jam_wptt'               => safe_post('jam_wptt') !== '' ? safe_post('jam_wptt') : null,
        //         'perawat_2_wptt'         => safe_post('perawat_2_wptt') !== '' ? safe_post('perawat_2_wptt') : null,
        //         'pasien_keluarga_wptt'   => safe_post('pasien_keluarga_wptt') !== '' ? safe_post('pasien_keluarga_wptt') : null,
        //         'pagi_wptt'              => safe_post('pagi_wptt')  !== '' ? safe_post('pagi_wptt') : null,
        //         'siang_wptt'             => safe_post('siang_wptt')  !== '' ? safe_post('siang_wptt') : null,
        //         'sore_wptt'              => safe_post('sore_wptt')  !== '' ? safe_post('sore_wptt') : null,
        //         'malam_wptt'             => safe_post('malam_wptt')  !== '' ? safe_post('malam_wptt') : null,
        //         'date_created'           => safe_post('pencegahan_date_wptt_infus') !== '' ? safe_post('pencegahan_date_wptt_infus') : null,
        //     );
        //     //  var_dump($waktu_pemberian_tanggal);die;
        //     $this->m_pelayanan->insertWaktuPemberianTanggalInfus($waktu_pemberian_tanggal_infus);
        // }


        // MPP-C 5
        $tgl_mpp    = safe_post('tgl_mpp');
        $pencegahan_date_mpp    = safe_post('pencegahan_date_mpp');
        $id_pendaftaran         = safe_post('id_pendaftaran');
        if (!empty($pencegahan_date_mpp)) {
            $monitoring_pasien_2 = array(
                'id_pendaftaran'         => $id_pendaftaran,
                'id_layanan_pendaftaran' => $layanan['id'],
                'id_user'                => safe_post('user_pengkajian') !== '' ? safe_post('user_pengkajian') : null,
                'oral_mpp'               => safe_post('oral_mpp') !== '' ? safe_post('oral_mpp') : null,
                'ngt_mpp'                => safe_post('ngt_mpp') !== '' ? safe_post('ngt_mpp') : null,
                'paranteral_mpp'         => safe_post('paranteral_mpp') !== '' ? safe_post('paranteral_mpp') : null,
                'paranteral_mppp'        => safe_post('paranteral_mppp') !== '' ? safe_post('paranteral_mppp') : null,
                'produk_mpp'             => safe_post('produk_mpp') !== '' ? safe_post('produk_mpp') : null,
                'input_mpp'              => safe_post('input_mpp') !== '' ? safe_post('input_mpp') : null,
                'urin_mpp'               => safe_post('urin_mpp') !== '' ? safe_post('urin_mpp') : null,
                'bab_mpp'                => safe_post('bab_mpp') !== '' ? safe_post('bab_mpp') : null,
                'gastrik_mpp'            => safe_post('gastrik_mpp') !== '' ? safe_post('gastrik_mpp') : null,
                'wsd_mpp'                => safe_post('wsd_mpp') !== '' ? safe_post('wsd_mpp') : null,
                'iwl_mpp'                => safe_post('iwl_mpp') !== '' ? safe_post('iwl_mpp') : null,
                'output_mpp'             => safe_post('output_mpp') !== '' ? safe_post('output_mpp') : null,
                'blance_cairan_mpp'             => safe_post('blance_cairan_mpp') !== '' ? safe_post('blance_cairan_mpp') : null,
                'tdarah_mpp'              => safe_post('tdarah_mpp') !== '' ? safe_post('tdarah_mpp') : null,
                'saturasi_mppp'            => safe_post('saturasi_mppp') !== '' ? safe_post('saturasi_mppp') : null,
                'toksigen_mpp'            => safe_post('toksigen_mpp') !== '' ? safe_post('toksigen_mpp') : null,
                'skesadaran_mpp'          => safe_post('skesadaran_mpp') !== '' ? safe_post('skesadaran_mpp') : null,
                'kategori_mpp'            => safe_post('kategori_mpp') !== '' ? safe_post('kategori_mpp') : null,
                'pengawasan_mpp'          => safe_post('pengawasan_mpp') !== '' ? safe_post('pengawasan_mpp') : null,
                'diit_mpp'                => safe_post('diit_mpp') !== '' ? safe_post('diit_mpp') : null,
                'tgl_mpp'                   => safe_post('tgl_mpp') !== '' ? safe_post('tgl_mpp') : null,
                'jam_mpp'                   => safe_post('jam_mpp') !== '' ? safe_post('jam_mpp') : null,
                'perawat_mpp'             => safe_post('perawat_mpp') !== '' ? safe_post('perawat_mpp') : null,
                'date_created'            => safe_post('pencegahan_date_mpp') !== '' ? safe_post('pencegahan_date_mpp') : null,
            );
            //  var_dump($monitoring_pasien);die;
            $this->m_pelayanan->insertMonitoringPasien2($monitoring_pasien_2);
        }





        // PKN
        // $tgl_pkn    = safe_post('tgl_pkn');
        // $pencegahan_date_pkn    = safe_post('pencegahan_date_pkn');
        // $id_pendaftaran         = safe_post('id_pendaftaran');
        // if (!empty($pencegahan_date_pkn)) {
        //     $pengawasan_khusus_neonatus = array(
        //         'id_pendaftaran'            => $id_pendaftaran,
        //         'id_layanan_pendaftaran'    => $layanan['id'],
        //         'id_user'                   => safe_post('user_pengkajian') !== '' ? safe_post('user_pengkajian') : null,
        //         'tgl_pkn'                   => safe_post('tgl_pkn') !== '' ? safe_post('tgl_pkn') : null,
        //         'jam_pkn'                   => safe_post('jam_pkn') !== '' ? safe_post('jam_pkn') : null,
        //         'bb_pkn'                    => safe_post('bb_pkn') !== '' ? safe_post('bb_pkn') : null,
        //         'lp_pkn'                    => safe_post('lp_pkn') !== '' ? safe_post('lp_pkn') : null,
        //         'kesadaran_pkn'             => safe_post('kesadaran_pkn') !== '' ? safe_post('kesadaran_pkn') : null,
        //         'pasien_pkn'                => safe_post('pasien_pkn') !== '' ? safe_post('pasien_pkn') : null,
        //         'inkubator_pkn'             => safe_post('inkubator_pkn') !== '' ? safe_post('inkubator_pkn') : null,
        //         'nadi_pkn'                  => safe_post('nadi_pkn') !== '' ? safe_post('nadi_pkn') : null,
        //         'rr_pkn'                    => safe_post('rr_pkn') !== '' ? safe_post('rr_pkn') : null,
        //         'modus_pkn'                 => safe_post('modus_pkn') !== '' ? safe_post('modus_pkn') : null,
        //         'peep_pkn'                  => safe_post('peep_pkn') !== '' ? safe_post('peep_pkn') : null,
        //         'buble_pkn'                 => safe_post('buble_pkn') !== '' ? safe_post('buble_pkn') : null,
        //         'fio2_pkn'                  => safe_post('fio2_pkn') !== '' ? safe_post('fio2_pkn') : null,
        //         'spo2_pkn'                  => safe_post('spo2_pkn') !== '' ? safe_post('spo2_pkn') : null,
        //         'flow_pkn'                  => safe_post('flow_pkn') !== '' ? safe_post('flow_pkn') : null,
        //         'air_pkn'                   => safe_post('air_pkn') !== '' ? safe_post('air_pkn') : null,
        //         'suhu_pkn'                  => safe_post('suhu_pkn') !== '' ? safe_post('suhu_pkn') : null,
        //         'line1_pkn'                 => safe_post('line1_pkn') !== '' ? safe_post('line1_pkn') : null,
        //         'line2_pkn'                 => safe_post('line2_pkn') !== '' ? safe_post('line2_pkn') : null,
        //         'plebitis_pkn'              => safe_post('plebitis_pkn') !== '' ? safe_post('plebitis_pkn') : null,
        //         'oral_pkn'                  => safe_post('oral_pkn') !== '' ? safe_post('oral_pkn') : null,
        //         'jml_pkn'                   => safe_post('jml_pkn') !== '' ? safe_post('jml_pkn') : null,
        //         'muntah_pkn'                => safe_post('muntah_pkn') !== '' ? safe_post('muntah_pkn') : null,
        //         'residu_pkn'                => safe_post('residu_pkn') !== '' ? safe_post('residu_pkn') : null,
        //         'bak_pkn'                   => safe_post('bak_pkn') !== '' ? safe_post('bak_pkn') : null,
        //         'bab_pkn'                   => safe_post('bab_pkn') !== '' ? safe_post('bab_pkn') : null,
        //         'foto_therapy_pkn'          => safe_post('foto_therapy_pkn') !== '' ? safe_post('foto_therapy_pkn') : null,
        //         'obat_pkn'                  => safe_post('obat_pkn') !== '' ? safe_post('obat_pkn') : null,
        //         'perawat_pkn'               => safe_post('perawat_pkn') !== '' ? safe_post('perawat_pkn') : null,
        //         'date_created'              => safe_post('pencegahan_date_pkn') !== '' ? safe_post('pencegahan_date_pkn') : null,


        //         // 'user_created'       	 	 => $this->session->userdata('id_translucent'),
        //     );
        //     //  var_dump($monitoring_pasien);die;
        //     $this->m_pelayanan->insertPengawasanKhususNeonatus($pengawasan_khusus_neonatus);
        // }





















        $ek_kontrol_dokter = safe_post('ambil_tanggal');

        if ($ek_kontrol_dokter) {

            $ek_kontrol = is_string($ek_kontrol_dokter);

            if ($ek_kontrol_dokter === "" || $ek_kontrol_dokter === null) {

                $ek_dokter = null;
            } else if (!is_array($ek_kontrol_dokter)) {


                $ek_dokter = null;
            } else if (empty($ek_kontrol_dokter)) {


                $ek_dokter = null;
            } else if ($ek_kontrol === true) {


                $ek_dokter = null;
            } else {

                foreach ($ek_kontrol_dokter as $key => $value) {

                    $date = new DateTime($value);
                    $new = $date->format('Y-m-d H:i:s');


                    $ek_dokter[$key] = $new;
                }
            }

            $tanggal_dibuat = safe_post('tanggal_dibuat');

            $ek_tanggal_dibuat = is_string($tanggal_dibuat);

            if ($tanggal_dibuat === "" || $tanggal_dibuat === null) {

                $dibuat_tanggal = null;
            } else if (!is_array($tanggal_dibuat)) {


                $dibuat_tanggal = null;
            } else if (empty($tanggal_dibuat)) {


                $dibuat_tanggal = null;
            } else if ($ek_tanggal_dibuat === true) {


                $dibuat_tanggal = null;
            } else {

                foreach ($tanggal_dibuat as $key => $value) {

                    $date = new DateTime($value);
                    $new = $date->format('Y-m-d H:i:s');


                    $dibuat_tanggal[$key] = $new;
                }
            }


            $jadwal_kontrol = array(
                'id_layanan_pendaftaran'            => $layanan['id'],
                'tanggal'                           => $ek_dokter,
                'id_ek_nama_dokter'                 => safe_post('id_ek_nama_dokter') !== '' ? safe_post('id_ek_nama_dokter') : NULL,
                'tempat_kontrol'                    => safe_post('ek_tempat_kontrol') !== '' ? safe_post('ek_tempat_kontrol') : NULL,
                'user'                              => safe_post('ek_operator') !== '' ? safe_post('ek_operator') : NULL,
                'created_date'                      => $dibuat_tanggal,
            );


            $this->m_pelayanan->updateJadwalKontrolKeperawatan($jadwal_kontrol);
        } else {

            $ek_kontrol_dokter = safe_post('ek_kontrol_dokter');

            if (!empty($ek_kontrol_dokter)) {

                $respon = ['show' => '0', 'status' => false, 'message' => 'Data Kontrol Kembali Belum ditambahkan', 'id' => '#data-kontrol-kembali'];
            }
        }

        $obat = safe_post('id_barang_auto');

        if ($obat) {

            $ek_nol = safe_post('ek_jam_pemberian');

            $ek_nol_filter = is_string($ek_nol);

            if ($ek_nol === "" || $ek_nol === null) {

                $terapi_nol = null;
            } else if ($ek_nol[0] === '') {


                $terapi_nol = null;
            } else if (!is_array($ek_nol)) {


                $terapi_nol = null;
            } else if (empty($ek_nol)) {


                $terapi_nol = null;
            } else if ($ek_nol_filter === true) {


                $terapi_nol = null;
            } else {

                foreach ($ek_nol as $key => $value) {

                    $date = new DateTime($value);
                    $new = $date->format('H:i:s');


                    $terapi_nol[$key] = $new;
                }
            }


            $ek_satu = safe_post('ek_jam_pemberian_satu');

            $ek_satu_filter = is_string($ek_satu);


            if ($ek_satu === "" || $ek_satu === null) {

                $terapi_satu = null;
            } else if ($ek_satu[0] === '') {


                $terapi_satu = null;
            } else if (!is_array($ek_satu)) {


                $terapi_satu = null;
            } else if (empty($ek_satu)) {


                $terapi_satu = null;
            } else if ($ek_satu_filter === true) {


                $terapi_satu = null;
            } else {

                foreach ($ek_satu as $key => $value) {

                    $date = new DateTime($value);
                    $new = $date->format('H:i:s');


                    $terapi_satu[$key] = $new;
                }
            }

            $ek_dua = safe_post('ek_jam_pemberian_dua');

            $ek_dua_filter = is_string($ek_dua);


            if ($ek_dua === "" || $ek_dua === null) {

                $terapi_dua = null;
            } else if ($ek_dua[0] === '') {

                $terapi_dua = null;
            } else if (!is_array($ek_dua)) {


                $terapi_dua = null;
            } else if (empty($ek_dua)) {


                $terapi_dua = null;
            } else if ($ek_dua_filter === true) {


                $terapi_dua = null;
            } else {

                foreach ($ek_dua as $key => $value) {

                    $date = new DateTime($value);
                    $new = $date->format('H:i:s');


                    $terapi_dua[$key] = $new;
                }
            }

            $ek_tiga = safe_post('ek_jam_pemberian_tiga');

            $ek_tiga_filter = is_string($ek_tiga);


            if ($ek_tiga === "" || $ek_tiga === null) {

                $terapi_tiga = null;
            } else if ($ek_tiga[0] === '') {

                $terapi_tiga = null;
            } else if (!is_array($ek_tiga)) {


                $terapi_tiga = null;
            } else if (empty($ek_tiga)) {


                $terapi_tiga = null;
            } else if ($ek_tiga_filter === true) {


                $terapi_tiga = null;
            } else {

                foreach ($ek_tiga as $key => $value) {

                    $date = new DateTime($value);
                    $new = $date->format('H:i:s');


                    $terapi_tiga[$key] = $new;
                }
            }


            $ek_empat = safe_post('ek_jam_pemberian_empat');

            $ek_empat_filter = is_string($ek_empat);

            if ($ek_empat === "" || $ek_empat === null) {

                $terapi_empat = null;
            } else if ($ek_empat[0] === '') {

                $terapi_empat = null;
            } else if (!is_array($ek_empat)) {


                $terapi_empat = null;
            } else if (empty($ek_empat)) {


                $terapi_empat = null;
            } else if ($ek_empat_filter === true) {


                $terapi_empat = null;
            } else {

                foreach ($ek_empat as $key => $value) {

                    $date = new DateTime($value);
                    $new = $date->format('H:i:s');


                    $terapi_empat[$key] = $new;
                }
            }

            $ek_lima = safe_post('ek_jam_pemberian_lima');

            $ek_lima_filter = is_string($ek_lima);


            if ($ek_lima === "" || $ek_lima === null) {

                $terapi_lima = null;
            } else if ($ek_lima[0] === '') {

                $terapi_lima = null;
            } else if (!is_array($ek_lima)) {

                $terapi_lima = null;
            } else if (empty($ek_lima)) {


                $terapi_lima = null;
            } else if ($ek_lima_filter === true) {


                $terapi_lima = null;
            } else {

                foreach ($ek_lima as $key => $value) {

                    $date = new DateTime($value);
                    $new = $date->format('H:i:s');


                    $terapi_lima[$key] = $new;
                }
            }

            $created_date = safe_post('created_date');

            $ek_created_date = is_string($created_date);

            if ($created_date === "" || $created_date === null) {

                $date_created = null;
            } else if ($created_date[0] === '') {

                $date_created = null;
            } else if (!is_array($created_date)) {

                $date_created = null;
            } else if (empty($created_date)) {

                $date_created = null;
            } else if ($ek_created_date === true) {


                $date_created = null;
            } else {

                foreach ($created_date as $key => $value) {

                    $date = new DateTime($value);
                    $new = $date->format('Y-m-d H:i:s');


                    $date_created[$key] = $new;
                }
            }

            $terapi_pulang = array(
                'id_layanan_pendaftaran'   => $layanan['id'],
                'obat'                     => safe_post('id_barang_auto') !== '' ? safe_post('id_barang_auto') : NULL,
                'jumlah_obat'              => safe_post('jumlah_obat') !== '' ? safe_post('jumlah_obat') : NULL,
                'dosis'                    => safe_post('trp_dosis') !== '' ? safe_post('trp_dosis') : NULL,
                'frekuensi'                => safe_post('frekuensi') !== '' ? safe_post('frekuensi') : NULL,
                'cara_pemberian'           => safe_post('cara_pemberian') !== '' ? safe_post('cara_pemberian') : NULL,
                'ek_jam_pemberian'         => $terapi_nol,
                'ek_jam_pemberian_satu'    => $terapi_satu,
                'ek_jam_pemberian_dua'     => $terapi_dua,
                'ek_jam_pemberian_tiga'    => $terapi_tiga,
                'ek_jam_pemberian_empat'   => $terapi_empat,
                'ek_jam_pemberian_lima'    => $terapi_lima,
                'petunjuk_khusus'          => safe_post('petunjuk_khusus') !== '' ? safe_post('petunjuk_khusus') : NULL,
                'id_users'                 => safe_post('user_account') !== '' ? safe_post('user_account') : NULL,
                'created_date'             => $date_created,
            );

            $this->m_pelayanan->updateTerapiPulang($terapi_pulang);
        } else {

            $obat = safe_post('obat');

            if (!empty($obat)) {

                $respon = ['show' => '0', 'add_show' => '0', 'status' => false, 'message' => 'Data Terapi Pulang Belum ditambahkan', 'id' => '#data-terapi-pulang'];
            }
        }

        $ek_tanggal_catatan_tindakan = safe_post('ek_tanggal_catatan_tindakan');

        if ($ek_tanggal_catatan_tindakan) {

            $ek_tanggal_catatan_tindakan = safe_post('ek_tanggal_catatan_tindakan');

            $ek_tanggal_tindakan_satu = is_string($ek_tanggal_catatan_tindakan);

            if ($ek_tanggal_catatan_tindakan === "" || $ek_tanggal_catatan_tindakan === null) {

                $tanggal_catatan_tindakan = null;
            } else if (!is_array($ek_tanggal_catatan_tindakan)) {


                $tanggal_catatan_tindakan = null;
            } else if (empty($ek_tanggal_catatan_tindakan)) {


                $tanggal_catatan_tindakan = null;
            } else if ($ek_tanggal_tindakan_satu === true) {


                $tanggal_catatan_tindakan = null;
            } else {

                foreach ($ek_tanggal_catatan_tindakan as $key => $value) {

                    $date = new DateTime($value);
                    $new = $date->format('Y-m-d');


                    $tanggal_catatan_tindakan[$key] = $new;
                }
            }

            $ek_catatan_tindakan_keperawatan = safe_post('ek_catatan_tindakan_keperawatan');
            $ek_catatan_tindakan_keperawatan_filter = is_string($ek_catatan_tindakan_keperawatan);
            if ($ek_catatan_tindakan_keperawatan === "" || $ek_catatan_tindakan_keperawatan === null) {
                $catatan_tindakan_keperawatan = NULL;
            } else if (!is_array($ek_catatan_tindakan_keperawatan)) {
                $catatan_tindakan_keperawatan = NULL;
            } else if (empty($ek_catatan_tindakan_keperawatan)) {
                $catatan_tindakan_keperawatan = NULL;
            } else if ($ek_catatan_tindakan_keperawatan_filter === true) {
                $catatan_tindakan_keperawatan = NULL;
            } else {
                foreach ($ek_catatan_tindakan_keperawatan as $key => $value) {
                    $catatan_tindakan_keperawatan[$key] = $value;
                }
            }

            $ek_catatan_tindakan_keperawatan_manual = safe_post('ek_catatan_tindakan_keperawatan_manual');
            $ek_catatan_tindakan_keperawatan_manual_filter = is_string($ek_catatan_tindakan_keperawatan_manual);
            if ($ek_catatan_tindakan_keperawatan_manual === "" || $ek_catatan_tindakan_keperawatan_manual === null) {
                $catatan_tindakan_keperawatan_manual = NULL;
            } else if (!is_array($ek_catatan_tindakan_keperawatan_manual)) {
                $catatan_tindakan_keperawatan_manual = NULL;
            } else if (empty($ek_catatan_tindakan_keperawatan_manual)) {
                $catatan_tindakan_keperawatan_manual = NULL;
            } else if ($ek_catatan_tindakan_keperawatan_manual_filter === true) {
                $catatan_tindakan_keperawatan_manual = NULL;
            } else {
                foreach ($ek_catatan_tindakan_keperawatan_manual as $key => $value) {
                    $catatan_tindakan_keperawatan_manual[$key] = $value;
                }
            }

            $tanggal_catatan_tindakan_dibuat = safe_post('tanggal_catatan_tindakan_dibuat');
            $ek_tanggal_catatan_tindakan_dibuat = is_string($tanggal_catatan_tindakan_dibuat);

            if ($tanggal_catatan_tindakan_dibuat === "" || $tanggal_catatan_tindakan_dibuat === null) {

                $tanggal_tindakan = null;
            } else if (!is_array($tanggal_catatan_tindakan_dibuat)) {


                $tanggal_tindakan = null;
            } else if (empty($tanggal_catatan_tindakan_dibuat)) {


                $tanggal_tindakan = null;
            } else if ($ek_tanggal_catatan_tindakan_dibuat === true) {


                $tanggal_tindakan = null;
            } else {

                foreach ($tanggal_catatan_tindakan_dibuat as $key => $value) {

                    $date = new DateTime($value);
                    $new = $date->format('Y-m-d H:i:s');


                    $tanggal_tindakan[$key] = $new;
                }
            }

            //PAGI
            $ek_jam_pagi = safe_post('ek_jam_pagi');
            $catatan_jam_pagi = [];
            foreach ($ek_jam_pagi as $key => $value) {
                if (empty($value)) {
                    $catatan_jam_pagi[] = NULL;
                    continue;
                }
                $date = new DateTime($value);
                $new = $date->format('H:i:s');
                $catatan_jam_pagi[$key] = $new;
            }


            // $ek_jam_pagi = safe_post('ek_jam_pagi');
            // $ek_jam_pagi_filter = is_string($ek_jam_pagi);

            // // if (safe_post('ek_cek_pagi') === 1) {
            // //     foreach ($ek_jam_pagi as $key => $value) {
            // //         $date = new DateTime($value);
            // //         $new = $date->format('H:i:s');
            // //         $catatan_jam_pagi[$key] = $new;
            // //     }
            // // } else {
            // //     $catatan_jam_pagi = null;
            // // }

            // if ($ek_jam_pagi[0] === "" || $ek_jam_pagi[0] === null) {
            //     $catatan_jam_pagi = [null];
            // } else if (!is_array($ek_jam_pagi)) {
            //     $catatan_jam_pagi = [null];
            // } else if (empty($ek_jam_pagi)) {
            //     $catatan_jam_pagi = [null];
            // } else if ($ek_jam_pagi_filter === true) {
            //     $catatan_jam_pagi = [null];
            // } else {
            //     foreach ($ek_jam_pagi as $key => $value) {
            //         $date = new DateTime($value);
            //         $new = $date->format('H:i:s');
            //         $catatan_jam_pagi[$key] = $new;
            //     }
            // }

            //SORE
            $ek_jam_sore = safe_post('ek_jam_sore');
            $catatan_jam_sore = [];
            foreach ($ek_jam_sore as $key => $value) {
                if (empty($value)) {
                    $catatan_jam_sore[] = NULL;
                    continue;
                }
                $date = new DateTime($value);
                $new = $date->format('H:i:s');
                $catatan_jam_sore[$key] = $new;
            }


            // $ek_jam_sore = safe_post('ek_jam_sore');
            // $ek_jam_sore_filter = is_string($ek_jam_sore);

            // // if (safe_post('ek_cek_sore') === 1) {
            // //     foreach ($ek_jam_sore as $key => $value) {
            // //         $date = new DateTime($value);
            // //         $new = $date->format('H:i:s');
            // //         $catatan_jam_sore[$key] = $new;
            // //     }
            // // } else {
            // //     $catatan_jam_sore = null;
            // // }

            // if ($ek_jam_sore[0] === "" || $ek_jam_sore[0] === null) {
            //     $catatan_jam_sore = [null];
            // } else if (!is_array($ek_jam_sore)) {
            //     $catatan_jam_sore = [null];
            // } else if (empty($ek_jam_sore)) {
            //     $catatan_jam_sore = [null];
            // } else if ($ek_jam_sore_filter === true) {
            //     $catatan_jam_sore = [null];
            // } else {
            //     foreach ($ek_jam_sore as $key => $value) {
            //         $date = new DateTime($value);
            //         $new = $date->format('H:i:s');
            //         $catatan_jam_sore[$key] = $new;
            //     }
            // }

            //MALAM
            $ek_jam_malam = safe_post('ek_jam_malam');
            $catatan_jam_malam = [];
            foreach ($ek_jam_malam as $key => $value) {
                if (empty($value)) {
                    $catatan_jam_malam[] = NULL;
                    continue;
                }
                $date = new DateTime($value);
                $new = $date->format('H:i:s');
                $catatan_jam_malam[$key] = $new;
            }


            // $ek_jam_malam = safe_post('ek_jam_malam');
            // $ek_jam_malam_filter = is_string($ek_jam_malam);

            // // if (safe_post('ek_cek_malam') === 1) {
            // //     foreach ($ek_jam_malam as $key => $value) {
            // //         $date = new DateTime($value);
            // //         $new = $date->format('H:i:s');
            // //         $catatan_jam_malam[$key] = $new;
            // //     }
            // // } else {
            // //     $catatan_jam_malam = null;
            // // }

            // if ($ek_jam_malam[0] === "" || $ek_jam_malam[0] === null) {
            //     $catatan_jam_malam = [null];
            // } else if (!is_array($ek_jam_malam)) {
            //     $catatan_jam_malam = [null];
            // } else if (empty($ek_jam_malam)) {
            //     $catatan_jam_malam = [null];
            // } else if ($ek_jam_malam_filter === true) {
            //     $catatan_jam_malam = [null];
            // } else {
            //     foreach ($ek_jam_malam as $key => $value) {
            //         $date = new DateTime($value);
            //         $new = $date->format('H:i:s');
            //         $catatan_jam_malam[$key] = $new;
            //     }
            // }

            $catatan_tindakan_keperawatan = array(
                'id_layanan_pendaftaran'                    => $layanan['id'],
                'ek_catatan_tindakan_keperawatan'           => $catatan_tindakan_keperawatan,
                'ek_catatan_tindakan_keperawatan_manual'    => $catatan_tindakan_keperawatan_manual,
                'ek_keterangan_catatan'                     => safe_post('ek_keterangan_catatan') !== '' ? safe_post('ek_keterangan_catatan') : NULL,
                'ek_tanggal_catatan_tindakan'               => $tanggal_catatan_tindakan,
                'ek_bismillah_pagi'                         => safe_post('ek_bismillah_pagi') !== '' ? safe_post('ek_bismillah_pagi') : NULL,
                'ek_cek_pagi'                               => safe_post('ek_cek_pagi') !== '' ? safe_post('ek_cek_pagi') : NULL,
                'ek_jam_pagi'                               => $catatan_jam_pagi,
                'ek_paraf_pagi'                             => safe_post('ek_paraf_pagi') !== '' ? safe_post('ek_paraf_pagi') : NULL,
                'ek_perawat_tindakan_pagi'                  => safe_post('ek_perawat_tindakan_pagi') !== '' ? safe_post('ek_perawat_tindakan_pagi') : NULL,
                'ek_hamdalah_pagi'                          => safe_post('ek_hamdalah_pagi') !== '' ? safe_post('ek_hamdalah_pagi') : NULL,
                'ek_bismillah_sore'                         => safe_post('ek_bismillah_sore') !== '' ? safe_post('ek_bismillah_sore') : NULL,
                'ek_cek_sore'                               => safe_post('ek_cek_sore') !== '' ? safe_post('ek_cek_sore') : NULL,
                'ek_jam_sore'                               => $catatan_jam_sore,
                'ek_paraf_sore'                             => safe_post('ek_paraf_sore') !== '' ? safe_post('ek_paraf_sore') : NULL,
                'ek_perawat_tindakan_sore'                  => safe_post('ek_perawat_tindakan_sore') !== '' ? safe_post('ek_perawat_tindakan_sore') : NULL,
                'ek_hamdalah_sore'                          => safe_post('ek_hamdalah_sore') !== '' ? safe_post('ek_hamdalah_sore') : NULL,
                'ek_bismillah_malam'                        => safe_post('ek_bismillah_malam') !== '' ? safe_post('ek_bismillah_malam') : NULL,
                'ek_cek_malam'                              => safe_post('ek_cek_malam') !== '' ? safe_post('ek_cek_malam') : NULL,
                'ek_jam_malam'                              => $catatan_jam_malam,
                'ek_perawat_tindakan_malam'                 => safe_post('ek_perawat_tindakan_malam') !== '' ? safe_post('ek_perawat_tindakan_malam') : NULL,
                'ek_hamdalah_malam'                         => safe_post('ek_hamdalah_malam') !== '' ? safe_post('ek_hamdalah_malam') : NULL,
                'ek_paraf_malam'                            => safe_post('ek_paraf_malam') !== '' ? safe_post('ek_paraf_malam') : NULL,
                'ek_operator_catatan_tindakan'              => safe_post('ek_operator_catatan_tindakan') !== '' ? safe_post('ek_operator_catatan_tindakan') : NULL,
                'created_date'                              => $tanggal_tindakan,
            );

            $this->m_pelayanan->updateCatatanTindakanKeperawatan($catatan_tindakan_keperawatan, false);
        } else {

            $keg_tindakan_keperawatan = safe_post('keg_tindakan_keperawatan');

            if (!empty($keg_tindakan_keperawatan)) {

                $respon = ['show' => '2', 'status' => false, 'message' => 'Kegiatan Tindakan Keperawatan Belum ditambahkan', 'id' => '#nurse-note'];
            }
        }

        $rencana_tindakan_keperawatan = safe_post('rencana_tindakan_keperawatan');

        if ($rencana_tindakan_keperawatan) {

            $tanggal_tindakan_satu = safe_post('tanggal_tindakan_satu');
            $ek_tanggal_tindakan_satu = is_string($tanggal_tindakan_satu);

            if ($tanggal_tindakan_satu === "" || $tanggal_tindakan_satu === null) {

                $tanggal_dibuat_rencana = null;
            } else if (!is_array($tanggal_tindakan_satu)) {


                $tanggal_dibuat_rencana = null;
            } else if (empty($tanggal_tindakan_satu)) {


                $tanggal_dibuat_rencana = null;
            } else if ($ek_tanggal_tindakan_satu === true) {


                $tanggal_dibuat_rencana = null;
            } else {

                foreach ($tanggal_tindakan_satu as $key => $value) {

                    $date = new DateTime($value);
                    $new = $date->format('Y-m-d');


                    $tanggal_dibuat_rencana[$key] = $new;
                }
            }

            $tanggal_tindakan_dua = safe_post('tanggal_tindakan_dua');
            $ek_tanggal_tindakan_dua = is_string($tanggal_tindakan_dua);

            if ($tanggal_tindakan_dua === "" || $tanggal_tindakan_dua === null) {

                $tanggal_dibuat_rencana_dua = null;
            } else if (!is_array($tanggal_tindakan_dua)) {


                $tanggal_dibuat_rencana_dua = null;
            } else if (empty($tanggal_tindakan_dua)) {


                $tanggal_dibuat_rencana_dua = null;
            } else if ($ek_tanggal_tindakan_dua === true) {


                $tanggal_dibuat_rencana_dua = null;
            } else {

                foreach ($tanggal_tindakan_dua as $key => $value) {

                    $date = new DateTime($value);
                    $new = $date->format('Y-m-d');


                    $tanggal_dibuat_rencana_dua[$key] = $new;
                }
            }

            $tanggal_tindakan_tiga = safe_post('tanggal_tindakan_tiga');
            $ek_tanggal_tindakan_tiga = is_string($tanggal_tindakan_tiga);

            if ($tanggal_tindakan_tiga === "" || $tanggal_tindakan_tiga === null) {

                $tanggal_dibuat_rencana_tiga = null;
            } else if (!is_array($tanggal_tindakan_tiga)) {

                $tanggal_dibuat_rencana_tiga = null;
            } else if (empty($tanggal_tindakan_tiga)) {

                $tanggal_dibuat_rencana_tiga = null;
            } else if ($ek_tanggal_tindakan_tiga === true) {

                $tanggal_dibuat_rencana_tiga = null;
            } else {

                foreach ($tanggal_tindakan_tiga as $key => $value) {

                    $date = new DateTime($value);
                    $new = $date->format('Y-m-d');


                    $tanggal_dibuat_rencana_tiga[$key] = $new;
                }
            }

            $tanggal_rencana_dibuat = safe_post('tanggal_rencana_dibuat');
            $ek_tanggal_rencana_dibuat = is_string($tanggal_rencana_dibuat);

            if ($tanggal_rencana_dibuat === "" || $tanggal_rencana_dibuat === null) {

                $tanggal_rencana = null;
            } else if (!is_array($tanggal_rencana_dibuat)) {


                $tanggal_rencana = null;
            } else if (empty($tanggal_rencana_dibuat)) {


                $tanggal_rencana = null;
            } else if ($ek_tanggal_rencana_dibuat === true) {


                $tanggal_rencana = null;
            } else {

                foreach ($tanggal_rencana_dibuat as $key => $value) {

                    $date = new DateTime($value);
                    $new = $date->format('Y-m-d H:i:s');


                    $tanggal_rencana[$key] = $new;
                }
            }

            $rncn_tind_keperawatan = array(
                'id_layanan_pendaftaran'        => $layanan['id'],
                'rencana_tindakan_keperawatan'  => safe_post('rencana_tindakan_keperawatan') !== '' ? safe_post('rencana_tindakan_keperawatan') : NULL,
                'keterangan'                    => safe_post('ek_keterangan_tambahan') !== '' ? safe_post('ek_keterangan_tambahan') : NULL,
                'tanggal_tindakan_satu'         => $tanggal_dibuat_rencana,
                'ek_tambahan_status'            => safe_post('ek_tambahan_status') !== '' ? safe_post('ek_tambahan_status') : NULL,
                'ek_waktu_pagi'                 => safe_post('ek_waktu_pagi') !== '' ? safe_post('ek_waktu_pagi') : NULL,
                'ek_waktu_siang'                => safe_post('ek_waktu_siang') !== '' ? safe_post('ek_waktu_siang') : NULL,
                'ek_waktu_malam'                => safe_post('ek_waktu_malam') !== '' ? safe_post('ek_waktu_malam') : NULL,
                'tanggal_tindakan_dua'          => $tanggal_dibuat_rencana_dua,
                'ek_tambahan_status_dua'        => safe_post('ek_tambahan_status_dua') !== '' ? safe_post('ek_tambahan_status_dua') : NULL,
                'ek_waktu_pagi_dua'             => safe_post('ek_waktu_pagi_dua') !== '' ? safe_post('ek_waktu_pagi_dua') : NULL,
                'ek_waktu_siang_dua'            => safe_post('ek_waktu_siang_dua') !== '' ? safe_post('ek_waktu_siang_dua') : NULL,
                'ek_waktu_malam_dua'            => safe_post('ek_waktu_malam_dua') !== '' ? safe_post('ek_waktu_malam_dua') : NULL,
                'tanggal_tindakan_tiga'         => $tanggal_dibuat_rencana_tiga,
                'ek_tambahan_status_tiga'       => safe_post('ek_tambahan_status_tiga') !== '' ? safe_post('ek_tambahan_status_tiga') : NULL,
                'ek_waktu_pagi_tiga'            => safe_post('ek_waktu_pagi_tiga') !== '' ? safe_post('ek_waktu_pagi_tiga') : NULL,
                'ek_waktu_siang_tiga'           => safe_post('ek_waktu_siang_tiga') !== '' ? safe_post('ek_waktu_siang_tiga') : NULL,
                'ek_waktu_malam_tiga'           => safe_post('ek_waktu_malam_tiga') !== '' ? safe_post('ek_waktu_malam_tiga') : NULL,
                'ek_operator_rencana_tindakan'  => safe_post('ek_operator_rencana_tindakan') !== '' ? safe_post('ek_operator_rencana_tindakan') : NULL,
                'created_date'                  => $tanggal_rencana,
            );

            $this->m_pelayanan->updateRencanaTindakanKeperawatan($rncn_tind_keperawatan, false);
        } else {

            $rencana_tindakan = safe_post('rencana_tindakan');

            if (!empty($rencana_tindakan)) {

                $respon = ['show' => '1', 'status' => false, 'message' => 'Rencana Tindakan Keperawatan Belum ditambahkan', 'id' => '#rencana-tindakan-keperawatan'];
            }
        }

        $masalah_keperawatan = safe_post('masalah_keperawatan');

        if ($masalah_keperawatan) {

            $tanggal_masalah_dibuat = safe_post('tanggal_masalah_dibuat');

            $ek_tanggal_masalah_dibuat = is_string($tanggal_masalah_dibuat);

            if ($tanggal_masalah_dibuat === "" || $tanggal_masalah_dibuat === null) {

                $tanggal_dibuat_masalah = null;
            } else if (!is_array($tanggal_masalah_dibuat)) {


                $tanggal_dibuat_masalah = null;
            } else if (empty($tanggal_masalah_dibuat)) {


                $tanggal_dibuat_masalah = null;
            } else if ($ek_tanggal_masalah_dibuat === true) {


                $tanggal_dibuat_masalah = null;
            } else {

                foreach ($tanggal_masalah_dibuat as $key => $value) {

                    $date = new DateTime($value);
                    $new = $date->format('Y-m-d H:i:s');


                    $tanggal_dibuat_masalah[$key] = $new;
                }
            }

            $tanggal_dimulai = safe_post('tanggal_mulai');

            $ek_tanggal_dimulai = is_string($tanggal_dimulai);

            if ($tanggal_dimulai === "" || $tanggal_dimulai === null) {

                $tanggal_mulai_awal = null;
            } else if (!is_array($tanggal_dimulai)) {


                $tanggal_mulai_awal = null;
            } else if (empty($tanggal_dimulai)) {


                $tanggal_mulai_awal = null;
            } else if ($ek_tanggal_dimulai === true) {


                $tanggal_mulai_awal = null;
            } else {

                foreach ($tanggal_dimulai as $key => $value) {

                    $date = new DateTime($value);
                    $new = $date->format('Y-m-d H:i:s');


                    $tanggal_mulai_awal[$key] = $new;
                }
            }

            $tanggal_diakhiri = safe_post('tanggal_selesai');

            $ek_tanggal_diakhiri = is_string($tanggal_diakhiri);

            if ($tanggal_diakhiri === "" || $tanggal_diakhiri === null) {

                $tanggal_mulai_akhir = null;
            } else if (!is_array($tanggal_diakhiri)) {


                $tanggal_mulai_akhir = null;
            } else if (empty($tanggal_diakhiri)) {


                $tanggal_mulai_akhir = null;
            } else if ($ek_tanggal_diakhiri === true) {


                $tanggal_mulai_akhir = null;
            } else {

                foreach ($tanggal_diakhiri as $key => $value) {

                    $date = new DateTime($value);
                    $new = $date->format('Y-m-d H:i:s');


                    $tanggal_mulai_akhir[$key] = $new;
                }
            }

            $mslh_keperawatan = array(
                'id_layanan_pendaftaran'   => $layanan['id'],
                'masalah_keperawatan'      => safe_post('masalah_keperawatan') !== '' ? safe_post('masalah_keperawatan') : NULL,
                'tanggal_mulai'            => $tanggal_mulai_awal,
                'tanggal_selesai'          => $tanggal_mulai_akhir,
                'id_users'                 => safe_post('ek_operator_masalah') !== '' ? safe_post('ek_operator_masalah') : NULL,
                'created_date'             => $tanggal_dibuat_masalah,
            );

            $this->m_pelayanan->updateMasalahKeperawatan($mslh_keperawatan);
        } else {

            $masalah_keperawatan = safe_post('ek_masalah_keperawatan');

            if (!empty($masalah_keperawatan)) {

                $respon = ['show' => '1', 'status' => false, 'message' => 'Data Asuhan Keperawatan Belum ditambahkan', 'id' => '#data-asuhan-keperawatan'];
            }
        }



        $tanggal_pengkajian = safe_post('tanggal_pengkajian');

        if ($tanggal_pengkajian) {

            $tanggal_pengkajian_dibuat = safe_post('tanggal_pengkajian');

            $ek_tanggal_pengkajian_dibuat = is_string($tanggal_pengkajian_dibuat);

            if ($tanggal_pengkajian_dibuat === "" || $tanggal_pengkajian_dibuat === null) {

                $tanggal_pengkajian_ulang = null;
            } else if (!is_array($tanggal_pengkajian_dibuat)) {


                $tanggal_pengkajian_ulang = null;
            } else if (empty($tanggal_pengkajian_dibuat)) {


                $tanggal_pengkajian_ulang = null;
            } else if ($ek_tanggal_pengkajian_dibuat === true) {


                $tanggal_pengkajian_ulang = null;
            } else {

                foreach ($tanggal_pengkajian_dibuat as $key => $value) {

                    $var1 = explode("/", $value);
                    $var2 = "$var1[2]-$var1[1]-$var1[0]";

                    $date = new DateTime($var2);
                    $new = $date->format('Y-m-d');


                    $tanggal_pengkajian_ulang[$key] = $new;
                }
            }

            $pengkajian_date = safe_post('pengkajian_date');

            $ek_pengkajian_date = is_string($pengkajian_date);

            if ($pengkajian_date === "" || $pengkajian_date === null) {

                $date_pengkajian = null;
            } else if (!is_array($pengkajian_date)) {


                $date_pengkajian = null;
            } else if (empty($pengkajian_date)) {


                $date_pengkajian = null;
            } else if ($ek_pengkajian_date === true) {


                $date_pengkajian = null;
            } else {

                foreach ($pengkajian_date as $key => $value) {


                    $date = new DateTime($value);
                    $new = $date->format('Y-m-d H:i:s');


                    $date_pengkajian[$key] = $new;
                }
            }



            $pengkajian_ulang = array(
                'id_layanan_pendaftaran'    => $layanan['id'],
                'tanggal_pengkajian'        => $tanggal_pengkajian_ulang,
                'jumlah_skor'               => safe_post('jumlah_skor') !== '' ? safe_post('jumlah_skor') : NULL,
                'riwayat_jatuh'             => safe_post('riwayat_jatuh') !== '' ? safe_post('riwayat_jatuh') : NULL,
                'diagnosis_sekunder'        => safe_post('diagnosis_sekunder') !== '' ? safe_post('diagnosis_sekunder') : NULL,
                'alat_bantu_dua'            => safe_post('alat_bantu_dua') !== '' ? safe_post('alat_bantu_dua') : NULL,
                'infus'                     => safe_post('infus') !== '' ? safe_post('infus') : NULL,
                'cara_berjalan'             => safe_post('cara_berjalan') !== '' ? safe_post('cara_berjalan') : NULL,
                'status_mental'             => safe_post('status_mental') !== '' ? safe_post('status_mental') : NULL,
                'users'                     => safe_post('user_pengkajian') !== '' ? safe_post('user_pengkajian') : NULL,
                'date_created'              => $date_pengkajian,
            );

            $this->m_pelayanan->updatePengkajianUlang($pengkajian_ulang);
        }

        $uprjpd_tanggal_pengkajian = safe_post('uprjpd_tanggal_pengkajian');
        $id_pendaftaran           = safe_post('id_pendaftaran');

        if (!empty($uprjpd_tanggal_pengkajian)) {
            $uprjpd_data = array(
                'id_pendaftaran'         => $id_pendaftaran,
                'id_layanan_pendaftaran' => $layanan['id'],
                'id_perawat_p'           => safe_post('uprjpd_perawat_p') !== '' ? safe_post('uprjpd_perawat_p') : null,
                'id_perawat_s'           => safe_post('uprjpd_perawat_s') !== '' ? safe_post('uprjpd_perawat_s') : null,
                'id_perawat_m'           => safe_post('uprjpd_perawat_m') !== '' ? safe_post('uprjpd_perawat_m') : null,
                'id_user'                => safe_post('user_uprjpd') !== '' ? safe_post('user_uprjpd') : null,
                'tanggal_pengkajian'     => safe_post('uprjpd_tanggal_pengkajian'),

                // Bel berfungsi dan mudah dijangkau
                'bel_p_ho'               => safe_post('uprjpd_bel_p_ho') !== '' ? safe_post('uprjpd_bel_p_ho') : null,
                'bel_p_10'               => safe_post('uprjpd_bel_p_10') !== '' ? safe_post('uprjpd_bel_p_10') : null,
                'bel_s_ho'               => safe_post('uprjpd_bel_s_ho') !== '' ? safe_post('uprjpd_bel_s_ho') : null,
                'bel_s_18'               => safe_post('uprjpd_bel_s_18') !== '' ? safe_post('uprjpd_bel_s_18') : null,
                'bel_m_ho'               => safe_post('uprjpd_bel_m_ho') !== '' ? safe_post('uprjpd_bel_m_ho') : null,
                'bel_m_23'               => safe_post('uprjpd_bel_m_23') !== '' ? safe_post('uprjpd_bel_m_23') : null,
                'bel_m_4'                => safe_post('uprjpd_bel_m_4') !== '' ? safe_post('uprjpd_bel_m_4') : null,

                // Roda tempat tidur terkunci
                'roda_p_ho'              => safe_post('uprjpd_roda_p_ho') !== '' ? safe_post('uprjpd_roda_p_ho') : null,
                'roda_p_10'              => safe_post('uprjpd_roda_p_10') !== '' ? safe_post('uprjpd_roda_p_10') : null,
                'roda_s_ho'              => safe_post('uprjpd_roda_s_ho') !== '' ? safe_post('uprjpd_roda_s_ho') : null,
                'roda_s_18'              => safe_post('uprjpd_roda_s_18') !== '' ? safe_post('uprjpd_roda_s_18') : null,
                'roda_m_ho'              => safe_post('uprjpd_roda_m_ho') !== '' ? safe_post('uprjpd_roda_m_ho') : null,
                'roda_m_23'              => safe_post('uprjpd_roda_m_23') !== '' ? safe_post('uprjpd_roda_m_23') : null,
                'roda_m_4'               => safe_post('uprjpd_roda_m_4') !== '' ? safe_post('uprjpd_roda_m_4') : null,

                // Posisikan tempat tidur pada posisi terendah
                'ptt_p_ho'               => safe_post('uprjpd_ptt_p_ho') !== '' ? safe_post('uprjpd_ptt_p_ho') : null,
                'ptt_p_10'               => safe_post('uprjpd_ptt_p_10') !== '' ? safe_post('uprjpd_ptt_p_10') : null,
                'ptt_s_ho'               => safe_post('uprjpd_ptt_s_ho') !== '' ? safe_post('uprjpd_ptt_s_ho') : null,
                'ptt_s_18'               => safe_post('uprjpd_ptt_s_18') !== '' ? safe_post('uprjpd_ptt_s_18') : null,
                'ptt_m_ho'               => safe_post('uprjpd_ptt_m_ho') !== '' ? safe_post('uprjpd_ptt_m_ho') : null,
                'ptt_m_23'               => safe_post('uprjpd_ptt_m_23') !== '' ? safe_post('uprjpd_ptt_m_23') : null,
                'ptt_m_4'                => safe_post('uprjpd_ptt_m_4') !== '' ? safe_post('uprjpd_ptt_m_4') : null,

                // Pagar pengaman tempat tidur dinaikan
                'ppt_p_ho'               => safe_post('uprjpd_ppt_p_ho') !== '' ? safe_post('uprjpd_ppt_p_ho') : null,
                'ppt_p_10'               => safe_post('uprjpd_ppt_p_10') !== '' ? safe_post('uprjpd_ppt_p_10') : null,
                'ppt_s_ho'               => safe_post('uprjpd_ppt_s_ho') !== '' ? safe_post('uprjpd_ppt_s_ho') : null,
                'ppt_s_18'               => safe_post('uprjpd_ppt_s_18') !== '' ? safe_post('uprjpd_ppt_s_18') : null,
                'ppt_m_ho'               => safe_post('uprjpd_ppt_m_ho') !== '' ? safe_post('uprjpd_ppt_m_ho') : null,
                'ppt_m_23'               => safe_post('uprjpd_ppt_m_23') !== '' ? safe_post('uprjpd_ppt_m_23') : null,
                'ppt_m_4'                => safe_post('uprjpd_ppt_m_4') !== '' ? safe_post('uprjpd_ppt_m_4') : null,

                // Penerang cukup
                'penerangan_p_ho'        => safe_post('uprjpd_penerangan_p_ho') !== '' ? safe_post('uprjpd_penerangan_p_ho') : null,
                'penerangan_p_10'        => safe_post('uprjpd_penerangan_p_10') !== '' ? safe_post('uprjpd_penerangan_p_10') : null,
                'penerangan_s_ho'        => safe_post('uprjpd_penerangan_s_ho') !== '' ? safe_post('uprjpd_penerangan_s_ho') : null,
                'penerangan_s_18'        => safe_post('uprjpd_penerangan_s_18') !== '' ? safe_post('uprjpd_penerangan_s_18') : null,
                'penerangan_m_ho'        => safe_post('uprjpd_penerangan_m_ho') !== '' ? safe_post('uprjpd_penerangan_m_ho') : null,
                'penerangan_m_23'        => safe_post('uprjpd_penerangan_m_23') !== '' ? safe_post('uprjpd_penerangan_m_23') : null,
                'penerangan_m_4'         => safe_post('uprjpd_penerangan_m_4') !== '' ? safe_post('uprjpd_penerangan_m_4') : null,

                // Pastikan alas kaki yang tidak licin untuk pasien yang dapat berjalan
                'alas_p_ho'              => safe_post('uprjpd_alas_p_ho') !== '' ? safe_post('uprjpd_alas_p_ho') : null,
                'alas_p_10'              => safe_post('uprjpd_alas_p_10') !== '' ? safe_post('uprjpd_alas_p_10') : null,
                'alas_s_ho'              => safe_post('uprjpd_alas_s_ho') !== '' ? safe_post('uprjpd_alas_s_ho') : null,
                'alas_s_18'              => safe_post('uprjpd_alas_s_18') !== '' ? safe_post('uprjpd_alas_s_18') : null,
                'alas_m_ho'              => safe_post('uprjpd_alas_m_ho') !== '' ? safe_post('uprjpd_alas_m_ho') : null,
                'alas_m_23'              => safe_post('uprjpd_alas_m_23') !== '' ? safe_post('uprjpd_alas_m_23') : null,
                'alas_m_4'               => safe_post('uprjpd_alas_m_4') !== '' ? safe_post('uprjpd_alas_m_4') : null,

                // Lantai kering dan tidak licin
                'lantai_p_ho'            => safe_post('uprjpd_lantai_p_ho') !== '' ? safe_post('uprjpd_lantai_p_ho') : null,
                'lantai_p_10'            => safe_post('uprjpd_lantai_p_10') !== '' ? safe_post('uprjpd_lantai_p_10') : null,
                'lantai_s_ho'            => safe_post('uprjpd_lantai_s_ho') !== '' ? safe_post('uprjpd_lantai_s_ho') : null,
                'lantai_s_18'            => safe_post('uprjpd_lantai_s_18') !== '' ? safe_post('uprjpd_lantai_s_18') : null,
                'lantai_m_ho'            => safe_post('uprjpd_lantai_m_ho') !== '' ? safe_post('uprjpd_lantai_m_ho') : null,
                'lantai_m_23'            => safe_post('uprjpd_lantai_m_23') !== '' ? safe_post('uprjpd_lantai_m_23') : null,
                'lantai_m_4'             => safe_post('uprjpd_lantai_m_4') !== '' ? safe_post('uprjpd_lantai_m_4') : null,

                // Dekatkan alat-alat pasien
                'alat_p_ho'              => safe_post('uprjpd_alat_p_ho') !== '' ? safe_post('uprjpd_alat_p_ho') : null,
                'alat_p_10'              => safe_post('uprjpd_alat_p_10') !== '' ? safe_post('uprjpd_alat_p_10') : null,
                'alat_s_ho'              => safe_post('uprjpd_alat_s_ho') !== '' ? safe_post('uprjpd_alat_s_ho') : null,
                'alat_s_18'              => safe_post('uprjpd_alat_s_18') !== '' ? safe_post('uprjpd_alat_s_18') : null,
                'alat_m_ho'              => safe_post('uprjpd_alat_m_ho') !== '' ? safe_post('uprjpd_alat_m_ho') : null,
                'alat_m_23'              => safe_post('uprjpd_alat_m_23') !== '' ? safe_post('uprjpd_alat_m_23') : null,
                'alat_m_4'               => safe_post('uprjpd_alat_m_4') !== '' ? safe_post('uprjpd_alat_m_4') : null,

                // Edukasi pasien tentang efek samping obat yang diberikan
                'edukasi_p_ho'           => safe_post('uprjpd_edukasi_p_ho') !== '' ? safe_post('uprjpd_edukasi_p_ho') : null,
                'edukasi_p_10'           => safe_post('uprjpd_edukasi_p_10') !== '' ? safe_post('uprjpd_edukasi_p_10') : null,
                'edukasi_s_ho'           => safe_post('uprjpd_edukasi_s_ho') !== '' ? safe_post('uprjpd_edukasi_s_ho') : null,
                'edukasi_s_18'           => safe_post('uprjpd_edukasi_s_18') !== '' ? safe_post('uprjpd_edukasi_s_18') : null,
                'edukasi_m_ho'           => safe_post('uprjpd_edukasi_m_ho') !== '' ? safe_post('uprjpd_edukasi_m_ho') : null,
                'edukasi_m_23'           => safe_post('uprjpd_edukasi_m_23') !== '' ? safe_post('uprjpd_edukasi_m_23') : null,
                'edukasi_m_4'            => safe_post('uprjpd_edukasi_m_4') !== '' ? safe_post('uprjpd_edukasi_m_4') : null,

                // Tidak meninggalkan pasien di kamar mandi saat menggunakan commode
                'commode_p_ho'           => safe_post('uprjpd_commode_p_ho') !== '' ? safe_post('uprjpd_commode_p_ho') : null,
                'commode_p_10'           => safe_post('uprjpd_commode_p_10') !== '' ? safe_post('uprjpd_commode_p_10') : null,
                'commode_s_ho'           => safe_post('uprjpd_commode_s_ho') !== '' ? safe_post('uprjpd_commode_s_ho') : null,
                'commode_s_18'           => safe_post('uprjpd_commode_s_18') !== '' ? safe_post('uprjpd_commode_s_18') : null,
                'commode_m_ho'           => safe_post('uprjpd_commode_m_ho') !== '' ? safe_post('uprjpd_commode_m_ho') : null,
                'commode_m_23'           => safe_post('uprjpd_commode_m_23') !== '' ? safe_post('uprjpd_commode_m_23') : null,
                'commode_m_4'            => safe_post('uprjpd_commode_m_4') !== '' ? safe_post('uprjpd_commode_m_4') : null,

                // Pasang gelang khusus
                'gelang_p_ho'            => safe_post('uprjpd_gelang_p_ho') !== '' ? safe_post('uprjpd_gelang_p_ho') : null,
                'gelang_p_10'            => safe_post('uprjpd_gelang_p_10') !== '' ? safe_post('uprjpd_gelang_p_10') : null,
                'gelang_s_ho'            => safe_post('uprjpd_gelang_s_ho') !== '' ? safe_post('uprjpd_gelang_s_ho') : null,
                'gelang_s_18'            => safe_post('uprjpd_gelang_s_18') !== '' ? safe_post('uprjpd_gelang_s_18') : null,
                'gelang_m_ho'            => safe_post('uprjpd_gelang_m_ho') !== '' ? safe_post('uprjpd_gelang_m_ho') : null,
                'gelang_m_23'            => safe_post('uprjpd_gelang_m_23') !== '' ? safe_post('uprjpd_gelang_m_23') : null,
                'gelang_m_4'             => safe_post('uprjpd_gelang_m_4') !== '' ? safe_post('uprjpd_gelang_m_4') : null,

                // Tempatkan pasien di kamar yang paling dekat dengan Nurse Station
                'station_p_ho'           => safe_post('uprjpd_station_p_ho') !== '' ? safe_post('uprjpd_station_p_ho') : null,
                'station_p_10'           => safe_post('uprjpd_station_p_10') !== '' ? safe_post('uprjpd_station_p_10') : null,
                'station_s_ho'           => safe_post('uprjpd_station_s_ho') !== '' ? safe_post('uprjpd_station_s_ho') : null,
                'station_s_18'           => safe_post('uprjpd_station_s_18') !== '' ? safe_post('uprjpd_station_s_18') : null,
                'station_m_ho'           => safe_post('uprjpd_station_m_ho') !== '' ? safe_post('uprjpd_station_m_ho') : null,
                'station_m_23'           => safe_post('uprjpd_station_m_23') !== '' ? safe_post('uprjpd_station_m_23') : null,
                'station_m_4'            => safe_post('uprjpd_station_m_4') !== '' ? safe_post('uprjpd_station_m_4') : null,

                // Paraf
                'paraf_p_ho'             => safe_post('uprjpd_paraf_p_ho') !== '' ? safe_post('uprjpd_paraf_p_ho') : null,
                'paraf_p_10'             => safe_post('uprjpd_paraf_p_10') !== '' ? safe_post('uprjpd_paraf_p_10') : null,
                'paraf_s_ho'             => safe_post('uprjpd_paraf_s_ho') !== '' ? safe_post('uprjpd_paraf_s_ho') : null,
                'paraf_s_18'             => safe_post('uprjpd_paraf_s_18') !== '' ? safe_post('uprjpd_paraf_s_18') : null,
                'paraf_m_ho'             => safe_post('uprjpd_paraf_m_ho') !== '' ? safe_post('uprjpd_paraf_m_ho') : null,
                'paraf_m_23'             => safe_post('uprjpd_paraf_m_23') !== '' ? safe_post('uprjpd_paraf_m_23') : null,
                'paraf_m_4'              => safe_post('uprjpd_paraf_m_4') !== '' ? safe_post('uprjpd_paraf_m_4') : null,

                'date_created' => safe_post('pencegahan_date_dewasa') !== '' ? safe_post('pencegahan_date_dewasa') : null,
            );

            $this->m_pelayanan->insertUpayaPencegahanDewasa($uprjpd_data);
        }

        $purja_tanggal_pengkajian = safe_post('purja_tanggal_pengkajian');
        $id_pendaftaran           = safe_post('id_pendaftaran');

        if (!empty($purja_tanggal_pengkajian)) {
            $pengkajian_date_anak    = safe_post('pengkajian_date_anak') ?? null;

            $pengkajian_ulang = array(
                'id_pendaftaran'     => $id_pendaftaran,
                'id_layanan_pendaftaran' => $layanan['id'],
                'tanggal_pengkajian' => safe_post('purjpa_tanggal_pengkajian'),
                'jumlah_skor'        => safe_post('jumlah_skor') !== '' ? safe_post('jumlah_skor') : null,
                'paraf'              => safe_post('purjpa_paraf') !== '' ? safe_post('purjpa_paraf') : null,
                'perawat'            => safe_post('purjpa_perawat') !== '' ? safe_post('purjpa_perawat') : null,
                'umur'               => safe_post('umur') !== '' ? safe_post('umur') : null,
                'jenis_kelamin'      => safe_post('jenis_kelamin') !== '' ? safe_post('jenis_kelamin') : null,
                'diagnosis'          => safe_post('diagnosis') !== '' ? safe_post('diagnosis') : null,
                'gangguan_kognitif'  => safe_post('gangguan_kognitif') !== '' ? safe_post('gangguan_kognitif') : null,
                'faktor_lingkungan'  => safe_post('faktor_lingkungan') !== '' ? safe_post('faktor_lingkungan') : null,
                'respon_pembedahan'  => safe_post('respon_pembedahan') !== '' ? safe_post('respon_pembedahan') : null,
                'penggunaan_obat'    => safe_post('penggunaan_obat') !== '' ? safe_post('penggunaan_obat') : null,
                'date_created'       => $pengkajian_date_anak,
                'users'              => safe_post('user_pengkajian') !== '' ? safe_post('user_pengkajian') : null,
            );


            $this->m_pelayanan->insertPengkajianUlangAnak($pengkajian_ulang);
        }

        // else {

        //     $purjd_tanggal_pengkajian = safe_post('purjd_tanggal_pengkajian');

        //     if (!empty($purjd_tanggal_pengkajian)) {

        //         $respon = ['show' => '3', 'status' => false, 'message' => 'Pengkajian Ulang Resiko Jatuh Dewasa Belum ditambahkan', 'id' => '#data-pengkajian-ulang-resiko'];
        //     }
        // }

        $uprjpa_tanggal_pengkajian = safe_post('uprjpa_tanggal_pengkajian');
        $id_pendaftaran           = safe_post('id_pendaftaran');

        if (!empty($uprjpa_tanggal_pengkajian)) {
            $uprjpa_data = array(
                'id_pendaftaran'         => $id_pendaftaran,
                'id_layanan_pendaftaran' => $layanan['id'],
                'id_perawat_p'           => safe_post('uprjpa_perawat_p') !== '' ? safe_post('uprjpa_perawat_p') : null,
                'id_perawat_s'           => safe_post('uprjpa_perawat_s') !== '' ? safe_post('uprjpa_perawat_s') : null,
                'id_perawat_m'           => safe_post('uprjpa_perawat_m') !== '' ? safe_post('uprjpa_perawat_m') : null,
                'id_user'                => safe_post('user_uprjpa') !== '' ? safe_post('user_uprjpa') : null,
                'tanggal_pengkajian'     => safe_post('uprjpa_tanggal_pengkajian'),

                // Bel berfungsi dan mudah dijangkau
                'bel_p_ho'               => safe_post('uprjpa_bel_p_ho') !== '' ? safe_post('uprjpa_bel_p_ho') : null,
                'bel_p_10'               => safe_post('uprjpa_bel_p_10') !== '' ? safe_post('uprjpa_bel_p_10') : null,
                'bel_s_ho'               => safe_post('uprjpa_bel_s_ho') !== '' ? safe_post('uprjpa_bel_s_ho') : null,
                'bel_s_18'               => safe_post('uprjpa_bel_s_18') !== '' ? safe_post('uprjpa_bel_s_18') : null,
                'bel_m_ho'               => safe_post('uprjpa_bel_m_ho') !== '' ? safe_post('uprjpa_bel_m_ho') : null,
                'bel_m_23'               => safe_post('uprjpa_bel_m_23') !== '' ? safe_post('uprjpa_bel_m_23') : null,
                'bel_m_4'                => safe_post('uprjpa_bel_m_4') !== '' ? safe_post('uprjpa_bel_m_4') : null,

                // Roda tempat tidur terkunci
                'roda_p_ho'              => safe_post('uprjpa_roda_p_ho') !== '' ? safe_post('uprjpa_roda_p_ho') : null,
                'roda_p_10'              => safe_post('uprjpa_roda_p_10') !== '' ? safe_post('uprjpa_roda_p_10') : null,
                'roda_s_ho'              => safe_post('uprjpa_roda_s_ho') !== '' ? safe_post('uprjpa_roda_s_ho') : null,
                'roda_s_18'              => safe_post('uprjpa_roda_s_18') !== '' ? safe_post('uprjpa_roda_s_18') : null,
                'roda_m_ho'              => safe_post('uprjpa_roda_m_ho') !== '' ? safe_post('uprjpa_roda_m_ho') : null,
                'roda_m_23'              => safe_post('uprjpa_roda_m_23') !== '' ? safe_post('uprjpa_roda_m_23') : null,
                'roda_m_4'               => safe_post('uprjpa_roda_m_4') !== '' ? safe_post('uprjpa_roda_m_4') : null,

                // Posisikan tempat tidur pada posisi terendah
                'ptt_p_ho'               => safe_post('uprjpa_ptt_p_ho') !== '' ? safe_post('uprjpa_ptt_p_ho') : null,
                'ptt_p_10'               => safe_post('uprjpa_ptt_p_10') !== '' ? safe_post('uprjpa_ptt_p_10') : null,
                'ptt_s_ho'               => safe_post('uprjpa_ptt_s_ho') !== '' ? safe_post('uprjpa_ptt_s_ho') : null,
                'ptt_s_18'               => safe_post('uprjpa_ptt_s_18') !== '' ? safe_post('uprjpa_ptt_s_18') : null,
                'ptt_m_ho'               => safe_post('uprjpa_ptt_m_ho') !== '' ? safe_post('uprjpa_ptt_m_ho') : null,
                'ptt_m_23'               => safe_post('uprjpa_ptt_m_23') !== '' ? safe_post('uprjpa_ptt_m_23') : null,
                'ptt_m_4'                => safe_post('uprjpa_ptt_m_4') !== '' ? safe_post('uprjpa_ptt_m_4') : null,

                // Pagar pengaman tempat tidur dinaikan
                'ppt_p_ho'               => safe_post('uprjpa_ppt_p_ho') !== '' ? safe_post('uprjpa_ppt_p_ho') : null,
                'ppt_p_10'               => safe_post('uprjpa_ppt_p_10') !== '' ? safe_post('uprjpa_ppt_p_10') : null,
                'ppt_s_ho'               => safe_post('uprjpa_ppt_s_ho') !== '' ? safe_post('uprjpa_ppt_s_ho') : null,
                'ppt_s_18'               => safe_post('uprjpa_ppt_s_18') !== '' ? safe_post('uprjpa_ppt_s_18') : null,
                'ppt_m_ho'               => safe_post('uprjpa_ppt_m_ho') !== '' ? safe_post('uprjpa_ppt_m_ho') : null,
                'ppt_m_23'               => safe_post('uprjpa_ppt_m_23') !== '' ? safe_post('uprjpa_ppt_m_23') : null,
                'ppt_m_4'                => safe_post('uprjpa_ppt_m_4') !== '' ? safe_post('uprjpa_ppt_m_4') : null,

                // Penerang cukup
                'penerangan_p_ho'        => safe_post('uprjpa_penerangan_p_ho') !== '' ? safe_post('uprjpa_penerangan_p_ho') : null,
                'penerangan_p_10'        => safe_post('uprjpa_penerangan_p_10') !== '' ? safe_post('uprjpa_penerangan_p_10') : null,
                'penerangan_s_ho'        => safe_post('uprjpa_penerangan_s_ho') !== '' ? safe_post('uprjpa_penerangan_s_ho') : null,
                'penerangan_s_18'        => safe_post('uprjpa_penerangan_s_18') !== '' ? safe_post('uprjpa_penerangan_s_18') : null,
                'penerangan_m_ho'        => safe_post('uprjpa_penerangan_m_ho') !== '' ? safe_post('uprjpa_penerangan_m_ho') : null,
                'penerangan_m_23'        => safe_post('uprjpa_penerangan_m_23') !== '' ? safe_post('uprjpa_penerangan_m_23') : null,
                'penerangan_m_4'         => safe_post('uprjpa_penerangan_m_4') !== '' ? safe_post('uprjpa_penerangan_m_4') : null,

                // Pastikan alas kaki yang tidak licin untuk pasien yang dapat berjalan
                'alas_p_ho'              => safe_post('uprjpa_alas_p_ho') !== '' ? safe_post('uprjpa_alas_p_ho') : null,
                'alas_p_10'              => safe_post('uprjpa_alas_p_10') !== '' ? safe_post('uprjpa_alas_p_10') : null,
                'alas_s_ho'              => safe_post('uprjpa_alas_s_ho') !== '' ? safe_post('uprjpa_alas_s_ho') : null,
                'alas_s_18'              => safe_post('uprjpa_alas_s_18') !== '' ? safe_post('uprjpa_alas_s_18') : null,
                'alas_m_ho'              => safe_post('uprjpa_alas_m_ho') !== '' ? safe_post('uprjpa_alas_m_ho') : null,
                'alas_m_23'              => safe_post('uprjpa_alas_m_23') !== '' ? safe_post('uprjpa_alas_m_23') : null,
                'alas_m_4'               => safe_post('uprjpa_alas_m_4') !== '' ? safe_post('uprjpa_alas_m_4') : null,

                // Lantai kering dan tidak licin
                'lantai_p_ho'            => safe_post('uprjpa_lantai_p_ho') !== '' ? safe_post('uprjpa_lantai_p_ho') : null,
                'lantai_p_10'            => safe_post('uprjpa_lantai_p_10') !== '' ? safe_post('uprjpa_lantai_p_10') : null,
                'lantai_s_ho'            => safe_post('uprjpa_lantai_s_ho') !== '' ? safe_post('uprjpa_lantai_s_ho') : null,
                'lantai_s_18'            => safe_post('uprjpa_lantai_s_18') !== '' ? safe_post('uprjpa_lantai_s_18') : null,
                'lantai_m_ho'            => safe_post('uprjpa_lantai_m_ho') !== '' ? safe_post('uprjpa_lantai_m_ho') : null,
                'lantai_m_23'            => safe_post('uprjpa_lantai_m_23') !== '' ? safe_post('uprjpa_lantai_m_23') : null,
                'lantai_m_4'             => safe_post('uprjpa_lantai_m_4') !== '' ? safe_post('uprjpa_lantai_m_4') : null,

                // Dekatkan alat-alat pasien
                'alat_p_ho'              => safe_post('uprjpa_alat_p_ho') !== '' ? safe_post('uprjpa_alat_p_ho') : null,
                'alat_p_10'              => safe_post('uprjpa_alat_p_10') !== '' ? safe_post('uprjpa_alat_p_10') : null,
                'alat_s_ho'              => safe_post('uprjpa_alat_s_ho') !== '' ? safe_post('uprjpa_alat_s_ho') : null,
                'alat_s_18'              => safe_post('uprjpa_alat_s_18') !== '' ? safe_post('uprjpa_alat_s_18') : null,
                'alat_m_ho'              => safe_post('uprjpa_alat_m_ho') !== '' ? safe_post('uprjpa_alat_m_ho') : null,
                'alat_m_23'              => safe_post('uprjpa_alat_m_23') !== '' ? safe_post('uprjpa_alat_m_23') : null,
                'alat_m_4'               => safe_post('uprjpa_alat_m_4') !== '' ? safe_post('uprjpa_alat_m_4') : null,

                // Edukasi pasien tentang efek samping obat yang diberikan
                'edukasi_p_ho'           => safe_post('uprjpa_edukasi_p_ho') !== '' ? safe_post('uprjpa_edukasi_p_ho') : null,
                'edukasi_p_10'           => safe_post('uprjpa_edukasi_p_10') !== '' ? safe_post('uprjpa_edukasi_p_10') : null,
                'edukasi_s_ho'           => safe_post('uprjpa_edukasi_s_ho') !== '' ? safe_post('uprjpa_edukasi_s_ho') : null,
                'edukasi_s_18'           => safe_post('uprjpa_edukasi_s_18') !== '' ? safe_post('uprjpa_edukasi_s_18') : null,
                'edukasi_m_ho'           => safe_post('uprjpa_edukasi_m_ho') !== '' ? safe_post('uprjpa_edukasi_m_ho') : null,
                'edukasi_m_23'           => safe_post('uprjpa_edukasi_m_23') !== '' ? safe_post('uprjpa_edukasi_m_23') : null,
                'edukasi_m_4'            => safe_post('uprjpa_edukasi_m_4') !== '' ? safe_post('uprjpa_edukasi_m_4') : null,

                // Tidak meninggalkan pasien di kamar mandi saat menggunakan commode
                'commode_p_ho'           => safe_post('uprjpa_commode_p_ho') !== '' ? safe_post('uprjpa_commode_p_ho') : null,
                'commode_p_10'           => safe_post('uprjpa_commode_p_10') !== '' ? safe_post('uprjpa_commode_p_10') : null,
                'commode_s_ho'           => safe_post('uprjpa_commode_s_ho') !== '' ? safe_post('uprjpa_commode_s_ho') : null,
                'commode_s_18'           => safe_post('uprjpa_commode_s_18') !== '' ? safe_post('uprjpa_commode_s_18') : null,
                'commode_m_ho'           => safe_post('uprjpa_commode_m_ho') !== '' ? safe_post('uprjpa_commode_m_ho') : null,
                'commode_m_23'           => safe_post('uprjpa_commode_m_23') !== '' ? safe_post('uprjpa_commode_m_23') : null,
                'commode_m_4'            => safe_post('uprjpa_commode_m_4') !== '' ? safe_post('uprjpa_commode_m_4') : null,

                // Pasang gelang khusus
                'gelang_p_ho'            => safe_post('uprjpa_gelang_p_ho') !== '' ? safe_post('uprjpa_gelang_p_ho') : null,
                'gelang_p_10'            => safe_post('uprjpa_gelang_p_10') !== '' ? safe_post('uprjpa_gelang_p_10') : null,
                'gelang_s_ho'            => safe_post('uprjpa_gelang_s_ho') !== '' ? safe_post('uprjpa_gelang_s_ho') : null,
                'gelang_s_18'            => safe_post('uprjpa_gelang_s_18') !== '' ? safe_post('uprjpa_gelang_s_18') : null,
                'gelang_m_ho'            => safe_post('uprjpa_gelang_m_ho') !== '' ? safe_post('uprjpa_gelang_m_ho') : null,
                'gelang_m_23'            => safe_post('uprjpa_gelang_m_23') !== '' ? safe_post('uprjpa_gelang_m_23') : null,
                'gelang_m_4'             => safe_post('uprjpa_gelang_m_4') !== '' ? safe_post('uprjpa_gelang_m_4') : null,

                // Tempatkan pasien di kamar yang paling dekat dengan Nurse Station
                'station_p_ho'           => safe_post('uprjpa_station_p_ho') !== '' ? safe_post('uprjpa_station_p_ho') : null,
                'station_p_10'           => safe_post('uprjpa_station_p_10') !== '' ? safe_post('uprjpa_station_p_10') : null,
                'station_s_ho'           => safe_post('uprjpa_station_s_ho') !== '' ? safe_post('uprjpa_station_s_ho') : null,
                'station_s_18'           => safe_post('uprjpa_station_s_18') !== '' ? safe_post('uprjpa_station_s_18') : null,
                'station_m_ho'           => safe_post('uprjpa_station_m_ho') !== '' ? safe_post('uprjpa_station_m_ho') : null,
                'station_m_23'           => safe_post('uprjpa_station_m_23') !== '' ? safe_post('uprjpa_station_m_23') : null,
                'station_m_4'            => safe_post('uprjpa_station_m_4') !== '' ? safe_post('uprjpa_station_m_4') : null,

                // Paraf
                'paraf_p_ho'             => safe_post('uprjpa_paraf_p_ho') !== '' ? safe_post('uprjpa_paraf_p_ho') : null,
                'paraf_p_10'             => safe_post('uprjpa_paraf_p_10') !== '' ? safe_post('uprjpa_paraf_p_10') : null,
                'paraf_s_ho'             => safe_post('uprjpa_paraf_s_ho') !== '' ? safe_post('uprjpa_paraf_s_ho') : null,
                'paraf_s_18'             => safe_post('uprjpa_paraf_s_18') !== '' ? safe_post('uprjpa_paraf_s_18') : null,
                'paraf_m_ho'             => safe_post('uprjpa_paraf_m_ho') !== '' ? safe_post('uprjpa_paraf_m_ho') : null,
                'paraf_m_23'             => safe_post('uprjpa_paraf_m_23') !== '' ? safe_post('uprjpa_paraf_m_23') : null,
                'paraf_m_4'              => safe_post('uprjpa_paraf_m_4') !== '' ? safe_post('uprjpa_paraf_m_4') : null,

                'date_created' => safe_post('pencegahan_date_anak') !== '' ? safe_post('pencegahan_date_anak') : null,
            );

            $this->m_pelayanan->insertUpayaPencegahanAnak($uprjpa_data);
        }

        $purjl_tanggal_pengkajian = safe_post('purjpl_tanggal_pengkajian');
        $id_pendaftaran           = safe_post('id_pendaftaran');

        if (!empty($purjl_tanggal_pengkajian)) {
            $pengkajian_date_lansia = safe_post('pengkajian_date_lansia') ?? null;

            $pengkajian_ulang = array(
                'id_pendaftaran'             => $id_pendaftaran,
                'id_layanan_pendaftaran'     => $layanan['id'],
                'id_perawat'                 => safe_post('purjpl_perawat') !== '' ? safe_post('purjpl_perawat') : null,
                'id_user'                    => safe_post('user_pengkajian') !== '' ? safe_post('user_pengkajian') : null,
                'tanggal_pengkajian'         => safe_post('purjpl_tanggal_pengkajian'),
                'jumlah_skor'                => safe_post('jumlah_skor') !== '' ? safe_post('jumlah_skor') : null,
                'paraf'                      => safe_post('purjpl_paraf') !== '' ? safe_post('purjpl_paraf') : null,
                'pasien_datang_karena_jatuh' => safe_post('purjpl_pasien_datang_karena_jatuh') !== '' ? safe_post('purjpl_pasien_datang_karena_jatuh') : null,
                'jatuh_dua_bulan_terakhir'   => safe_post('purjpl_jatuh_2_bulan_terakhir') !== '' ? safe_post('purjpl_jatuh_2_bulan_terakhir') : null,
                'delirium'                   => safe_post('purjpl_pasien_delirium') !== '' ? safe_post('purjpl_pasien_delirium') : null,
                'disorientasi'               => safe_post('purjpl_pasien_disorientasi') !== '' ? safe_post('purjpl_pasien_disorientasi') : null,
                'agitasi'                    => safe_post('purjpl_pasien_agitasi') !== '' ? safe_post('purjpl_pasien_agitasi') : null,
                'kacamata'                   => safe_post('purjpl_pasien_kacamata') !== '' ? safe_post('purjpl_pasien_kacamata') : null,
                'buram'                      => safe_post('purjpl_pasien_buram') !== '' ? safe_post('purjpl_pasien_buram') : null,
                'galukoma'                   => safe_post('purjpl_pasien_galukoma') !== '' ? safe_post('purjpl_pasien_galukoma') : null,
                'berkemih'                   => safe_post('purjpl_berkemih') !== '' ? safe_post('purjpl_berkemih') : null,
                'mandiri'                    => safe_post('purjpl_pasien_mandiri') !== '' ? safe_post('purjpl_pasien_mandiri') : null,
                'sedikit_bantuan'            => safe_post('purjpl_pasien_sedikit_bantuan') !== '' ? safe_post('purjpl_pasien_sedikit_bantuan') : null,
                'bantuan_nyata'              => safe_post('purjpl_pasien_bantuan_nyata') !== '' ? safe_post('purjpl_pasien_bantuan_nyata') : null,
                'bantuan_total'              => safe_post('purjpl_pasien_bantuan_total') !== '' ? safe_post('purjpl_pasien_bantuan_total') : null,
                'm_mandiri'                  => safe_post('purjpl_pasien_m_mandiri') !== '' ? safe_post('purjpl_pasien_m_mandiri') : null,
                'm_sedikit_bantuan'          => safe_post('purjpl_pasien_m_sedikit_bantuan') !== '' ? safe_post('purjpl_pasien_m_sedikit_bantuan') : null,
                'kursi_roda'                 => safe_post('purjpl_pasien_kursi_roda') !== '' ? safe_post('purjpl_pasien_kursi_roda') : null,
                'imobilisasi'                => safe_post('purjpl_pasien_imobilisasi') !== '' ? safe_post('purjpl_pasien_imobilisasi') : null,
                'date_created'               => $pengkajian_date_lansia,
            );

            //          var_dump($pengkajian_ulang);die;

            $this->m_pelayanan->insertPengkajianUlangLansia($pengkajian_ulang);
        }

        $uprjpl_tanggal_pengkajian = safe_post('uprjpl_tanggal_pengkajian');
        $id_pendaftaran           = safe_post('id_pendaftaran');

        if (!empty($uprjpl_tanggal_pengkajian)) {
            $pengkajian_ulang = array(
                'id_pendaftaran'         => $id_pendaftaran,
                'id_layanan_pendaftaran' => $layanan['id'],
                'id_perawat_p'           => safe_post('uprjpl_perawat_p') !== '' ? safe_post('uprjpl_perawat_p') : null,
                'id_perawat_s'           => safe_post('uprjpl_perawat_s') !== '' ? safe_post('uprjpl_perawat_s') : null,
                'id_perawat_m'           => safe_post('uprjpl_perawat_m') !== '' ? safe_post('uprjpl_perawat_m') : null,
                'id_user'                => safe_post('user_pengkajian') !== '' ? safe_post('user_pengkajian') : null,
                'tanggal_pengkajian'     => safe_post('uprjpl_tanggal_pengkajian'),

                // Bel berfungsi dan mudah dijangkau
                'bel_p_ho'               => safe_post('uprjpl_bel_p_ho') !== '' ? safe_post('uprjpl_bel_p_ho') : null,
                'bel_p_10'               => safe_post('uprjpl_bel_p_10') !== '' ? safe_post('uprjpl_bel_p_10') : null,
                'bel_s_ho'               => safe_post('uprjpl_bel_s_ho') !== '' ? safe_post('uprjpl_bel_s_ho') : null,
                'bel_s_18'               => safe_post('uprjpl_bel_s_18') !== '' ? safe_post('uprjpl_bel_s_18') : null,
                'bel_m_ho'               => safe_post('uprjpl_bel_m_ho') !== '' ? safe_post('uprjpl_bel_m_ho') : null,
                'bel_m_23'               => safe_post('uprjpl_bel_m_23') !== '' ? safe_post('uprjpl_bel_m_23') : null,
                'bel_m_4'                => safe_post('uprjpl_bel_m_4') !== '' ? safe_post('uprjpl_bel_m_4') : null,

                // Roda tempat tidur terkunci
                'roda_p_ho'              => safe_post('uprjpl_roda_p_ho') !== '' ? safe_post('uprjpl_roda_p_ho') : null,
                'roda_p_10'              => safe_post('uprjpl_roda_p_10') !== '' ? safe_post('uprjpl_roda_p_10') : null,
                'roda_s_ho'              => safe_post('uprjpl_roda_s_ho') !== '' ? safe_post('uprjpl_roda_s_ho') : null,
                'roda_s_18'              => safe_post('uprjpl_roda_s_18') !== '' ? safe_post('uprjpl_roda_s_18') : null,
                'roda_m_ho'              => safe_post('uprjpl_roda_m_ho') !== '' ? safe_post('uprjpl_roda_m_ho') : null,
                'roda_m_23'              => safe_post('uprjpl_roda_m_23') !== '' ? safe_post('uprjpl_roda_m_23') : null,
                'roda_m_4'               => safe_post('uprjpl_roda_m_4') !== '' ? safe_post('uprjpl_roda_m_4') : null,

                // Posisikan tempat tidur pada posisi terendah
                'ptt_p_ho'               => safe_post('uprjpl_ptt_p_ho') !== '' ? safe_post('uprjpl_ptt_p_ho') : null,
                'ptt_p_10'               => safe_post('uprjpl_ptt_p_10') !== '' ? safe_post('uprjpl_ptt_p_10') : null,
                'ptt_s_ho'               => safe_post('uprjpl_ptt_s_ho') !== '' ? safe_post('uprjpl_ptt_s_ho') : null,
                'ptt_s_18'               => safe_post('uprjpl_ptt_s_18') !== '' ? safe_post('uprjpl_ptt_s_18') : null,
                'ptt_m_ho'               => safe_post('uprjpl_ptt_m_ho') !== '' ? safe_post('uprjpl_ptt_m_ho') : null,
                'ptt_m_23'               => safe_post('uprjpl_ptt_m_23') !== '' ? safe_post('uprjpl_ptt_m_23') : null,
                'ptt_m_4'                => safe_post('uprjpl_ptt_m_4') !== '' ? safe_post('uprjpl_ptt_m_4') : null,

                // Pagar pengaman tempat tidur dinaikan
                'ppt_p_ho'               => safe_post('uprjpl_ppt_p_ho') !== '' ? safe_post('uprjpl_ppt_p_ho') : null,
                'ppt_p_10'               => safe_post('uprjpl_ppt_p_10') !== '' ? safe_post('uprjpl_ppt_p_10') : null,
                'ppt_s_ho'               => safe_post('uprjpl_ppt_s_ho') !== '' ? safe_post('uprjpl_ppt_s_ho') : null,
                'ppt_s_18'               => safe_post('uprjpl_ppt_s_18') !== '' ? safe_post('uprjpl_ppt_s_18') : null,
                'ppt_m_ho'               => safe_post('uprjpl_ppt_m_ho') !== '' ? safe_post('uprjpl_ppt_m_ho') : null,
                'ppt_m_23'               => safe_post('uprjpl_ppt_m_23') !== '' ? safe_post('uprjpl_ppt_m_23') : null,
                'ppt_m_4'                => safe_post('uprjpl_ppt_m_4') !== '' ? safe_post('uprjpl_ppt_m_4') : null,

                // Penerang cukup
                'penerangan_p_ho'        => safe_post('uprjpl_penerangan_p_ho') !== '' ? safe_post('uprjpl_penerangan_p_ho') : null,
                'penerangan_p_10'        => safe_post('uprjpl_penerangan_p_10') !== '' ? safe_post('uprjpl_penerangan_p_10') : null,
                'penerangan_s_ho'        => safe_post('uprjpl_penerangan_s_ho') !== '' ? safe_post('uprjpl_penerangan_s_ho') : null,
                'penerangan_s_18'        => safe_post('uprjpl_penerangan_s_18') !== '' ? safe_post('uprjpl_penerangan_s_18') : null,
                'penerangan_m_ho'        => safe_post('uprjpl_penerangan_m_ho') !== '' ? safe_post('uprjpl_penerangan_m_ho') : null,
                'penerangan_m_23'        => safe_post('uprjpl_penerangan_m_23') !== '' ? safe_post('uprjpl_penerangan_m_23') : null,
                'penerangan_m_4'         => safe_post('uprjpl_penerangan_m_4') !== '' ? safe_post('uprjpl_penerangan_m_4') : null,

                // Pastikan alas kaki yang tidak licin untuk pasien yang dapat berjalan
                'alas_p_ho'              => safe_post('uprjpl_alas_p_ho') !== '' ? safe_post('uprjpl_alas_p_ho') : null,
                'alas_p_10'              => safe_post('uprjpl_alas_p_10') !== '' ? safe_post('uprjpl_alas_p_10') : null,
                'alas_s_ho'              => safe_post('uprjpl_alas_s_ho') !== '' ? safe_post('uprjpl_alas_s_ho') : null,
                'alas_s_18'              => safe_post('uprjpl_alas_s_18') !== '' ? safe_post('uprjpl_alas_s_18') : null,
                'alas_m_ho'              => safe_post('uprjpl_alas_m_ho') !== '' ? safe_post('uprjpl_alas_m_ho') : null,
                'alas_m_23'              => safe_post('uprjpl_alas_m_23') !== '' ? safe_post('uprjpl_alas_m_23') : null,
                'alas_m_4'               => safe_post('uprjpl_alas_m_4') !== '' ? safe_post('uprjpl_alas_m_4') : null,

                // Lantai kering dan tidak licin
                'lantai_p_ho'            => safe_post('uprjpl_lantai_p_ho') !== '' ? safe_post('uprjpl_lantai_p_ho') : null,
                'lantai_p_10'            => safe_post('uprjpl_lantai_p_10') !== '' ? safe_post('uprjpl_lantai_p_10') : null,
                'lantai_s_ho'            => safe_post('uprjpl_lantai_s_ho') !== '' ? safe_post('uprjpl_lantai_s_ho') : null,
                'lantai_s_18'            => safe_post('uprjpl_lantai_s_18') !== '' ? safe_post('uprjpl_lantai_s_18') : null,
                'lantai_m_ho'            => safe_post('uprjpl_lantai_m_ho') !== '' ? safe_post('uprjpl_lantai_m_ho') : null,
                'lantai_m_23'            => safe_post('uprjpl_lantai_m_23') !== '' ? safe_post('uprjpl_lantai_m_23') : null,
                'lantai_m_4'             => safe_post('uprjpl_lantai_m_4') !== '' ? safe_post('uprjpl_lantai_m_4') : null,

                // Dekatkan alat-alat pasien
                'alat_p_ho'              => safe_post('uprjpl_alat_p_ho') !== '' ? safe_post('uprjpl_alat_p_ho') : null,
                'alat_p_10'              => safe_post('uprjpl_alat_p_10') !== '' ? safe_post('uprjpl_alat_p_10') : null,
                'alat_s_ho'              => safe_post('uprjpl_alat_s_ho') !== '' ? safe_post('uprjpl_alat_s_ho') : null,
                'alat_s_18'              => safe_post('uprjpl_alat_s_18') !== '' ? safe_post('uprjpl_alat_s_18') : null,
                'alat_m_ho'              => safe_post('uprjpl_alat_m_ho') !== '' ? safe_post('uprjpl_alat_m_ho') : null,
                'alat_m_23'              => safe_post('uprjpl_alat_m_23') !== '' ? safe_post('uprjpl_alat_m_23') : null,
                'alat_m_4'               => safe_post('uprjpl_alat_m_4') !== '' ? safe_post('uprjpl_alat_m_4') : null,

                // Edukasi pasien tentang efek samping obat yang diberikan
                'edukasi_p_ho'           => safe_post('uprjpl_edukasi_p_ho') !== '' ? safe_post('uprjpl_edukasi_p_ho') : null,
                'edukasi_p_10'           => safe_post('uprjpl_edukasi_p_10') !== '' ? safe_post('uprjpl_edukasi_p_10') : null,
                'edukasi_s_ho'           => safe_post('uprjpl_edukasi_s_ho') !== '' ? safe_post('uprjpl_edukasi_s_ho') : null,
                'edukasi_s_18'           => safe_post('uprjpl_edukasi_s_18') !== '' ? safe_post('uprjpl_edukasi_s_18') : null,
                'edukasi_m_ho'           => safe_post('uprjpl_edukasi_m_ho') !== '' ? safe_post('uprjpl_edukasi_m_ho') : null,
                'edukasi_m_23'           => safe_post('uprjpl_edukasi_m_23') !== '' ? safe_post('uprjpl_edukasi_m_23') : null,
                'edukasi_m_4'            => safe_post('uprjpl_edukasi_m_4') !== '' ? safe_post('uprjpl_edukasi_m_4') : null,

                // Tidak meninggalkan pasien di kamar mandi saat menggunakan commode
                'commode_p_ho'           => safe_post('uprjpl_commode_p_ho') !== '' ? safe_post('uprjpl_commode_p_ho') : null,
                'commode_p_10'           => safe_post('uprjpl_commode_p_10') !== '' ? safe_post('uprjpl_commode_p_10') : null,
                'commode_s_ho'           => safe_post('uprjpl_commode_s_ho') !== '' ? safe_post('uprjpl_commode_s_ho') : null,
                'commode_s_18'           => safe_post('uprjpl_commode_s_18') !== '' ? safe_post('uprjpl_commode_s_18') : null,
                'commode_m_ho'           => safe_post('uprjpl_commode_m_ho') !== '' ? safe_post('uprjpl_commode_m_ho') : null,
                'commode_m_23'           => safe_post('uprjpl_commode_m_23') !== '' ? safe_post('uprjpl_commode_m_23') : null,
                'commode_m_4'            => safe_post('uprjpl_commode_m_4') !== '' ? safe_post('uprjpl_commode_m_4') : null,

                // Pasang gelang khusus
                'gelang_p_ho'            => safe_post('uprjpl_gelang_p_ho') !== '' ? safe_post('uprjpl_gelang_p_ho') : null,
                'gelang_p_10'            => safe_post('uprjpl_gelang_p_10') !== '' ? safe_post('uprjpl_gelang_p_10') : null,
                'gelang_s_ho'            => safe_post('uprjpl_gelang_s_ho') !== '' ? safe_post('uprjpl_gelang_s_ho') : null,
                'gelang_s_18'            => safe_post('uprjpl_gelang_s_18') !== '' ? safe_post('uprjpl_gelang_s_18') : null,
                'gelang_m_ho'            => safe_post('uprjpl_gelang_m_ho') !== '' ? safe_post('uprjpl_gelang_m_ho') : null,
                'gelang_m_23'            => safe_post('uprjpl_gelang_m_23') !== '' ? safe_post('uprjpl_gelang_m_23') : null,
                'gelang_m_4'             => safe_post('uprjpl_gelang_m_4') !== '' ? safe_post('uprjpl_gelang_m_4') : null,

                // Tempatkan pasien di kamar yang paling dekat dengan Nurse Station
                'station_p_ho'           => safe_post('uprjpl_station_p_ho') !== '' ? safe_post('uprjpl_station_p_ho') : null,
                'station_p_10'           => safe_post('uprjpl_station_p_10') !== '' ? safe_post('uprjpl_station_p_10') : null,
                'station_s_ho'           => safe_post('uprjpl_station_s_ho') !== '' ? safe_post('uprjpl_station_s_ho') : null,
                'station_s_18'           => safe_post('uprjpl_station_s_18') !== '' ? safe_post('uprjpl_station_s_18') : null,
                'station_m_ho'           => safe_post('uprjpl_station_m_ho') !== '' ? safe_post('uprjpl_station_m_ho') : null,
                'station_m_23'           => safe_post('uprjpl_station_m_23') !== '' ? safe_post('uprjpl_station_m_23') : null,
                'station_m_4'            => safe_post('uprjpl_station_m_4') !== '' ? safe_post('uprjpl_station_m_4') : null,

                // Paraf
                'paraf_p_ho'             => safe_post('uprjpl_paraf_p_ho') !== '' ? safe_post('uprjpl_paraf_p_ho') : null,
                'paraf_p_10'             => safe_post('uprjpl_paraf_p_10') !== '' ? safe_post('uprjpl_paraf_p_10') : null,
                'paraf_s_ho'             => safe_post('uprjpl_paraf_s_ho') !== '' ? safe_post('uprjpl_paraf_s_ho') : null,
                'paraf_s_18'             => safe_post('uprjpl_paraf_s_18') !== '' ? safe_post('uprjpl_paraf_s_18') : null,
                'paraf_m_ho'             => safe_post('uprjpl_paraf_m_ho') !== '' ? safe_post('uprjpl_paraf_m_ho') : null,
                'paraf_m_23'             => safe_post('uprjpl_paraf_m_23') !== '' ? safe_post('uprjpl_paraf_m_23') : null,
                'paraf_m_4'              => safe_post('uprjpl_paraf_m_4') !== '' ? safe_post('uprjpl_paraf_m_4') : null,

                'date_created' => safe_post('pencegahan_date_lansia') !== '' ? safe_post('pencegahan_date_lansia') : null,
            );

            $this->m_pelayanan->insertUpayaPencegahanLansia($pengkajian_ulang);
        }

        // $uprjpn_tanggal_pengkajian = safe_post('uprjpn_tanggal_pengkajian');
        // $id_pendaftaran           = safe_post('id_pendaftaran');

        // if (!empty($uprjpn_tanggal_pengkajian)) {
        //     $upaya_pencegahan_resiko_jatuh_neonatus = array(
        //         'id_pendaftaran'         => $id_pendaftaran,
        //         'id_layanan_pendaftaran' => $layanan['id'],
        //         'id_perawat_1'           => safe_post('perawat_1') !== '' ? safe_post('perawat_1') : null,
        //         'id_perawat_2'           => safe_post('perawat_2') !== '' ? safe_post('perawat_2') : null,
        //         'id_perawat_3'           => safe_post('perawat_3') !== '' ? safe_post('perawat_3') : null,
        //         'id_user'                => safe_post('user_pengkajian') !== '' ? safe_post('user_pengkajian') : null,
        //         'tanggal_pengkajian'     => safe_post('uprjpn_tanggal_pengkajian'),

        //         // Posisi tanda Risiko  jatuh tetap ada/terpasang
        //         'terpasang_p_ho'               => safe_post('terpasang_p_ho') !== '' ? safe_post('terpasang_p_ho') : null,
        //         'terpasang_p_10'               => safe_post('terpasang_p_10') !== '' ? safe_post('terpasang_p_10') : null,
        //         'terpasang_s_ho'               => safe_post('terpasang_s_ho') !== '' ? safe_post('terpasang_s_ho') : null,
        //         'terpasang_s_18'               => safe_post('terpasang_s_18') !== '' ? safe_post('terpasang_s_18') : null,
        //         'terpasang_m_ho'               => safe_post('terpasang_m_ho') !== '' ? safe_post('terpasang_m_ho') : null,
        //         'terpasang_m_23'               => safe_post('terpasang_m_23') !== '' ? safe_post('terpasang_m_23') : null,
        //         'terpasang_m_4'                => safe_post('terpasang_m_4') !== '' ? safe_post('terpasang_m_4') : null,

        //         // Pastikan roda box/incubator pada posisi terkunci
        //         'terkunci_p_ho'              => safe_post('terkunci_p_ho') !== '' ? safe_post('terkunci_p_ho') : null,
        //         'terkunci_p_10'              => safe_post('terkunci_p_10') !== '' ? safe_post('terkunci_p_10') : null,
        //         'terkunci_s_ho'              => safe_post('terkunci_s_ho') !== '' ? safe_post('terkunci_s_ho') : null,
        //         'terkunci_s_18'              => safe_post('terkunci_s_18') !== '' ? safe_post('terkunci_s_18') : null,
        //         'terkunci_m_ho'              => safe_post('terkunci_m_ho') !== '' ? safe_post('terkunci_m_ho') : null,
        //         'terkunci_m_23'              => safe_post('terkunci_m_23') !== '' ? safe_post('terkunci_m_23') : null,
        //         'terkunci_m_4'               => safe_post('terkunci_m_4') !== '' ? safe_post('terkunci_m_4') : null,

        //         // Pastikan pintu inkubator tertutup bila tidak ada tindakan
        //         'tindakan_p_ho'               => safe_post('tindakan_p_ho') !== '' ? safe_post('tindakan_p_ho') : null,
        //         'tindakan_p_10'               => safe_post('tindakan_p_10') !== '' ? safe_post('tindakan_p_10') : null,
        //         'tindakan_s_ho'               => safe_post('tindakan_s_ho') !== '' ? safe_post('tindakan_s_ho') : null,
        //         'tindakan_s_18'               => safe_post('tindakan_s_18') !== '' ? safe_post('tindakan_s_18') : null,
        //         'tindakan_m_ho'               => safe_post('tindakan_m_ho') !== '' ? safe_post('tindakan_m_ho') : null,
        //         'tindakan_m_23'               => safe_post('tindakan_m_23') !== '' ? safe_post('tindakan_m_23') : null,
        //         'tindakan_m_4'                => safe_post('tindakan_m_4') !== '' ? safe_post('tindakan_m_4') : null,

        //         // Paraf
        //         'paraff_p_ho'             => safe_post('paraff_p_ho') !== '' ? safe_post('paraff_p_ho') : null,
        //         'paraff_p_10'             => safe_post('paraff_p_10') !== '' ? safe_post('paraff_p_10') : null,
        //         'paraff_s_ho'             => safe_post('paraff_s_ho') !== '' ? safe_post('paraff_s_ho') : null,
        //         'paraff_s_18'             => safe_post('paraff_s_18') !== '' ? safe_post('paraff_s_18') : null,
        //         'paraff_m_ho'             => safe_post('paraff_m_ho') !== '' ? safe_post('paraff_m_ho') : null,
        //         'paraff_m_23'             => safe_post('paraff_m_23') !== '' ? safe_post('paraff_m_23') : null,
        //         'paraff_m_4'              => safe_post('paraff_m_4') !== '' ? safe_post('paraff_m_4') : null,

        //         'date_created' => safe_post('pencegahan_date_neonatus') !== '' ? safe_post('pencegahan_date_neonatus') : null,
        //     );
        //     // var_dump($upaya_pencegahan_resiko_jatuh_neonatus);
        //     $this->m_pelayanan->insertUpayaPencegahanResikoJatuhPadaNeonatus($upaya_pencegahan_resiko_jatuh_neonatus);
        // }























        $tindakan_petugas = safe_post('tindakan_petugas');

        if ($tindakan_petugas) {

            $tanggal_kajian = safe_post('tanggal_kajian');

            $pundpn_tanggal_kajian = is_string($tanggal_kajian);


            if ($tanggal_kajian === "" || $tanggal_kajian === null) {

                $date_kajian = null;
            } else if (!is_array($tanggal_kajian)) {


                $date_kajian = null;
            } else if (empty($tanggal_kajian)) {


                $date_kajian = null;
            } else if ($pundpn_tanggal_kajian === true) {

                $date_kajian = null;
            } else {

                foreach ($tanggal_kajian as $key => $value) {


                    $date = new DateTime($value);
                    $new = $date->format('Y-m-d H:i:s');


                    $date_kajian[$key] = $new;
                }
            }


            $tanggal_kajian_dibuat = safe_post('tanggal_kajian_dibuat');

            $pundpn_tanggal_kajian_dibuat = is_string($tanggal_kajian_dibuat);

            if ($tanggal_kajian_dibuat === "" || $tanggal_kajian_dibuat === null) {

                $date_kajian_dibuat = null;
            } else if (!is_array($tanggal_kajian_dibuat)) {


                $date_kajian_dibuat = null;
            } else if (empty($tanggal_kajian_dibuat)) {


                $date_kajian_dibuat = null;
            } else if ($pundpn_tanggal_kajian_dibuat === true) {


                $date_kajian_dibuat = null;
            } else {

                foreach ($tanggal_kajian_dibuat as $key => $value) {


                    $date = new DateTime($value);
                    $new = $date->format('Y-m-d H:i:s');


                    $date_kajian_dibuat[$key] = $new;
                }
            }



            $pengkajian_ulang = array(
                'id_layanan_pendaftaran'    => $layanan['id'],
                'tanggal_pemantauan'        => $date_kajian,
                'skor_nyeri'                => safe_post('skor_nyeri') !== '' ? safe_post('skor_nyeri') : NULL,
                'tindakan_petugas'          => safe_post('tindakan_petugas') !== '' ? safe_post('tindakan_petugas') : NULL,
                'id_users'                  => safe_post('petugas_kajian') !== '' ? safe_post('petugas_kajian') : NULL,
                'created_date'              => $date_kajian_dibuat,
            );

            $this->m_pelayanan->updatePemantauanUlang($pengkajian_ulang);
        } else {

            $tanggal_kaji = safe_post('tanggal_kaji');

            if (!empty($tanggal_kaji)) {

                $respon = ['show' => '4', 'status' => false, 'message' => 'Pengkajian dan Pemantauan Nyeri Belum ditambahkan', 'id' => '#data-pengkajian-pemantauan-nyeri'];
            }
        }

        //Bukti Visit Dokter DPJP
        $dokter_visit = safe_post('dokter_visit');

        if (!empty($dokter_visit)) {

            $tanggal_visit = safe_post('tanggal_visit');
            $tanggal_waktu_visit = is_string($tanggal_visit);

            if ($tanggal_visit === "" || $tanggal_visit === null) {

                $date_visit = null;
            } else if (!is_array($tanggal_visit)) {


                $date_visit = null;
            } else if (empty($tanggal_visit)) {


                $date_visit = null;
            } else if ($tanggal_waktu_visit === true) {


                $date_visit = null;
            } else {

                foreach ($tanggal_visit as $key => $value) {


                    $date = new DateTime($value);
                    $new = $date->format('Y-m-d H:i:s');


                    $date_visit[$key] = $new;
                }
            }

            $tanggal_visit_dibuat = safe_post('tanggal_visit_dibuat');

            $tanggal_waktu_visit = is_string($tanggal_visit_dibuat);

            if ($tanggal_visit_dibuat === "" || $tanggal_visit_dibuat === null) {

                $date_visit_dibuat = null;
            } else if (!is_array($tanggal_visit_dibuat)) {


                $date_visit_dibuat = null;
            } else if (empty($tanggal_visit_dibuat)) {


                $date_visit_dibuat = null;
            } else if ($tanggal_waktu_visit === true) {


                $date_visit_dibuat = null;
            } else {

                foreach ($tanggal_visit_dibuat as $key => $value) {


                    $date = new DateTime($value);
                    $new = $date->format('Y-m-d H:i:s');


                    $date_visit_dibuat[$key] = $new;
                }
            }

            $bukti_visit_dokter = array(
                'id_layanan_pendaftaran'    => $layanan['id'],
                'tanggal_waktu_visit'       => $date_visit,
                'id_dokter_visit'           => safe_post('dokter_visit') !== '' ? safe_post('dokter_visit') : NULL,
                'keterangan_visit'          => safe_post('ket_bukti_visit') !== '' ? safe_post('ket_bukti_visit') : NULL,
                'id_users'                  => safe_post('operator_visit') !== '' ? safe_post('operator_visit') : NULL,
                'created_date'              => $date_visit_dibuat,
            );

            $this->m_pelayanan->updateBuktiVisit($bukti_visit_dokter);
        }

        // // Catatan Operan Perawat PAGI
        // $id_dpjp_utama_pagi = safe_post('dpjp_utama_pagi');
        // if (!empty($id_dpjp_utama_pagi)) {

        //     $tanggal_waktu_pagi = safe_post('tanggal_waktu_pagi');

        //     $di_tanggal_waktu_pagi = is_string($tanggal_waktu_pagi);

        //     if ($tanggal_waktu_pagi === "" || $tanggal_waktu_pagi === null) {

        //         $date_pagi = null;
        //     } else if (!is_array($tanggal_waktu_pagi)) {


        //         $date_pagi = null;
        //     } else if (empty($tanggal_waktu_pagi)) {


        //         $date_pagi = null;
        //     } else if ($di_tanggal_waktu_pagi === true) {


        //         $date_pagi = null;
        //     } else {

        //         foreach ($tanggal_waktu_pagi as $key => $value) {


        //             $date = new DateTime($value);
        //             $new = $date->format('Y-m-d H:i:s');

        //             $date_pagi[$key] = $new;
        //         }
        //     }



        //     $catatan_operan_perawat_pagi = array(
        //         'id_layanan_pendaftaran'        => $layanan['id'],
        //         'operan_diagnosa_keperawatan'   => safe_post('operan_diagnosa_keperawatan') !== '' ? safe_post('operan_diagnosa_keperawatan') : NULL,
        //         'dpjp_utama_pagi'               => safe_post('dpjp_utama_pagi') !== '' ? safe_post('dpjp_utama_pagi') : NULL,
        //         'konsulen_pagi'                 => safe_post('konsulen_pagi'),
        //         'tanggal_waktu_pagi'            => $date_pagi,
        //         'diagnosa_keperawatan_pagi'     => safe_post('diagnosa_keperawatan_pagi') !== '' ? safe_post('diagnosa_keperawatan_pagi') : NULL,
        //         'infus_pagi'                    => safe_post('infus_pagi') !== '' ? safe_post('infus_pagi') : NULL,
        //         'rencana_tindakan_pagi'         => safe_post('rencana_tindakan_pagi') !== '' ? safe_post('rencana_tindakan_pagi') : NULL,
        //         'perawat_mengover_pagi'         => safe_post('perawat_mengover_pagi') !== '' ? safe_post('perawat_mengover_pagi') : NULL,
        //         'perawat_menerima_pagi'         => safe_post('perawat_menerima_pagi') !== '' ? safe_post('perawat_menerima_pagi') : NULL,
        //         'id_users'                      => safe_post('user_input_catatan') !== '' ? safe_post('user_input_catatan') : NULL,
        //     );


        //     $this->m_pelayanan->updateCatatanPagi($catatan_operan_perawat_pagi);
        // }


        // //Catatan Operan Perawat Sore
        // $id_dokter_dpjp_sore = safe_post('id_dokter_dpjp_sore');
        // if (!empty($id_dokter_dpjp_sore)) {

        //     $tanggal_waktu_sore = safe_post('tanggal_waktu_sore');

        //     $di_tanggal_waktu_sore = is_string($tanggal_waktu_sore);

        //     if ($tanggal_waktu_sore === "" || $tanggal_waktu_sore === null) {

        //         $date_sore = null;
        //     } else if (!is_array($tanggal_waktu_sore)) {


        //         $date_sore = null;
        //     } else if (empty($tanggal_waktu_sore)) {


        //         $date_sore = null;
        //     } else if ($di_tanggal_waktu_sore === true) {


        //         $date_sore = null;
        //     } else {

        //         foreach ($tanggal_waktu_sore as $key => $value) {


        //             $date = new DateTime($value);
        //             $new = $date->format('Y-m-d H:i:s');


        //             $date_sore[$key] = $new;
        //         }
        //     }

        //     $catatan_operan_perawat_sore = array(
        //         'id_layanan_pendaftaran'        => $layanan['id'],
        //         'dokter_dpjp_sore'              => safe_post('id_dokter_dpjp_sore') !== '' ? safe_post('id_dokter_dpjp_sore') : NULL,
        //         'konsulen_sore'                 => safe_post('konsulen_sore'),
        //         'tanggal_waktu_sore'            => $date_sore,
        //         'diagnosa_keperawatan_sore'     => safe_post('diagnosa_keperawatan_sore') !== '' ? safe_post('diagnosa_keperawatan_sore') : NULL,
        //         'infus_sore'                    => safe_post('infus_sore') !== '' ? safe_post('infus_sore') : NULL,
        //         'rencana_tindakan_sore'         => safe_post('rencana_tindakan_sore') !== '' ? safe_post('rencana_tindakan_sore') : NULL,
        //         'perawat_mengover_sore'         => safe_post('perawat_mengover_sore') !== '' ? safe_post('perawat_mengover_sore') : NULL,
        //         'perawat_menerima_sore'         => safe_post('perawat_menerima_sore') !== '' ? safe_post('perawat_menerima_sore') : NULL,
        //         'id_users'                      => safe_post('user_input_catatan') !== '' ? safe_post('user_input_catatan') : NULL,
        //     );

        //     $this->m_pelayanan->updateCatatanSore($catatan_operan_perawat_sore);
        // }

        // //Catatan Operan Perawat Malam
        // $dokter_dpjp_malam = safe_post('id_dokter_dpjp_malam');
        // if (!empty($dokter_dpjp_malam)) {

        //     $tanggal_waktu_malam = safe_post('tanggal_waktu_malam');

        //     $di_tanggal_waktu_malam = is_string($tanggal_waktu_malam);

        //     if ($tanggal_waktu_malam === "" || $tanggal_waktu_malam === null) {

        //         $date_malam = null;
        //     } else if (!is_array($tanggal_waktu_malam)) {


        //         $date_malam = null;
        //     } else if (empty($tanggal_waktu_malam)) {


        //         $date_malam = null;
        //     } else if ($tanggal_waktu_malam === true) {


        //         $date_malam = null;
        //     } else {

        //         foreach ($tanggal_waktu_malam as $key => $value) {


        //             $date = new DateTime($value);
        //             $new = $date->format('Y-m-d H:i:s');


        //             $date_malam[$key] = $new;
        //         }
        //     }

        //     $catatan_operan_perawat_malam = array(
        //         'id_layanan_pendaftaran'         => $layanan['id'],
        //         'dokter_dpjp_malam'              => safe_post('id_dokter_dpjp_malam') !== '' ? safe_post('id_dokter_dpjp_malam') : NULL,
        //         'konsulen_malam'                 => safe_post('konsulen_malam'),
        //         'tanggal_waktu_malam'            => $date_malam,
        //         'diagnosa_keperawatan_malam'     => safe_post('diagnosa_keperawatan_malam') !== '' ? safe_post('diagnosa_keperawatan_malam') : NULL,
        //         'infus_malam'                    => safe_post('infus_malam') !== '' ? safe_post('infus_malam') : NULL,
        //         'rencana_tindakan_malam'         => safe_post('rencana_tindakan_malam') !== '' ? safe_post('rencana_tindakan_malam') : NULL,
        //         'perawat_mengover_malam'         => safe_post('perawat_mengover_malam') !== '' ? safe_post('perawat_mengover_malam') : NULL,
        //         'perawat_menerima_malam'         => safe_post('perawat_menerima_malam') !== '' ? safe_post('perawat_menerima_malam') : NULL,
        //         'id_users'                       => safe_post('user_input_catatan') !== '' ? safe_post('user_input_catatan') : NULL,
        //     );

        //     $this->m_pelayanan->updateCatatanMalam($catatan_operan_perawat_malam);
        // }


        // Daftar Dokter DPJP
        // $diagnosis_dokter = safe_post('diagnosis_dokter');

        // if (!empty($diagnosis_dokter)) {

        //     // tanggal dpjp
        //     $tanggal_mulai_dpjp = safe_post('tanggal_mulai_dpjp');

        //     $dpjp_tanggal_mulai = is_string($tanggal_mulai_dpjp);

        //     if ($tanggal_mulai_dpjp === "" || $tanggal_mulai_dpjp === null) {

        //         $date_dpjp = null;
        //     } else if (!is_array($tanggal_mulai_dpjp)) {


        //         $date_dpjp = null;
        //     } else if (empty($tanggal_mulai_dpjp)) {


        //         $date_dpjp = null;
        //     } else if ($dpjp_tanggal_mulai === true) {


        //         $date_dpjp = null;
        //     } else {

        //         foreach ($tanggal_mulai_dpjp as $key => $value) {

        //             $var1 = explode("/", $value);
        //             $var2 = "$var1[2]-$var1[1]-$var1[0]";

        //             $date = new DateTime($var2);
        //             $new = $date->format('Y-m-d');

        //             $date_dpjp[$key] = $new;
        //         }
        //     }

        //     $tanggal_akhir_dpjp = safe_post('tanggal_akhir_dpjp');

        //     $dpjp_tanggal_akhir = is_string($tanggal_akhir_dpjp);

        //     if ($tanggal_akhir_dpjp === "" || $tanggal_akhir_dpjp === null) {

        //         $date_akhir_dpjp = null;
        //     } else if (!is_array($tanggal_akhir_dpjp)) {


        //         $date_akhir_dpjp = null;
        //     } else if (empty($tanggal_akhir_dpjp)) {


        //         $date_akhir_dpjp = null;
        //     } else if ($dpjp_tanggal_akhir === true) {


        //         $date_akhir_dpjp = null;
        //     } else {

        //         foreach ($tanggal_akhir_dpjp as $key => $value) {

        //             $var1 = explode("/", $value);
        //             $var2 = "$var1[2]-$var1[1]-$var1[0]";

        //             $date = new DateTime($var2);
        //             $new = $date->format('Y-m-d');

        //             $date_akhir_dpjp[$key] = $new;
        //         }
        //     }

        //     //tanggal dpjp utama
        //     $tanggal_mulai_dpjp_utama = safe_post('tanggal_mulai_dpjp_utama');

        //     $dpjp_tanggal_mulai_utama = is_string($tanggal_mulai_dpjp_utama);

        //     if ($tanggal_mulai_dpjp_utama === "" || $tanggal_mulai_dpjp_utama === null) {

        //         $date_mulai_dpjp_utama = null;
        //     } else if (!is_array($tanggal_mulai_dpjp_utama)) {


        //         $date_mulai_dpjp_utama = null;
        //     } else if (empty($tanggal_mulai_dpjp_utama)) {


        //         $date_mulai_dpjp_utama = null;
        //     } else if ($dpjp_tanggal_mulai_utama === true) {


        //         $date_mulai_dpjp_utama = null;
        //     } else {

        //         foreach ($tanggal_mulai_dpjp_utama as $key => $value) {

        //             $var1 = explode("/", $value);
        //             $var2 = "$var1[2]-$var1[1]-$var1[0]";

        //             $date = new DateTime($var2);
        //             $new = $date->format('Y-m-d');

        //             $date_mulai_dpjp_utama[$key] = $new;
        //         }
        //     }

        //     $tanggal_akhir_dpjp_utama = safe_post('tanggal_akhir_dpjp_utama');

        //     $dpjp_tanggal_akhir_utama = is_string($tanggal_akhir_dpjp_utama);

        //     if ($tanggal_akhir_dpjp_utama === "" || $tanggal_akhir_dpjp_utama === null) {

        //         $date_akhir_dpjp_utama = null;
        //     } else if (!is_array($tanggal_akhir_dpjp_utama)) {


        //         $date_akhir_dpjp_utama = null;
        //     } else if (empty($tanggal_akhir_dpjp_utama)) {


        //         $date_akhir_dpjp_utama = null;
        //     } else if ($dpjp_tanggal_akhir_utama === true) {


        //         $date_akhir_dpjp_utama = null;
        //     } else {

        //         foreach ($tanggal_akhir_dpjp_utama as $key => $value) {
        //             $var1 = explode("/", $value);
        //             $var2 = "$var1[2]-$var1[1]-$var1[0]";

        //             $date = new DateTime($var2);
        //             $new = $date->format('Y-m-d');

        //             $date_akhir_dpjp_utama[$key] = $new;
        //         }
        //     }

        //     $daftar_dokter_dpjp = array(
        //         'id_layanan_pendaftaran'    => $layanan['id'],
        //         'diagnosis_dokter'          => safe_post('diagnosis_dokter') !== '' ? safe_post('diagnosis_dokter') : NULL,
        //         'keterangan_dpjp'           => safe_post('keterangan_dpjp') !== '' ? safe_post('keterangan_dpjp') : NULL,
        //         'tanggal_awal_dpjp'         => $date_dpjp,
        //         'tanggal_akhir_dpjp'        => $date_akhir_dpjp,
        //         'tanggal_awal_dpjp_utama'   => $date_mulai_dpjp_utama,
        //         'tanggal_akhir_dpjp_utama'  => $date_akhir_dpjp_utama,
        //         'id_dokter_dpjp'            => safe_post('nama_dokter_dpjp') !== '' ? safe_post('nama_dokter_dpjp') : NULL,
        //         'id_dokter_dpjp_utama'      => safe_post('nama_dokter_dpjp_utama') !== '' ? safe_post('nama_dokter_dpjp_utama') : NULL,
        //         'id_users'                  => safe_post('user_dokter_dpjp') !== '' ? safe_post('user_dokter_dpjp') : NULL,
        //         'created_date'              => $this->datetime,
        //     );

        //     $this->m_pelayanan->updateDaftarDPJP($daftar_dokter_dpjp);
        // }

        $ruang_rawat = safe_post('sirs_ruang_rawat');

        if ($ruang_rawat) {

            $si_tanggal_mulai = safe_post('sirs_tanggal_mulai');

            $sirs_tanggal_mulai = is_string($si_tanggal_mulai);

            if ($si_tanggal_mulai === "" || $si_tanggal_mulai === null) {

                $sirs_mulai = null;
            } else if (!is_array($si_tanggal_mulai)) {

                $sirs_mulai = null;
            } else if (empty($si_tanggal_mulai)) {


                $sirs_mulai = null;
            } else if ($sirs_tanggal_mulai === true) {


                $sirs_mulai = null;
            } else {

                foreach ($si_tanggal_mulai as $key => $value) {


                    $var1 = explode("/", $value);
                    $var2 = "$var1[2]-$var1[1]-$var1[0]";

                    $date = new DateTime($var2);
                    $new = $date->format('Y-m-d');


                    $sirs_mulai[$key] = $new;
                }
            }

            $tanggal_selesai = safe_post('sirs_tanggal_selesai');

            $sirs_tanggal_selesai = is_string($tanggal_selesai);

            if ($tanggal_selesai === "" || $tanggal_selesai === null) {

                $sirs_selesai = null;
            } else if (!is_array($tanggal_selesai)) {


                $sirs_selesai = null;
            } else if (empty($tanggal_selesai)) {


                $sirs_selesai = null;
            } else if ($sirs_tanggal_selesai === true) {


                $sirs_selesai = null;
            } else {

                foreach ($tanggal_selesai as $key => $value) {


                    $var1 = explode("/", $value);
                    $var2 = "$var1[2]-$var1[1]-$var1[0]";

                    $date = new DateTime($var2);
                    $new = $date->format('Y-m-d');


                    $sirs_selesai[$key] = $new;
                }
            }

            $sirs_ruang_rawat = array(
                'id_layanan_pendaftaran'    => $layanan['id'],
                'ruang_rawat'               => $ruang_rawat,
                'tanggal_mulai'             => $sirs_mulai,
                'tanggal_selesai'           => $sirs_selesai,
                'user'                      => safe_post('sirs_petugas') !== '' ? safe_post('sirs_petugas') : NULL,
            );

            $this->m_pelayanan->updateRuangRawat($sirs_ruang_rawat);
        } else {

            $sirs_ruang = safe_post('sirs_ruang');

            if (!empty($sirs_ruang)) {

                $respon = ['show' => '6', 'status' => false, 'message' => 'Tempat Di Rawat Belum ditambahkan'];
            }
        }

        $sirs_tindakan = safe_post('sirs_tindakan');

        if ($sirs_tindakan) {

            $tanggal_pasang = safe_post('sirs_tanggal_pasang');

            $sirs_tanggal_pasang = is_string($tanggal_pasang);

            if ($tanggal_pasang === "" || $tanggal_pasang === null) {

                $sirs_pasang = null;
            } else if (!is_array($tanggal_pasang)) {


                $sirs_pasang = null;
            } else if (empty($tanggal_pasang)) {


                $sirs_pasang = null;
            } else if ($sirs_tanggal_pasang === true) {


                $sirs_pasang = null;
            } else {

                foreach ($tanggal_pasang as $key => $value) {


                    $var1 = explode("/", $value);
                    $var2 = "$var1[2]-$var1[1]-$var1[0]";

                    $date = new DateTime($var2);
                    $new = $date->format('Y-m-d');


                    $sirs_pasang[$key] = $new;
                }
            }

            $tanggal_lepas = safe_post('sirs_tanggal_lepas');

            $sirs_tanggal_lepas = is_string($tanggal_lepas);

            if ($tanggal_lepas === "" || $tanggal_lepas === null) {

                $sirs_lepas = null;
            } else if (!is_array($tanggal_lepas)) {


                $sirs_lepas = null;
            } else if (empty($tanggal_lepas)) {


                $sirs_lepas = null;
            } else if ($sirs_tanggal_lepas === true) {


                $sirs_lepas = null;
            } else {

                foreach ($tanggal_lepas as $key => $value) {


                    $var1 = explode("/", $value);
                    $var2 = "$var1[2]-$var1[1]-$var1[0]";

                    $date = new DateTime($var2);
                    $new = $date->format('Y-m-d');


                    $sirs_lepas[$key] = $new;
                }
            }

            $perawat_lepas = safe_post('sirs_perawat_lepas');

            $sirs_perawat_lepas = is_string($perawat_lepas);

            if ($perawat_lepas === "" || $perawat_lepas === null) {

                $sirs_perawat = null;
            } else if (!is_array($perawat_lepas)) {


                $sirs_perawat = null;
            } else if (empty($perawat_lepas)) {


                $sirs_perawat = null;
            } else if ($sirs_perawat_lepas === true) {


                $sirs_perawat = null;
            } else {

                foreach ($perawat_lepas as $key => $value) {


                    $sirs_perawat[$key] = $value;
                }
            }



            $sirs_tindakan_pemasangan = array(
                'id_layanan_pendaftaran'    => $layanan['id'],
                'sirs_tindakan'             => $sirs_tindakan,
                'sirs_tanggal_pasang'       => $sirs_pasang,
                'sirs_lokasi'               => safe_post('sirs_lokasi') !== '' ? safe_post('sirs_lokasi') : NULL,
                'sirs_alasan_pasang'        => safe_post('sirs_alasan_pasang') !== '' ? safe_post('sirs_alasan_pasang') : NULL,
                'sirs_perawat_pasang'       => safe_post('sirs_perawat_pasang') !== '' ? safe_post('sirs_perawat_pasang') : NULL,
                'sirs_tanggal_lepas'        => $sirs_lepas,
                'sirs_alasan_lepas'         => safe_post('sirs_alasan_lepas') !== '' ? safe_post('sirs_alasan_lepas') : NULL,
                'sirs_perawat_lepas'        => $sirs_perawat,
                'sirs_pemasang_alat'        => safe_post('sirs_pemasang_alat') !== '' ? safe_post('sirs_pemasang_alat') : NULL,
            );

            $this->m_pelayanan->updatePemasanganAlat($sirs_tindakan_pemasangan);
        } else {

            $pasang_sirs_tindakan = safe_post('pasang_sirs_tindakan');

            if (!empty($pasang_sirs_tindakan)) {

                $respon = ['show' => '6', 'status' => false, 'message' => 'Pemasangan Alat Belum ditambahkan'];
            }
        }

        $sirs_antibiotik = safe_post('sirs_nama_antibiotika');

        if ($sirs_antibiotik) {

            $tanggal_pemberian = safe_post('sirs_tanggal_pemberian');

            $tanggal_pemberian = safe_post('sirs_tanggal_pemberian');

            $sirs_tanggal_pemberian = is_string($tanggal_pemberian);

            if ($tanggal_pemberian === "" || $tanggal_pemberian === null) {

                $sirs_pemberian = null;
            } else if (!is_array($tanggal_pemberian)) {


                $sirs_pemberian = null;
            } else if (empty($tanggal_pemberian)) {


                $sirs_pemberian = null;
            } else if ($sirs_tanggal_pemberian === true) {


                $sirs_pemberian = null;
            } else {

                foreach ($tanggal_pemberian as $key => $value) {


                    $date = new DateTime($value);
                    $new = $date->format('Y-m-d');

                    $sirs_pemberian[$key] = $new;
                }
            }

            $tanggal_selesai = safe_post('sirs_antibiotik_tanggal_selesai');

            $sirs_tanggal_selesai = is_string($tanggal_selesai);

            if ($tanggal_selesai === "" || $tanggal_selesai === null) {

                $sirs_selesai = null;
            } else if (!is_array($tanggal_selesai)) {


                $sirs_selesai = null;
            } else if (empty($tanggal_selesai)) {


                $sirs_selesai = null;
            } else if ($sirs_tanggal_selesai === true) {


                $sirs_selesai = null;
            } else {

                foreach ($tanggal_selesai as $key => $value) {


                    $date = new DateTime($value);
                    $new = $date->format('Y-m-d');

                    $sirs_selesai[$key] = $new;
                }
            }

            $antibiotika = array(
                'id_layanan_pendaftaran'    => $layanan['id'],
                'sirs_antibiotik'           => $sirs_antibiotik,
                'sirs_dosis_antibiotik'     => safe_post('dosis_antibiotik') !== '' ? safe_post('dosis_antibiotik') : NULL,
                'sirs_tanggal_pemberian'    => $sirs_pemberian,
                'sirs_tanggal_selesai'      => $sirs_selesai,
                'sirs_teknik_antibiotik'    => safe_post('sirs_teknik_pemberian_antibiotik') !== '' ? safe_post('sirs_teknik_pemberian_antibiotik') : NULL,
                'sirs_petugas_antibiotik'   => safe_post('petugas_antibiotik') !== '' ? safe_post('petugas_antibiotik') : NULL,
            );

            $this->m_pelayanan->updateAntibiotika($antibiotika);
        } else {

            $f_sirs_nama_antibiotika = safe_post('f_sirs_nama_antibiotika');

            if (!empty($f_sirs_nama_antibiotika)) {

                $respon = ['show' => '6', 'status' => false, 'message' => 'F. Antibiotika Belum ditambahkan'];
            }
        }

        $surveilans = array(
            'id_layanan_pendaftaran'            => $layanan['id'],
            'sirs_diagnosis_masuk'              => safe_post('sirs_diagnosis_masuk') !== '' ? safe_post('sirs_diagnosis_masuk') : NULL,
            'hbsag'                             => safe_post('hbsag') !== '' ? safe_post('hbsag') : NULL,
            'antihcv'                           => safe_post('antihcv') !== '' ? safe_post('antihcv') : NULL,
            'antihiv'                           => safe_post('antihiv') !== '' ? safe_post('antihiv') : NULL,
            't_op'                              => json_encode(array(
                't_op_ortopedi' => safe_post('t_op_ortopedi'),
                't_op_digestive' => safe_post('t_op_digestive'),
                't_op_plastik' => safe_post('t_op_plastik'),
                't_op_tumor' => safe_post('t_op_tumor'),
                't_op_urologi' => safe_post('t_op_urologi'),
                't_op_tht' => safe_post('t_op_tht'),
                't_op_anak' => safe_post('t_op_anak'),
                't_op_gilut' => safe_post('t_op_gilut'),
                't_op_vaskuler' => safe_post('t_op_vaskuler'),
                't_op_saraf' => safe_post('t_op_saraf'),
                't_op_mata' => safe_post('t_op_mata'),
                't_op_thorax' => safe_post('t_op_thorax'),
                't_op_obgyn' => safe_post('t_op_obgyn'),
                't_op_lain' => safe_post('t_op_lain'),
                'sm_top_lain' => safe_post('sm_top_lain'),

            )),
            'sirs_jam'                           => safe_post('sirs_jam') !== '' ? safe_post('sirs_jam') : NULL,
            'sirs_menit'                         => safe_post('sirs_menit') !== '' ? safe_post('sirs_menit') : NULL,
            'sirs_drain'                         => safe_post('sirs_drain') !== '' ? safe_post('sirs_drain') : NULL,
            'sirs_asascore'                      => safe_post('sirs_asascore') !== '' ? safe_post('sirs_asascore') : NULL,
            'sirs_jenis_operasi'                 => safe_post('sirs_jenis_operasi') !== '' ? safe_post('sirs_jenis_operasi') : NULL,
            'sirs_tindakan_operasi'              => safe_post('sirs_tindakan_operasi') !== '' ? safe_post('sirs_tindakan_operasi') : NULL,
            'sirs_antibiotik'                    => json_encode(array(
                'sirs_antibiotik' => safe_post('sirs_antibiotik'),
                'sirs_antibiotik_profilaksis' => safe_post('sirs_antibiotik_profilaksis'),
                'sirs_dosis_antibiotik' => safe_post('sirs_dosis_antibiotik'),
            )),
            'sirs_waktu_pemberian'               => safe_post('sirs_waktu_pemberian') !== '' ? safe_post('sirs_waktu_pemberian') : NULL,
            'sirs_jam_satu'                      => safe_post('sirs_jam_satu') !== '' ? safe_post('sirs_jam_satu') : NULL,
            'sirs_menit_satu'                    => safe_post('sirs_menit_satu') !== '' ? safe_post('sirs_menit_satu') : NULL,
            'sirs_drain_satu'                    => safe_post('sirs_drain_satu') !== '' ? safe_post('sirs_drain_satu') : NULL,
            'sirs_asascore_satu'                 => safe_post('sirs_asascore_satu') !== '' ? safe_post('sirs_asascore_satu') : NULL,
            'sirs_jenis_operasi_satu'            => safe_post('sirs_jenis_operasi_satu') !== '' ? safe_post('sirs_jenis_operasi_satu') : NULL,
            'sirs_tindakan_operasi_satu'         => safe_post('sirs_tindakan_operasi_satu') !== '' ? safe_post('sirs_tindakan_operasi_satu') : NULL,
            'sirs_antibiotik_satu'               => json_encode(array(
                'sirs_antibiotik_satu' => safe_post('sirs_antibiotik_satu'),
                'sirs_antibiotik_profilaksis_satu' => safe_post('sirs_antibiotik_profilaksis_satu'),
                'sirs_dosis_antibiotik_satu' => safe_post('sirs_dosis_antibiotik_satu'),
            )),
            'sirs_waktu_pemberian_satu'         => safe_post('sirs_waktu_pemberian_satu') !== '' ? safe_post('sirs_waktu_pemberian_satu') : NULL,
            'sirs_tirah_baring'                 => safe_post('sirs_tirah_baring') !== '' ? safe_post('sirs_tirah_baring') : NULL,
            'sirs_ido'                          => json_encode(array(
                'sirs_ido' => safe_post('sirs_ido'),
                'sirs_komplikasi_ido' => safe_post('sirs_komplikasi_ido'),
                'sirs_kultur_ido' => safe_post('sirs_kultur_ido'),
            )),
            'sirs_iad'                          => json_encode(array(
                'sirs_iad' => safe_post('sirs_iad'),
                'sirs_komplikasi_iad' => safe_post('sirs_komplikasi_iad'),
                'sirs_kultur_iad' => safe_post('sirs_kultur_iad'),
            )),
            'sirs_isk'                          => json_encode(array(
                'sirs_isk' => safe_post('sirs_isk'),
                'sirs_komplikasi_isk' => safe_post('sirs_komplikasi_isk'),
                'sirs_kultur_isk' => safe_post('sirs_kultur_isk'),
            )),
            'sirs_hap'                          => json_encode(array(
                'sirs_hap' => safe_post('sirs_hap'),
                'sirs_komplikasi_hap' => safe_post('sirs_komplikasi_hap'),
                'sirs_kultur_hap' => safe_post('sirs_kultur_hap'),
            )),
            'sirs_vap'                          => json_encode(array(
                'sirs_vap' => safe_post('sirs_vap'),
                'sirs_komplikasi_vap' => safe_post('sirs_komplikasi_vap'),
                'sirs_kultur_vap' => safe_post('sirs_kultur_vap'),
            )),
            'sirs_plebitis'                     => json_encode(array(
                'sirs_plebitis' => safe_post('sirs_plebitis'),
                'sirs_komplikasi_plebitis' => safe_post('sirs_komplikasi_plebitis'),
                'sirs_kultur_plebitis' => safe_post('sirs_kultur_plebitis'),
            )),
            'sirs_dekubitus'                    => json_encode(array(
                'sirs_dekubitus' => safe_post('sirs_dekubitus'),
                'sirs_komplikasi_dekubitus' => safe_post('sirs_komplikasi_dekubitus'),
                'sirs_kultur_dekubitus' => safe_post('sirs_kultur_dekubitus'),
            )),
            'sirs_lain'                         => json_encode(array(
                'sirs_lain' => safe_post('sirs_lain'),
                'sirs_komplikasi_lain' => safe_post('sirs_komplikasi_lain'),
                'sirs_kultur_lain' => safe_post('sirs_kultur_lain'),
            )),
            'sirs_pemakaian_antibiotika'        => safe_post('sirs_pemakaian_antibiotika') !== '' ? safe_post('sirs_pemakaian_antibiotika') : NULL,
            'sirs_keluar_rs'                    => safe_post('sirs_keluar_rs') !== '' ? safe_post('sirs_keluar_rs') : NULL,
            'sirs_sebab_keluar'                 => safe_post('sirs_sebab_keluar') !== '' ? safe_post('sirs_sebab_keluar') : NULL,
            'sirs_diagnosis_akhir'              => safe_post('sirs_diagnosis_akhir') !== '' ? safe_post('sirs_diagnosis_akhir') : NULL,
            'sirs_perawat'                      => safe_post('surveilans_perawat') !== '' ? safe_post('surveilans_perawat') : NULL,
            'sirs_ipcn'                         => safe_post('surveilans_ipcn') !== '' ? safe_post('surveilans_ipcn') : NULL,
            'id_users'                          => safe_post('id_users') !== '' ? safe_post('id_users') : NULL,
        );


        $id_surveilans =  $this->db->select("ss.id, ss.sirs_tanggal_diagnosis, ss.sirs_tanggal_diagnosis_satu, ss.sirs_tanggal_keluars, ss.sirs_petugas, ss.sirs_ipcn_link, ss.sirs_tanggal_ttd_perawat, ss.sirs_tanggal_ttd_ipcn")
            ->from('sm_surveilans as ss')
            ->where('ss.id_layanan_pendaftaran', $id, true)
            ->get()
            ->row();

        if (isset($id_surveilans)) {

            $id_ssp = $id_surveilans->id;

            $sirs_tanggal_diagnosis = safe_post('sirs_tanggal_diagnosis');

            if ($sirs_tanggal_diagnosis === '' && $id_surveilans->sirs_tanggal_diagnosis !== NULL) {

                $surveilans['sirs_tanggal_diagnosis'] = null;
            } else {


                if ($id_surveilans->sirs_tanggal_diagnosis !== NULL) {

                    $sirs_tanggal_diag = $id_surveilans->sirs_tanggal_diagnosis;
                } else if ($sirs_tanggal_diagnosis === "" || $sirs_tanggal_diagnosis === null) {

                    $sirs_tanggal_diag = null;
                } else if (empty($sirs_tanggal_diagnosis)) {


                    $sirs_tanggal_diag = null;
                } else if (is_null($sirs_tanggal_diagnosis)) {


                    $sirs_tanggal_diag = null;
                } else {

                    $var1 = explode("/", $sirs_tanggal_diagnosis);
                    $var2 = "$var1[2]-$var1[1]-$var1[0]";

                    $date = new DateTime($var2);
                    $new = $date->format('Y-m-d');


                    $sirs_tanggal_diag = $new;
                }

                $surveilans['sirs_tanggal_diagnosis'] = $sirs_tanggal_diag;
            }

            if ($id_surveilans->sirs_tanggal_diagnosis_satu !== NULL) {
                $surveilans['sirs_tanggal_diagnosis_satu'] = $id_surveilans->sirs_tanggal_diagnosis_satu;
            } else {

                $sirs_tanggal_diagnosis_satu = safe_post('sirs_tanggal_diagnosis_satu');

                if ($sirs_tanggal_diagnosis_satu === "" || $sirs_tanggal_diagnosis_satu === null) {

                    $sirs_tanggal_diag_satu = null;
                } else if (empty($sirs_tanggal_diagnosis_satu)) {


                    $sirs_tanggal_diag_satu = null;
                } else if (is_null($sirs_tanggal_diagnosis_satu)) {


                    $sirs_tanggal_diag_satu = null;
                } else {

                    $var1 = explode("/", $sirs_tanggal_diagnosis_satu);
                    $var2 = "$var1[2]-$var1[1]-$var1[0]";

                    $date = new DateTime($var2);
                    $new = $date->format('Y-m-d');


                    $sirs_tanggal_diag_satu = $new;
                }

                $surveilans['sirs_tanggal_diagnosis_satu'] = $sirs_tanggal_diag_satu;
            }

            if ($id_surveilans->sirs_tanggal_keluars !== NULL) {

                $surveilans['sirs_tanggal_keluars'] = $id_surveilans->sirs_tanggal_keluars;
            } else {

                $sirs_tanggal_keluars = safe_post('sirs_tanggal_keluars');

                if ($sirs_tanggal_keluars === "" || $sirs_tanggal_keluars === null) {

                    $sirs_tanggal_klr = null;
                } else if (empty($sirs_tanggal_keluars)) {


                    $sirs_tanggal_klr = null;
                } else if (is_null($sirs_tanggal_keluars)) {


                    $sirs_tanggal_klr = null;
                } else {


                    $var1 = explode("/", $sirs_tanggal_keluars);


                    $var2 = "$var1[2]-$var1[1]-$var1[0]";

                    $date = new DateTime($var2);
                    $new = $date->format('Y-m-d');


                    $sirs_tanggal_klr = $new;
                }

                $surveilans['sirs_tanggal_keluars'] = $sirs_tanggal_klr;
            }

            if ($id_surveilans->sirs_petugas !== NULL) {
                $surveilans['sirs_petugas'] = $id_surveilans->sirs_petugas;
            } else {
                $surveilans['sirs_petugas'] = safe_post('surveilans_petugas') !== '' ? safe_post('surveilans_petugas') : NULL;
            }

            if ($id_surveilans->sirs_ipcn_link !== NULL) {
                $surveilans['sirs_ipcn_link'] = $id_surveilans->sirs_ipcn_link;
            } else {
                $surveilans['sirs_ipcn_link'] = safe_post('surveilans_ipcn_link') !== '' ? safe_post('surveilans_ipcn_link') : NULL;
            }

            if ($id_surveilans->sirs_tanggal_ttd_perawat !== NULL) {
                $surveilans['sirs_tanggal_ttd_perawat'] = $id_surveilans->sirs_tanggal_ttd_perawat;
            } else {

                $sirs_ttd_tanggal_p = safe_post('surveilans_tanggal_ttd_perawat');



                if ($sirs_ttd_tanggal_p === "" || $sirs_ttd_tanggal_p === null) {

                    $sirs_tanggal_p = null;
                } else if (empty($sirs_ttd_tanggal_p)) {


                    $sirs_tanggal_p = null;
                } else if (is_null($sirs_ttd_tanggal_p)) {


                    $sirs_tanggal_p = null;
                } else {

                    $var1 = explode("/", $sirs_ttd_tanggal_p);
                    $var2 = explode(" ", $var1[2]);

                    $var3 = $var2[0] . "-" . $var1[1] . "-" . $var1[0] . " " . $var2[1];

                    $date = new DateTime($var3);

                    $new = $date->format('Y-m-d H:i:s');


                    $sirs_tanggal_p = $new;
                }

                $surveilans['sirs_tanggal_ttd_perawat'] = $sirs_tanggal_p;
            }

            if ($id_surveilans->sirs_tanggal_ttd_ipcn !== NULL) {

                $surveilans['sirs_tanggal_ttd_ipcn'] = $id_surveilans->sirs_tanggal_ttd_ipcn;
            } else {

                $sirs_tanggal_ipcn = safe_post('surveilans_tanggal_ttd_ipcn');

                if ($sirs_tanggal_ipcn === "" || $sirs_tanggal_ipcn === null) {

                    $sirs_ttd_ipcn = null;
                } else if (empty($sirs_tanggal_ipcn)) {


                    $sirs_ttd_ipcn = null;
                } else if (is_null($sirs_tanggal_ipcn)) {


                    $sirs_ttd_ipcn = null;
                } else {


                    $var1 = explode("/", $sirs_tanggal_ipcn);

                    $var2 = explode(" ", $var1[2]);

                    $var3 = $var2[0] . "-" . $var1[1] . "-" . $var1[0] . " " . $var2[1];

                    $date = new DateTime($var3);

                    $new = $date->format('Y-m-d H:i:s');

                    $sirs_ttd_ipcn = $new;
                }

                $surveilans['sirs_tanggal_ttd_ipcn'] = $sirs_ttd_ipcn;
            }

            $surveilans['updated_date'] = $this->datetime;



            $this->db->where('id', $id_ssp)->update('sm_surveilans', $surveilans);
        } else {


            $sirs_tanggal_diagnosis = safe_post('sirs_tanggal_diagnosis');

            if ($sirs_tanggal_diagnosis === "" || $sirs_tanggal_diagnosis === null) {

                $sirs_tanggal_diag = null;
            } else if (empty($sirs_tanggal_diagnosis)) {


                $sirs_tanggal_diag = null;
            } else if (is_null($sirs_tanggal_diagnosis)) {


                $sirs_tanggal_diag = null;
            } else {




                $var1 = explode("/", $sirs_tanggal_diagnosis);

                $var2 = "$var1[2]-$var1[1]-$var1[0]";

                $date = new DateTime($var2);
                $new = $date->format('Y-m-d');


                $sirs_tanggal_diag = $new;
            }

            $surveilans['sirs_tanggal_diagnosis'] = $sirs_tanggal_diag;

            $sirs_tanggal_diagnosis_satu = safe_post('sirs_tanggal_diagnosis_satu');

            if ($sirs_tanggal_diagnosis_satu === "" || $sirs_tanggal_diagnosis_satu === null) {

                $sirs_tanggal_diag_satu = null;
            } else if (empty($sirs_tanggal_diagnosis_satu)) {


                $sirs_tanggal_diag_satu = null;
            } else if (is_null($sirs_tanggal_diagnosis_satu)) {

                $sirs_tanggal_diag_satu = null;
            } else {



                $var1 = explode("/", $sirs_tanggal_diagnosis_satu);
                $var2 = "$var1[2]-$var1[1]-$var1[0]";

                $date = new DateTime($var2);
                $new = $date->format('Y-m-d');


                $sirs_tanggal_diag_satu = $new;
            }

            $surveilans['sirs_tanggal_diagnosis_satu'] = $sirs_tanggal_diag_satu;

            $sirs_tanggal_keluars = safe_post('sirs_tanggal_keluars');

            if ($sirs_tanggal_keluars === "" || $sirs_tanggal_keluars === null) {

                $sirs_tanggal_klr = null;
            } else if (empty($sirs_tanggal_keluars)) {


                $sirs_tanggal_klr = null;
            } else if (is_null($sirs_tanggal_keluars)) {


                $sirs_tanggal_klr = null;
            } else {



                $var1 = explode("/", $sirs_tanggal_keluars);
                $var2 = "$var1[2]-$var1[1]-$var1[0]";

                $date = new DateTime($var2);
                $new = $date->format('Y-m-d');


                $sirs_tanggal_klr = $new;
            }

            $surveilans['sirs_tanggal_keluars'] = $sirs_tanggal_klr;

            $sirs_ttd_tanggal_p = safe_post('surveilans_tanggal_ttd_perawat');

            if ($sirs_ttd_tanggal_p === "" || $sirs_ttd_tanggal_p === null) {

                $sirs_tanggal_p = null;
            } else if (empty($sirs_ttd_tanggal_p)) {


                $sirs_tanggal_p = null;
            } else if (is_null($sirs_ttd_tanggal_p)) {


                $sirs_tanggal_p = null;
            } else {


                $var1 = explode("/", $sirs_ttd_tanggal_p);
                $var2 = explode(" ", $var1[2]);

                $var3 = $var2[0] . "-" . $var1[1] . "-" . $var1[0] . " " . $var2[1];

                $date = new DateTime($var3);

                $new = $date->format('Y-m-d H:i:s');


                $sirs_tanggal_p = $new;
            }

            $surveilans['sirs_tanggal_ttd_perawat'] = $sirs_tanggal_p;

            $sirs_tanggal_ipcn = safe_post('surveilans_tanggal_ttd_ipcn');

            if ($sirs_tanggal_ipcn === "" || $sirs_tanggal_ipcn === null) {

                $sirs_ttd_ipcn = null;
            } else if (empty($sirs_tanggal_ipcn)) {


                $sirs_ttd_ipcn = null;
            } else if (is_null($sirs_tanggal_ipcn)) {


                $sirs_ttd_ipcn = null;
            } else {

                $var1 = explode("/", $sirs_tanggal_ipcn);

                $var2 = explode(" ", $var1[2]);

                $var3 = $var2[0] . "-" . $var1[1] . "-" . $var1[0] . " " . $var2[1];

                $date = new DateTime($var3);

                $new = $date->format('Y-m-d H:i:s');


                $sirs_ttd_ipcn = $new;
            }

            $surveilans['sirs_tanggal_ttd_ipcn'] = $sirs_ttd_ipcn;

            $surveilans['sirs_petugas'] = safe_post('surveilans_petugas') !== '' ? safe_post('surveilans_petugas') : NULL;
            $surveilans['sirs_ipcn_link'] = safe_post('surveilans_ipcn_link') !== '' ? safe_post('surveilans_ipcn_link') : NULL;

            $this->m_pelayanan->updateSurveilans($surveilans);
        }

        if (!empty($respon)) {

            $response = $respon;
        } else {

            $response = null;
        }


        if ($this->db->trans_status() === false) :
            $this->db->trans_rollback();
            $status = false;
        else :
            $this->db->trans_commit();
            $status = true;
        endif;

        $message = array(
            'status' => $status,
            'token'  => $this->security->get_csrf_hash(),
            'id'     => $layanan['id'],
            'respon' => $response,
        );

        $this->response($message, REST_Controller::HTTP_OK);
    }

    private function konverTimeStamp($time)
    {

        $estimate = new DateTime($time);
        $nw_est = $estimate->getTimestamp();
        $nw_est_one = $nw_est * 1000;

        return $nw_est_one;
    }

    private function integrasi_pasien($idLayanan)
    {
        $this->autentikasi_user_post();

        if ($idLayanan === null) {

            $cdecode = ["metaData" => ["code" => 201, "message" => 'ID Layanan Tidak ada, harap refresh kembali']];
            return $cdecode;
            die();
        }

        $this->load->model('satu_sehat/Satu_sehat_model', 'sehat');

        $data = $this->sehat->cekidLayananPendaftaran($idLayanan);

        $identitas = $data->no_identitas;

        $nama = strtolower(preg_replace('/\xc2\xa0/', ' ', $this->get('nama')));

        $idRM = $data->no_rm;

        if ($identitas !== "") {

            $idUser = $this->session->userdata('id_translucent');

            $getID = $this->sehat->aksesSatuSehat($idUser);

            $tokenBearer = $getID->token;

            $xKonfigurasi = $this->sehat->getConfigSatuSehat();

            $url = $xKonfigurasi->apiurl . "Patient?identifier=https://fhir.kemkes.go.id/id/nik|" . $identitas;

            $header = $this->sehat->authBearer($tokenBearer);

            $output = $this->sehat->postBearer($url, $header);

            if($output['result'] !== false){

                $entryOutput = json_decode($output['result']);

                if (isset($entryOutput->entry)) {

                    if (!empty($entryOutput->entry)) {

                        $entryId = $entryOutput->entry;

                        $idPasien = $entryId[0]->resource->id;

                        $cekNama = $entryId[0]->resource->name;

                        $namaPasien = strtolower(preg_replace('/\xc2\xa0/', ' ', $cekNama[0]->text));

                        $update = ["ihsn" => $idPasien];

                        $data = $this->db->where('id', $idRM)->update('sm_pasien', $update);

                        $decode = ["metaData" => ["code" => 200, "message" => "IHSN Berhasil disimpan"]];
                    } else {

                        date_default_timezone_set('Asia/Jakarta');
                        $xDetailData = ["kategori" => "Patient", "param" => $identitas, "message" => $output['result'], "jenis_data" => 'error', "tanggal" => date('Y-m-d H:i:s'), "user" => $this->session->userdata('nama'), "function" => 'integrasi_pasien Pelayanan'];
                        $this->db->insert('sm_satu_sehat_log', $xDetailData);

                        $decode = ["metaData" => ["code" => 201, "message" => "Tidak ada data Satu Sehat untuk NIK Tersebut"]];
                    }
                } else {

                    date_default_timezone_set('Asia/Jakarta');
                    $xDetailData = ["kategori" => "Patient", "param" => $identitas, "message" => $output['result'], "jenis_data" => 'error', "tanggal" => date('Y-m-d H:i:s'), "user" => $this->session->userdata('nama'), "function" => 'integrasi_pasien Pelayanan'];
                    $this->db->insert('sm_satu_sehat_log', $xDetailData);

                    $decode = ["metaData" => ["code" => 201, "message" => "Tidak ada data Satu Sehat untuk NIK Tersebut"]];
                }

            } else {

                $decode = ["metaData" => ["code" => 201, "message" => "Tidak ada data Satu Sehat untuk NIK Tersebut"]];

            }

        } else {

            date_default_timezone_set('Asia/Jakarta');
            $xDetailData = ["kategori" => "Patient", "param" => 'NIK Tidak ada, Harap masukkan data NIK terlebih dahulu', "message" => $output['result'], "jenis_data" => 'error', "tanggal" => date('Y-m-d H:i:s'), "user" => $this->session->userdata('nama'), "function" => 'integrasi_pasien Pelayanan'];
            $this->db->insert('sm_satu_sehat_log', $xDetailData);

            $decode = ["metaData" => ["code" => 201, "message" => "NIK Tidak ada, Harap masukkan data NIK terlebih dahulu"]];
        }

        return $decode;
    }

    private function integrasi_nakes($idLayanan)
    {
        $this->autentikasi_user_post();

        if ($idLayanan === null) {

            date_default_timezone_set('Asia/Jakarta');

            $xDetailDataRequest = ["kategori" => "integrasi_nakes", "message" => 'id Layanan Tidak Ada', "jenis_data" => 'error', "tanggal" => date('Y-m-d H:i:s'), "user" => $this->session->userdata('nama'), "function" => 'integrasi_nakes pelayanan'];

            $this->db->insert('sm_satu_sehat_log', $xDetailDataRequest);
            return;
        
        }

        $this->load->model('satu_sehat/Satu_sehat_model', 'sehat');

        $data = $this->sehat->cekidLayananPendaftaran($idLayanan);

        $identitas = $data->nik_dokter;

        $idMedis = $data->id_nakes;

        if ($identitas !== null) {

            $idUser = $this->session->userdata('id_translucent');

            $getID = $this->sehat->aksesSatuSehat($idUser);

            $tokenBearer = $getID->token;

            $xKonfigurasi = $this->sehat->getConfigSatuSehat();

            $url = $xKonfigurasi->apiurl . "Practitioner?identifier=https://fhir.kemkes.go.id/id/nik|" . $identitas;

            $header = $this->sehat->authBearer($tokenBearer);

            $output = $this->sehat->postBearer($url, $header);

            if($output['result'] !== false){

                $entryOutput = json_decode($output['result']);

                if (isset($entryOutput->entry)) {

                    if (!empty($entryOutput->entry)) {

                        $entryId = $entryOutput->entry;

                        $idNakes = $entryId[0]->resource->id;

                        $cekNama = $entryId[0]->resource->name;

                        $update = ["ihs_number" => $idNakes];

                        $data = $this->db->where('id', $idMedis)->update('sm_tenaga_medis', $update);

                    } else {

                        date_default_timezone_set('Asia/Jakarta');
                        $xDetailData = ["kategori" => "Practitioner", "param" => $identitas, "message" => $output['result'], "jenis_data" => 'error', "tanggal" => date('Y-m-d H:i:s'), "user" => $this->session->userdata('nama'), "function" => 'integrasi_nakes Pelayanan'];
                        $this->db->insert('sm_satu_sehat_log', $xDetailData);

                    }

                } else {

                    date_default_timezone_set('Asia/Jakarta');
                    $xDetailData = ["kategori" => "Practitioner", "param" => $identitas, "message" => $output['result'], "jenis_data" => 'error', "tanggal" => date('Y-m-d H:i:s'), "user" => $this->session->userdata('nama'), "function" => 'integrasi_nakes Pelayanan'];
                    $this->db->insert('sm_satu_sehat_log', $xDetailData);

                }

            }

        } else {

            date_default_timezone_set('Asia/Jakarta');
            $xDetailData = ["kategori" => "Practitioner", "param" => $identitas, "message" => 'NIK Tidak ada, Harap masukkan data NIK terlebih dahulu', "jenis_data" => 'error', "tanggal" => date('Y-m-d H:i:s'), "user" => $this->session->userdata('nama'), "function" => 'integrasi_nakes Pelayanan'];
            $this->db->insert('sm_satu_sehat_log', $xDetailData);

        }

    }

    private function integrasi_encounter_post($idLayanan)
    {

        $this->autentikasi_user_post();

        if ($idLayanan === null) {

            date_default_timezone_set('Asia/Jakarta');

            $xDetailDataRequest = ["kategori" => "integrasi_encounter_post", "message" => 'id Layanan Tidak Ada', "jenis_data" => 'error', "tanggal" => date('Y-m-d H:i:s'), "user" => $this->session->userdata('nama'), "function" => 'integrasi_encounter_post pelayanan'];

            $this->db->insert('sm_satu_sehat_log', $xDetailDataRequest);
            return;
        }

        $this->load->model('satu_sehat/Satu_sehat_model', 'sehat');

        $data = $this->sehat->cekidLayananPendaftaran($idLayanan);

        if ($data->id_poli !== null) {

            $idSpesial = (int)$data->id_poli;

            $nama = 1;

            $dataPoli = $this->sehat->cekDataPoli($nama, $idSpesial);

            if ($dataPoli !== null && $dataPoli !== '') {

                $lokasi = $dataPoli->integrasi_baru;
                $nama = $dataPoli->nama;

            } else {

                date_default_timezone_set('Asia/Jakarta');

                $xDetailDataRequest = ["kategori" => "Encounter", "no_rm" => $data->no_rm, "message" => 'Poli Belum di integrasi, Silakan integrasikan ke satu sehat terlebih dahulu', "jenis_data" => 'error', "tanggal" => date('Y-m-d H:i:s'), "user" => $this->session->userdata('nama'), "function" => 'integrasi_encounter_post pelayanan'];

                $this->db->insert('sm_satu_sehat_log', $xDetailDataRequest);
                return;
            
            }

        } else {

            date_default_timezone_set('Asia/Jakarta');

            $xDetailDataRequest = ["kategori" => "Encounter", "no_rm" => $data->no_rm, "message" => 'Id Poli Tidak Ada', "jenis_data" => 'error', "tanggal" => date('Y-m-d H:i:s'), "user" => $this->session->userdata('nama'), "function" => 'integrasi_encounter_post pelayanan'];

            $this->db->insert('sm_satu_sehat_log', $xDetailDataRequest);
            return;
            
        }

        if ($data->ihsn !== null) {

            $dataIhsn = $data->ihsn;
            $namaPasien = $data->nama_pasien;

        } else {


            $this->integrasi_pasien($idLayanan);

            $dataPasien = $this->sehat->cekidLayananPendaftaran($idLayanan);

            if (isset($dataPasien->ihsn)) {

                $dataIhsn = $dataPasien->ihsn;
                $namaPasien = $dataPasien->nama_pasien;

            } else {

                date_default_timezone_set('Asia/Jakarta');

                $xDetailDataRequest = ["kategori" => "Encounter", "no_rm" => $data->no_rm, "message" => 'Data Pasien tidak ada', "jenis_data" => 'error', "tanggal" => date('Y-m-d H:i:s'), "user" => $this->session->userdata('nama'), "function" => 'integrasi_encounter_post pelayanan'];

                $this->db->insert('sm_satu_sehat_log', $xDetailDataRequest);

                return;
                
            }
        }


        if ($data->ihs_number !== null) {

            $dataIhsDokter = $data->ihs_number;
            $namaDokter = $data->nama_dokter;

        } else {

            $this->integrasi_nakes($idLayanan);

            $dataNakes = $this->sehat->cekidLayananPendaftaran($idLayanan);

            if (isset($dataNakes->ihs_number)) {

                $dataIhsDokter = $dataNakes->ihs_number;
                $namaDokter = $dataNakes->nama_dokter;

            } else {

                date_default_timezone_set('Asia/Jakarta');

                $xDetailDataRequest = ["kategori" => "Encounter", "no_rm" => $data->no_rm, "message" => 'Data Nakes tidak ada', "jenis_data" => 'error', "tanggal" => date('Y-m-d H:i:s'), "user" => $this->session->userdata('nama'), "function" => 'integrasi_encounter_post pelayanan'];

                $this->db->insert('sm_satu_sehat_log', $xDetailDataRequest);

                return;
                
            }

        }

        $xKonfigurasi = $this->sehat->getConfigSatuSehat();

        $idOrganization = $xKonfigurasi->organization;

        $idUser = $this->session->userdata('id_translucent');

        $getID = $this->sehat->aksesSatuSehat($idUser);

        $tokenBearer = $getID->token;

        $url = $xKonfigurasi->apiurl . "Encounter";

        $header = $this->sehat->authBearer($tokenBearer);

        $waktuStart = $data->task_tiga;

        $waktuEnd = $data->task_empat;

        $konvTimeStart = $this->konverTimeStamp($waktuStart);

        $konvTimeEnd = $this->konverTimeStamp($waktuEnd);

        $timeStart = date('c', $konvTimeStart / 1000);

        $timeEnd = date('c', $konvTimeEnd / 1000);

        $params = array(
            "resourceType"  => "Encounter",
            "identifier"    => [array(

                "system"    => "http://sys-ids.kemkes.go.id/encounter/" . $idOrganization,
                "value"     => $data->kode_booking

            )],
            "status"        => "arrived",
            "class"         => array(

                "system"    => "http://terminology.hl7.org/CodeSystem/v3-ActCode",
                "code"      => "AMB",
                "display"   => "ambulatory"

            ),
            "subject"      => array(

                "reference" => "Patient/" . $dataIhsn,
                "display"   => $namaPasien

            ),
            "participant"   => [array(

                "type"      => [array(

                    "coding" => [array(

                        "system"    => "http://terminology.hl7.org/CodeSystem/v3-ParticipationType",
                        "code"      => "ATND",
                        "display"   => "attender"

                    )]

                )],

                "individual" => array(
                    "reference" => "Practitioner/" . $dataIhsDokter,
                    "display"   => $namaDokter
                )
            )],
            "period"    => array(

                "start" => $timeStart

            ),
            "location"  => [array(

                "location" => array(
                    "reference"  => "Location/" . $lokasi,
                    "display"    => $nama
                )

            )],
            "statusHistory" => [array(

                "status"    => "arrived",
                "period"    => array(

                    "start" => $timeStart,
                    "end" => $timeEnd
                )
            )],
            "serviceProvider" => array(
                "reference" => "Organization/" . $idOrganization
            )

        );

        $data_api = json_encode($params);

        $output = $this->sehat->postEncounter($url, $data_api, $header);

        if($output['result'] !== false){

            if ($output['respon'] === 201) {

                $result = json_decode($output['result']);

                date_default_timezone_set('Asia/Jakarta');

                $xDetailDataRequest = ["kategori" => "Encounter", "no_rm" => $data->no_rm, "message" => json_encode($params), "jenis_data" => 'ok', "tanggal" => date('Y-m-d H:i:s'), "user" => $this->session->userdata('nama'), "respon" => $output['respon'], "function" => 'integrasi_encounter_post pelayanan'];

                $this->db->insert('sm_satu_sehat_log', $xDetailDataRequest);

                $update = ["id_encounter" => $result->id];

                $this->db->where('id', $idLayanan)->update('sm_layanan_pendaftaran', $update);

            } else {

                date_default_timezone_set('Asia/Jakarta');

                $xDetailDataRequest = ["kategori" => "Encounter", "no_rm" => $data->no_rm, "message" => $output['result'], "jenis_data" => 'error', "tanggal" => date('Y-m-d H:i:s'), "user" => $this->session->userdata('nama'), "respon" => $output['respon'], "param" => json_encode($params), "function" => 'integrasi_encounter_post pelayanan'];

                $this->db->insert('sm_satu_sehat_log', $xDetailDataRequest);

            }

        }
    }

    function lakukan_task_empat($id, $idLayanan = null)
    {

        $id_pendaftaran = $id;

        $cekBooking = $this->m_pelayanan->cekBookingAntrean((int)$id_pendaftaran);

        if ($cekBooking === null) {

            $decode = ["metaData" => ["code" => 202, "message" => 'Pasien tidak ada di Dalam Antrian']];
            $update = ["keterangan_antrean" => 'Bukan Antrean'];
            $data = $this->db->where('id', (int)$id_pendaftaran)->update('sm_pendaftaran', $update);
            $this->response($decode, 202);
        } else {

            $taskEmpat = $cekBooking->task_empat;

            if ($taskEmpat === null) {

                $kode_booking_bpjs = $cekBooking->kode_booking;

                date_default_timezone_set('Asia/Jakarta');
                $tanggalTunggu = (round(microtime(true) * 1000));
                $new_estimasi = date('Y-m-d H:i:s', (int)$tanggalTunggu / 1000);

                $update = ["task_empat" => $new_estimasi, "id_pendaftaran" => (int)$id_pendaftaran];

                $get_id_antrian = $this->m_pelayanan->getIdAntrean($kode_booking_bpjs);
                $id_antrian = (int)$get_id_antrian->id;

                $this->db->where('id', (int)$id_antrian)->update('sm_antrian_bpjs', $update);

                $data_response = array(
                    "nomor_task"        => 4,
                    "waktu_task"        => $tanggalTunggu,
                    "kode_booking"      => $kode_booking_bpjs,
                    "id_antrian"        => (int)$id_antrian,
                    "konversi_waktu"    => $new_estimasi,
                    "id_users"          => $this->session->userdata('id_translucent'),
                );

                $cek_respon_bpjs = $this->m_pelayanan->getResponseBPJS($kode_booking_bpjs, 4);

                if (!isset($cek_respon_bpjs->id)) {

                    $this->db->insert('sm_update_task_bpjs', $data_response);
                }

                if (isset($idLayanan)) {

                    $this->integrasi_encounter_post($idLayanan);

                }

            } else {

                $this->load->model('satu_sehat/Satu_sehat_model', 'sehat');

                $data = $this->sehat->cekidLayananPendaftaran($idLayanan);

                if ($data->id_encounter === null) {

                    if (isset($idLayanan)) {

                        $this->integrasi_encounter_post($idLayanan);

                    }

                }

                $update = ["log_task" => $taskEmpat];

                $kode_booking_bpjs = $cekBooking->kode_booking;

                $get_id_antrian = $this->m_pelayanan->getIdAntrean($kode_booking_bpjs);
                $id_antrian = (int)$get_id_antrian->id;

                $this->db->where('id', (int)$id_antrian)->update('sm_antrian_bpjs', $update);

            }
        }
    }

    function lakukan_task_enam_post()
    {

        if (!$this->post('id')) :
            $this->response(NULL, REST_Controller::HTTP_BAD_REQUEST); // (400)
        endif;

        $id_pendaftaran = safe_post('id');

        $id_jual = safe_post('id_jual');

        $cekBooking = $this->m_pelayanan->cekBookingTaskEnam($id_pendaftaran);

        if ($cekBooking === null) {

            $decode = ["metaData" => ["code" => 202, "message" => 'Pasien tidak ada di Dalam Antrian']];
            $this->response($decode, 202);
        } else {

            $taskEnam = $cekBooking->task_enam;

            if ($taskEnam === null) {

                $kode_booking_bpjs = $cekBooking->kode_booking;


                date_default_timezone_set('Asia/Jakarta');
                $tanggalTunggu = (round(microtime(true) * 1000));
                $new_estimasi = date('Y-m-d H:i:s', $tanggalTunggu / 1000);



                $update = ["task_enam" => $new_estimasi];

                $get_id_antrian = $this->m_pelayanan->getIdAntrean($kode_booking_bpjs);
                $id_antrian = (int)$get_id_antrian->id;

                $data = $this->db->where('id', $id_antrian)->update('sm_antrian_bpjs', $update);

                $proses_resep = ["proses_resep" => 1];

                $data_resep = $this->db->where('id', $id_jual)->update('sm_penjualan', $proses_resep);

                $data_response = array(
                    "nomor_task"        => 6,
                    "waktu_task"        => $tanggalTunggu,
                    "kode_booking"      => $kode_booking_bpjs,
                    "id_antrian"        => $id_antrian,
                    "konversi_waktu"    => $new_estimasi,
                );

                $cek_respon_bpjs = $this->m_pelayanan->getResponseBPJS($kode_booking_bpjs, 6);

                if (!isset($cek_respon_bpjs->id)) {

                    $this->db->insert('sm_update_task_bpjs', $data_response);
                }

                $decode = ["metaData" => ["code" => 200, "message" => 'Task 6 Berhasil di update']];
                $this->response($decode, 200);
            } else {

                $decode = ["metaData" => ["code" => 200, "message" => 'Task 6 Sudah ada']];
                $this->response($decode, 200);
            }
        }
    }

    function simpan_pemeriksaan_post()
    {
        $this->db->trans_begin();

        
        // update alergi pasien
        $this->m_pelayanan->updateAlergiPasien(safe_post('id_pasien'), safe_post('alergi'));
        $lp_status = $this->db->select('status_terlayani, id_pendaftaran', false)->where('id', (int)safe_post('id_layanan'), true)->get('sm_layanan_pendaftaran')->row();

        if (safe_post('jenis_layanan') === 'Poliklinik') {

            $idPendaftaran = $lp_status->id_pendaftaran;

            $this->lakukan_task_empat((int)$idPendaftaran, (int)safe_post('id_layanan'));

        }

        $id_sub_spesialis = NULL;

        // check subspesialis post
        if (isset($_POST['subspesialis'])) :
            $id_sub_spesialis = safe_post('subspesialis') !== '' ? safe_post('subspesialis') : NULL;
        endif;

        $dokter = safe_post('dokter') !== '' ? safe_post('dokter') : NULL;
        $layanan = array('id' => safe_post('id_layanan'), 'id_dokter' => $dokter, 'status_terlayani' => 'Sudah', 'id_sub_spesialis' => $id_sub_spesialis);

        // check dokter pengganti post
        if (isset($_POST['dokter_pengganti'])) :
            $layanan['id_dokter_pengganti'] = !empty($_POST['dokter_pengganti']) ? $_POST['dokter_pengganti'] : NULL;
        endif;

        // update layanan pendaftaran
        $this->m_pelayanan->updateLayananPendaftaran($layanan);

        // data anamnesa
        if (safe_post('jenis_layanan') !== 'Rawat Inap') {
            $anamnesa = array(
                'id_layanan_pendaftaran'    => $layanan['id'],
                'waktu'                     => $this->datetime,
                'keluhan_utama'             => safe_post('keluhan_utama') !== '' ? safe_post('keluhan_utama') : NULL,
                'riwayat_penyakit_keluarga' => safe_post('riwayat_penyakit_keluarga') !== '' ? safe_post('riwayat_penyakit_keluarga') : NULL,
                'riwayat_penyakit_sekarang' => safe_post('riwayat_penyakit_sekarang') !== '' ? safe_post('riwayat_penyakit_sekarang') : NULL,
                'anamnesa_sosial'           => safe_post('anamnesa_sosial') !== '' ? safe_post('anamnesa_sosial') : NULL,
                'riwayat_penyakit_dahulu'   => safe_post('riwayat_penyakit_dahulu') !== '' ? safe_post('riwayat_penyakit_dahulu') : NULL,
                'keadaan_umum'              => safe_post('keadaan_umum') !== '' ? safe_post('keadaan_umum') : NULL,
                'kesadaran'                 => safe_post('kesadaran') !== '' ? safe_post('kesadaran') : NULL,
                'gcs'                       => safe_post('gcs') !== '' ? safe_post('gcs') : NULL,
                'tensi_sistolik'            => safe_post('tensi_sistolik') !== '' ? safe_post('tensi_sistolik') : NULL,
                'tensi_diastolik'           => safe_post('tensi_diastolik') !== '' ? safe_post('tensi_diastolik') : NULL,
                'suhu'                      => safe_post('suhu') !== '' ? safe_post('suhu') : NULL,
                'nadi'                      => safe_post('nadi') !== '' ? safe_post('nadi') : NULL,
                'tinggi_badan'              => safe_post('tinggi_badan') !== '' ? safe_post('tinggi_badan') : NULL,
                'berat_badan'               => safe_post('berat_badan') !== '' ? safe_post('berat_badan') : NULL,
                'rr'                        => safe_post('rr') !== '' ? safe_post('rr') : NULL,
                'nps'                       => safe_post('nps') !== '' ? safe_post('nps') : NULL,
                'kepala'                    => safe_post('kepala') !== '' ? safe_post('kepala') : NULL,
                'thorax'                    => safe_post('thorax') !== '' ? safe_post('thorax') : NULL,
                'cor'                       => safe_post('cor') !== '' ? safe_post('cor') : NULL,
                'genitalia'                 => safe_post('genitalia') !== '' ? safe_post('genitalia') : NULL,
                'pemeriksaan_penunjang'     => safe_post('pemeriksaan_penunjang') !== '' ? safe_post('pemeriksaan_penunjang') : NULL,
                'status_mentalis'           => safe_post('status_mentalis') !== '' ? safe_post('status_mentalis') : NULL,
                'status_gizi'               => safe_post('status_gizi') !== '' ? safe_post('status_gizi') : NULL,
                'hidung'                    => safe_post('hidung') !== '' ? safe_post('hidung') : NULL,
                'mata'                      => safe_post('mata') !== '' ? safe_post('mata') : NULL,
                'usul_tindak_lanjut'        => safe_post('usul_tindak_lanjut') !== '' ? safe_post('usul_tindak_lanjut') : NULL,
                'leher'                     => safe_post('leher') !== '' ? safe_post('leher') : NULL,
                'pulmo'                     => safe_post('pulmo') !== '' ? safe_post('pulmo') : NULL,
                'abdomen'                   => safe_post('abdomen') !== '' ? safe_post('abdomen') : NULL,
                'ekstrimitas'               => safe_post('ekstrimitas') !== '' ? safe_post('ekstrimitas') : NULL,
                'prognosis'                 => safe_post('prognosis') !== '' ? safe_post('prognosis') : NULL,
                'lingkar_kepala'            => safe_post('lingkar_kepala') !== '' ? safe_post('lingkar_kepala') : NULL,
                'telinga'                   => safe_post('telinga') !== '' ? safe_post('telinga') : NULL,
                'tenggorok'                 => safe_post('tenggorok') !== '' ? safe_post('tenggorok') : NULL,
                'kulit_kelamin'             => safe_post('kulit_kelamin') !== '' ? safe_post('kulit_kelamin') : NULL,
                'pupil_dbn'                 => safe_post('pupil_dbn') !== '' ? safe_post('pupil_dbn') : NULL,
                'pupil_bentuk'              => safe_post('pupil_bentuk') !== '' ? safe_post('pupil_bentuk') : NULL,
                'pupil_ukuran'              => safe_post('pupil_ukuran') !== '' ? safe_post('pupil_ukuran') : NULL,
                'pupil_reflek_cahaya'       => safe_post('pupil_reflek_cahaya') !== '' ? safe_post('pupil_reflek_cahaya') : NULL,
                'nervi_cranialis_dbn'       => safe_post('nervi_cranialis_dbn') !== '' ? safe_post('nervi_cranialis_dbn') : NULL,
                'nervi_cranialis_paresis'   => safe_post('nervi_cranialis_paresis') !== '' ? safe_post('nervi_cranialis_paresis') : NULL,
                'rf_kiri_atas'              => safe_post('rf_kiri_atas') !== '' ? safe_post('rf_kiri_atas') : NULL,
                'rf_kiri_bawah'             => safe_post('rf_kiri_bawah') !== '' ? safe_post('rf_kiri_bawah') : NULL,
                'rf_kanan_atas'             => safe_post('rf_kanan_atas') !== '' ? safe_post('rf_kanan_atas') : NULL,
                'rf_kanan_bawah'            => safe_post('rf_kanan_bawah') !== '' ? safe_post('rf_kanan_bawah') : NULL,
                'sensorik_dbn'              => safe_post('sensorik_dbn') !== '' ? safe_post('sensorik_dbn') : NULL,
                'sensorik_lain'             => safe_post('sensorik_lain') !== '' ? safe_post('sensorik_lain') : NULL,
                'pemeriksaan_khusus'        => safe_post('pemeriksaan_khusus') !== '' ? safe_post('pemeriksaan_khusus') : NULL,
                'trm_dbn'                   => safe_post('trm_dbn') !== '' ? safe_post('trm_dbn') : NULL,
                'trm_kaku_kuduk'            => safe_post('trm_kaku_kuduk') !== '' ? safe_post('trm_kaku_kuduk') : NULL,
                'trm_laseque'               => safe_post('trm_laseque') !== '' ? safe_post('trm_laseque') : NULL,
                'trm_kerning'               => safe_post('trm_kerning') !== '' ? safe_post('trm_kerning') : NULL,
                'motorik_kiri_atas'         => safe_post('motorik_kiri_atas') !== '' ? safe_post('motorik_kiri_atas') : NULL,
                'motorik_kiri_bawah'        => safe_post('motorik_kiri_bawah') !== '' ? safe_post('motorik_kiri_bawah') : NULL,
                'motorik_kanan_atas'        => safe_post('motorik_kanan_atas') !== '' ? safe_post('motorik_kanan_atas') : NULL,
                'motorik_kanan_bawah'       => safe_post('motorik_kanan_bawah') !== '' ? safe_post('motorik_kanan_bawah') : NULL,
                'reflek_patologis'          => safe_post('reflek_patologis') !== '' ? safe_post('reflek_patologis') : NULL,
                'otonom'                    => safe_post('otonom') !== '' ? safe_post('otonom') : NULL,
                'riwayat_kelahiran'         => safe_post('riwayat_kelahiran') !== '' ? safe_post('riwayat_kelahiran') : NULL,
                'riwayat_nutrisi'           => safe_post('riwayat_nutrisi') !== '' ? safe_post('riwayat_nutrisi') : NULL,
                'riwayat_imunisasi'         => safe_post('riwayat_imunisasi') !== '' ? safe_post('riwayat_imunisasi') : NULL,
                'riwayat_tumbuh_kembang'    => safe_post('riwayat_tumbuh_kembang') !== '' ? safe_post('riwayat_tumbuh_kembang') : NULL,
                's_soap'                    => safe_post('s_soap') !== '' ? safe_post('s_soap') : NULL,
                'o_soap'                    => safe_post('o_soap') !== '' ? safe_post('o_soap') : NULL,
                'a_soap'                    => safe_post('a_soap') !== '' ? safe_post('a_soap') : NULL,
                'p_soap'                    => safe_post('p_soap') !== '' ? safe_post('p_soap') : NULL,
                's_sbar'                    => safe_post('s_sbar') !== '' ? safe_post('s_sbar') : NULL,
                'b_sbar'                    => safe_post('b_sbar') !== '' ? safe_post('b_sbar') : NULL,
                'a_sbar'                    => safe_post('a_sbar') !== '' ? safe_post('a_sbar') : NULL,
                'r_sbar'                    => safe_post('r_sbar') !== '' ? safe_post('r_sbar') : NULL,
                'usul_tindak_lanjut'        => safe_post('usul_tindak_lanjut') !== '' ? safe_post('usul_tindak_lanjut') : NULL,
                'alergi'                    => safe_post('alergi') !== '' ? safe_post('alergi') : NULL,
            );
        } else {
            $visitasi = array(
                'id_layanan_pendaftaran'    => $layanan['id'],
                'waktu'                     => $this->datetime,
                'keluhan_utama'             => safe_post('keluhan_utama_ri') !== '' ? safe_post('keluhan_utama_ri') : NULL,
                'tensi_sistolik'            => safe_post('tensi_s') !== '' ? safe_post('tensi_s') : NULL,
                'tensi_diastolik'           => safe_post('tensi_d') !== '' ? safe_post('tensi_d') : NULL,
                'suhu'                      => safe_post('suhu_ri') !== '' ? safe_post('suhu_ri') : NULL,
                'nadi'                      => safe_post('nadi_ri') !== '' ? safe_post('nadi_ri') : NULL,
                'nps'                       => safe_post('nafas_ri') !== '' ? safe_post('nafas_ri') : NULL,
                'rr'                        => safe_post('respirasi_ri') !== '' ? safe_post('respirasi_ri') : NULL,
                'alergi'                    => safe_post('alergi_ri') !== '' ? safe_post('alergi_ri') : NULL,
                'urine'                     => safe_post('urine_ri') !== '' ? safe_post('urine_ri') : NULL,
            );

            $soap = array(
                'id_layanan_pendaftaran'    => $layanan['id'],
                'waktu'                     => $this->datetime,
                'id_dokter'                 => safe_post('dokter') !== '' ? safe_post('dokter') : NULL,
                'jenis'                     => safe_post('jenis_layanan'),
                's_soap'                    => safe_post('s_soap') !== '' ? safe_post('s_soap') : NULL,
                'o_soap'                    => safe_post('o_soap') !== '' ? safe_post('o_soap') : NULL,
                'a_soap'                    => safe_post('a_soap') !== '' ? safe_post('a_soap') : NULL,
                'p_soap'                    => safe_post('p_soap') !== '' ? safe_post('p_soap') : NULL,
                's_sbar'                    => safe_post('s_sbar') !== '' ? safe_post('s_sbar') : NULL,
                'b_sbar'                    => safe_post('b_sbar') !== '' ? safe_post('b_sbar') : NULL,
                'a_sbar'                    => safe_post('a_sbar') !== '' ? safe_post('a_sbar') : NULL,
                'r_sbar'                    => safe_post('r_sbar') !== '' ? safe_post('r_sbar') : NULL,
                'keterangan'                => safe_post('keterangan') !== '' ? safe_post('keterangan') : NULL,
            );
        }

        // insert data anamnesa
        if (safe_post('jenis_layanan') === 'Rawat Inap') :
            $this->m_pelayanan->insertAnamnesa($visitasi);
            $this->m_pelayanan->insertSOAP($soap);
            $jenis = 'Rawat Inap';
        else :
            if (safe_post('jenis_layanan') === 'IGD') :
                $this->m_pelayanan->updateAnamnesa($anamnesa);
                $jenis = 'IGD';
            else :
                if (safe_post('jenis_layanan') === 'Pemulasaran Jenazah') :
                    $jenis = 'Pemulasaran Jenazah';
                else :
                    if (safe_post('jenis_layanan') === 'Hemodialisa') :
                        $this->m_pelayanan->updateAnamnesa($anamnesa);
                        $jenis = 'Hemodialisa';
                    else :
                        $this->m_pelayanan->updateAnamnesa($anamnesa);
                        $jenis = 'Rawat Jalan';
                    endif;
                endif;
            endif;
        endif;


        // cek profil pasien
        $checkProfilPasien = $this->db->query("select * from sm_profil_pasien where id_pasien = '" . safe_post('id_pasien') . "'")->row();
        $dataProfilPasien = array(
            'id_pasien' => safe_post('id_pasien'),
            'tinggi_badan' => safe_post('tinggi_badan') !== '' ? safe_post('tinggi_badan') : NULL,
            'berat_badan'  => safe_post('berat_badan') !== '' ? safe_post('berat_badan') : NULL,
            'id_master_alergi'  => safe_post('opsi_alergi') !== '' ? safe_post('opsi_alergi') : NULL,
            'keterangan_alergi'  => safe_post('alergi') !== '' ? safe_post('alergi') : NULL,
        );
        if ($checkProfilPasien) :
            $this->db->where('id_pasien', safe_post('id_pasien'), true)->update('sm_profil_pasien', $dataProfilPasien);
        else :
            $this->db->insert('sm_profil_pasien', $dataProfilPasien);
        endif;

        // data diagnosa
        $diagnosa = array(
            'id_diag'                   => $this->post('id_diag'),
            'id_dokter'                 => $this->post('dokter_diag'),
            'id_golongan_sebab_sakit'   => $this->post('id_golongan_sebab_sakit') !== '' ? $this->post('id_golongan_sebab_sakit') : NULL,
            'kode_diagnosa'             => $this->post('kode_diag') !== '' ? $this->post('kode_diag') : NULL,
            'diagnosa_manual'           => $this->post('diag_manual') === "on" ? NULL : $this->post('diag_manual'),
            'golongan_sebab_sakit_lain' => $this->post('gol_sebab_sakit_lain') !== '' ? $this->post('gol_sebab_sakit_lain') : NULL,
            'diagnosa_klinis'           => $this->post('diag_klinis') === "on" ? NULL : $this->post('diag_klinis'),
            'prioritas'                 => $this->post('prioritas') !== '' ? $this->post('prioritas') : NULL,
            'diagnosa_banding'          => $this->post('diag_banding') !== '' ? $this->post('diag_banding') : NULL,
            'diagnosa_akhir'            => $this->post('diag_akhir') === "on" ? 0 : $this->post('diag_akhir'),
            'penyebab_kematian'         => $this->post('sebab_kematian') === "on" ? 0 : $this->post('sebab_kematian'),
            'jenis_kasus'               => $this->post('jenis_kasus') !== '' ? $this->post('jenis_kasus') : NULL,
            'is_resume'                 => $this->post('is_resume') ?? 1,
        );

        if ($jenis !== "Rawat Inap") :
            $diagnosa['post'] = array(1);
        endif;
        // echo json_encode($diagnosa); die;
        // insert data diagnosa
        $this->m_pelayanan->simpanDiagnosaPemeriksaan($layanan['id'], $diagnosa, safe_post('id_pasien'));

        // data tindakan
        $tindakan = array(
            'operator' => $this->post('id_operator'),
            'tindakan' => $this->post('id_tindakan'),
            'tindakan_icd9' => $this->post('id_tindakan_icd9'),
            'qty'      => $this->post('qty'),
        );

        //  insert data tindakan
        $this->m_pelayanan->simpanTindakanPemeriksaan($layanan['id'], $tindakan, $jenis);

        if (safe_post('jenis_layanan') === 'Poliklinik') :
            $this->m_pelayanan->updateDokterTindakanKonsultasi($layanan['id'], $dokter, $lp_status->status_terlayani);
        else :
            $posted = true;
            if (safe_post('jenis_layanan') === 'IGD') :
                $posted = false;
            endif;

            if (safe_post('jenis_layanan') === 'Rawat Inap') :
                $posted = false;
            endif;

            if ($posted) :
                $data_logs = array(
                    'waktu'       => $this->datetime,
                    'status'      => safe_post('jenis_layanan'),
                    'id_dokter'   => $dokter,
                    'query'       => "select pd.* from sm_layanan_pendaftaran as lp 
                                      join sm_pendaftaran as pd on (pd.id = lp.id_pendaftaran) 
                                      where lp.id = '" . $layanan['id'] . "' ",
                    'no_register' => $layanan['id'],
                    'klinik'      => ''
                );

                $this->db->insert('sm_logs_error', $data_logs);
            endif;
        endif;

        // insert data BHP
        $kemasan = safe_post('id_kemasan');
        if (is_array($kemasan)) :
            $this->m_pelayanan->simpanBHP();
        endif;
        
        // insert data PKRT
        $id_tarif_pkrt = safe_post('id_tarif_pkrt');
        if (is_array($id_tarif_pkrt)) :
            $this->m_pelayanan->simpanPKRT();
        endif;

        // insert data Order Operasi
        $id_tarif_operasi = safe_post('id_tarif_operasi');
        $timing  = safe_post('timing');
        $bobot 	 = safe_post('bobot');
        $icd9_ok = safe_post('icd9-ok');
        if (is_array($id_tarif_operasi)) :
            foreach ($id_tarif_operasi as $i => $val) :
                $data_operasi = array(
                    'id_tarif' => $val,
                    'icd9_ok' => $icd9_ok[$i],
                    'bobot' => $bobot[$i],
                    'timing' => $timing[$i],
                    'id_layanan_pendaftaran' => $layanan['id'],
                    'id_pasien' => safe_post('id_pasien')
                );
                $this->m_pelayanan->simpanJadwalOperasi($data_operasi);
            endforeach;
        endif;

        // insert data Order VK
        $order_vk = safe_post('jml_order_vk');
        if (is_array($order_vk)) :
            foreach ($order_vk as $i => $val) :
                $data_vk = array(
                    'id_layanan_pendaftaran' => $layanan['id'],
                    'id_pasien' => safe_post('id_pasien'),
                    'layanan' => 'VK',
                );
                $this->m_pelayanan->simpanOrderVK($data_vk);
            endforeach;
        endif;

        // Order Hemodialisis
        $hemo_order = safe_post('hemo_order');
        $get_no_sep = safe_post('no_sep_hemodialisis');
        $id_dftr_hemodialisis = safe_post('id_dftr_hemodialisis');
        $dokter_hemodialisis = safe_post('dokter_hemodialisis');
        $cara_bayar_hemodialisis = safe_post('cara_bayar_hemodialisis');
        $id_penjamin_hemodialisis = safe_post('id_penjamin_hemodialisis');
        $no_polish_hemodialisis = safe_post('no_polish_hemodialisis');

        if (is_array($hemo_order)) {
            $hemo_status = $this->db->select('tindak_lanjut')->where('id', $layanan['id'])->get('sm_layanan_pendaftaran')->row();
            $hemo_lanjut = $hemo_status->tindak_lanjut;
            if ($hemo_lanjut === NULL) {
                foreach ($hemo_order as $i => $val) {
                    $data_hemo = array(
                        'id_pendaftaran'    => $id_dftr_hemodialisis[$i],
                        'tanggal_layanan'   => $this->datetime,
                        'id_dokter'         => $dokter_hemodialisis[$i] !== '' ? $dokter_hemodialisis[$i] : NULL,
                        'jenis_layanan'     => 'Hemodialisa',
                        'kondisi'           => 'Hidup',
                        'resusitasi'        => 0,
                        'cara_bayar'        => $cara_bayar_hemodialisis[$i] !== '' ? $cara_bayar_hemodialisis[$i] : NULL,
                        'id_penjamin'       => $id_penjamin_hemodialisis[$i] !== '' ? $id_penjamin_hemodialisis[$i] : NULL,
                        'no_polish'         => $no_polish_hemodialisis[$i] !== '' ? $no_polish_hemodialisis[$i] : NULL,
                        'no_sep'            => ($get_no_sep[$i] !== '') ? strtoupper($get_no_sep[$i]) : NULL,
                        'terklaim'          => ($cara_bayar_hemodialisis[$i] === 'Tunai') ? 1 : 0,
                        'status_terlayani'  => 'Belum',
                        'id_users'          => $this->session->userdata('id_translucent'),
                    );

                    $this->m_pelayanan->simpanDataDFTRHemodialisis($data_hemo);
                }
            }
        }

        // Order DPMP
        $dpmp_order = safe_post('dpmp_order');
        $id_dftr_dpmp = safe_post('id_dftr_dpmp');

        if (is_array($dpmp_order)) {
            $dpmp_status = $this->db->select('tindak_lanjut')->where('id', $layanan['id'])->get('sm_layanan_pendaftaran')->row();
            $dpmp_lanjut = $dpmp_status->tindak_lanjut;
            if ($dpmp_lanjut === NULL) {
                foreach ($dpmp_order as $i => $val) {
                    $data_dpmp = array(
                        'id_layanan_pendaftaran'    => $layanan['id'],
                        'id_pendaftaran'            => $id_dftr_dpmp,
                        'waktu_order'               => $this->datetime,
                        'status'                    => 'Belum',
                        'id_users'                  => $this->session->userdata('id_translucent'),
                    );

                    $this->m_pelayanan->simpanDataOrderDPMP($data_dpmp);
                }
            }
        }

        //Order Bimroh
        $order_bimroh = safe_post('jenis_order');
        if (is_array($order_bimroh)) :
            foreach ($order_bimroh as $i => $val) :
                $simpan_order_bimroh = array(
                    'id_layanan_pendaftaran' => $layanan['id'],
                    'id_pasien' => safe_post('id_pasien'),
                    'id_perawat' => safe_post('perawat_order_bimroh')[$i] !== '' ? safe_post('perawat_order_bimroh')[$i] : NULL,
                    'waktu_order' => $this->datetime,
                    'jenis_order' => $val,
                    'kondisi_pasien' => safe_post('kondisi_pasien')[$i] !== '' ? safe_post('kondisi_pasien')[$i] : NULL,
                    'diagnosa_spiritual' => safe_post('diagnosa_spiritual')[$i] !== '' ? safe_post('diagnosa_spiritual')[$i] : NULL,
                    'terapi_tindak_lanjut' => safe_post('terapi_tindak_lanjut')[$i] !== '' ? safe_post('terapi_tindak_lanjut')[$i] : NULL,
                );

                $this->m_pelayanan->simpanOrderBimroh($simpan_order_bimroh);
            endforeach;
        endif;

        //order Talqin        
        $order_talqin = safe_post('kondisi_pasien_talqin');
        if (is_array($order_talqin)) :
            foreach ($order_talqin as $i => $val) :
                $simpan_order_talqin = array(
                    'id_layanan_pendaftaran' => $layanan['id'],
                    'id_pasien' => safe_post('id_pasien'),
                    'id_perawat_talqin' => safe_post('perawat_order_talqin')[$i] !== '' ? safe_post('perawat_order_talqin')[$i] : NULL,
                    'waktu_order_talqin' => $this->datetime,
                    'kondisi_pasien_talqin' => $val,
                    'terapi_advice_talqin' => safe_post('terapi_advice_talqin')[$i] !== '' ? safe_post('terapi_advice_talqin')[$i] : NULL,
                );

                $this->m_pelayanan->simpanOrderTalqin($simpan_order_talqin);
            endforeach;
        endif;

        // insert data Order Darah
        $kemasan = safe_post('id_kemasan_darah');
        if (is_array($kemasan)) :
            $this->m_pelayanan->simpanOrderDarah();
        endif;

        // update tanggal periksa
        $waktu_periksa = array('id_layanan_pendaftaran' => $layanan['id'], 'waktu' => $this->datetime);
        $this->m_pelayanan->updateWaktuPeriksa($waktu_periksa);

        if (safe_post('jenis_layanan') === 'Poliklinik') {

            $this->load->model('satu_sehat/Satu_sehat_model', 'sehat');

            $cekOnOff = $this->sehat->cekSatuSehatOnOff();

            if($cekOnOff->onoff === '1'){

                if(safe_post('alergi') !== null && safe_post('alergi') !== ''){
                
                    $this->sehat->integrasiAllergyIntoleran(safe_post('alergi'), safe_post('opsi_alergi'), safe_post('id_layanan'), safe_post('pilihan_alergi'));

                }

                $fields = ['riwayat_penyakit_sekarang', 'riwayat_penyakit_dahulu', 'riwayat_penyakit_keluarga'];

                foreach ($fields as $field) {
                    $value = safe_post($field);
                    $value = $this->cleanText($value);

                    if (!empty($value)) {
                        $this->sehat->integrasiClinicalImpression($value, safe_post('id_layanan'));
                        break;
                    }
                }

            }

        }

        // update tracer
        $this->load->model('Tracer_model', 'tracer');
        $this->tracer->updateStatusBerkas($layanan['id']);

        if ($this->db->trans_status() === false) :
            $this->db->trans_rollback();
            $status = false;
        else :
            $this->db->trans_commit();
            $status = true;
        endif;

        $message = array(
            'status' => $status,
            'token'  => $this->security->get_csrf_hash(),
            'id'     => $layanan['id'],
        );

        $this->response($message, REST_Controller::HTTP_OK);
    }

    private function cleanText($text) {
        
        $text = mb_convert_encoding($text, 'UTF-8', 'UTF-8');

        $text = preg_replace('/[^\p{L}\p{N}\p{P}\p{Z}]/u', '', $text);

        $text = trim($text);

        return $text;
    }

    // hemodialisis
    function get_data_hemodialisis_get()
    {
        $jenis = $this->get('jenis', true);
        $id_daftar = $this->get('id_daftar', true);
        $data = $this->m_pelayanan->ambilDataHemodialisis($id_daftar, $jenis);

        $response = array('status' => true, 'data' => $data);
        $this->response($response, REST_Controller::HTTP_OK);
    }

    // dpmp
    function get_data_dpmp_get()
    {
        $id_daftar = $this->get('id_daftar', true);
        $data = $this->m_pelayanan->ambilDataDPMP($id_daftar);

        $response = array('status' => true, 'data' => $data);
        $this->response($response, REST_Controller::HTTP_OK);
    }

    function hapus_order_hemodialisa_delete($id_layanan)
    {

        $this->db->select('count(ttp.id) as jumlah', false)->from('sm_tarif_tindakan_pasien as ttp')
            ->join('sm_layanan_pendaftaran as lp', 'lp.id = ttp.id_layanan_pendaftaran')
            ->where('lp.id', $id_layanan)
            ->where("(ttp.jenis_transaksi = 'Tindakan' or ttp.jenis_transaksi = 'Pendaftaran' or ttp.jenis_transaksi = 'IGD' or ttp.jenis_transaksi = 'Rawat Inap' or ttp.jenis_transaksi = 'Intensive Care' )");
        $query = $this->db->get()->row();
        $check = 0;

        if (count((array) $query) > 0) :
            $check = $query->jumlah;
        endif;

        $status = false;
        $message = '';

        if ($check > 0) :
            // Sudah ada tindakan
            $status = false;
            $message = 'Tidak dapat membatalkan permintaan, pasien sudah mendapatkan tindakan';
        else :

            $this->db->trans_begin();

            $data = array(
                'status_terlayani' => 'Batal',
                'tindak_lanjut' => 'Batal'
            );
            $this->db->where('id', $id_layanan)->update('sm_layanan_pendaftaran', $data);
            $this->db->where('id_layanan_pendaftaran', $id_layanan)->delete('sm_resume_kunjungan');
            $this->db->where('id_layanan_pendaftaran', $id_layanan)->delete('sm_hemodialisa');
            $billing = [
                'total' => 0,
                'status' => 'Batal'
            ];

            $this->db->where('id_layanan_pendaftaran', $id_layanan)->update('sm_pembayaran', $billing);

        endif;

        if ($this->db->trans_status() === false) :
            $this->db->trans_rollback();
            $status = false;
            $message = 'Gagal melakukan pembatalan order hemodialisis';
        else :
            $this->db->trans_commit();
            $this->load->model('logs/Logs_model', 'm_logs');
            $this->m_logs->recordAdminLogs($id_layanan, 'Batal Order Hemodialisis');
            $status = true;
            $message = 'Berhasil melakukan pembatalan order hemodialisis';
        endif;

        $response = array('status' => $status, 'message' => $message);
        $this->response($response, REST_Controller::HTTP_OK);
    }

    function simpan_pemeriksaan_icare_post()
    {
        $this->db->trans_begin();

        // update alergi pasien
        $this->m_pelayanan->updateAlergiPasien(safe_post('id_pasien'), safe_post('alergi'));
        $lp_status = $this->db->select('status_terlayani, id_pendaftaran')->where('id', safe_post('id_layanan'))->get('sm_layanan_pendaftaran')->row();
        $id_sub_spesialis = NULL;

        // check subspesialis post
        if (isset($_POST['subspesialis'])) :
            $id_sub_spesialis = safe_post('subspesialis') !== '' ? safe_post('subspesialis') : NULL;
        endif;

        $dokter = safe_post('dokter') !== '' ? safe_post('dokter') : NULL;
        $layanan = array('id' => safe_post('id_layanan'), 'id_dokter' => $dokter, 'status_terlayani' => 'Sudah', 'id_sub_spesialis' => $id_sub_spesialis);

        // check dokter pengganti post
        if (isset($_POST['dokter_pengganti'])) :
            $layanan['id_dokter_pengganti'] = !empty($_POST['dokter_pengganti']) ? $_POST['dokter_pengganti'] : NULL;
        endif;

        // update layanan pendaftaran
        $this->m_pelayanan->updateLayananPendaftaran($layanan);

        // data anamnesa
        if (safe_post('jenis_layanan') !== 'Intensive Care') {
            $anamnesa = array(
                'id_layanan_pendaftaran'    => $layanan['id'],
                'waktu'                     => $this->datetime,
                'keluhan_utama'             => safe_post('keluhan_utama') !== '' ? safe_post('keluhan_utama') : NULL,
                'riwayat_penyakit_keluarga' => safe_post('riwayat_penyakit_keluarga') !== '' ? safe_post('riwayat_penyakit_keluarga') : NULL,
                'riwayat_penyakit_sekarang' => safe_post('riwayat_penyakit_sekarang') !== '' ? safe_post('riwayat_penyakit_sekarang') : NULL,
                'anamnesa_sosial'           => safe_post('anamnesa_sosial') !== '' ? safe_post('anamnesa_sosial') : NULL,
                'riwayat_penyakit_dahulu'   => safe_post('riwayat_penyakit_dahulu') !== '' ? safe_post('riwayat_penyakit_dahulu') : NULL,
                'keadaan_umum'              => safe_post('keadaan_umum') !== '' ? safe_post('keadaan_umum') : NULL,
                'kesadaran'                 => safe_post('kesadaran') !== '' ? safe_post('kesadaran') : NULL,
                'gcs'                       => safe_post('gcs') !== '' ? safe_post('gcs') : NULL,
                'tensi_sistolik'            => safe_post('tensi_sistolik') !== '' ? safe_post('tensi_sistolik') : NULL,
                'tensi_diastolik'           => safe_post('tensi_diastolik') !== '' ? safe_post('tensi_diastolik') : NULL,
                'suhu'                      => safe_post('suhu') !== '' ? safe_post('suhu') : NULL,
                'nadi'                      => safe_post('nadi') !== '' ? safe_post('nadi') : NULL,
                'tinggi_badan'              => safe_post('tinggi_badan') !== '' ? safe_post('tinggi_badan') : NULL,
                'berat_badan'               => safe_post('berat_badan') !== '' ? safe_post('berat_badan') : NULL,
                'rr'                        => safe_post('rr') !== '' ? safe_post('rr') : NULL,
                'nps'                       => safe_post('nps') !== '' ? safe_post('nps') : NULL,
                'kepala'                    => safe_post('kepala') !== '' ? safe_post('kepala') : NULL,
                'thorax'                    => safe_post('thorax') !== '' ? safe_post('thorax') : NULL,
                'cor'                       => safe_post('cor') !== '' ? safe_post('cor') : NULL,
                'genitalia'                 => safe_post('genitalia') !== '' ? safe_post('genitalia') : NULL,
                'pemeriksaan_penunjang'     => safe_post('pemeriksaan_penunjang') !== '' ? safe_post('pemeriksaan_penunjang') : NULL,
                'status_mentalis'           => safe_post('status_mentalis') !== '' ? safe_post('status_mentalis') : NULL,
                'status_gizi'               => safe_post('status_gizi') !== '' ? safe_post('status_gizi') : NULL,
                'hidung'                    => safe_post('hidung') !== '' ? safe_post('hidung') : NULL,
                'mata'                      => safe_post('mata') !== '' ? safe_post('mata') : NULL,
                'usul_tindak_lanjut'        => safe_post('usul_tindak_lanjut') !== '' ? safe_post('usul_tindak_lanjut') : NULL,
                'leher'                     => safe_post('leher') !== '' ? safe_post('leher') : NULL,
                'pulmo'                     => safe_post('pulmo') !== '' ? safe_post('pulmo') : NULL,
                'abdomen'                   => safe_post('abdomen') !== '' ? safe_post('abdomen') : NULL,
                'ekstrimitas'               => safe_post('ekstrimitas') !== '' ? safe_post('ekstrimitas') : NULL,
                'prognosis'                 => safe_post('prognosis') !== '' ? safe_post('prognosis') : NULL,
                'lingkar_kepala'            => safe_post('lingkar_kepala') !== '' ? safe_post('lingkar_kepala') : NULL,
                'telinga'                   => safe_post('telinga') !== '' ? safe_post('telinga') : NULL,
                'tenggorok'                 => safe_post('tenggorok') !== '' ? safe_post('tenggorok') : NULL,
                'kulit_kelamin'             => safe_post('kulit_kelamin') !== '' ? safe_post('kulit_kelamin') : NULL,
                'pupil_dbn'                 => safe_post('pupil_dbn') !== '' ? safe_post('pupil_dbn') : NULL,
                'pupil_bentuk'              => safe_post('pupil_bentuk') !== '' ? safe_post('pupil_bentuk') : NULL,
                'pupil_ukuran'              => safe_post('pupil_ukuran') !== '' ? safe_post('pupil_ukuran') : NULL,
                'pupil_reflek_cahaya'       => safe_post('pupil_reflek_cahaya') !== '' ? safe_post('pupil_reflek_cahaya') : NULL,
                'nervi_cranialis_dbn'       => safe_post('nervi_cranialis_dbn') !== '' ? safe_post('nervi_cranialis_dbn') : NULL,
                'nervi_cranialis_paresis'   => safe_post('nervi_cranialis_paresis') !== '' ? safe_post('nervi_cranialis_paresis') : NULL,
                'rf_kiri_atas'              => safe_post('rf_kiri_atas') !== '' ? safe_post('rf_kiri_atas') : NULL,
                'rf_kiri_bawah'             => safe_post('rf_kiri_bawah') !== '' ? safe_post('rf_kiri_bawah') : NULL,
                'rf_kanan_atas'             => safe_post('rf_kanan_atas') !== '' ? safe_post('rf_kanan_atas') : NULL,
                'rf_kanan_bawah'            => safe_post('rf_kanan_bawah') !== '' ? safe_post('rf_kanan_bawah') : NULL,
                'sensorik_dbn'              => safe_post('sensorik_dbn') !== '' ? safe_post('sensorik_dbn') : NULL,
                'sensorik_lain'             => safe_post('sensorik_lain') !== '' ? safe_post('sensorik_lain') : NULL,
                'pemeriksaan_khusus'        => safe_post('pemeriksaan_khusus') !== '' ? safe_post('pemeriksaan_khusus') : NULL,
                'trm_dbn'                   => safe_post('trm_dbn') !== '' ? safe_post('trm_dbn') : NULL,
                'trm_kaku_kuduk'            => safe_post('trm_kaku_kuduk') !== '' ? safe_post('trm_kaku_kuduk') : NULL,
                'trm_laseque'               => safe_post('trm_laseque') !== '' ? safe_post('trm_laseque') : NULL,
                'trm_kerning'               => safe_post('trm_kerning') !== '' ? safe_post('trm_kerning') : NULL,
                'motorik_kiri_atas'         => safe_post('motorik_kiri_atas') !== '' ? safe_post('motorik_kiri_atas') : NULL,
                'motorik_kiri_bawah'        => safe_post('motorik_kiri_bawah') !== '' ? safe_post('motorik_kiri_bawah') : NULL,
                'motorik_kanan_atas'        => safe_post('motorik_kanan_atas') !== '' ? safe_post('motorik_kanan_atas') : NULL,
                'motorik_kanan_bawah'       => safe_post('motorik_kanan_bawah') !== '' ? safe_post('motorik_kanan_bawah') : NULL,
                'reflek_patologis'          => safe_post('reflek_patologis') !== '' ? safe_post('reflek_patologis') : NULL,
                'otonom'                    => safe_post('otonom') !== '' ? safe_post('otonom') : NULL,
                'riwayat_kelahiran'         => safe_post('riwayat_kelahiran') !== '' ? safe_post('riwayat_kelahiran') : NULL,
                'riwayat_nutrisi'           => safe_post('riwayat_nutrisi') !== '' ? safe_post('riwayat_nutrisi') : NULL,
                'riwayat_imunisasi'         => safe_post('riwayat_imunisasi') !== '' ? safe_post('riwayat_imunisasi') : NULL,
                'riwayat_tumbuh_kembang'    => safe_post('riwayat_tumbuh_kembang') !== '' ? safe_post('riwayat_tumbuh_kembang') : NULL,
                's_soap'                    => safe_post('s_soap') !== '' ? safe_post('s_soap') : NULL,
                'o_soap'                    => safe_post('o_soap') !== '' ? safe_post('o_soap') : NULL,
                'a_soap'                    => safe_post('a_soap') !== '' ? safe_post('a_soap') : NULL,
                'p_soap'                    => safe_post('p_soap') !== '' ? safe_post('p_soap') : NULL,
            );
        } else {
            $visitasi = array(
                'id_layanan_pendaftaran'    => $layanan['id'],
                'waktu'                     => $this->datetime,
                'keluhan_utama'             => safe_post('keluhan_utama_ri') !== '' ? safe_post('keluhan_utama_ri') : NULL,
                'tensi_sistolik'            => safe_post('tensi_s') !== '' ? safe_post('tensi_s') : NULL,
                'tensi_diastolik'           => safe_post('tensi_d') !== '' ? safe_post('tensi_d') : NULL,
                'suhu'                      => safe_post('suhu_ri') !== '' ? safe_post('suhu_ri') : NULL,
                'nadi'                      => safe_post('nadi_ri') !== '' ? safe_post('nadi_ri') : NULL,
                'nps'                       => safe_post('nafas_ri') !== '' ? safe_post('nafas_ri') : NULL,
                'rr'                        => safe_post('respirasi_ri') !== '' ? safe_post('respirasi_ri') : NULL,
            );

            $soap = array(
                'id_layanan_pendaftaran'    => $layanan['id'],
                'waktu'                     => $this->datetime,
                'id_dokter'                 => safe_post('dokter') !== '' ? safe_post('dokter') : NULL,
                'jenis'                     => safe_post('jenis_layanan'),
                's_soap'                    => safe_post('s_soap') !== '' ? safe_post('s_soap') : NULL,
                'o_soap'                    => safe_post('o_soap') !== '' ? safe_post('o_soap') : NULL,
                'a_soap'                    => safe_post('a_soap') !== '' ? safe_post('a_soap') : NULL,
                'p_soap'                    => safe_post('p_soap') !== '' ? safe_post('p_soap') : NULL,
                'keterangan'                => safe_post('keterangan') !== '' ? safe_post('keterangan') : NULL,
            );
        }

        // insert data anamnesa

        if (safe_post('jenis_layanan') === 'Intensive Care') :
            $this->m_pelayanan->insertAnamnesa($visitasi);
            $this->m_pelayanan->insertSOAP($soap);
            $jenis = 'Intensive Care';
        else :
            if (safe_post('jenis_layanan') === 'IGD') :
                $this->m_pelayanan->updateAnamnesa($anamnesa);
                $jenis = 'IGD';
            else :
                if (safe_post('jenis_layanan') === 'Pemulasaran Jenazah') :
                    $jenis = 'Pemulasaran Jenazah';
                else :
                    if (safe_post('jenis_layanan') === 'Hemodialisa') :
                        $this->m_pelayanan->updateAnamnesa($anamnesa);
                        $jenis = 'Hemodialisa';
                    else :
                        $this->m_pelayanan->updateAnamnesa($anamnesa);
                        $jenis = 'Rawat Jalan';
                    endif;
                endif;
            endif;
        endif;


        // cek profil pasien
        $checkProfilPasien = $this->db->query("select * from sm_profil_pasien where id_pasien = '" . safe_post('id_pasien') . "'")->row();
        $dataProfilPasien = array(
            'id_pasien' => safe_post('id_pasien'),
            'tinggi_badan' => safe_post('tinggi_badan') !== '' ? safe_post('tinggi_badan') : NULL,
            'berat_badan'  => safe_post('berat_badan') !== '' ? safe_post('berat_badan') : NULL,
        );
        if ($checkProfilPasien) :
            $this->db->where('id_pasien', safe_post('id_pasien'), true)->update('sm_profil_pasien', $dataProfilPasien);
        else :
            $this->db->insert('sm_profil_pasien', $dataProfilPasien);
        endif;

        // data diagnosa
        $diagnosa = array(
            'id_diag'                   => $this->post('id_diag'),
            'id_dokter'                 => $this->post('dokter_diag'),
            'id_golongan_sebab_sakit'   => $this->post('id_golongan_sebab_sakit') !== '' ? $this->post('id_golongan_sebab_sakit') : NULL,
            'kode_diagnosa'             => $this->post('kode_diag') !== '' ? $this->post('kode_diag') : NULL,
            'diagnosa_manual'           => $this->post('diag_manual'),
            'golongan_sebab_sakit_lain' => $this->post('gol_sebab_sakit_lain') !== '' ? $this->post('gol_sebab_sakit_lain') : NULL,
            'diagnosa_klinis'           => $this->post('diag_klinis') === "on" ? NULL : $this->post('diag_klinis'),
            'prioritas'                 => $this->post('prioritas') !== '' ? $this->post('prioritas') : NULL,
            'diagnosa_banding'          => $this->post('diag_banding') !== '' ? $this->post('diag_banding') : NULL,
            'diagnosa_akhir'            => $this->post('diag_akhir') === "on" ? 0 : $this->post('diag_akhir'),
            'penyebab_kematian'         => $this->post('sebab_kematian') === "on" ? 0 : $this->post('sebab_kematian'),
            'is_resume'                 => $this->post('is_resume') ?? 1,
        );

        if ($jenis !== "Intensive Care") :
            $diagnosa['post'] = array(1);
        endif;
        // echo json_encode($diagnosa); die;
        // insert data diagnosa
        $this->m_pelayanan->simpanDiagnosaPemeriksaan($layanan['id'], $diagnosa, safe_post('id_pasien'));

        // data tindakan
        $tindakan = array(
            'operator' => $this->post('id_operator'),
            'tindakan' => $this->post('id_tindakan'),
            'tindakan_icd9' => $this->post('id_tindakan_icd9'),
            'qty'      => $this->post('qty'),
        );

        //  insert data tindakan
        $this->m_pelayanan->simpanTindakanPemeriksaan($layanan['id'], $tindakan, $jenis);

        if (safe_post('jenis_layanan') === 'Poliklinik') :
            $this->m_pelayanan->updateDokterTindakanKonsultasi($layanan['id'], $dokter, $lp_status->status_terlayani);
        else :
            $posted = true;
            if (safe_post('jenis_layanan') === 'IGD') :
                $posted = false;
            endif;

            if (safe_post('jenis_layanan') === 'Intensive Care') :
                $posted = false;
            endif;

            if ($posted) :
                $data_logs = array(
                    'waktu'       => $this->datetime,
                    'status'      => safe_post('jenis_layanan'),
                    'id_dokter'   => $dokter,
                    'query'       => "select pd.* from sm_layanan_pendaftaran as lp 
                                      join sm_pendaftaran as pd on (pd.id = lp.id_pendaftaran) 
                                      where lp.id = '" . $layanan['id'] . "' ",
                    'no_register' => $layanan['id'],
                    'klinik'      => ''
                );

                $this->db->insert('sm_logs_error', $data_logs);
            endif;
        endif;

        // insert data BHP
        $kemasan = safe_post('id_kemasan');
        if (is_array($kemasan)) :
            $this->m_pelayanan->simpanBHP();
        endif;
 
        // insert data PKRT
        $id_tarif_pkrt = safe_post('id_tarif_pkrt');
        if (is_array($id_tarif_pkrt)) :
            $this->m_pelayanan->simpanPKRT();
        endif;

        // insert data Order Operasi
        $id_tarif_operasi = safe_post('id_tarif_operasi');
        $timing = safe_post('timing');
        $bobot = safe_post('bobot');
        if (is_array($id_tarif_operasi)) :
            foreach ($id_tarif_operasi as $i => $val) :
                $data_operasi = array(
                    'id_tarif' => $val,
                    'bobot' => $bobot[$i],
                    'timing' => $timing[$i],
                    'id_layanan_pendaftaran' => $layanan['id'],
                    'id_pasien' => safe_post('id_pasien')
                );
                $this->m_pelayanan->simpanJadwalOperasi($data_operasi);
            endforeach;
        endif;

        // insert data Order VK
        $order_vk = safe_post('jml_order_vk');
        if (is_array($order_vk)) :
            foreach ($order_vk as $i => $val) :
                $data_vk = array(
                    'id_layanan_pendaftaran' => $layanan['id'],
                    'id_pasien' => safe_post('id_pasien'),
                    'layanan' => 'VK',
                );
                $this->m_pelayanan->simpanOrderVK($data_vk);
            endforeach;
        endif;

        // Order Hemodialisis
        $hemo_order = safe_post('hemo_order');
        $get_no_sep = safe_post('no_sep_hemodialisis');
        $id_dftr_hemodialisis = safe_post('id_dftr_hemodialisis');
        $dokter_hemodialisis = safe_post('dokter_hemodialisis');
        $cara_bayar_hemodialisis = safe_post('cara_bayar_hemodialisis');
        $id_penjamin_hemodialisis = safe_post('id_penjamin_hemodialisis');
        $no_polish_hemodialisis = safe_post('no_polish_hemodialisis');

        if (is_array($hemo_order)) {
            $hemo_status = $this->db->select('tindak_lanjut')->where('id', $layanan['id'])->get('sm_layanan_pendaftaran')->row();
            $hemo_lanjut = $hemo_status->tindak_lanjut;
            if ($hemo_lanjut === NULL) {
                foreach ($hemo_order as $i => $val) {
                    $data_hemo = array(
                        'id_pendaftaran'    => $id_dftr_hemodialisis[$i],
                        'tanggal_layanan'   => $this->datetime,
                        'id_dokter'         => $dokter_hemodialisis[$i] !== '' ? $dokter_hemodialisis[$i] : NULL,
                        'jenis_layanan'     => 'Hemodialisa',
                        'kondisi'           => 'Hidup',
                        'resusitasi'        => 0,
                        'cara_bayar'        => $cara_bayar_hemodialisis[$i] !== '' ? $cara_bayar_hemodialisis[$i] : NULL,
                        'id_penjamin'       => $id_penjamin_hemodialisis[$i] !== '' ? $id_penjamin_hemodialisis[$i] : NULL,
                        'no_polish'         => $no_polish_hemodialisis[$i] !== '' ? $no_polish_hemodialisis[$i] : NULL,
                        'no_sep'            => ($get_no_sep[$i] !== '') ? strtoupper($get_no_sep[$i]) : NULL,
                        'terklaim'          => ($cara_bayar_hemodialisis[$i] === 'Tunai') ? 1 : 0,
                        'status_terlayani'  => 'Belum',
                        'id_users'          => $this->session->userdata('id_translucent'),
                    );

                    $this->m_pelayanan->simpanDataDFTRHemodialisis($data_hemo);
                }
            }
        }

        // Order DPMP
        $dpmp_order = safe_post('dpmp_order');
        $id_dftr_dpmp = safe_post('id_dftr_dpmp');

        if (is_array($dpmp_order)) {
            $dpmp_status = $this->db->select('tindak_lanjut')->where('id', $layanan['id'])->get('sm_layanan_pendaftaran')->row();
            $dpmp_lanjut = $dpmp_status->tindak_lanjut;
            if ($dpmp_lanjut === NULL) {
                foreach ($dpmp_order as $i => $val) {
                    $data_dpmp = array(
                        'id_layanan_pendaftaran'    => $layanan['id'],
                        'id_pendaftaran'            => $id_dftr_dpmp,
                        'waktu_order'               => $this->datetime,
                        'status'                    => 'Belum',
                        'id_users'                  => $this->session->userdata('id_translucent'),
                    );

                    $this->m_pelayanan->simpanDataOrderDPMP($data_dpmp);
                }
            }
        }


        //Order Bimroh
        $order_bimroh = safe_post('jenis_order');
        if (is_array($order_bimroh)) :
            foreach ($order_bimroh as $i => $val) :
                $simpan_order_bimroh = array(
                    'id_layanan_pendaftaran' => $layanan['id'],
                    'id_pasien' => safe_post('id_pasien'),
                    'id_perawat' => safe_post('perawat_order_bimroh')[$i] !== '' ? safe_post('perawat_order_bimroh')[$i] : NULL,
                    'waktu_order' => $this->datetime,
                    'jenis_order' => $val,
                    'kondisi_pasien' => safe_post('kondisi_pasien')[$i] !== '' ? safe_post('kondisi_pasien')[$i] : NULL,
                    'diagnosa_spiritual' => safe_post('diagnosa_spiritual')[$i] !== '' ? safe_post('diagnosa_spiritual')[$i] : NULL,
                    'terapi_tindak_lanjut' => safe_post('terapi_tindak_lanjut')[$i] !== '' ? safe_post('terapi_tindak_lanjut')[$i] : NULL,
                );

                $this->m_pelayanan->simpanOrderBimroh($simpan_order_bimroh);
            endforeach;
        endif;

        //order Talqin        
        $order_talqin = safe_post('kondisi_pasien_talqin');
        if (is_array($order_talqin)) :
            foreach ($order_talqin as $i => $val) :
                $simpan_order_talqin = array(
                    'id_layanan_pendaftaran' => $layanan['id'],
                    'id_pasien' => safe_post('id_pasien'),
                    'id_perawat_talqin' => safe_post('perawat_order_talqin')[$i] !== '' ? safe_post('perawat_order_talqin')[$i] : NULL,
                    'waktu_order_talqin' => $this->datetime,
                    'kondisi_pasien_talqin' => $val,
                    'terapi_advice_talqin' => safe_post('terapi_advice_talqin')[$i] !== '' ? safe_post('terapi_advice_talqin')[$i] : NULL,
                );

                $this->m_pelayanan->simpanOrderTalqin($simpan_order_talqin);
            endforeach;
        endif;

        // insert data Order Darah
        $kemasan = safe_post('id_kemasan_darah');
        if (is_array($kemasan)) :
            $this->m_pelayanan->simpanOrderDarah();
        endif;

        // update tanggal periksa
        $waktu_periksa = array('id_layanan_pendaftaran' => $layanan['id'], 'waktu' => $this->datetime);
        $this->m_pelayanan->updateWaktuPeriksa($waktu_periksa);

        // update tracer
        $this->load->model('Tracer_model', 'tracer');
        $this->tracer->updateStatusBerkas($layanan['id']);

        if ($this->db->trans_status() === false) :
            $this->db->trans_rollback();
            $status = false;
        else :
            $this->db->trans_commit();
            $status = true;
        endif;

        $message = array(
            'status' => $status,
            'token'  => $this->security->get_csrf_hash(),
            'id'     => $layanan['id'],
        );

        $this->response($message, REST_Controller::HTTP_OK);
    }

    function get_tindakan_detail_get()
    {
        if (!$this->get('id', true)) :
            $this->response(NULL, REST_Controller::HTTP_BAD_REQUEST);
        endif;

        $data     = $this->m_pelayanan->getTindakanDetail($this->get('id', true));
        $response = array('status' => true, 'data' => $data);
        $this->response($response, REST_Controller::HTTP_OK);
    }

    function update_operator_tindakan_put()
    {
        $this->db->trans_begin();
        $operator = $this->put('operator', true) !== '' ? $this->put('operator', true) : NULL;
        $id = $this->put('id_tarif_tindakan', true);
        $tindakan = $this->m_pelayanan->getTindakanDetail($id);
        $id_layanan_pendaftaran = $tindakan->id_layanan_pendaftaran;
        $catatan = 'Tindakan : ' . $tindakan->layanan;
        $catatan .= '<br>Sebelum edit : Operator ' . $tindakan->operator;

        // update operator tindakan
        $update = ['id_operator' => $operator];
        $this->db->where('id', $id)->update('sm_tarif_tindakan_pasien', $update);

        $tindakan = $this->m_pelayanan->getTindakanDetail($id);
        $catatan .= '<br>Setelah edit : Operator ' . $tindakan->operator;

        if ($this->db->trans_status() === false) :
            $this->db->trans_rollback();
            $status = false;
        else :
            $this->db->trans_commit();
            $this->load->model('logs/Logs_model', 'm_logs');
            $this->m_logs->recordAdminLogs($id_layanan_pendaftaran, 'Edit Operator Tindakan', $catatan);
            $status = true;
        endif;

        $message = array('status' => $status);
        $this->response($message, REST_Controller::HTTP_OK);
    }

    function get_tindakan_list_get()
    {
        if (!$this->get('id_layanan', true)) :
            $this->response(NULL, REST_Controller::HTTP_BAD_REQUEST);
        endif;

        $data = $this->m_pelayanan->getTindakanPemeriksaan($this->get('id_layanan', true));
        $response = array('status' => true, 'data' => $data);
        $this->response($response, REST_Controller::HTTP_OK);
    }

    function update_waktu_tindakan_put()
    {
        $this->db->trans_begin();
        $id = $this->put('id', true);
        $waktu = $this->put('waktu', true);
        $tindakan = $this->m_pelayanan->getTindakanDetail($id);
        $id_layanan_pendaftaran = $tindakan->id_layanan_pendaftaran;
        $catatan = 'Tindakan : ' . $tindakan->layanan;
        $catatan .= '<br>Sebelum edit : Waktu ' . $tindakan->tanggal;

        // update tanggal tindakan
        $update = ['tanggal' => $waktu];
        $this->db->where('id', $id)->update('sm_tarif_tindakan_pasien', $update);

        $tindakan = $this->m_pelayanan->getTindakanDetail($id);
        $catatan .= '<br>Setelah edit : Waktu ' . $tindakan->tanggal;

        if ($this->db->trans_status() === false) :
            $this->db->trans_rollback();
            $status = false;
        else :
            $this->db->trans_commit();
            $this->load->model('logs/Logs_model', 'm_logs');
            $this->m_logs->recordAdminLogs($id_layanan_pendaftaran, 'Edit Waktu Tindakan', $catatan);
            $status = true;
        endif;

        $message = array('status' => $status, 'id_layanan_pendaftaran' => $id_layanan_pendaftaran);
        $this->response($message, REST_Controller::HTTP_OK);
    }

    function update_waktu_tanggal_keluar_put()
    {
        $this->db->trans_begin();
        $id = $this->put('id', true);
        $waktu = $this->put('waktu', true);
        $pendaftaran = $this->m_pelayanan->getPendaftaranById($id);

        $id_layanan_pendaftaran = $pendaftaran->id_layanan_pendaftaran;
        $catatan = 'Pendaftaran : ' . $pendaftaran->id;
        $catatan .= '<br> Layanan Pendaftaran : ' . $pendaftaran->id_layanan_pendaftaran;
        $catatan .= '<br>Sebelum edit : Waktu ' . $pendaftaran->tanggal_keluar;

        // update tanggal tindakan
        $update = ['tanggal_keluar' => $waktu];
        $this->db->where('id', $id)->update('sm_pendaftaran', $update);

        $tindakan = $this->m_pelayanan->getPendaftaranById($id);
        $catatan .= '<br>Setelah edit : Waktu ' . $tindakan->tanggal_keluar;

        if ($this->db->trans_status() === false) :
            $this->db->trans_rollback();
            $status = false;
        else :
            $this->db->trans_commit();
            $this->load->model('logs/Logs_model', 'm_logs');
            $this->m_logs->recordAdminLogs($id_layanan_pendaftaran, 'Edit Tanggal Keluar', $catatan);
            $status = true;
        endif;

        $message = array('status' => $status, 'id_layanan_pendaftaran' => $id_layanan_pendaftaran);
        $this->response($message, REST_Controller::HTTP_OK);
    }

    function simpan_konsul_post()
    {
        $this->db->trans_begin();
        $id_pendaftaran = safe_post('id_pendaftaran');
        $id_layanan_pendaftaran = safe_post('id_layanan_pendaftaran');
        $layanan = $this->post('layanan') != '' ? $this->post('layanan') : NULL;
        $dokter = $this->post('dokter') != '' ? $this->post('dokter') : NULL;
        $jenis_layanan = 'Poliklinik';
        $catatan = 'Konsul ke ';
        $keterangan = $this->post('keterangan') != '' ? $this->post('keterangan') : NULL;

        $layanan_pendaftaran_last = $this->m_pelayanan->getLastLayananPendaftaran($id_pendaftaran);
        $this->load->model('pendaftaran/Pendaftaran_model', 'pendaftaran');
        foreach ($layanan as $index => $value) {
            $no_antrian = $this->pendaftaran->getNextNoAntrian(array('id_unit' => $value, 'tanggal' => date('Y-m-d')));
            $layanan_pendaftaran = array(
                'id_pendaftaran'  => $id_pendaftaran,
                'tanggal_layanan' => $this->datetime,
                'id_unit_layanan' => $value,
                'no_antrian'      => $no_antrian,
                'jenis_layanan'   => $jenis_layanan,
                'konsul'          => 1,
                'kondisi'         => 'Hidup',
                'resusitasi'      => 0,
                'id_dokter'       => $dokter[$index],
                'cara_bayar'      => $layanan_pendaftaran_last->cara_bayar,
                'id_penjamin'     => $layanan_pendaftaran_last->id_penjamin,
                'no_polish'       => $layanan_pendaftaran_last->no_polish,
                'id_users'        => $this->session->userdata('id_translucent'),
                'keterangan'        => $keterangan[$index],
                'id_layanan_asal'   => $id_layanan_pendaftaran

            );

            $id = $this->pendaftaran->simpanDataLayananPendaftaran($layanan_pendaftaran);
            $this->m_pelayanan->updateLastLayanan($id, true);

            $this->m_pelayanan->ubahJadwalDokterKuota(
                'tambah',
                date('Y-m-d', strtotime($layanan_pendaftaran_last->tanggal_layanan)),
                $layanan[$index],
                $dokter[$index]
            );

            $this->load->model('spesialisasi/Spesialisasi_model', 'sp');
            $spesialis = $this->sp->getDataSpesialisasiById($value);
            if ($spesialis->id_tarif !== NULL) {
                $tindakan = array('operator' => $dokter[$index], 'tindakan' => ($spesialis->id_tarif), 'qty' => '1');
                $this->m_pelayanan->simpanTindakanPemeriksaan($id, $tindakan, 'Pendaftaran');
            }

            $catatan .= 'Klinik ' . $spesialis->nama;
            if ($index < count(array($layanan)) - 1) {
                $catatan .= ', ';
            }
        }

        $tindak_lanjut = array('tindak_lanjut' => 'Klinik Lain', 'kondisi' => 'Hidup');
        $this->m_pelayanan->updateTindakLanjut($id_layanan_pendaftaran, $tindak_lanjut);

        $this->load->model('satu_sehat/Satu_sehat_model', 'sehat');
        $cekOnOff = $this->sehat->cekSatuSehatOnOff();

        if($cekOnOff->onoff === '1'){
            $this->m_pelayanan->integrasiTindakLanjut($id_layanan_pendaftaran, $tindak_lanjut);
        }

        if ($this->db->trans_status() === FALSE) {
            $this->db->trans_rollback();
            $status = false;
        } else {
            $this->db->trans_commit();
            $status = true;
        }

        $this->load->model('logs/Logs_model', 'm_logs');
        $this->m_logs->recordAdminLogs($id_layanan_pendaftaran, 'Konsul Klinik', $catatan);
        $message = array('id' => $layanan_pendaftaran['id_pendaftaran'], 'status' => $status, 'message' => '');
        $this->response($message, REST_Controller::HTTP_OK);
    }

    function hapus_bhp_delete()
    {
        $data_bhp = array("id_penjualan" => $this->get("id"), "id_kemasan" => $this->get("id_kemasan"), "id_barang" => $this->get("id_barang"));
        $data = $this->m_pelayanan->deleteDataBHP($data_bhp);
        exit(json_encode($data));
    }

    function hapus_pkrt_delete()
    {
        $data_pkrt = array("id_pembayaran_pkrt" => $this->get("id_pembayaran_pkrt"), "id_layanan_pendaftaran" => $this->get("id_layanan_pendaftaran"));
        $data = $this->m_pelayanan->deleteDataPKRT($data_pkrt);
        exit(json_encode($data));
    }

    function hapus_darah_delete()
    {
        $data_bhp = array("id_penjualan" => $this->get("id"), "id_kemasan" => $this->get("id_kemasan"), "id_barang" => $this->get("id_barang"));
        $data = $this->m_pelayanan->deleteDataDarah($data_bhp);
        exit(json_encode($data));
    }

    // resep
    function get_pasien_last_resep_get()
    {
        $data = $this->m_pelayanan->getLastResepPasien($this->get("id"));
        $this->response($data, REST_Controller::HTTP_OK);
    }

    function get_data_layanan_current_pasien_get()
    {
        $id_layanan_pendaftaran = $this->get('id');

        $data = $this->db->select('tindak_lanjut, jenis_layanan, id_penjamin')->from('sm_layanan_pendaftaran')->where('id', $id_layanan_pendaftaran)->get()->row();

        $this->response($data, REST_Controller::HTTP_OK);
    }

    function get_list_history_resep_get()
    {
        if (!$this->get("page")) :
            $this->response(NULL, REST_Controller::HTTP_BAD_REQUEST);
        endif;

        $search = array(
            "key"           => safe_get("pencarian"),
            "id"            => $this->get("id"),
            "status"        => safe_get("status"),
            "tanggal_awal"  => date2mysql(safe_get("tanggal_awal")),
            "tanggal_akhir" => date2mysql(safe_get("tanggal_akhir")),
            "dokter"        => safe_get("dokter"),
            "pasien"        => safe_get("pasien"),
            "barang"        => safe_get("nama"),
            "sediaan"       => safe_get("sediaan"),
            "formularium"   => safe_get("formularium"),
            "fornas"        => safe_get("fornas"),
            "generik"       => safe_get("generik"),
            "roa"           => safe_get("roa"),
            "ven"           => safe_get("ven"),
            "golongan"      => safe_get("golongan") !== "" ? implode(",", safe_get("golongan")) : "",
            "katastropik"   => safe_get("katastropik"),
            "id_lp"         => safe_get("id_layanan_pendaftaran"),
            "cara_bayar"    => safe_get("cara_bayar"),
            "penjamin"      => safe_get("penjamin"),
            "id_unit"       => safe_get("unit"),
            "nama_barang"   => safe_get("barang")
        );

        $start = ($this->get("page") - 1) * $this->limit;
        $data = $this->m_pelayanan->getListDataHistoryResep($this->limit, $start, $search);
        $data["page"] = (int) $this->get("page");
        $data["limit"] = $this->limit;
        if ($data) :
            $this->response($data, REST_Controller::HTTP_OK);
        else :
            $this->response(array("error" => "Data tidak ditemukan"), REST_Controller::HTTP_NOT_FOUND);
        endif;
    }

    function simpan_data_resep_post()
    {
        $data = $this->m_pelayanan->simpanDataResep();
        $this->response($data, REST_Controller::HTTP_OK);
    }

    function get_data_resep_get()
    {
        $result = array();
        $data   = $this->m_pelayanan->getDataResepById(safe_get('id'));
        $result = $data;
        if (!empty($_GET['cek_stok']) && !empty($data['data']) && !empty($data['data'][0]->resep_r)) :
            $arr_resep_r = array();
            foreach ($data['data'][0]->resep_r as $i => $val) :
                $tmp_resep_r = $val;
                if (!empty($val->resep_r_detail)) :
                    $arr_resep_r_detail = array();
                    foreach ($val->resep_r_detail as $j => $val2) :
                        $tmp_resep_r_detail = $val2;
                        $tmp_resep_r_detail->stok_awal = $val2->sisa - 0;
                        $tmp_resep_r_detail->stok_akhir = $val2->sisa - $val2->jumlah_pakai;
                        $arr_resep_r_detail[] = $tmp_resep_r_detail;
                        if ($tmp_resep_r_detail->stok_akhir < 0) :
                            $arr_warning[] = array(
                                "code" => NULL,
                                "message" => "Stok " . $val2->nama_barang . " tidak mencukupi. Sisa stok " . $val2->sisa . " " . $val2->sediaan . ", akan digunakan " . $val2->jumlah_pakai . " " . $val2->sediaan, "key_resep_r" => $i, "key_resep_r_detail" => $j
                            );
                        endif;
                    endforeach;
                    $tmp_resep_r->resep_r_detail = $arr_resep_r_detail;
                endif;
                $arr_resep_r[] = $tmp_resep_r;
            endforeach;
            $result['data'][0]->resep_r = $arr_resep_r;
            if (!empty($arr_warning)) :
                $result['status']['warning'] = $arr_warning;
            endif;
        endif;

        $this->response($result, REST_Controller::HTTP_OK);
    }

    function get_resep_tebus_get()
    {
        if ($this->get('log', true) != '1') {
            $data = $this->m_pelayanan->getListDataResepTebus($this->get('id', true));
        } else {
            $data = $this->m_pelayanan->getListDataResepTebusLog($this->get('id', true));
        }
        $this->response($data, REST_Controller::HTTP_OK);
    }

    // end resep

    function delete_penjualan_delete()
    {
        $data = $this->m_pelayanan->deletePenjualan($this->get("id", true));
        $this->response($data, REST_Controller::HTTP_OK);
    }

    // CEK
    function cek_diagnosa_akhir_get()
    {
        if (!$this->get('id')) :
            $result = array('status' => false, 'message' => 'Parameter tidak lengkap');
            $this->response($result, REST_Controller::HTTP_OK);
        endif;

        $id     = $this->get('id');
        $status = $this->m_pelayanan->cekDiagnosaAkhir($id);
        $result = array('status' => $status);
        $this->response($result, REST_Controller::HTTP_OK);
    }

    function cek_status_bhp_operasi_get()
    {
        $data = $this->m_pelayanan->checkStatusBHPOperasi($this->get("id_layanan_pendaftaran"));
        $this->response($data, REST_Controller::HTTP_OK);
    }

    function simpan_tindak_lanjut_post($jenis = NULL)
    {
        $this->db->trans_begin();
        $status_order_ranap     = true;
        $message                = '';
        $id_pendaftaran         = '';
        $id_layanan_pendaftaran = '';
        $pindah_ipj             = 'Tidak';
        if (safe_post('id_layanan_pendaftaran') === '') :
            $this->response(NULL, REST_Controller::HTTP_BAD_REQUEST);
        endif;

        $id_pendaftaran         = safe_post('id_pendaftaran');
        $id_layanan_pendaftaran = safe_post('id_layanan_pendaftaran');
        $layanan_tl             = safe_post('layanan_tl');

        $cek_resep = $this->db->select('count(*) as count')->from('sm_resep')->where('id_layanan_pendaftaran', $id_layanan_pendaftaran, true)->get()->row()->count;
        if (safe_post('tindak_lanjut') !== 'Pemulasaran Jenazah') :
            if (safe_post('tanpa_resep') !== 'Ya' && $cek_resep < 1) :
                $response = array(
                    'id_pendaftaran'         => $id_pendaftaran,
                    'id_layanan_pendaftaran' => $id_layanan_pendaftaran,
                    'status'                 => false,
                    'message'                => "Pasien <b>Belum</b> menerima resep <br> Apakah anda yakin akan men-checkout pasien ?",
                );

                echo json_encode($response);
                die;
            endif;
        endif;

        $layanan_pendaftaran = $this->db->select('tindak_lanjut')->get_where('sm_layanan_pendaftaran', array('id' => $id_layanan_pendaftaran))->row();
        if (0 < count((array)$layanan_pendaftaran) && $layanan_pendaftaran->tindak_lanjut !== NULL && $layanan_pendaftaran->tindak_lanjut !== 'Konsul Klinik Lain') :
            $response = array(
                'status'  => false,
                'message' => 'Pasien sudah keluar',
            );
            echo json_encode($response);
            die;
        endif;
        // Update Data Tindak Lanjut / Checkout
        $data = array(
            'tindak_lanjut' => safe_post('tindak_lanjut'),
            'kondisi'       => safe_post('kondisi_keluar')
        );
        $this->m_pelayanan->updateTindakLanjut($id_layanan_pendaftaran, $data);

        if ($data['tindak_lanjut'] === 'Pulang' | $data['tindak_lanjut'] === 'Pulang APS' | $data['tindak_lanjut'] === 'Atas Izin Dokter' | $data['tindak_lanjut'] === 'Pulang Paksa' | $data['tindak_lanjut'] === 'Melarikan Diri' | $data['tindak_lanjut'] === 'Perujuk') :
            $pindah_ipj = safe_post('pindah_ipj');
			
            if($layanan_tl == 'HD_Konsul'){
                $pendaftaran = array(
                    'kondisi_keluar' => $this->post('kondisi_keluar')
                );
                $this->db->where('id', $id_pendaftaran)->update('sm_pendaftaran', $pendaftaran);
            } else {
                $pendaftaran = array(
                    'tanggal_keluar' => $this->datetime,
                    'kondisi_keluar' => $this->post('kondisi_keluar')
                );
                $this->db->where('id', $id_pendaftaran)->update('sm_pendaftaran', $pendaftaran);
            } 
            $message = 'Berhasil mengubah status pasien menjadi Pulang / Pulang APS';
        else :
            if ($data['tindak_lanjut'] === 'RS Lain') :
                $pendaftaran = array(
                    'tanggal_keluar'      => $this->datetime,
                    'kondisi_keluar'      => safe_post('kondisi_keluar'),
                    'id_instansi_merujuk' => safe_post('instansi_rujukan') ?: NULL,
                    'nadis_merujuk' => safe_post('dokter') ?: NULL,
                    'keterangan_rujukan' => safe_post('keterangan_rujukan') ?: NULL
                );
                $this->db->where('id', $id_pendaftaran)->update('sm_pendaftaran', $pendaftaran);
                $message = 'Berhasil merujuk pasien ke RS Lain';
            else :
                $id_penjamin = safe_post('id_penjamin') !== '' ? safe_post('id_penjamin') : NULL;
                if ($data['tindak_lanjut'] === 'IGD') :
                    $data_layanan_pendaftaran = array(
                        'id_pendaftaran' => $id_pendaftaran,
                        'tanggal_layanan' => $this->datetime,
                        'jenis_layanan'  => $data['tindak_lanjut'],
                        'kondisi'        => safe_post('kondisi_keluar'),
                        'resusitasi'     => 0,
                        'cara_bayar'     => $id_penjamin !== '9' ? 'Asuransi' : 'Tunai',
                        'id_penjamin'    => $id_penjamin,
                        'id_users'       => $this->session->userdata('id_translucent')
                    );
                    $this->load->model('pendaftaran/Pendaftaran_model', 'pendaftaran');
                    $this->pendaftaran->simpanDataLayananPendaftaran($data_layanan_pendaftaran);

                    $update_pendaftaran = array(
                        'jenis_igd' => safe_post('jenis_igd')
                    );
                    $this->db->where('id', $id_pendaftaran, true)->update('sm_pendaftaran', $update_pendaftaran);
                    $message = 'Berhasil memindahkan pasien ke pelayanan ' . $data["tindak_lanjut"];
                // jika pasien tindak lanjut nya pemulasaran jenazah
                else :
                    if ($data['tindak_lanjut'] === 'Pemulasaran Jenazah') :
                        $data_layanan_pendaftaran = array(
                            'id_pendaftaran' => $id_pendaftaran,
                            'tanggal_layanan' => $this->datetime,
                            'jenis_layanan'  => $data['tindak_lanjut'],
                            'kondisi'        => $this->post('kondisi_keluar'),
                            'resusitasi'     => 0,
                            'cara_bayar'     => $id_penjamin !== '9' ? 'Asuransi' : 'Tunai',
                            'id_penjamin'    => $id_penjamin,
                            'id_users'       => $this->session->userdata('id_translucent')
                        );
                        $this->load->model('pendaftaran/Pendaftaran_model', 'pendaftaran');
                        $this->pendaftaran->simpanDataLayananPendaftaran($data_layanan_pendaftaran);

                        $message = 'Berhasil memindahkan pasien ke pelayanan ' . $data["tindak_lanjut"];
                    endif;
                endif;
            endif;
        endif;

        // get id_pasien di sm_pendaftaran
        $pasien = $this->db->select('id_pasien')->get_where('sm_pendaftaran', array('id' => $id_pendaftaran))->row();
        if (safe_post('kondisi_keluar') === 'Meninggal' | safe_post('kondisi_keluar') === 'Meninggal < 48 Jam' | safe_post('kondisi_keluar') === 'Meninggal > 48 Jam') :
            // update table sm_profil_pasien -> is_died = Ya
            $this->db->where('id_pasien', $pasien->id_pasien)->update('sm_profil_pasien', array('is_died' => 'Ya'));
        endif;


        if ($jenis === 'Inap') :
            $this->m_pelayanan->dischargeToRawatInap($id_layanan_pendaftaran);
            if ($data['tindak_lanjut'] === 'Pulang' | $data['tindak_lanjut'] === 'Pulang APS' | $data['tindak_lanjut'] === 'Atas Izin Dokter' | $data['tindak_lanjut'] === 'Pulang Paksa' | $data['tindak_lanjut'] === 'Melarikan Diri' | $data['tindak_lanjut'] === 'Perujuk' | $data['tindak_lanjut'] === 'Pemulasaran Jenazah') :
                $this->m_pelayanan->insertAdministrasiRawatInap($id_pendaftaran, $id_layanan_pendaftaran);
            endif;
        endif;

        if ($data['tindak_lanjut'] === 'Rawat Inap') :
            $add = array(
                'waktu'                  => $this->datetime,
                'id_pendaftaran'         => $id_pendaftaran,
                'id_layanan_pendaftaran' => $id_layanan_pendaftaran,
                'id_dokter'              => safe_post('dokter') !== '' ? safe_post('dokter') : NULL,
                'id_dokter_dpjp'         => safe_post('dokter_dpjp') !== '' ? safe_post('dokter_dpjp') : NULL,
                'id_bangsal_tujuan'      => safe_post('bangsal') !== '' ? safe_post('bangsal') : NULL,
                'is_pindah_ruang'        => safe_post('pindah_ruang') !== '' ?  safe_post('pindah_ruang') : 0
            );
            $status_order_ranap = $this->m_pelayanan->simpanOrderRawatInap($add);
        endif;

        //intensive care
        if ($data['tindak_lanjut'] === 'Intensive Care') :
            $add = array(
                'waktu'                  => $this->datetime,
                'id_pendaftaran'         => $id_pendaftaran,
                'id_layanan_pendaftaran' => $id_layanan_pendaftaran,
                'id_dokter'              => safe_post('dokter') !== '' ? safe_post('dokter') : NULL,
                'id_dokter_dpjp'         => safe_post('dokter_dpjp') !== '' ? safe_post('dokter_dpjp') : NULL
            );
            $status_order_icare = $this->m_pelayanan->simpanOrderIntensiveCare($add);
        endif;

        //Kebidanan
        if ($data['tindak_lanjut'] === 'Kebidanan') :
            $add = array(
                'waktu'                  => $this->datetime,
                'id_pendaftaran'         => $id_pendaftaran,
                'id_layanan_pendaftaran' => $id_layanan_pendaftaran,
                'id_dokter'              => safe_post('dokter') !== '' ? safe_post('dokter') : NULL,
                'id_dokter_dpjp'         => safe_post('dokter_dpjp') !== '' ? safe_post('dokter_dpjp') : NULL
            );
            $status_order_kebidanan = $this->m_pelayanan->simpanOrderKebidanan($add);
        endif;

        $this->m_pelayanan->insertResumeDiagnosa($id_pendaftaran);

        // Update task 5 (lima)
        $this->lakukan_task_lima($id_pendaftaran, $id_layanan_pendaftaran);


        if ($this->db->trans_status() === false) :
            $this->db->trans_rollback();
            $status  = false;
            $message = "Gagal mengubah status keluar pasien";
        else :
            $this->db->trans_commit();
            $status = true;

            if ($status_order_ranap) :
                $status = true;
                $message = "Berhasil men-checkout pasien";
            else :
                $status = false;
                $message = "Gagal memindahkan pasien ke Rawat Inap, pasien masih dalam status order rawat inap";
            endif;



            $vclaim = NULL;
            if ($jenis === "Inap" && $data['tindak_lanjut'] === 'Pulang' | $data['tindak_lanjut'] === 'Pulang APS' | $data['tindak_lanjut'] === 'Atas Izin Dokter' | $data['tindak_lanjut'] === 'Pulang Paksa' | $data['tindak_lanjut'] === 'Melarikan Diri' | $data['tindak_lanjut'] === 'Perujuk' | $data['tindak_lanjut'] === 'Pemulasaran Jenazah') :
                $vclaim = $this->updateTanggalPulangSEP($id_pendaftaran);
            endif;

        endif;

        $this->load->model('logs/Logs_model', 'm_logs');
        $this->m_logs->recordAdminLogs($id_layanan_pendaftaran, 'Status Keluar ' . $data['tindak_lanjut']);
        $response = array('status' => $status, 'token' => $this->security->get_csrf_hash(), 'message' => $message, 'message' => $message, 'id_pendaftaran' => $id_pendaftaran, 'id_layanan_pendaftaran' => $id_layanan_pendaftaran);
        $this->response($response, REST_Controller::HTTP_OK);
    }

    function simpan_tindak_lanjut_rehab_post($jenis = NULL)
    {
        $this->db->trans_begin();
        $status_order_ranap     = true;
        $message                = '';
        $id_pendaftaran         = '';
        $id_layanan_pendaftaran = '';
        $pindah_ipj             = 'Tidak';
        if (safe_post('rhm_id_layanan_pendaftaran') === '') :
            $this->response(NULL, REST_Controller::HTTP_BAD_REQUEST);
        endif;

        $id_pendaftaran         = safe_post('id_pendaftaran');
        $id_layanan_pendaftaran = safe_post('rhm_id_layanan_pendaftaran');

        $cek_resep = $this->db->select('count(*) as count')->from('sm_resep')->where('id_layanan_pendaftaran', $id_layanan_pendaftaran, true)->get()->row()->count;
        if (safe_post('tindak_lanjut') !== 'Pemulasaran Jenazah') :
            if (safe_post('tanpa_resep') !== 'Ya' && $cek_resep < 1) :
                $response = array(
                    'id_pendaftaran'         => $id_pendaftaran,
                    'id_layanan_pendaftaran' => $id_layanan_pendaftaran,
                    'status'                 => false,
                    'message'                => "Pasien <b>Belum</b> menerima resep <br> Apakah anda yakin akan men-checkout pasien ?",
                );

                echo json_encode($response);
                die;
            endif;
        endif;
        $layanan_pendaftaran = $this->db->select('tindak_lanjut')->get_where('sm_layanan_pendaftaran', array('id' => $id_layanan_pendaftaran))->row();
        if (0 < count((array)$layanan_pendaftaran) && $layanan_pendaftaran->tindak_lanjut !== NULL) :
            $response = array(
                'status'  => false,
                'message' => 'Pasien sudah keluar',
            );
            echo json_encode($response);
            die;
        endif;
        // Update Data Tindak Lanjut / Checkout
        $data = array(
            'tindak_lanjut' => safe_post('tindak_lanjut'),
            'kondisi'       => safe_post('kondisi_keluar')
        );
        $this->m_pelayanan->updateTindakLanjut($id_layanan_pendaftaran, $data);

        if ($data['tindak_lanjut'] === 'Pulang' | $data['tindak_lanjut'] === 'Pulang APS' | $data['tindak_lanjut'] === 'Atas Izin Dokter' | $data['tindak_lanjut'] === 'Pulang Paksa' | $data['tindak_lanjut'] === 'Melarikan Diri' | $data['tindak_lanjut'] === 'Perujuk') :
            $pindah_ipj = safe_post('pindah_ipj');
            // Update Data Tindak Lanjut di Table Pendaftaran
            $pendaftaran = array(
                'tanggal_keluar' => $this->datetime,
                'kondisi_keluar' => $this->post('kondisi_keluar')
            );
            $this->db->where('id', $id_pendaftaran)->update('sm_pendaftaran', $pendaftaran);
            $message = 'Berhasil mengubah status pasien menjadi Pulang / Pulang APS';
        else :
            if ($data['tindak_lanjut'] === 'RS Lain') :
                $pendaftaran = array(
                    'tanggal_keluar'      => $this->datetime,
                    'kondisi_keluar'      => safe_post('kondisi_keluar'),
                    'id_instansi_merujuk' => safe_post('instansi_rujukan') ?: NULL,
                    'nadis_merujuk' => safe_post('dokter') ?: NULL,
                    'keterangan_rujukan' => safe_post('keterangan_rujukan') ?: NULL
                );
                $this->db->where('id', $id_pendaftaran)->update('sm_pendaftaran', $pendaftaran);
                $message = 'Berhasil merujuk pasien ke RS Lain';
            else :
                if ($data['tindak_lanjut'] === 'IGD') :
                    $data_layanan_pendaftaran = array(
                        'id_pendaftaran' => $id_pendaftaran,
                        'tanggal_layanan' => $this->datetime,
                        'jenis_layanan'  => $data['tindak_lanjut'],
                        'kondisi'        => safe_post('kondisi_keluar'),
                        'resusitasi'     => 0,
                        'cara_bayar'     => 'Tunai',
                        'id_users'       => $this->session->userdata('id_translucent')
                    );
                    $this->load->model('pendaftaran/Pendaftaran_model', 'pendaftaran');
                    $this->pendaftaran->simpanDataLayananPendaftaran($data_layanan_pendaftaran);

                    $update_pendaftaran = array(
                        'jenis_igd' => safe_post('jenis_igd')
                    );
                    $this->db->where('id', $id_pendaftaran, true)->update('sm_pendaftaran', $update_pendaftaran);
                    $message = 'Berhasil memindahkan pasien ke pelayanan ' . $data["tindak_lanjut"];
                // jika pasien tindak lanjut nya pemulasaran jenazah
                else :
                    if ($data['tindak_lanjut'] === 'Pemulasaran Jenazah') :
                        $data_layanan_pendaftaran = array(
                            'id_pendaftaran' => $id_pendaftaran,
                            'tanggal_layanan' => $this->datetime,
                            'jenis_layanan'  => $data['tindak_lanjut'],
                            'kondisi'        => $this->post('kondisi_keluar'),
                            'resusitasi'     => 0,
                            'cara_bayar'     => 'Tunai',
                            'id_users'       => $this->session->userdata('id_translucent')
                        );
                        $this->load->model('pendaftaran/Pendaftaran_model', 'pendaftaran');
                        $this->pendaftaran->simpanDataLayananPendaftaran($data_layanan_pendaftaran);

                        $message = 'Berhasil memindahkan pasien ke pelayanan ' . $data["tindak_lanjut"];
                    endif;
                endif;
            endif;
        endif;

        // get id_pasien di sm_pendaftaran
        $pasien = $this->db->select('id_pasien')->get_where('sm_pendaftaran', array('id' => $id_pendaftaran))->row();
        if (safe_post('kondisi_keluar') === 'Meninggal' | safe_post('kondisi_keluar') === 'Meninggal < 48 Jam' | safe_post('kondisi_keluar') === 'Meninggal > 48 Jam') :
            // update table sm_profil_pasien -> is_died = Ya
            $this->db->where('id_pasien', $pasien->id_pasien)->update('sm_profil_pasien', array('is_died' => 'Ya'));
        endif;


        if ($jenis === 'Inap') :
            $this->m_pelayanan->dischargeToRawatInap($id_layanan_pendaftaran);
            if ($data['tindak_lanjut'] === 'Pulang' | $data['tindak_lanjut'] === 'Pulang APS' | $data['tindak_lanjut'] === 'Atas Izin Dokter' | $data['tindak_lanjut'] === 'Pulang Paksa' | $data['tindak_lanjut'] === 'Melarikan Diri' | $data['tindak_lanjut'] === 'Perujuk' | $data['tindak_lanjut'] === 'Pemulasaran Jenazah') :
                $this->m_pelayanan->insertAdministrasiRawatInap($id_pendaftaran, $id_layanan_pendaftaran);
            endif;
        endif;

        if ($data['tindak_lanjut'] === 'Rawat Inap') :
            $add = array(
                'waktu'                  => $this->datetime,
                'id_pendaftaran'         => $id_pendaftaran,
                'id_layanan_pendaftaran' => $id_layanan_pendaftaran,
                'id_dokter'              => safe_post('dokter') !== '' ? safe_post('dokter') : NULL,
                'id_dokter_dpjp'         => safe_post('dokter_dpjp') !== '' ? safe_post('dokter_dpjp') : NULL,
                'id_bangsal_tujuan'      => safe_post('bangsal') !== '' ? safe_post('bangsal') : NULL,
                'is_pindah_ruang'        => safe_post('pindah_ruang') !== '' ?  safe_post('pindah_ruang') : 0
            );
            $status_order_ranap = $this->m_pelayanan->simpanOrderRawatInap($add);
        endif;

        //intensive care
        if ($data['tindak_lanjut'] === 'Intensive Care') :
            $add = array(
                'waktu'                  => $this->datetime,
                'id_pendaftaran'         => $id_pendaftaran,
                'id_layanan_pendaftaran' => $id_layanan_pendaftaran,
                'id_dokter'              => safe_post('dokter') !== '' ? safe_post('dokter') : NULL,
                'id_dokter_dpjp'         => safe_post('dokter_dpjp') !== '' ? safe_post('dokter_dpjp') : NULL
            );
            $status_order_icare = $this->m_pelayanan->simpanOrderIntensiveCare($add);
        endif;

        //Kebidanan
        if ($data['tindak_lanjut'] === 'Kebidanan') :
            $add = array(
                'waktu'                  => $this->datetime,
                'id_pendaftaran'         => $id_pendaftaran,
                'id_layanan_pendaftaran' => $id_layanan_pendaftaran,
                'id_dokter'              => safe_post('dokter') !== '' ? safe_post('dokter') : NULL,
                'id_dokter_dpjp'         => safe_post('dokter_dpjp') !== '' ? safe_post('dokter_dpjp') : NULL
            );
            $status_order_kebidanan = $this->m_pelayanan->simpanOrderKebidanan($add);
        endif;

        $this->m_pelayanan->insertResumeDiagnosa($id_pendaftaran);

        // Update task 5 (lima)
        $this->lakukan_task_lima($id_pendaftaran, $id_layanan_pendaftaran);

        if ($this->db->trans_status() === false) :
            $this->db->trans_rollback();
            $status  = false;
            $message = "Gagal mengubah status keluar pasien";
        else :
            $this->db->trans_commit();
            $status = true;

            if ($status_order_ranap) :
                $status = true;
                $message = "Berhasil men-checkout pasien";
            else :
                $status = false;
                $message = "Gagal memindahkan pasien ke Rawat Inap, pasien masih dalam status order rawat inap";
            endif;



            $vclaim = NULL;
            if ($jenis === "Inap" && $data['tindak_lanjut'] === 'Pulang' | $data['tindak_lanjut'] === 'Pulang APS' | $data['tindak_lanjut'] === 'Atas Izin Dokter' | $data['tindak_lanjut'] === 'Pulang Paksa' | $data['tindak_lanjut'] === 'Melarikan Diri' | $data['tindak_lanjut'] === 'Perujuk' | $data['tindak_lanjut'] === 'Pemulasaran Jenazah') :
                $vclaim = $this->updateTanggalPulangSEP($id_pendaftaran);
            endif;

        endif;

        $this->load->model('logs/Logs_model', 'm_logs');
        $this->m_logs->recordAdminLogs($id_layanan_pendaftaran, 'Status Keluar ' . $data['tindak_lanjut']);
        $response = array('status' => $status, 'token' => $this->security->get_csrf_hash(), 'message' => $message);
        $this->response($response, REST_Controller::HTTP_OK);
    }

    function simpan_tindak_lanjut_icare_post($jenis = NULL)
    {
        $this->db->trans_begin();
        $status_order_icare     = true;
        $message                = '';
        $id_pendaftaran         = '';
        $id_layanan_pendaftaran = '';
        $pindah_ipj             = 'Tidak';
        if (safe_post('id_layanan_pendaftaran') === '') :
            $this->response(NULL, REST_Controller::HTTP_BAD_REQUEST);
        endif;

        $id_pendaftaran         = safe_post('id_pendaftaran');
        $id_layanan_pendaftaran = safe_post('id_layanan_pendaftaran');

        $cek_resep = $this->db->select('count(*) as count')->from('sm_resep')->where('id_layanan_pendaftaran', $id_layanan_pendaftaran, true)->get()->row()->count;
        if (safe_post('tanpa_resep') !== 'Ya' && $cek_resep < 1) :
            $response = array(
                'id_pendaftaran'         => $id_pendaftaran,
                'id_layanan_pendaftaran' => $id_layanan_pendaftaran,
                'status'                 => false,
                'message'                => "Pasien <b>Belum</b> menerima resep <br> Apakah anda yakin akan men-checkout pasien ?",
            );

            echo json_encode($response);
            die;
        endif;

        $layanan_pendaftaran = $this->db->select('tindak_lanjut')->get_where('sm_layanan_pendaftaran', array('id' => $id_layanan_pendaftaran))->row();
        if (0 < count((array)$layanan_pendaftaran) && $layanan_pendaftaran->tindak_lanjut !== NULL) :
            $response = array(
                'status'  => false,
                'message' => 'Pasien sudah keluar',
            );
            echo json_encode($response);
            die;
        endif;
        // Update Data Tindak Lanjut / Checkout
        $data = array(
            'tindak_lanjut' => safe_post('tindak_lanjut'),
            'kondisi'       => safe_post('kondisi_keluar')
        );
        $this->m_pelayanan->updateTindakLanjut($id_layanan_pendaftaran, $data);

        if ($data['tindak_lanjut'] === 'Pulang' | $data['tindak_lanjut'] === 'Pulang APS' | $data['tindak_lanjut'] === 'Atas Izin Dokter' | $data['tindak_lanjut'] === 'Pulang Paksa' | $data['tindak_lanjut'] === 'Melarikan Diri' | $data['tindak_lanjut'] === 'Perujuk') :
            $pindah_ipj = safe_post('pindah_ipj');
            // Update Data Tindak Lanjut di Table Pendaftaran
            $pendaftaran = array(
                'tanggal_keluar' => $this->datetime,
                'kondisi_keluar' => $this->post('kondisi_keluar')
            );
            $this->db->where('id', $id_pendaftaran)->update('sm_pendaftaran', $pendaftaran);
            $message = 'Berhasil mengubah status pasien menjadi Pulang / Pulang APS';
        else :
            if ($data['tindak_lanjut'] === 'RS Lain') :
                $pendaftaran = array(
                    'tanggal_keluar'      => $this->datetime,
                    'kondisi_keluar'      => safe_post('kondisi_keluar'),
                    'id_instansi_merujuk' => safe_post('instansi_rujukan') ?: NULL,
                    'nadis_merujuk' => safe_post('dokter') ?: NULL,
                    'keterangan_rujukan' => safe_post('keterangan_rujukan') ?: NULL
                );
                $this->db->where('id', $id_pendaftaran)->update('sm_pendaftaran', $pendaftaran);
                $message = 'Berhasil merujuk pasien ke RS Lain';
            else :
                if ($data['tindak_lanjut'] === 'IGD') :
                    $data_layanan_pendaftaran = array(
                        'id_pendaftaran' => $id_pendaftaran,
                        'tanggal_layanan' => $this->datetime,
                        'jenis_layanan'  => $data['tindak_lanjut'],
                        'kondisi'        => safe_post('kondisi_keluar'),
                        'resusitasi'     => 0,
                        'cara_bayar'     => 'Tunai',
                        'id_users'       => $this->session->userdata('id_translucent')
                    );
                    $this->load->model('pendaftaran/Pendaftaran_model', 'pendaftaran');
                    $this->pendaftaran->simpanDataLayananPendaftaran($data_layanan_pendaftaran);

                    $update_pendaftaran = array(
                        'jenis_igd' => safe_post('jenis_igd')
                    );
                    $this->db->where('id', $id_pendaftaran, true)->update('sm_pendaftaran', $update_pendaftaran);
                    $message = 'Berhasil memindahkan pasien ke pelayanan ' . $data["tindak_lanjut"];
                // jika pasien tindak lanjut nya pemulasaran jenazah
                else :
                    if ($data['tindak_lanjut'] === 'Pemulasaran Jenazah') :
                        $data_layanan_pendaftaran = array(
                            'id_pendaftaran' => $id_pendaftaran,
                            'tanggal_layanan' => $this->datetime,
                            'jenis_layanan'  => $data['tindak_lanjut'],
                            'kondisi'        => $this->post('kondisi_keluar'),
                            'resusitasi'     => 0,
                            'cara_bayar'     => 'Tunai',
                            'id_users'       => $this->session->userdata('id_translucent')
                        );
                        $this->load->model('pendaftaran/Pendaftaran_model', 'pendaftaran');
                        $this->pendaftaran->simpanDataLayananPendaftaran($data_layanan_pendaftaran);

                        $message = 'Berhasil memindahkan pasien ke pelayanan ' . $data["tindak_lanjut"];
                    endif;
                endif;
            endif;
        endif;

        $this->load->model('satu_sehat/Satu_sehat_model', 'sehat');

        $cekOnOff = $this->sehat->cekSatuSehatOnOff();

        if($cekOnOff->onoff === '1'){

            $this->m_pelayanan->integrasiTindakLanjut($id_layanan_pendaftaran, $data);

        }

        // get id_pasien di sm_pendaftaran
        $pasien = $this->db->select('id_pasien')->get_where('sm_pendaftaran', array('id' => $id_pendaftaran))->row();
        if (safe_post('kondisi_keluar') === 'Meninggal' | safe_post('kondisi_keluar') === 'Meninggal < 48 Jam' | safe_post('kondisi_keluar') === 'Meninggal > 48 Jam') :
            // update table sm_profil_pasien -> is_died = Ya
            $this->db->where('id_pasien', $pasien->id_pasien)->update('sm_profil_pasien', array('is_died' => 'Ya'));
        endif;


        if ($jenis === 'Inap') :
            $this->m_pelayanan->dischargeToIntensiveCare($id_layanan_pendaftaran);
            if ($data['tindak_lanjut'] === 'Pulang' | $data['tindak_lanjut'] === 'Pulang APS' | $data['tindak_lanjut'] === 'Atas Izin Dokter' | $data['tindak_lanjut'] === 'Pulang Paksa' | $data['tindak_lanjut'] === 'Melarikan Diri' | $data['tindak_lanjut'] === 'Perujuk' | $data['tindak_lanjut'] === 'Pemulasaran Jenazah') :
                $this->m_pelayanan->insertAdministrasiIntensiveCare($id_pendaftaran, $id_layanan_pendaftaran);
            endif;
        endif;

        if ($data['tindak_lanjut'] === 'Rawat Inap') :
            $add = array(
                'waktu'                  => $this->datetime,
                'id_pendaftaran'         => $id_pendaftaran,
                'id_layanan_pendaftaran' => $id_layanan_pendaftaran,
                'id_dokter'              => safe_post('dokter') !== '' ? safe_post('dokter') : NULL,
                'id_dokter_dpjp'         => safe_post('dokter_dpjp') !== '' ? safe_post('dokter_dpjp') : NULL,
                'id_bangsal_tujuan'      => safe_post('bangsal') !== '' ? safe_post('bangsal') : NULL,
                'is_pindah_ruang'        => safe_post('pindah_ruang') !== '' ?  safe_post('pindah_ruang') : 0
            );
            $status_order_ranap = $this->m_pelayanan->simpanOrderRawatInap($add);
        endif;

        //intensive care
        if ($data['tindak_lanjut'] === 'Intensive Care') :
            $add = array(
                'waktu'                  => $this->datetime,
                'id_pendaftaran'         => $id_pendaftaran,
                'id_layanan_pendaftaran' => $id_layanan_pendaftaran,
                'id_dokter'              => safe_post('dokter') !== '' ? safe_post('dokter') : NULL,
                'id_dokter_dpjp'         => safe_post('dokter_dpjp') !== '' ? safe_post('dokter_dpjp') : NULL

            );
            $status_order_icare = $this->m_pelayanan->simpanOrderIntensiveCare($add);

        endif;

        //Kebidanan
        if ($data['tindak_lanjut'] === 'Kebidanan') :
            $add = array(
                'waktu'                     => $this->datetime,
                'id_pendaftaran'            => $id_pendaftaran,
                'id_layanan_pendaftaran'    => $id_layanan_pendaftaran,
                'id_dokter'                 => safe_post('dokter') !== '' ? safe_post('dokter') : NULL,
                'id_dokter_dpjp'            => safe_post('dokter_dpjp') !== '' ? safe_post('dokter_dpjp') : NULL,
                'id_bangsal_tujuan'         => safe_post('bangsal') !== '' ? safe_post('bangsal') : NULL,
                'is_pindah_ruang'           => safe_post('pindah_ruang') !== '' ?  safe_post('pindah_ruang') : 0
            );
            $status_order_kebidanan = $this->m_pelayanan->simpanOrderKebidanan($add);
        endif;

        $this->m_pelayanan->insertResumeDiagnosa($id_pendaftaran);


        if ($this->db->trans_status() === false) :
            $this->db->trans_rollback();
            $status  = false;
            $message = "Gagal mengubah status keluar pasien";
        else :
            $this->db->trans_commit();
            $status = true;

            if ($status_order_icare) :
                $status = true;
                $message = "Berhasil men-checkout pasien";
            else :
                $status = false;
                $message = "Gagal memindahkan pasien ke Intensive Care, pasien masih dalam status order intensive care";
            endif;

            $vclaim = NULL;
            if ($jenis === "Inap" && $data['tindak_lanjut'] === 'Pulang' | $data['tindak_lanjut'] === 'Pulang APS' | $data['tindak_lanjut'] === 'Atas Izin Dokter' | $data['tindak_lanjut'] === 'Pulang Paksa' | $data['tindak_lanjut'] === 'Melarikan Diri' | $data['tindak_lanjut'] === 'Perujuk' | $data['tindak_lanjut'] === 'Pemulasaran Jenazah') :
                $vclaim = $this->updateTanggalPulangSEP($id_pendaftaran);
            endif;

        endif;

        $this->load->model('logs/Logs_model', 'm_logs');
        $this->m_logs->recordAdminLogs($id_layanan_pendaftaran, 'Status Keluar ' . $data['tindak_lanjut']);
        $response = array('status' => $status, 'token' => $this->security->get_csrf_hash(), 'message' => $message);
        $this->response($response, REST_Controller::HTTP_OK);
    }

    function pembatalan_status_keluar_get()
    {
        if (!$this->get('id_pendaftaran') & !$this->get('id_layanan_pendaftaran')) :
            $this->response(NULL, REST_Controller::HTTP_BAD_REQUEST);
        endif;
        $id_pendaftaran         = $this->get('id_pendaftaran');
        $id_layanan_pendaftaran = $this->get('id_layanan_pendaftaran');
        $response = $this->m_pelayanan->pembatalanStatusKeluar($id_pendaftaran, $id_layanan_pendaftaran);
        $this->load->model('logs/Logs_model', 'm_logs');
        $this->m_logs->recordAdminLogs($id_layanan_pendaftaran, 'Batal Status keluar ' . $response['tindak_lanjut']);
        $this->response($response, REST_Controller::HTTP_OK);
    }

    function pembatalan_status_keluar_icare_get()
    {
        if (!$this->get('id_pendaftaran') & !$this->get('id_layanan_pendaftaran')) :
            $this->response(NULL, REST_Controller::HTTP_BAD_REQUEST);
        endif;
        $id_pendaftaran         = $this->get('id_pendaftaran');
        $id_layanan_pendaftaran = $this->get('id_layanan_pendaftaran');
        $response = $this->m_pelayanan->pembatalanStatusKeluarIcare($id_pendaftaran, $id_layanan_pendaftaran);
        $this->load->model('logs/Logs_model', 'm_logs');
        $this->m_logs->recordAdminLogs($id_layanan_pendaftaran, 'Batal Status keluar ' . $response['tindak_lanjut']);
        $this->response($response, REST_Controller::HTTP_OK);
    }

    function pembatalan_konsul_klinik_get()
    {
        if (!$this->get('id_pendaftaran') & !$this->get('id_layanan_pendaftaran')) :
            $this->response(NULL, REST_Controller::HTTP_BAD_REQUEST);
        endif;
        $id_pendaftaran         = $this->get('id_pendaftaran');
        $id_layanan_pendaftaran = $this->get('id_layanan_pendaftaran');
        $jenis = safe_get('jenis_layanan');
        // var_dump($id_pendaftaran);die;

        $layanan_pendaftaran_last = $this->db->get_where('sm_layanan_pendaftaran', ['id' => $id_layanan_pendaftaran])->row();
        $this->m_pelayanan->ubahJadwalDokterKuota(
            'kurang',
            date('Y-m-d', strtotime($layanan_pendaftaran_last->tanggal_layanan)),
            $layanan_pendaftaran_last->id_unit_layanan,
            $layanan_pendaftaran_last->id_dokter
        );

        $response = $this->m_pelayanan->pembatalanKonsulKlinik($id_pendaftaran, $id_layanan_pendaftaran);

        // TAMBAHAN WAHYU
        if ($response) :
            $dataDiagnosa = $this->db->get_where('sm_diagnosa', ['id_layanan_pendaftaran' => $id_layanan_pendaftaran])->result();
            $dataTindakan = $this->db->get_where('sm_tarif_tindakan_pasien', ['id_layanan_pendaftaran' => $id_layanan_pendaftaran])->result();

            // Mapping jenis layanan
            $jenisMapping = [
                'Poliklinik' => 'Tindakan',
                'Rawat Inap' => 'Rawat Inap',
                'Intensive Care' => 'Intensive Care',
                'Pemulasaran Jenazah' => 'Pemulasaran Jenazah',
            ];
            $jenis = $jenisMapping[$jenis] ?? 'Tindakan'; // Default ke "Tindakan"

            // Hapus data diagnosa
            if (!empty($dataDiagnosa)) {
                foreach ($dataDiagnosa as $value) {
                    $this->m_pelayanan->deleteDiagnosaPemeriksaan($value->id);
                }
            }

            // Hapus data tindakan
            if (!empty($dataTindakan)) {
                foreach ($dataTindakan as $value) {
                    $this->m_pelayanan->deleteTindakanPemeriksaan($value->id, $jenis);
                }
            }
        endif;
        // END TAMBAHAN WAHYU

        $this->load->model('logs/Logs_model', 'm_logs');
        $this->m_logs->recordAdminLogs($id_layanan_pendaftaran, 'Batal Konsul Klinik ' . $response);
        $this->response($response, REST_Controller::HTTP_OK);
    }

    function updateTanggalPulangSEP($id_pendaftaran)
    {
        $this->db->select('pd.no_sep')->from('sm_pendaftaran as pd')->where('pd.id', $id_pendaftaran, true)->where('pd.no_sep is not null');
        $layanan = $this->db->get()->row();
        $result = NULL;
        if ($layanan) :
            $no_sep = $layanan->no_sep;
            $data = array('no_sep' => $no_sep, 'tanggal_pulang' => date('d/m/Y'), 'user' => $this->session->userdata('account'));
            $result = postCurl(base_url() . URL_VCLAIM . "update_tgl_pulang_sep", http_build_query($data));
        endif;

        return $result;
    }

    function get_item_laboratorium_get()
    {
        if (!$this->get('id_layanan') | $this->get('id_layanan') === '') {
            $response = array('status' => false, 'message' => 'Kesalahan aplikasi, parameter kurang lengkap');
            $this->response($response, 200);
        }
        $id_layanan = $this->get('id_layanan');
        $message = 'OK';
        $data = $this->m_pelayanan->get_item_laboratorium_by_layanan($id_layanan);
        if (sizeof($data) < 1) {
            $message = 'Tarif laboratorium yang dipilih belum mempunyai item pemeriksaan.<br/>Hubungi administrator untuk meminta penambahan item pemeriksaan';
        }
        $response = array('status' => true, 'message' => $message, 'data' => $data);
        $this->response($response, 200);
    }

    private function mulai($page)
    {
        return (($page - 1) * $this->batas);
    }

    function tarif_pelayanan_get()
    {
        $q = safe_get('q');
        $page = safe_get('page');
        $jenis_pemeriksaan = safe_get('jenis_pemeriksaan'); // Tetap menangani jenis_pemeriksaan
        $tipePeriksa = safe_get('jenis_lab'); // Tambahkan parameter jenis_lab
        if($tipePeriksa === '293'){

            $jenisLab =  'Patologi Anatomi';

        } else if($tipePeriksa === '298'){

            $jenisLab =  'MIKROBIOLOGI';

        } else {

            $jenisLab =  'Patologi Klinik';

        }
        
        $kelas = safe_get('kelas');
        $jenis_tindakan = safe_get('jenis_tindakan');
        $start = $this->mulai($page);
        $data = $this->m_pelayanan->getAutoTarifPelayanan($q, $jenis_pemeriksaan, $jenis_tindakan, $jenisLab, $kelas, $start, $this->batas);

        if ((safe_get('page') == 1) && ($q == '')) :
            $pilih[] = array(
                'id' => '', 
                'layanan' => '', 
                'instalasi' => '', 
                'jenis' => '', 
                'bobot' => '', 
                'total' => '', 
                'kelas' => '', 
            );

            $data['data'] = array_merge($pilih, $data['data']);
            $data['total'] += 1;
        endif;
        $this->response($data, REST_Controller::HTTP_OK);
        
    }

    function order_laboratorium_post()
    {
        $status = true;
        $message = "";
        $id_layanan_pendaftaran = $this->post('id_layanan');
        $item_post = $this->post('tindakan_lab');
        $cito = $this->post('cito');
        $item_lab = $this->post('item_lab');
        $item_lab_label = $this->post('item_lab_label');
        $sql = "select lp.*, pj.diskon
                from sm_layanan_pendaftaran lp
                left join sm_penjamin pj on (pj.id = lp.id_penjamin)
                where lp.id = '" . $id_layanan_pendaftaran . "' ";
        $layanan_pendaftaran = $this->db->query($sql)->row();

        if (0 < count((array)$layanan_pendaftaran)) {
            $arr_item = array();
            if (is_array($item_post)) {
                foreach ($item_post as $key => $value) {
                    if ($value !== '') {
                        $arr_item[$key]['layanan'] = $value;
                        $arr_item[$key]['cito'] = $cito[$key];
                        $arr_item[$key]['item_lab'] = $item_lab[$key];
                        $arr_item[$key]['item_lab_label'] = $item_lab_label[$key];
                    }
                }

                if (is_array($arr_item)) {
                    $item = "[";
                    foreach ($arr_item as $key => $value) {
                        if ($value !== '') {
                            $cek = $this->m_pelayanan->cek_penjaminan_tarif($value['layanan'], $layanan_pendaftaran->id_penjamin);
                            $penjamin = 0;
                            if (0 < $cek) {
                                $penjamin = $layanan_pendaftaran->id_penjamin;
                            }
                            $item .= "{\"item\":\"" . $value['layanan'] . "\",\"penjamin\":\"" . $penjamin . "\",\"cito\":\"" . $value['cito'] . "\", \"item_lab\":" . ($value['item_lab'] !== "" ? $value['item_lab'] : "[]") . " , \"item_lab_label\":\"" . $value['item_lab_label'] . "\"}";
                            if ($key < sizeof($arr_item) - 1) {
                                $item .= ",";
                            }
                        }
                    }
                    $item .= "]";

                    date_default_timezone_set('Asia/Jakarta');
                    $request = array(
                        'id_layanan_pendaftaran' => (int)$this->post('id_layanan'),
                        'id_dokter' => $this->post('dokter') !== '' & $this->post('dokter') !== 'none' ? (int)$this->post('dokter') : 'NULL',
                        'waktu_order' => "'" . date('Y-m-d H:i:s') . "'",
                        'jenis' => "'" . $this->post('jenis') . "'",
                        'status' => "'request'",
                        'item' => "'" . $item . "'"
                    );
                    $this->m_pelayanan->add_order_laboratorium($request);
                    $status = true;
                    $message = "Berhasil order laboratorium";
                } else {
                    $status = false;
                    $message = "Gagal order laboratorium, anda belum memilih item pemerikaan";
                }
            } else {
                $status = false;
                $message = "Gagal order laboratorium, anda belum memilih item pemerikaan";
            }
        } else {
            $status = false;
            $message = "Gagal order laboratorium, Kesalahan sistem.<br/>Ulangi transaksi dan mohon segera hubungi admin";
        }
        $response = array("status" => $status, "message" => $message);
        $this->response($response, 200);
    }

    function curlLAB_get()
    {

        if (!$this->get('ono') && !$this->get('id_lab')) :
            $this->response(NULL, REST_Controller::HTTP_BAD_REQUEST);
        endif;
        $id_ono         = $this->get('ono');
        $id_lab         = $this->get('id_lab');

        $this->load->model('hasil_laboratorium/Hasil_laboratorium_model', 'm_hasil_laboratorium');
        $detail_lab = $this->m_hasil_laboratorium->getDetailLaboratorium($id_lab);
        $status_lis = $detail_lab->status_lis;

        $this->load->library('Curl');
        $ch = curl_init();
        curl_setopt_array($ch, array(
            CURLOPT_URL => $this->url . '/api/result/ono/' . $id_ono . '/view/',
            CURLOPT_RETURNTRANSFER => true,
            CURLOPT_USERAGENT => 'Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.8.1.13) Gecko/20080311 Firefox/2.0.0.13',
            CURLOPT_ENCODING => "",
            CURLOPT_MAXREDIRS => 10,
            CURLOPT_TIMEOUT => 120,
            CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
            CURLOPT_CUSTOMREQUEST => "GET",
            CURLOPT_HTTPHEADER => array(
                'x-username: ' . $this->user . '',
                'x-password: ' . $this->pass . ''
            ),
        ));

        $response = curl_exec($ch);

        if ($response === false) {

            curl_close($ch); // close cURL handler

            $status = false;
            $message = "Gagal Menghubungi LIS";
            $respon = 503;

            if ($status_lis === "1") {

                $data_lab = $this->m_hasil_laboratorium->getItemDetailLaboratorium($id_lab);
                $data_response = $data_lab;
            } else {

                $data_response = null;
            }
        } else {

            $response_getinfo = curl_getinfo($ch, CURLINFO_RESPONSE_CODE);

            if ($response_getinfo === 200) {

                $respon = 200;
                $status = true;
                $message = "Berhasil melakukan permintaan Laboratorium ke LIS";
                $data_laboratorium = json_decode($response);

                $gabung_item = array();

                foreach ($data_laboratorium->detail as $j => $key) {

                    $gabung_item[$j]['flag'] = $key->flag;
                    $gabung_item[$j]['order_testnm'] = $key->order_testnm;
                    $gabung_item[$j]['test_comment'] = $key->test_comment;
                    $gabung_item[$j]['test_cd'] = $key->test_cd;
                    $gabung_item[$j]['test_group'] = $key->test_group;
                    $gabung_item[$j]['nama'] = $this->m_hasil_laboratorium->getDataItemPemeriksaan($key->test_cd);
                    $gabung_item[$j]['result_value'] = $key->result_value;
                    $gabung_item[$j]['ref_range'] = $key->ref_range;
                    $gabung_item[$j]['unit'] = $key->unit;
                    $gabung_item[$j]['disp_seq'] = $key->disp_seq;
                }

                $data_response = $gabung_item;

                curl_close($ch);
            } else {

                curl_close($ch);
                $status = false;
                $message = "Data Belum Tersedia";
                $respon = 404;
                $data_response = '';
            }
        }

        $data = array("response" => $data_response, "status" => $status, "message" => $message);
        $this->response($data, $respon);
    }

    function daftarLAB_post()
    {
        $status = true;
        $message = "";


        $id_layanan_pendaftaran = $this->post('id_layanan');
        $n_sql = "select pas.*, sp.nama as dokt_name, lp.jenis_layanan, p.jenis_rawat, p.id_pasien as rm_pasien
            from sm_layanan_pendaftaran lp
            left join sm_pendaftaran p on (p.id = lp.id_pendaftaran) 
            left join sm_tenaga_medis tm on (tm.id = lp.id_dokter) 
            left join sm_pegawai sp on (sp.id = tm.id_pegawai) 
            left join sm_pasien pas on (p.id_pasien = pas.id) 
            where lp.id = '" . $id_layanan_pendaftaran . "' ";
        $n_pendaftaran = $this->db->query($n_sql)->row();

        $sql = "select lp.*, pj.diskon
            from sm_layanan_pendaftaran lp
            left join sm_penjamin pj on (pj.id = lp.id_penjamin)
            where lp.id = '" . $id_layanan_pendaftaran . "' ";
        $layanan_pendaftaran = $this->db->query($sql)->row();

        if (0 < count((array)$layanan_pendaftaran)) {

            date_default_timezone_set('Asia/Jakarta');

            $request = array(
                'id_layanan_pendaftaran' => (int)$this->post('id_layanan'),
                'waktu_order' => "'" . date('Y-m-d H:i:s') . "'",
                'status' => "'request'",
            );
            $order_id = $this->m_pelayanan->daftar_order_lab($request);

            $no_rm = $n_pendaftaran->rm_pasien;
            $nomer_urut = $no_rm . '' . $order_id;
            $ono_request = array(

                'ono'  => "" . $nomer_urut . ""
            );

            $this->m_pelayanan->update_order_laboratorium($ono_request, $order_id);

            $respon = 201;
            $status = true;
            $message = "Berhasil Order Laboratorium";
        } else {

            $respon = 404;
            $status = false;
            $message = "Gagal order laboratorium";
        }

        $data = array("status" => $status, "message" => $message);
        $this->response($data, $respon);
    }

    function updateOrderLab_post()
    {

        $this->db->trans_begin();

        $status = true;
        $message = "";
        $cito = $this->post('cito');
        $itemPost = $this->post('tindakan_lab');
        $itemLab = $this->post('item_lab');
        $itemLabLabel = $this->post('item_lab_label');
        $keterangan = $this->post('keterangan');

        $idLayananPendaftaran = (int)$this->post('id_layanan');

        $idOrder = (int)$this->post('id_order');

        $sql = "select lp.*, pj.diskon
            from sm_layanan_pendaftaran lp
            left join sm_penjamin pj on (pj.id = lp.id_penjamin)
            where lp.id = '" . $idLayananPendaftaran . "' ";
        $layananPendaftaran = $this->db->query($sql)->row();

        $nSql = "select ol.id as id_lab, status, item
                    from sm_order_laboratorium ol
                    where ol.id = " . $idOrder . " ";
        $orderLab = $this->db->query($nSql)->row();

        if (is_object($orderLab)) {

            if (isset($orderLab->status)) {

                if ($orderLab->status === 'request') {

                    $arrItem = array();
                    if (is_array($itemPost)) {

                        foreach ($itemPost as $key => $value) {
                            if ($value !== '') {
                                $arrItem[$key]['layanan'] = $value;
                                $arrItem[$key]['cito'] = $cito[$key];
                                $arrItem[$key]['item_lab'] = $itemLab[$key];
                                $arrItem[$key]['item_lab_label'] = $itemLabLabel[$key];
                                $arrItem[$key]['keterangan'] = $keterangan[$key];
                            }
                        }

                        if (is_array($arrItem)) {
                            $item = "[";
                            foreach ($arrItem as $key => $value) {
                                if ($value !== '') {
                                    $cek = $this->m_pelayanan->cekPenjaminanTarif($value['layanan'], (int)$layananPendaftaran->id_penjamin);
                                    $penjamin = 0;
                                    $angkaCek = (int)$cek->jumlah;
                                    if (0 < $angkaCek) {
                                        $penjamin = $layananPendaftaran->id_penjamin;
                                    }

                                    $item .= "{\"item\":\"" . $value['layanan'] . "\",\"penjamin\":\"" . $penjamin . "\",\"cito\":\"" . $value['cito'] . "\",\"item_lab\":" . ($value['item_lab'] !== "" ? $value['item_lab'] : "[]") . ",\"item_lab_label\":\"" . $value['item_lab_label'] . "\",\"keterangan\":\"" . $value['keterangan'] . "\"}";
                                    if ($key < sizeof($arrItem) - 1) {
                                        $item .= ",";
                                    }
                                }
                            }

                            $item .= "]";

                            $request = array(
                                'item' => $item
                            );

                            $this->db->where('id', $idOrder)->update('sm_order_laboratorium', $request);

                            if ($this->db->trans_status() === FALSE) :
                                $this->db->trans_rollback();
                                $status = FALSE;
                            else :
                                $this->db->trans_commit();
                                $status = TRUE;
                            endif;

                            $decode = ["metaData" => ["code" => 200, "message" => "Update Item Laboratium Berhasil"]];

                            $this->response($decode, REST_Controller::HTTP_OK);
                        }
                    }
                } else {

                    $decode = ["metaData" => ["code" => 201, "message" => 'Status Order Laboratium sudah terkonfirmasi, harap membuat order yang baru']];

                    if ($this->db->trans_status() === FALSE) :
                        $this->db->trans_rollback();
                        $status = FALSE;
                    else :
                        $this->db->trans_commit();
                        $status = TRUE;
                    endif;

                    die(json_encode($decode));
                }
            } else {

                $decode = ["metaData" => ["code" => 201, "message" => 'Tidak Ada Data']];

                if ($this->db->trans_status() === FALSE) :
                    $this->db->trans_rollback();
                    $status = FALSE;
                else :
                    $this->db->trans_commit();
                    $status = TRUE;
                endif;

                die(json_encode($decode));
            }
        } else {

            $decode = ["metaData" => ["code" => 201, "message" => 'Tidak Ada Data Order Laboratorium']];

            if ($this->db->trans_status() === FALSE) :
                $this->db->trans_rollback();
                $status = FALSE;
            else :
                $this->db->trans_commit();
                $status = TRUE;
            endif;

            die(json_encode($decode));
        }
    }

    function postLab_post()
    {
        $this->load->library('Curl');

        $status = true;
        $message = "";
        $cito = $this->post('cito');
        $item_post = $this->post('tindakan_lab');
        $item_lab = $this->post('item_lab');
        $item_lab_label = $this->post('item_lab_label');
        $keterangan = $this->post('keterangan');
        $jenis_lab = $this->post('jenis_lab');



        $id_layanan_pendaftaran = $this->post('id_layanan');
        $n_sql = "select pas.*, sp.nama as dokt_name, lp.jenis_layanan, p.jenis_rawat, p.id_pasien as rm_pasien
            from sm_layanan_pendaftaran lp
            left join sm_pendaftaran p on (p.id = lp.id_pendaftaran) 
            left join sm_tenaga_medis tm on (tm.id = lp.id_dokter) 
            left join sm_pegawai sp on (sp.id = tm.id_pegawai) 
            left join sm_pasien pas on (p.id_pasien = pas.id) 
            where lp.id = '" . $id_layanan_pendaftaran . "' ";
        $n_pendaftaran = $this->db->query($n_sql)->row();

        $sql = "select lp.*, pj.diskon
            from sm_layanan_pendaftaran lp
            left join sm_penjamin pj on (pj.id = lp.id_penjamin)
            where lp.id = '" . $id_layanan_pendaftaran . "' ";
        $layanan_pendaftaran = $this->db->query($sql)->row();

        if (0 < count((array)$layanan_pendaftaran)) {

            $arr_item = array();
            if (is_array($item_post)) {

                foreach ($item_post as $key => $value) {
                    if ($value !== '') {
                        $arr_item[$key]['layanan'] = $value;
                        $arr_item[$key]['cito'] = $cito[$key];
                        $arr_item[$key]['item_lab'] = $item_lab[$key];
                        $arr_item[$key]['item_lab_label'] = $item_lab_label[$key];
                        $arr_item[$key]['keterangan'] = $keterangan[$key];
                        $arr_item[$key]['jenis_lab'] = $jenis_lab[$key];
                    }
                }

                if (is_array($arr_item)) {
                    $item = "[";
                    foreach ($arr_item as $key => $value) {
                        if ($value !== '') {
                            $cek = $this->m_pelayanan->cek_penjaminan_tarif($value['layanan'], $layanan_pendaftaran->id_penjamin);
                            $penjamin = 0;
                            if (0 < $cek) {
                                $penjamin = $layanan_pendaftaran->id_penjamin;
                            }

                            $item .= "{\"item\":\"" . $value['layanan'] . "\",\"penjamin\":\"" . $penjamin . "\",\"cito\":\"" . $value['cito'] . "\", \"item_lab\":" . ($value['item_lab'] !== "" ? $value['item_lab'] : "[]") . " , \"item_lab_label\":\"" . $value['item_lab_label'] . "\", \"keterangan\":\"" . $value['keterangan'] . "\"}";
                            if ($key < sizeof($arr_item) - 1) {
                                $item .= ",";
                            }
                        }
                    }
                    $item .= "]";

                    date_default_timezone_set('Asia/Jakarta');

                    $request = array(
                        'id_layanan_pendaftaran' => (int)$this->post('id_layanan'),
                        'id_dokter' => $this->post('dokter') !== '' & $this->post('dokter') !== 'none' ? (int)$this->post('dokter') : 'NULL',
                        'waktu_order' => "'" . date('Y-m-d H:i:s') . "'",
                        'jenis' => "'" . $value['jenis_lab'] . "'",
                        'keterangan' => "'" . $value['keterangan'] . "'",
                        'status' => "'request'",
                        'item' => "'" . $item . "'"
                    );

                    $this->m_pelayanan->add_order_laboratorium($request);
                    $status = true;
                    $message = "Berhasil order laboratorium";

                    $get_lab = "select ol.id as id_lab
                    from sm_order_laboratorium ol
                    where ol.id_layanan_pendaftaran = '" . $id_layanan_pendaftaran . "' and ol.ono is null";
                    $order_lab = $this->db->query($get_lab)->row();
                    $no_rm = $n_pendaftaran->rm_pasien;
                    $nomer_urut = $no_rm . '' . $order_lab->id_lab;
                    $ono_request = array(

                        'ono'  => "" . $nomer_urut . ""
                    );

                    $this->m_pelayanan->update_order_laboratorium($ono_request, $order_lab->id_lab);

                    $respon = 201;
                    $status = true;
                    $message = "Berhasil memperbaharui Nomor ONO";
                } else {

                    $respon = 404;
                    $status = false;
                    $message = "Gagal order laboratorium, anda belum memilih item pemerikaan";
                }
            } else {
                $respon = 404;
                $status = false;
                $message = "Gagal order laboratorium, anda belum memilih item pemerikaan";
            }
        } else {

            $respon = 404;
            $status = false;
            $message = "Gagal order laboratorium, anda belum memilih item pemerikaan";
        }

        $data = array("status" => $status, "message" => $message);
        $this->response($data, $respon);
    }

    function postUlangLIS_post()
    {
        $this->load->library('Curl');

        $dokter_pjwb = $this->post('dokter_pjwb');

        $id_order_lab = $this->post('id_order_lab');
        $id_layanan_pendaftaran = $this->post('id_layanan');
        $n_sql = "select pas.*, concat_ws(' ', pas.no_rumah, concat('Rt.', pas.no_rt, '/', pas.no_rw), pas.nama_kel, pas.nama_kec, pas.nama_kab, pas.nama_prop, pas.kode_pos) as alamat_tambahan, sp.nama as dokt_name, lp.jenis_layanan, p.jenis_rawat, p.id_pasien as rm_pasien, gss.nama as diagnosis, pj.nama as penjamin, dg.golongan_sebab_sakit_lain as sebab_sakit, lp.cara_bayar
            from sm_layanan_pendaftaran lp
            left join sm_pendaftaran p on (p.id = lp.id_pendaftaran) 
            left join sm_penjamin pj on (pj.id = lp.id_penjamin) 
            left join sm_diagnosa dg on (dg.id_layanan_pendaftaran = lp.id)
            left join sm_golongan_sebab_sakit as gss on (gss.id = dg.id_golongan_sebab_sakit)
            left join sm_tenaga_medis tm on (tm.id = lp.id_dokter) 
            left join sm_pegawai sp on (sp.id = tm.id_pegawai) 
            left join sm_pasien pas on (p.id_pasien = pas.id) 
            where lp.id = '" . $id_layanan_pendaftaran . "' ";
        $n_pendaftaran = $this->db->query($n_sql)->row();

        $get_pjwb = "select sp.nip
            from sm_tenaga_medis tm 
            left join sm_pegawai sp on (sp.id = tm.id_pegawai) 
            where tm.id = '" . $dokter_pjwb . "' ";
        $n_pjwb = $this->db->query($get_pjwb)->row();

        if (isset($n_pendaftaran->diagnosis)) {

            $sebab_sakit_lain = $n_pendaftaran->diagnosis;
        } else {

            $s_sebab = substr($n_pendaftaran->sebab_sakit, 0, 100);

            if (is_string($s_sebab)) {

                $sebab_sakit_lain = $s_sebab;
            } else {

                $sebab_sakit_lain = null;
            }
        }

        if ($sebab_sakit_lain === null | $sebab_sakit_lain === '') {

            if ($n_pendaftaran->jenis_layanan === 'Laboratorium') {

                $cekDiagnosa = true;
            } else {

                $cekDiagnosa = false;
            }
        } else {

            $cekDiagnosa = true;
        }

        if ($cekDiagnosa === true) {

            if (0 < count((array)$n_pendaftaran)) {

                $order_lab = $this->m_pelayanan->get_order_laboratorium($id_order_lab);

                if ($order_lab !== null) {
                    $get_order_value = json_decode($order_lab->item);

                    if (is_array($get_order_value)) {

                        $alamat = substr($n_pendaftaran->alamat, 50, 50);

                        if (is_string($alamat)) {

                            $max_alamat = substr($n_pendaftaran->alamat, 0, 50);
                            $max_alamat_satu = $alamat;
                        } else {

                            $alamat_utama = strlen(substr($n_pendaftaran->alamat, 0, 50));

                            $hitung_alamat = 50 - $alamat_utama;

                            $alternatif_alamat = $n_pendaftaran->alamat_tambahan;

                            if ($hitung_alamat > 0) {

                                if (($hitung_alamat > 0 || $hitung_alamat < 0) && $hitung_alamat < 2) {

                                    $hitung_ulang_a = 0;
                                } else {

                                    $hitung_ulang_a = $hitung_alamat - 2;
                                }

                                $alamat_awal = substr($n_pendaftaran->alamat, 0, 50);

                                $satu_alamat = substr($alternatif_alamat, 0, ($hitung_ulang_a));

                                $max_alamat = $alamat_awal . ' ' . $satu_alamat;

                                $hitung_satu_alamat = strlen($satu_alamat);

                                $max_alamat_satu = substr($n_pendaftaran->alamat_tambahan, $hitung_satu_alamat, 50);
                            } else {

                                $max_alamat = substr($n_pendaftaran->alamat, 0, 50);

                                $opsi_alamat = substr($alternatif_alamat, 0, 50);

                                if (is_string($opsi_alamat)) {

                                    $max_alamat_satu = $opsi_alamat;
                                } else {

                                    $max_alamat_satu = null;
                                }
                            }
                        }

                        if (isset($n_pendaftaran->penjamin)) {

                            $penjamin = $n_pendaftaran->penjamin;
                        } else {

                            $penjamin = $n_pendaftaran->cara_bayar;
                        }

                        if (isset($n_pendaftaran->diagnosis)) {

                            $sebab_sakit_lain = $n_pendaftaran->diagnosis;
                        } else {

                            $s_sebab = substr($n_pendaftaran->sebab_sakit, 0, 100);

                            if (is_string($s_sebab)) {

                                $sebab_sakit_lain = $s_sebab;
                            } else {

                                $sebab_sakit_lain = null;
                            }
                        }

                        $t_lahir = str_replace("-", "", $n_pendaftaran->tanggal_lahir);
                        $j_kel = $n_pendaftaran->kelamin;

                        if ($j_kel === 'L') {

                            $jenis_kelamin = 1;
                        } else {

                            $jenis_kelamin = 2;
                        }

                        $j_rawat = $n_pendaftaran->jenis_rawat;

                        if ($j_rawat === 'Inap') {

                            $jenis_rawat = "IP";
                        } else {

                            $jenis_rawat = "OP";
                        }

                        foreach ($get_order_value as $key) {

                            $cito_value = $key->cito;

                            if ($cito_value === "ya") {

                                $cito = "U";
                            } else {

                                $cito = "R";
                            }

                            $a = $key->item;

                            $la = "select coalesce(la.test_code, '') as nama_kode
                                from sm_layanan la
                                left join sm_tarif_pelayanan tp on (tp.id_layanan = la.id) 
                                where tp.id = '" . $a . "' ";
                            $code_name = $this->db->query($la)->row();

                            $test_code = $code_name->nama_kode;
                            $test_item[] = $test_code;
                        }


                        $inap = $n_pendaftaran->jenis_layanan;
                        if ($inap === "Rawat Inap") {

                            $q = "select coalesce(bg.nama, '') as bangsal, ri.no_ruang as no_ruang, ri.id_bangsal as id_bangsal
                            from sm_layanan_pendaftaran lp
                            left join sm_rawat_inap ri on (ri.id_layanan_pendaftaran = lp.id) 
                            left join sm_bangsal bg on (bg.id = ri.id_bangsal) 
                            where lp.id = '" . $id_layanan_pendaftaran . "' ";
                            $bangsal_name = $this->db->query($q)->row();

                            $source_code = $bangsal_name->id_bangsal;

                            if ($source_code === '2') {

                                //Meranti

                                $id_bangsal = 2;
                                $bangsal = 'Meranti';
                                $no_ruang = $bangsal_name->no_ruang;
                            } else if ($source_code === '3') {

                                //Cendana

                                $id_bangsal = 155;
                                $bangsal = 'Cendana';
                                $no_ruang = $bangsal_name->no_ruang;
                            } else if ($source_code === '4') {

                                //Cendana II

                                $id_bangsal = 184;
                                $bangsal = 'Cendana II';
                                $no_ruang = $bangsal_name->no_ruang;
                            } else if ($source_code === '5') {

                                //Jati

                                $id_bangsal = 37;
                                $bangsal = 'Jati';
                                $no_ruang = $bangsal_name->no_ruang;
                            } else if ($source_code === '6') {

                                //Mahoni I

                                // $id_bangsal = 107;
                                // $bangsal = 'Mahoni I';
                                // $no_ruang = $bangsal_name->no_ruang;

                                //Albasia 2

                                $id_bangsal = 209;
                                $bangsal = 'Albasia 2';
                                $no_ruang = $bangsal_name->no_ruang;
                            } else if ($source_code === '7') {

                                //Mahoni II

                                $id_bangsal = 190;
                                $bangsal = 'Mahoni II';
                                $no_ruang = $bangsal_name->no_ruang;
                            } else if ($source_code === '8') {

                                //Eboni

                                $id_bangsal = 38;
                                $bangsal = 'Eboni';
                                $no_ruang = $bangsal_name->no_ruang;
                            } else if ($source_code === '9') {

                                //Pinus

                                $id_bangsal = 9;
                                $bangsal = 'Pinus';
                                $no_ruang = $bangsal_name->no_ruang;
                            } else if ($source_code === '16') {

                                //Isolasi Ulin 1

                                $id_bangsal = 212;
                                $bangsal = 'Isolasi Ulin 1';
                                $no_ruang = $bangsal_name->no_ruang;
                            } else if ($source_code === '17') {

                                //Isolasi Ulin 2

                                $id_bangsal = 213;
                                $bangsal = 'Isolasi Ulin 2';
                                $no_ruang = $bangsal_name->no_ruang;
                            } else if ($source_code === '18') {

                                //Albasia

                                $id_bangsal = 18;
                                $bangsal = 'Albasia';
                                $no_ruang = $bangsal_name->no_ruang;
                            } else if ($source_code === '19') {

                                //Albasia 2

                                $id_bangsal = 209;
                                $bangsal = 'Albasia 2';
                                $no_ruang = $bangsal_name->no_ruang;
                            } else if ($source_code === '20') {

                                //Kamar Bersalin

                                $id_bangsal = 72;
                                $bangsal = 'Kamar Bersalin';
                                $no_ruang = $bangsal_name->no_ruang;
                            } else if ($source_code === '24') {

                                //Rawat Gabung Bayi

                                $id_bangsal = 185;
                                $bangsal = 'Rawat Gabung Bayi';
                                $no_ruang = $bangsal_name->no_ruang;
                            } else {

                                $id_bangsal = $bangsal_name->id_bangsal;;
                                $bangsal = $bangsal_name->bangsal;
                                $no_ruang = $bangsal_name->no_ruang;
                            }
                        } else if ($inap === "Intensive Care") {

                            $q = "select coalesce(bg.nama, '') as bangsal, ri.no_ruang as no_ruang, ri.id_bangsal as id_bangsal
                            from sm_layanan_pendaftaran lp
                            left join sm_intensive_care ri on (ri.id_layanan_pendaftaran = lp.id) 
                            left join sm_bangsal bg on (bg.id = ri.id_bangsal) 
                            where lp.id = '" . $id_layanan_pendaftaran . "' ";
                            $bangsal_name = $this->db->query($q)->row();

                            $source_code = $bangsal_name->id_bangsal;

                            if ($source_code === '10') {

                                //HCU

                                $id_bangsal = 36;
                                $bangsal = 'HCU';
                                $no_ruang = $bangsal_name->no_ruang;
                            } else if ($source_code === '11') {

                                //ICU

                                $id_bangsal = 33;
                                $bangsal = 'ICU';
                                $no_ruang = $bangsal_name->no_ruang;
                            } else if ($source_code === '12') {

                                //NICU

                                $id_bangsal = 70;
                                $bangsal = 'NICU';
                                $no_ruang = $bangsal_name->no_ruang;
                            } else if ($source_code === '13') {

                                //PICU

                                $id_bangsal = 35;
                                $bangsal = 'PICU';
                                $no_ruang = $bangsal_name->no_ruang;
                            } else {

                                $id_bangsal = $bangsal_name->id_bangsal;;
                                $bangsal = $bangsal_name->bangsal;
                                $no_ruang = $bangsal_name->no_ruang;
                            }
                        } else if ($inap === "IGD") {

                            $q = "select coalesce(sp.jenis_igd, '') as bangsal, sp.jenis_pendaftaran as id_bangsal
                            from sm_layanan_pendaftaran lp
                            left join sm_pendaftaran sp on (lp.id_pendaftaran = sp.id) 
                            where lp.id = '" . $id_layanan_pendaftaran . "' ";
                            $bangsal_name = $this->db->query($q)->row();

                            $source_code = $bangsal_name->id_bangsal;


                            if ($inap === 'IGD') {

                                //IGD

                                $id_bangsal = 45;
                                $bangsal = 'IGD';
                                $no_ruang = "";
                            } else {

                                $id_bangsal = $bangsal_name->id_bangsal;
                                $bangsal = $bangsal_name->bangsal;
                                $no_ruang = "";
                            }
                        } else if ($inap === "Laboratorium") {

                            $id_bangsal = 109;
                            $bangsal = 'Laboratorium';
                            $no_ruang = "";
                        } else if ($inap === "Hemodialisa") {

                            $id_bangsal = 65;
                            $bangsal = 'Hemodialisis(HD)';
                            $no_ruang = "";
                        } else if ($inap === "Poliklinik") {

                            $q = "select ss.id as id, ss.nama as bangsal, ss.kode as id_bangsal, ss.id_unit as no_ruang
                            from sm_layanan_pendaftaran lp
                            left join sm_spesialisasi ss on (lp.id_unit_layanan = ss.id) 
                            where lp.id = '" . $id_layanan_pendaftaran . "' ";

                            $bangsal_name = $this->db->query($q)->row();

                            $source_bangsal = $bangsal_name->id;

                            if ($source_bangsal === '11') {

                                $id_bangsal = 15;
                                $bangsal = 'ANAK, P';
                                $no_ruang = "";
                            } else if ($source_bangsal === '12') {

                                $id_bangsal = 201;
                                $bangsal = 'BEDAH MULUT, P';
                                $no_ruang = "";
                            } else if ($source_bangsal === '13') {

                                $id_bangsal = 175;
                                $bangsal = 'BEDAH SYARAF, P';
                                $no_ruang = "";
                            } else if ($source_bangsal === '14') {

                                $id_bangsal = 6;
                                $bangsal = 'BEDAH, P';
                                $no_ruang = "";
                            } else if ($source_bangsal === '15') {

                                $id_bangsal = 156;
                                $bangsal = 'GIGI, P';
                                $no_ruang = "";
                            } else if ($source_bangsal === '16') {

                                $id_bangsal = 186;
                                $bangsal = 'GINJAL HIPERTENSI, P';
                                $no_ruang = "";
                            } else if ($source_bangsal === '20') {

                                $id_bangsal = 3;
                                $bangsal = 'JANTUNG,P';
                                $no_ruang = "";
                            } else if ($source_bangsal === '21') {

                                $id_bangsal = 12;
                                $bangsal = 'JIWA, P';
                                $no_ruang = "";
                            } else if ($source_bangsal === '22') {

                                $id_bangsal = 196;
                                $bangsal = 'KEDOKTERAN GIGI ANAK, P';
                                $no_ruang = "";
                            } else if ($source_bangsal === '23') {

                                $id_bangsal = 197;
                                $bangsal = 'KONSERVASI GIGI, P';
                                $no_ruang = "";
                            } else if ($source_bangsal === '24') {

                                $id_bangsal = 11;
                                $bangsal = 'KULIT KELAMIN, P';
                                $no_ruang = "";
                            } else if ($source_bangsal === '25') {

                                $id_bangsal = 4;
                                $bangsal = 'MATA,P';
                                $no_ruang = "";
                            } else if ($source_bangsal === '26') {

                                $id_bangsal = 8;
                                $bangsal = 'OBGYN, P';
                                $no_ruang = "";
                            } else if ($source_bangsal === '27') {

                                $id_bangsal = 198;
                                $bangsal = 'ORTHODONTI, P';
                                $no_ruang = "";
                            } else if ($source_bangsal === '28') {

                                $id_bangsal = 170;
                                $bangsal = 'ORTHOPAEDI, P';
                                $no_ruang = "";
                            } else if ($source_bangsal === '29') {

                                $id_bangsal = 5;
                                $bangsal = 'PARU, P';
                                $no_ruang = "";
                            } else if ($source_bangsal === '30') {

                                $id_bangsal = 17;
                                $bangsal = 'PENYAKIT DALAM, P';
                                $no_ruang = "";
                            } else if ($source_bangsal === '31') {

                                $id_bangsal = 200;
                                $bangsal = 'PENYAKIT MULUT, P';
                                $no_ruang = "";
                            } else if ($source_bangsal === '32') {

                                $id_bangsal = 199;
                                $bangsal = 'PERIODONTI, P';
                                $no_ruang = "";
                            } else if ($source_bangsal === '34') {

                                $id_bangsal = 16;
                                $bangsal = 'REHAB MEDIK';
                                $no_ruang = "";
                            } else if ($source_bangsal === '35') {

                                $id_bangsal = 7;
                                $bangsal = 'SYARAF, P';
                                $no_ruang = "";
                            } else if ($source_bangsal === '36') {

                                $id_bangsal = 10;
                                $bangsal = 'THT, P';
                                $no_ruang = "";
                            } else if ($source_bangsal === '37') {

                                $id_bangsal = 171;
                                $bangsal = 'UROLOGI, P';
                                $no_ruang = "";
                            } else {

                                $id_bangsal = $bangsal_name->id_bangsal;
                                $bangsal = $bangsal_name->bangsal;
                                $no_ruang = "";
                            }
                        } else {

                            $q = "select ss.nama as bangsal, ss.kode as id_bangsal, ss.id_unit as no_ruang
                            from sm_layanan_pendaftaran lp
                            left join sm_spesialisasi ss on (lp.id_unit_layanan = ss.id) 
                            where lp.id = '" . $id_layanan_pendaftaran . "' ";
                            $bangsal_name = $this->db->query($q)->row();

                            $id_bangsal = $bangsal_name->id_bangsal;
                            $bangsal = $bangsal_name->bangsal;
                            $no_ruang = $bangsal_name->no_ruang;
                        }

                        $nomer_urut = $order_lab->ono;

                        $params = array(
                            "message_dt" => "" . date("YmdHis") . "",
                            "order_control" => "NW",
                            "patient" => array(
                                "pid" => $n_pendaftaran->id,
                                "apid" => "",
                                "name" => substr($n_pendaftaran->nama, 0, 50),
                                "address1" => $max_alamat,
                                "address2" => $max_alamat_satu,
                                "address3" => $penjamin,
                                "address4" => $n_pjwb->nip,
                                "birth_dt" => $t_lahir,
                                "sex" => $jenis_kelamin
                            ),
                            "ono" => $nomer_urut,
                            "ptype" => $jenis_rawat,
                            "request_dt" => "" . date("YmdHis") . "",
                            "source" => array(
                                "code" => $id_bangsal,
                                "name" => $bangsal,
                                "room_no" => $no_ruang
                            ),
                            "clinician" => array(
                                "code" => $order_lab->id_dokter,
                                "name" => $order_lab->nama_dokter
                            ),
                            "priority" => $cito,
                            "diagnose" => $sebab_sakit_lain,
                            "pstatus" => "",
                            "comment" => "",
                            "visitno" => "",
                            "order_testid" => $test_item
                        );

                        $data_api = json_encode($params);

                        $ch = curl_init();

                        if (!$ch) {
                            die("Couldn't initialize a cURL handle");
                        }
                        curl_setopt_array($ch, array(
                            CURLOPT_URL => $this->url . '/api/order/create/',
                            CURLOPT_POST => 1,
                            CURLOPT_POSTFIELDS => $data_api,
                            CURLOPT_RETURNTRANSFER => true,
                            CURLOPT_HTTPHEADER => array(
                                'x-username: ' . $this->user . '',
                                'x-password: ' . $this->pass . ''
                            ),
                        ));

                        $api_result = curl_exec($ch);

                        if ($api_result === false) {

                            curl_close($ch); // close cURL handler
                            $status = false;
                            $message = "Gagal Menghubungi LIS";
                            $respon = 503;

                            $response_lab = "select jl.id as id_response
                            from sm_jenis_lab jl
                            where jl.id_lab = '" . $id_order_lab . "' ";
                            $create_response = $this->db->query($response_lab)->row();

                            if ($create_response !== null) {

                                $id_response = $create_response->id_response;
                                $response_lab = array(
                                    'id_layanan_pendaftaran' => (int)$this->post('id_layanan'),
                                    'id_lab' => (int)$order_lab->id,
                                    'status' => 503
                                );

                                $this->m_pelayanan->update_response_laboratorium($response_lab, $id_response);
                            } else {

                                $response_lab = array(
                                    'id_layanan_pendaftaran' => (int)$this->post('id_layanan'),
                                    'id_lab' => (int)$order_lab->id,
                                    'status' => 503
                                );

                                $this->m_pelayanan->respon_order_lab($response_lab);
                            }
                        } else {

                            $response_getinfo = curl_getinfo($ch, CURLINFO_RESPONSE_CODE);
                            $response_http = curl_getinfo($ch, CURLINFO_HTTP_CODE);
                            $outputJSON = json_decode($api_result);

                            curl_close($ch); // close cURL handler

                            if ($response_http !== null) {

                                $response_lab = "select jl.id as id_response
                                    from sm_jenis_lab jl
                                    where jl.id_lab = '" . $id_order_lab . "' ";
                                $create_response = $this->db->query($response_lab)->row();

                                if ($create_response !== null) {

                                    $id_response = $create_response->id_response;
                                    $response_lab = array(
                                        'id_layanan_pendaftaran' => (int)$this->post('id_layanan'),
                                        'id_lab' => (int)$order_lab->id,
                                        'status' => (int)$response_getinfo
                                    );

                                    $this->m_pelayanan->update_response_laboratorium($response_lab, $id_response);
                                } else {

                                    $response_lab = array(
                                        'id_layanan_pendaftaran' => (int)$this->post('id_layanan'),
                                        'id_lab' => (int)$order_lab->id,
                                        'status' => (int)$response_getinfo
                                    );

                                    $this->m_pelayanan->respon_order_lab($response_lab);
                                }

                                if ($response_getinfo === 201) {
                                    $respon = 201;
                                    $status = true;
                                    $message = "Berhasil melakukan permintaan Laboratorium ke LIS";
                                } else if ($response_getinfo === 400) {

                                    if (isset($outputJSON->order_testid)) {

                                        $function = $outputJSON->order_testid;

                                        if ($function !== null) {

                                            foreach ($function as $key => $value) {

                                                $get_respon = $value[0];
                                            }
                                        } else {

                                            $get_respon = false;
                                        }
                                    }

                                    if (isset($get_respon)) {

                                        if ($get_respon === 'This field may not be blank.') {

                                            $respon = 400;
                                            $status = false;
                                            $message = "Mohon Tidak Menggunakan item pemeriksaan selain dari Laboratorium Sysmex";
                                        }
                                    } else {

                                        if (isset($outputJSON->source->code[0])) {

                                            if ($outputJSON->source->code[0] === 'This field may not be null.') {

                                                $respon = 400;
                                                $status = false;
                                                $message = "Test Code tidak boleh kosong atau nama dokter tidak boleh kosong, silakan isi diagnosis terlebih dahulu";
                                            } else if ($outputJSON->source->code[0] === 'This field may not be blank.') {

                                                $respon = 400;
                                                $status = false;
                                                $message = "Kode pada Spesialisasi Tidak Boleh Kosong";
                                            }
                                        } else {

                                            if (isset($outputJSON->content)) {
                                                $getJSON = $outputJSON->content;

                                                if ($getJSON === "Duplicate ONO. Order not created") {

                                                    $response_lab = "select jl.id as id_response
                                                from sm_jenis_lab jl
                                                where jl.id_lab = '" . $id_order_lab . "' ";
                                                    $create_response = $this->db->query($response_lab)->row();

                                                    if ($create_response !== null) {

                                                        $id_response = $create_response->id_response;
                                                        $response_lab = array(
                                                            'id_layanan_pendaftaran' => (int)$this->post('id_layanan'),
                                                            'id_lab' => (int)$order_lab->id,
                                                            'status' => 201
                                                        );

                                                        $this->m_pelayanan->update_response_laboratorium($response_lab, $id_response);
                                                    } else {

                                                        $response_lab = array(
                                                            'id_layanan_pendaftaran' => (int)$this->post('id_layanan'),
                                                            'id_lab' => (int)$order_lab->id,
                                                            'status' => 201
                                                        );

                                                        $this->m_pelayanan->respon_order_lab($response_lab);
                                                    }

                                                    $respon = 201;
                                                    $status = true;
                                                    $message = "Berhasil melakukan permintaan Laboratorium ke LIS";
                                                }
                                            } else {

                                                $respon = 400;
                                                $status = false;
                                                $message = "Test Code tidak boleh kosong atau nama dokter tidak boleh kosong, silakan isi diagnosis terlebih dahulu";
                                            }
                                        }
                                    }
                                } else {

                                    $respon = 503;
                                    $status = false;
                                    $message = "Gagal post ke service LIS";
                                }
                            } else {

                                $response_lab = "select jl.id as id_response
                                    from sm_jenis_lab jl
                                    where jl.id_lab = '" . $id_order_lab . "' ";
                                $create_response = $this->db->query($response_lab)->row();

                                if ($create_response !== null) {

                                    $id_response = $create_response->id_response;
                                    $response_lab = array(
                                        'id_layanan_pendaftaran' => (int)$this->post('id_layanan'),
                                        'id_lab' => (int)$order_lab->id,
                                        'status' => (int)$response_getinfo
                                    );

                                    $this->m_pelayanan->update_response_laboratorium($response_lab, $id_response);
                                } else {

                                    $response_lab = array(
                                        'id_layanan_pendaftaran' => (int)$this->post('id_layanan'),
                                        'id_lab' => (int)$order_lab->id,
                                        'status' => (int)$response_getinfo
                                    );

                                    $this->m_pelayanan->respon_order_lab($response_lab);
                                }

                                if ($response_getinfo === 201) {

                                    $respon = 201;
                                    $status = true;
                                    $message = "Berhasil melakukan permintaan Laboratorium ke LIS";
                                } else if ($response_getinfo === 400) {

                                    $respon = 400;
                                    $status = false;
                                    $message = "Gagal post ke service LIS atau nama dokter tidak boleh kosong, silakan isi diagnosis terlebih dahulu";
                                } else {

                                    $respon = 404;
                                    $status = false;
                                    $message = "Gagal post ke service LIS";
                                }
                            }
                        }
                    } else {

                        $respon = 404;
                        $status = false;
                        $message = "Tidak ada Item Pemeriksaan";
                    }
                } else {

                    $respon = 404;
                    $status = false;
                    $message = "Tidak Ada Data Order Laboratorium";
                }
            } else {

                $respon = 404;
                $status = false;
                $message = "Tidak ada Data Pasien";
            }
        } else {

            $respon = 404;
            $status = false;
            $message = "Data Diagnosis Belum ada, Silakan Konfirmasi Ke ruangan yang melakukan order Lab";
        }

        $data = array("status" => $status, "message" => $message);
        $this->response($data, $respon);
    }



    function rencana_tindakan_keperawatan_get()
    {
        $q = safe_get('q');
        $start = $this->start(safe_get('page'));
        $data = $this->m_pelayanan->getRencanaTindakanKeperawatan($q, $start, $this->limit);
        if ((safe_get('page') == 1) & ($q == '')) {
            $pilih[] = array(
                'id' => '',
                'nama' => ' ',
            );

            $data['data'] = array_merge($pilih, $data['data']);
            $data['total'] += 1;
        }
        $this->response($data, REST_Controller::HTTP_OK);
    }


    function pemeriksaan_pendaftaran_laboratorium_get()
    {
        if (!$this->get("id")) {
            $this->response(NULL, 400);
        }

        $data = $this->m_pelayanan->get_request_order_lab($this->get("id"));

        foreach ($data as $key => $value) {
            $value->detail = $this->m_pelayanan->get_pemeriksaan_response_laboratorium($value->id);
        }

        $request = $this->m_pelayanan->get_request_response_laboratorium($this->get("id"));
        foreach ($request as $key => $value) {
            $data[] = $value;
        }

        $this->response($data, 200);
    }

    function pemeriksaan_laboratorium_detail_get()
    {
        if (!$this->get("id")) {
            $this->response(NULL, 400);
        }
        $data = $this->m_pelayanan->get_pemeriksaan_laboratorium($this->get("id"), "list");
        foreach ($data as $key => $value) {
            $value->detail = $this->m_pelayanan->get_pemeriksaan_laboratorium_detail($value->id);
        }
        $request = $this->m_pelayanan->get_request_laboratorium($this->get("id"));
        foreach ($request as $key => $value) {
            $data[] = $value;
        }

        $this->response($data, 200);
    }

    function validasiString($input)
    {
        // Menghilangkan spasi di awal dan akhir string
        $trimmedInput = trim($input);

        // Memeriksa apakah string setelah di-trim masih memiliki panjang lebih dari 3 karakter
        if (strlen($trimmedInput) > 3) {
            // String valid
            return true;
        } else {
            // String tidak valid
            return false;
        }
    }

    function order_radiologi_post()
    {

        $this->db->trans_begin();

        $status = true;
        $message = "";
        $id_layanan_pendaftaran = $this->post('id_layanan');
        $item_post = $this->post('tindakan_rad');
        $cito = $this->post('cito');
        $item_rad = $this->post('item_rad');
        $item_rad_label = $this->post('item_rad_label');
        $keterangan = $this->post('keterangan');
        $bbRad = $this->post('bb_rad');

        $bb = $this->post('berat_badan');

        $countedValues = array_count_values($item_post);
        $duplicates = [];

        if (!is_array($countedValues)) {

            $decode = ["status" => false, "message" => 'Item Tidak Boleh Kosong dalam satu order'];
            die(json_encode($decode));
            exit();

        }

        foreach ($countedValues as $value => $count) {
            if ($count > 1) {
                $duplicates[] = $value;
            }
        }

        if (count($duplicates) > 0) {

            $decode = ["status" => false, "message" => 'Item Tidak Boleh Duplikat dalam satu order'];
            die(json_encode($decode));
            exit();
        }

        if ($bb === null | $bb === '') :
            $decode = ["status" => false, "message" => 'Berat Badan Tidak Boleh Kosong'];
            die(json_encode($decode));
            exit();
        endif;

        $sql = "select lp.*, pj.diskon
                from sm_layanan_pendaftaran lp
                left join sm_penjamin pj on (pj.id = lp.id_penjamin)
                where lp.id = '" . $id_layanan_pendaftaran . "' ";
        $layanan_pendaftaran = $this->db->query($sql)->row();

        if (0 < count((array)$layanan_pendaftaran)) {
            $arr_item = array();
            if (is_array($item_post)) {
                foreach ($item_post as $key => $value) {
                    if ($value !== '') {

                        if ($this->validasiString($keterangan[$key]) === false) {

                            $decode = ["status" => false, "message" => 'Silakan isi Keterangan Klinis dengan Benar dan lebih dari 3 karakter'];
                            die(json_encode($decode));
                            exit();
                        }

                        $arr_item[$key]['layanan'] = $value;
                        $arr_item[$key]['cito'] = $cito[$key];
                        $arr_item[$key]['item_rad'] = $item_rad[$key];
                        $arr_item[$key]['item_rad_label'] = $item_rad_label[$key];
                        $arr_item[$key]['keterangan'] = $keterangan[$key];
                        $arr_item[$key]['berat_badan'] = $bb[$key];
                    }
                }

                if (is_array($arr_item)) {

                    $item = "[";
                    foreach ($arr_item as $key => $value) {
                        if ($value !== '') {
                            $cek = $this->m_pelayanan->cek_penjaminan_tarif($value['layanan'], $layanan_pendaftaran->id_penjamin);
                            $penjamin = 0;
                            if (0 < $cek) {
                                $penjamin = $layanan_pendaftaran->id_penjamin;
                            }
                            // $item .= "{\"item\":\"" . $value['layanan'] . "\",\"penjamin\":\"" . $penjamin . "\",\"cito\":\"" . $value['cito'] . "\", \"item_rad\":" . ($value['item_rad'] !== "" ? $value['item_rad'] : "[]") . " , \"item_rad_label\":\"" . $value['item_rad_label'] . "\"}";
                            // if ($key < sizeof($arr_item) - 1) {
                            //     $item .= ",";
                            $item .= "{\"item\":\"" . $value['layanan'] . "\",\"penjamin\":\"" . $penjamin . "\",\"cito\":\"" . $value['cito'] . "\", \"item_rad\":" . ($value['item_rad'] !== "" ? $value['item_rad'] : "[]") . " , \"item_rad_label\":\"" . $value['item_rad_label'] . "\" , \"keterangan\":\"" . $value['keterangan'] . "\",\"berat_badan\":\"" . $value['berat_badan'] . "\"}"; //tambahan lina radiologi
                            if ($key < sizeof($arr_item) - 1) {
                                $item .= ",";
                            }
                        }
                    }
                    $item .= "]";

                    date_default_timezone_set('Asia/Jakarta');
                    $request = array(
                        'id_layanan_pendaftaran' => (int)$this->post('id_layanan'),
                        'id_dokter' => $this->post('dokter') !== '' & $this->post('dokter') !== 'none' ? (int)$this->post('dokter') : 'NULL',
                        'waktu_order' => "'" . date('Y-m-d H:i:s') . "'",
                        'jenis' => "'" . $this->post('jenis_rad') . "'",
                        'status' => "'request'",
                        'item' => "'" . $item . "'"
                    );

                    $this->m_pelayanan->add_order_radiologi($request);

                    $this->load->model('order_radiologi/Order_radiologi_model', 'm_order_radiologi');

                    $dataBb = $this->m_order_radiologi->getDataBbPasienRanap($id_layanan_pendaftaran);

                    if ($dataBb !== false) {

                        if ($dataBb->berat_badan === null | $dataBb->berat_badan === '') {

                            if ($bbRad !== null) {

                                $beratBadan = array("berat_badan" => $bbRad);
                                $this->db->where('id', (int)$dataBb->id)->update('sm_profil_pasien', $beratBadan);
                            } else {

                                if (isset($bb)) {

                                    $checkProfilPasien = $this->db->query("select * from sm_profil_pasien where id_pasien = '" . $dataBb->id_pasien . "'")->row();

                                    if ($checkProfilPasien) {

                                        foreach ($arr_item as $key => $value) {

                                            $beratBadan = array("berat_badan" => $bb[0]);
                                            $this->db->where('id', (int)$dataBb->id)->update('sm_profil_pasien', $beratBadan);

                                            break;
                                        }
                                    } else {

                                        foreach ($arr_item as $key => $value) {

                                            $dataProfilPasien = array(

                                                'id_pasien' => $dataBb->id_pasien,
                                                'berat_badan'  => $value['berat_badan'],

                                            );

                                            $this->db->insert('sm_profil_pasien', $dataProfilPasien);

                                            break;
                                        }
                                    }
                                }
                            }
                        }
                    }

                    $status = true;
                    $message = "Berhasil order radiologi";
                } else {
                    $status = false;
                    $message = "Gagal order radiologi, anda belum memilih item pemerikaan";
                }
            } else {
                $status = false;
                $message = "Gagal order radiologi, anda belum memilih item pemerikaan";
            }
        } else {
            $status = false;
            $message = "Gagal order radiologi, Kesalahan sistem.<br/>Ulangi transaksi dan mohon segera hubungi admin";
        }

        if ($this->db->trans_status() === false) :
            $this->db->trans_rollback();

        else :
            $this->db->trans_commit();

        endif;

        $response = array("status" => $status, "message" => $message);
        $this->response($response, 200);
    }

    function daftarRad_post()
    {
        $this->db->trans_begin();

        $idLayananPendaftaran = $this->post('idLayananPendaftaran');

        $beratBadan = $this->post('daftar_bb_rad');

        if ($idLayananPendaftaran === '') {

            $decode = ["metaData" => ["code" => 201, "message" => 'id Layanan Pendaftaran Tidak Ada, Silakan Hubungi IT']];
            die(json_encode($decode));
            exit();
        }

        if ($beratBadan === '') {

            $decode = ["metaData" => ["code" => 201, "message" => 'Berat Badan Tidak Ada']];
            die(json_encode($decode));
            exit();
        }

        $sql = "select lp.*, pj.diskon, sp.id_pasien
                from sm_layanan_pendaftaran lp
                left join sm_pendaftaran sp on (sp.id = lp.id_pendaftaran)
                left join sm_penjamin pj on (pj.id = lp.id_penjamin)
                where lp.id = '" . $idLayananPendaftaran . "' ";
        $layananPendaftaran = $this->db->query($sql)->row();

        if ($layananPendaftaran->tindak_lanjut !== null && $layananPendaftaran->tindak_lanjut !== '') {

            $decode = ["metaData" => ["code" => 201, "message" => 'Pasien sudah pulang, tidak dapat melakukan Order Radiologi...']];
            die(json_encode($decode));
            exit();
        }

        date_default_timezone_set('Asia/Jakarta');

        $request = array(
            "id_layanan_pendaftaran" => (int)$idLayananPendaftaran,
            "waktu_order" => "'" . date('Y-m-d H:i:s') . "'",
            "status" => "'request'",
            "berat_badan" => "'" . $beratBadan . "'",
        );

        $orderRad = $this->m_pelayanan->add_order_radiologi($request);

        $checkProfilPasien = $this->db->query("select * from sm_profil_pasien where id_pasien = '" . $layananPendaftaran->id_pasien . "'")->row();

        $dataProfilPasien = array(

            'id_pasien' => $layananPendaftaran->id_pasien,
            'berat_badan'  => $beratBadan !== '' ? $beratBadan : NULL,

        );


        if ($checkProfilPasien) :
            $this->db->where('id_pasien', $layananPendaftaran->id_pasien, true)->update('sm_profil_pasien', $dataProfilPasien);
        else :
            $this->db->insert('sm_profil_pasien', $dataProfilPasien);
        endif;

        if ($orderRad === true) {

            $decode = ["metaData" => ["code" => 200, "message" => 'Berhasil Melakukan Order Radiologi']];
        } else {

            $decode = ["metaData" => ["code" => 201, "message" => 'Gagal Melakukan Order Radiologi']];
        }

        if ($this->db->trans_status() === false) :
            $this->db->trans_rollback();

        else :
            $this->db->trans_commit();

        endif;

        $this->response($decode, $decode['metaData']['code']);
    }

    function pemeriksaan_radiologi_detail_get()
    {
        if (!$this->get("id")) {
            $this->response(NULL, 400);
        }
        $data = $this->m_pelayanan->get_pemeriksaan_radiologi($this->get("id"), "list");
        foreach ($data as $key => $value) {
            $value->detail = $this->m_pelayanan->get_pemeriksaan_radiologi_detail($value->id);
        }
        $request = $this->m_pelayanan->get_request_radiologi($this->get("id"));
        foreach ($request as $key => $value) {
            $data[] = $value;
        }
        $this->response($data, 200);
    }

    function get_detail_radiologi_get()
    {
        if (!$this->get("id")) {
            $this->response(NULL, 400);
        }

        $data = $this->m_pelayanan->getDetailRadiologi($this->get('id'));
        $this->response($data, REST_Controller::HTTP_OK);
    }

    // fisioterapi
    function get_pemeriksaan_fisioterapi_detail_get()
    {
        if (!$this->get('id', true)) {
            $this->response(NULL, REST_Controller::HTTP_BAD_REQUEST);
        }
        $id = $this->get('id', true);
        $data = $this->m_pelayanan->getPemeriksaanFisioterapi($id, 'list');
        foreach ($data as $key => $value) {
            $value->detail = $this->m_pelayanan->getPemeriksaanFisioterapiDetail($value->id);
        }

        $request = $this->m_pelayanan->getRequestFisioterapi($id);
        foreach ($request as $key => $value) {
            $data[] = $value;
        }

        $this->response($data, REST_Controller::HTTP_OK);
    }

    function simpan_order_fisioterapi_post()
    {
        $status = true;
        $message = "";
        $dataRequest = array(
            "id_layanan_pendaftaran" => (int)$this->post("id_layanan_pendaftaran"),
            "id_dokter" => $this->post("dokter") !== "" & $this->post("dokter") !== "none" ? (int)$this->post("dokter") : NULL,
            "waktu_order" => "'" . $this->datetime . "'",
            "status" => "'request'",
            "item" => NULL
        );
        $itemPost = $this->post("id_tindakan_fisio");
        $sql = "select lp.*, pj.diskon 
                from sm_layanan_pendaftaran as lp 
                left join sm_penjamin as pj on (pj.id = lp.id_penjamin) 
                where lp.id = '" . $dataRequest["id_layanan_pendaftaran"] . "' ";
        $data  = $this->db->query($sql)->row();
        if (0 < count((array)$data)) {
            $item = array();
            if (is_array($itemPost)) {
                foreach ($itemPost as $key => $value) {
                    if ($value !== "") {
                        $item[] = $value;
                    }
                }

                if (is_array($item)) {
                    $dataRequest["item"] = "'[";
                    foreach ($item as $key => $value) {
                        if ($value !== "") {
                            $cek = $this->m_pelayanan->cek_penjaminan_tarif($value, $data->id_penjamin);
                            $penjamin = 0;
                        }

                        if (0 < $cek) {
                            $penjamin = $data->id_penjamin;
                        }

                        $dataRequest["item"] .= "{\"item\":\"" . $value . "\",\"penjamin\":\"" . $penjamin . "\"}";
                        if ($key < count((array)$item) - 1) {
                            $dataRequest["item"] .= ",";
                        }
                    }
                    $dataRequest["item"] .= "]'";
                    $responseSimpan = $this->m_pelayanan->simpanOrderFisioterapi($dataRequest);

                    if ($responseSimpan) {
                        $status = true;
                        $message = "Berhasil order rehabilitasi medik";
                    } else {
                        $status = false;
                        $message = "Gagal order rehabilitasi medik";
                    }
                } else {
                    $status = false;
                    $message = "Gagal order rehabilitasi medik, anda belum memilih item pemeriksaan";
                }
            } else {
                $status = false;
                $message = "Gagal order rehabilitasi medik, anda belum memilih item pemeriksaan";
            }
        } else {
            $status = false;
            $message = "Gagal order Rehabilitasi medik, Terjadi kesalahan sistem.<br>Ulangi transaksi dan segera hubungi admin";
        }

        $response = array("status" => $status, "message" => $message);
        $this->response($response, REST_Controller::HTTP_OK);
    }


    function get_detail_fisioterapi_get()
    {
        if (!$this->get("id")) {
            $this->response(NULL, 400);
        }

        $data = $this->m_pelayanan->getDetailFisioterapi($this->get('id'));
        $this->response($data, REST_Controller::HTTP_OK);
    }
    // end fisioterapi

    // signature
    function upload_signature_post()
    {
        $id = safe_post('id');
        $name = safe_post('name');
        $imageData = base64_decode($_POST['signature']);
        $imageName = 'ttd-' . $id . '-' . str_replace(' ', '-', $name) . '.png';
        // update to your database
        if ($id !== '') {
            // location to where you want to created sign image
            $fileName = './signatures/' . $imageName;
            // write_file('./signatures/' . $imageName, $imageData, 'r+');
            $upload = file_put_contents($fileName, $imageData);
            if ($upload) {
                $status = $this->db->where('id', $id)->update('sm_pegawai', array('signature' => $imageName));
                if ($status) {
                    $result['status'] = $status;
                } else {
                    $result['status'] = $status;
                }
            } else {
                $result['status'] = false;
            }
            $result['filename'] = $imageName;
            $this->response($result, REST_Controller::HTTP_OK);
        }
    }
    // signature

    function nadis_auto_get()
    {
        $params['q'] = safe_get('q');
        $start = $this->start(safe_get('page'));
        $params['jenis'] = safe_get('jenis');
        $data = $this->m_pelayanan->getPegawaiNadis($params, $start, $this->limit);
        if ((safe_get('page') == 1) & ($params['q'] == '')) {
            $pilih[] = array(
                'id' => '',
                'nama' => ' ',
                'spesialisasi' => '',
            );

            $data['data'] = array_merge($pilih, $data['data']);
            $data['total'] += 1;
        }
        $this->response($data, REST_Controller::HTTP_OK);
    }

    // cppt
    function simpan_cppt_post()
    {
        if (!safe_post('id_layanan_pendaftaran')) :
            $this->response(array('status' => false, 'message' => 'Parameter tidak lengkap'), REST_Controller::HTTP_BAD_REQUEST);
        endif;

        $data = array(
            'id'                        => safe_post('id_cppt'),
            'id_layanan_pendaftaran'    => safe_post('id_layanan_pendaftaran'),
            'waktu'                     => (safe_post('waktu_cppt') !== '' ? datetime2mysql(safe_post('waktu_cppt')) : NULL),
            'id_profesi'                => safe_post('profesi'),
            'subject'                   => $this->post('subject'),
            'objective'                 => $this->post('objective'),
            'assessment'                => $this->post('assessment'),
            'plan'                      => $this->post('plan'),
            'ademi_assesment'           => $this->post('ademi_assesment'),
            'ademi_diag'                => $this->post('ademi_diag'),
            'ademi_interv'              => $this->post('ademi_interv'),
            'ademi_monev'               => $this->post('ademi_monev'),
            'sbar_situation'            => $this->post('sbar_situation'),
            'sbar_background'           => $this->post('sbar_background'),
            'sbar_assesment'            => $this->post('sbar_assesment'),
            'sbar_recommend'            => $this->post('sbar_recommend'),
            'id_nadis'                  => (safe_post('nadis') !== '' ? safe_post('nadis') : NULL),
            'ttd_nadis'                 => (safe_post('ttd_nadis') !== '' ? safe_post('ttd_nadis') : NULL),
            'instruksi_ppa'             => safe_post('instruksi'),
            'id_dokter_dpjp'            => (safe_post('dokter_dpjp') !== '' ? safe_post('dokter_dpjp') : NULL),
            'id_user'                   => $this->session->userdata('id_translucent'),
            'konsul_via_telp'           => (safe_post('konsul_via_telp') !== '' ? safe_post('konsul_via_telp') : 0),
            'history_edit'              => '1',
            'konsul'                    => (safe_post('konsul') !== '' ? safe_post('konsul') : NULL),
        );

        $response = $this->m_pelayanan->updateCPPT($data);
        $this->response($response, REST_Controller::HTTP_OK);
    }

    function get_list_cppt_get()
    {
        if (!$this->get('page', true)) :
            $this->response(NULL, REST_Controller::HTTP_BAD_REQUEST); // (400)
        endif;
        $limit = 5;
        $start  = ($this->get('page') - 1) * $limit;
        $search = [
            'keyword' => safe_get('keyword'),
            'waktu' => date2mysql(safe_get('waktu')),
            'id_layanan_pendaftaran'  => $this->get('id_layanan_pendaftaran', true),
            'id_pendaftaran'  => $this->get('id_pendaftaran', true),
        ];

        $data            = $this->m_pelayanan->getListDataCPPT($limit, $start, $search);
        $data['page']    = (int) $this->get('page');
        $data['limit']   = $limit;

        if ($data) :
            $this->response($data, REST_Controller::HTTP_OK); // (200)
        endif;
    }

    function get_cppt_get()
    {
        if (!$this->get('id', true)) :
            $this->response(NULL, REST_Controller::HTTP_BAD_REQUEST); // (400)
        endif;

        $data = $this->m_pelayanan->getCPPT($this->get('id', true));
        $this->response($data, REST_Controller::HTTP_OK);
    }

    function get_verif_raber_get()
    {
        if (!$this->get('id', true)) :
            $this->response(NULL, REST_Controller::HTTP_BAD_REQUEST); // (400)
        endif;

        $status = $this->m_pelayanan->getVerifiedRaber($this->get('id', true));
        if ($status) :
            $response = array('status' => $status, 'message' => 'Berhasil memverifikasi rawat bersama');
        else :
            $response = array('status' => $status, 'message' => 'Gagal memverifikasi rawat bersama');
        endif;
        $this->response($response, REST_Controller::HTTP_OK);
    }

    function hapus_cppt_delete($id)
    {
        $status = $this->m_pelayanan->deleteCPPT($id);
        if ($status) :
            $response = array('status' => $status, 'message' => 'Berhasil Menghapus Catatan Perkembangan Pasien Terintegrasi');
        else :
            $response = array('status' => $status, 'message' => 'Gagal Menghapus Catatan Perkembangan Pasien Terintegrasi');
        endif;
        $this->response($response, REST_Controller::HTTP_OK);
    }

    function verifikasi_tbak_post()
    {
        if (!$this->post('id', true)) :
            $this->response(array('status' => false, 'message' => 'Parameter tidak lengkap'));
        endif;

        $data = array(
            'waktu_penerima_tbak' => (safe_post('waktu_penerima_tbak') !== '' ? datetime2mysql(safe_post('waktu_penerima_tbak')) : NULL),
            'waktu_pemberi_tbak' => (safe_post('waktu_pemberi_tbak') !== '' ? datetime2mysql(safe_post('waktu_pemberi_tbak')) : NULL),
            'id_nadis_tbak' => safe_post('nadis_tbak'),
            'id_dokter_dpjp_tbak' => safe_post('dokter_dpjp_tbak'),
            'ttd_nadis_tbak' => safe_post('ttd_nadis_tbak'),
            'ttd_dokter_dpjp_tbak' => safe_post('ttd_dokter_dpjp_tbak'),
        );

        $status = $this->db->where('id', $this->post('id', true), true)->update('sm_cppt', $data);
        if ($status) {
            $response['status'] = $status;
            $response['message'] = 'Berhasil memverifikasi CPPT dengan metode TBAK';
        } else {
            $response['status'] = $status;
            $response['message'] = 'Berhasil memverifikasi CPPT dengan metode TBAK';
        }
        $this->response($response, REST_Controller::HTTP_OK);
    }

    function verifikasi_dpjp_post()
    {
        if (!$this->post('id', true)) :
            $this->response(array('status' => false, 'message' => 'Parameter tidak lengkap'));
        endif;
        $data = array(
            'waktu_verif_dpjp' => (safe_post('waktu_pemberi_verif_dpjp') !== '' ? datetime2mysql(safe_post('waktu_pemberi_verif_dpjp')) : NULL),
            'id_dokter_dpjp' => safe_post('dokter_verif_dpjp'),
            'ttd_dokter_dpjp' => safe_post('ttd_dokter_verif_dpjp')
        );
        $status = $this->db->where('id', $this->post('id', true), true)->update('sm_cppt', $data);
        if ($status) {
            $response['status'] = $status;
            $response['message'] = 'Berhasil memverifikasi CPPT oleh DPJP';
        } else {
            $response['status'] = $status;
            $response['message'] = 'Berhasil memverifikasi CPPT oleh DPJP';
        }
        $this->response($response, REST_Controller::HTTP_OK);
    }

    function get_cppt_verified_get()
    {
        if (!$this->get('id', true)) :
            $this->response(NULL, REST_Controller::HTTP_BAD_REQUEST); // (400)
        endif;

        $data = $this->m_pelayanan->getVerifiedCPPT($this->get('id', true));
        $this->response($data, REST_Controller::HTTP_OK);
    }
	
	function get_cppt_verified_dpjp_get()
    {
        if (!$this->get('id', true)) :
            $this->response(NULL, REST_Controller::HTTP_BAD_REQUEST); // (400)
        endif;

        $data = $this->m_pelayanan->getVerifiedDpjpCPPT($this->get('id', true));
        $this->response($data, REST_Controller::HTTP_OK);
    }
    // end cppt

    // edukasi
    function simpan_edukasi_post()
    {
        $this->db->trans_begin();
        if (!$this->post('id_layanan_pendaftaran', true)) :
            $this->response(array('status' => false, 'alert' => 'error', 'message' => 'Parameter tidak lengkap'), REST_Controller::HTTP_BAD_GATEWAY);
        endif;

        if (!$this->post('id')) {
            $data = array(
                'id_layanan_pendaftaran' => safe_post('id_layanan_pendaftaran'),
                'waktu' => $this->datetime,
                'sedia_menerima_info' => safe_post('sedia_menerima_informasi'),
                'bahasa' => safe_post('bahasa'),
                'ket_bahasa_lain' => safe_post('bahasa_lain'),
                'ket_bahasa_daerah' => safe_post('daerah'),
                'butuh_penterjemah' => safe_post('kebutuhan_penterjemah'),
                'baca_tulis' => safe_post('baca_tulis'),
                'tipe_pembelajaran' => safe_post('tipe_belajar'),
                'hambatan_edukasi' => safe_post('hambatan_edukasi'),
                'ket_hambatan_edukasi' => safe_post('hambatan_edukasi_lain'),
                'perencanaan_edukasi' => (safe_post('perencanaan_edukasi') !== '' ? implode(', ', safe_post('perencanaan_edukasi')) : ''),
                'id_user' => $this->session->userdata('id_translucent'),
                'created_date' => $this->datetime,
            );

            $id_edukasi = $this->m_pelayanan->simpanEdukasi($data);
        } else {
            $id_edukasi = $this->post('id');
            $this->db->update('sm_edukasi', array('perencanaan_edukasi' => (safe_post('perencanaan_edukasi') !== '' ? implode(', ', safe_post('perencanaan_edukasi')) : '')), array('id' => $id_edukasi));
        }


        $data_detail = array(
            'id_edu' => $this->post('id_edu', true),
            'id_topik_edu' => $this->post('id_topik_edu') !== '' ? $this->post('id_topik_edu', true) : NULL,
            'ket_topik_edu' => $this->post('ket_topik_edu') !== '' ? $this->post('ket_topik_edu', true) : NULL,
            'tanggal_edu' => $this->post('tanggal_edu') !== '' ? $this->post('tanggal_edu', true) : NULL,
            'nama_keluarga_edu' => $this->post('nama_keluarga_edu') !== '' ? $this->post('nama_keluarga_edu', true) : NULL,
            'status_hubungan_edu' => $this->post('status_hubungan_edu') !== '' ? $this->post('status_hubungan_edu', true) : NULL,
            'id_edukator_edu' => $this->post('id_edukator_edu') !== '' ? $this->post('id_edukator_edu', true) : NULL,
            'pemahaman_awal_edu' => $this->post('pemahaman_awal_edu') !== '' ? $this->post('pemahaman_awal_edu', true) : NULL,
            'metoda_edu' => $this->post('metoda_edu') !== '' ? $this->post('metoda_edu', true) : NULL,
            'media_edu' => $this->post('media_edu') !== '' ? $this->post('media_edu', true) : NULL,
            'evaluasi_edu' => $this->post('evaluasi_edu') !== '' ? $this->post('evaluasi_edu', true) : NULL,
            'tanggal_re_edu' => $this->post('tanggal_re_edu') !== '' ? $this->post('tanggal_re_edu') : NULL,
            'ttd_keluarga_edu' => $this->post('ttd_keluarga_edu', false),
            'ttd_edukator_edu' => $this->post('ttd_edukator_edu', false),
        );

        $this->m_pelayanan->simpanDetailEdukasi($data_detail, $id_edukasi);
        if ($this->db->trans_status() === false) :
            $this->db->trans_rollback();
            $response = array('status' => false, 'alert' => 'error', 'message' => 'Gagal menyimpan edukasi pasien dan keluarga terintegrasi');
        else :
            $this->db->trans_commit();
            $response = array('status' => true, 'alert' => 'success', 'message' => 'Berhasil menyimpan edukasi pasien dan keluarga terintegrasi');
        endif;

        $this->response($response, REST_Controller::HTTP_OK);
    }

    function hapus_edukasi_delete($id)
    {
        $status = $this->m_pelayanan->deleteEdukasi($id);
        if ($status) {
            $response = array('status' => $status, 'message' => 'Berhasil menghapus edukasi');
        } else {
            $response = array('status' => $status, 'message' => 'Gagal menghapus edukasi');
        }
        $this->response($response, REST_Controller::HTTP_OK);
    }
    // end edukasi

    // surat
    function simpan_surat_post()
    {
        if (!$this->post('id_layanan_pendaftaran', true)) :
            $this->response(array('status' => false, 'message' => 'Parameter tidak lengkap'), REST_Controller::HTTP_BAD_GATEWAY);
        endif;

        $data = array(
            'id' => safe_post('id'),
            'id_layanan_pendaftaran' => safe_post('id_layanan_pendaftaran'),
            'kode' => $this->m_pelayanan->getAutoNumberSurat($this->post('id_layanan_pendaftaran'), $this->post('jenis_surat_aps')),
            'waktu' => $this->datetime,
            'nik' => safe_post('nik_pjwb_aps'),
            'nama' => safe_post('nama_pjwb_aps'),
            'tanggal_lahir' => (safe_post('tgl_lahir_pjwb_aps') !== '' ? date2mysql(safe_post('tgl_lahir_pjwb_aps')) : NULL),
            'kelamin' => safe_post('kelamin_pjwb_aps'),
            'alamat' => safe_post('alamat_pjwb_aps'),
            'no_telp' => safe_post('telp_pjwb_aps'),
            'status_hubungan' => safe_post('status_hubungan_pjwb_aps'),
            'jenis_surat' => safe_post('jenis_surat_aps'),
            'alasan' => safe_post('alasan'),
            'id_pasien' => (safe_post('id_pasien') !== '' ? safe_post('id_pasien') : NULL),
            'id_user' => $this->session->userdata('id_translucent'),
        );

        $reponse = $this->m_pelayanan->simpanSurat($data);
        $this->response($reponse, REST_Controller::HTTP_OK);
    }

    function get_data_surat_get()
    {
        if (!$this->get('id_layanan_pendaftaran', true)) :
            $this->response(array('status' => false, 'message' => 'Parameter tidak lengkap'), REST_Controller::HTTP_BAD_GATEWAY);
        endif;

        $data = $this->m_pelayanan->getDataSurat($this->get('id_layanan_pendaftaran', true));
        $this->response($data, REST_Controller::HTTP_OK);
    }
    // end surat

    // penjualan
    function get_detail_harga_barang_penjualan_get()
    {
        $param = array(
            'id_barang' => $this->get('id', true),
            'id_kemasan' => $this->get('id_kemasan', true)
        );
        $data = $this->m_pelayanan->getDetailHargaBarangPenjualan($param);
        $this->response($data, REST_Controller::HTTP_OK);
    }

    function get_data_penjualan_get()
    {
        $id = $this->get('id', true);
        $data = $this->m_pelayanan->getDataPenjualan($id);
        $this->response($data, REST_Controller::HTTP_OK);
    }

    function delete_data_penjualan_delete()
    {
        $id = $this->get('id', true);
        $data = $this->m_pelayanan->deleteDataPenjualan($id);
        $this->response($data, REST_Controller::HTTP_OK);
    }

    function get_detail_penjualan_get()
    {
        $id = $this->get('id', true);
        $data = $this->m_pelayanan->getDataDetailPenjualan($id);
        $this->response($data, REST_Controller::HTTP_OK);
    }
    // end penjualan

    // operasi
    function get_load_data_operasi_get()
    {
        $jenis = $this->get('jenis', true);
        $id_layanan = $this->get('id_layanan', true);
        $data = $this->m_pelayanan->getLoadDataOperasi($id_layanan, $jenis)->result();
        exit(json_encode($data));
    }

    function hapus_jadwal_operasi_delete()
    {
        $id = $this->delete('id', true);
        $id_layanan_pendaftaran = $this->delete('id_layanan_pendaftaran', true);
        $jenis = $this->delete('jenis', true);
        $data = $this->m_pelayanan->hapusJadwalOperasi($id, $id_layanan_pendaftaran, $jenis);
        exit(json_encode($data));
    }
    // end operasi

    function check_history_pembayaran_get()
    {
        $param = ['table' => $this->get('table', true), 'id' => $this->get('id', true)];
        $data = $this->m_pelayanan->checkHistoryPembayaran($param);
        $this->response($data, REST_Controller::HTTP_OK);
    }

    //bimroh
    function get_load_data_bimroh_get()
    {
        $id_layanan = $this->get('id_layanan', true);
        $data = $this->m_pelayanan->getLoadDataBimroh($id_layanan)->result();
        exit(json_encode($data));
    }

    function hapus_order_bimroh_delete()
    {
        $id = $this->delete('id', true);
        $id_layanan_pendaftaran = $this->delete('id_layanan_pendaftaran', true);
        $data = $this->m_pelayanan->hapusOrderBimroh($id, $id_layanan_pendaftaran);
        exit(json_encode($data));
    }
    //end bimroh

    //talqin

    function get_load_data_talqin_get()
    {
        $id_layanan = $this->get('id_layanan', true);
        $data = $this->m_pelayanan->getLoadDataTalqin($id_layanan)->result();
        exit(json_encode($data));
    }

    function hapus_order_talqin_delete()
    {
        $id = $this->delete('id', true);
        $id_layanan_pendaftaran = $this->delete('id_layanan_pendaftaran', true);
        $data = $this->m_pelayanan->hapusOrderTalqin($id, $id_layanan_pendaftaran);
        exit(json_encode($data));
    }

    //end talqin

    function status_keluar_sementara_get()
    {
        if (!$this->get('id_pendaftaran') & !$this->get('id_layanan_pendaftaran')) :
            $this->response(NULL, REST_Controller::HTTP_BAD_REQUEST);
        endif;
        $id_pendaftaran         = $this->get('id_pendaftaran');
        $id_layanan_pendaftaran = $this->get('id_layanan_pendaftaran');
        $response = $this->m_pelayanan->statusKeluarSementara($id_pendaftaran, $id_layanan_pendaftaran);
        $this->load->model('logs/Logs_model', 'm_logs');
        $this->m_logs->recordAdminLogs($id_layanan_pendaftaran, 'Status keluar Sementara, ' . $response['tindak_lanjut']);
        $this->response($response, REST_Controller::HTTP_OK);
    }

    function status_keluar_sementara_mcu_get()
    {
        if (!$this->get('id_pendaftaran') & !$this->get('id_layanan_pendaftaran')) :
            $this->response(NULL, REST_Controller::HTTP_BAD_REQUEST);
        endif;
        $id_pendaftaran         = $this->get('id_pendaftaran');
        $id_layanan_pendaftaran = $this->get('id_layanan_pendaftaran');
        $response = $this->m_pelayanan->statusKeluarSementaraMCU($id_pendaftaran, $id_layanan_pendaftaran);
        $this->load->model('logs/Logs_model', 'm_logs');
        $this->m_logs->recordAdminLogs($id_layanan_pendaftaran, 'Status keluar Sementara, ' . $response['tindak_lanjut']);
        $this->response($response, REST_Controller::HTTP_OK);
    }


    function status_keluar_sementara_it_get()
    {
        if (!$this->get('id_pendaftaran') & !$this->get('id_layanan_pendaftaran')) :
            $this->response(NULL, REST_Controller::HTTP_BAD_REQUEST);
        endif;
        $id_pendaftaran         = $this->get('id_pendaftaran');
        $id_layanan_pendaftaran = $this->get('id_layanan_pendaftaran');
        $response = $this->m_pelayanan->statusKeluarSementaraIt($id_pendaftaran, $id_layanan_pendaftaran);
        $this->load->model('logs/Logs_model', 'm_logs');
        $this->m_logs->recordAdminLogs($id_layanan_pendaftaran, 'Status keluar Sementara, ' . $response['tindak_lanjut']);
        $this->response($response, REST_Controller::HTTP_OK);
    }

    function pembatalan_status_keluar_sementara_get()
    {
        if (!$this->get('id_pendaftaran') & !$this->get('id_layanan_pendaftaran')) :
            $this->response(NULL, REST_Controller::HTTP_BAD_REQUEST);
        endif;
        $id_pendaftaran         = $this->get('id_pendaftaran');
        $id_layanan_pendaftaran = $this->get('id_layanan_pendaftaran');
        $response = $this->m_pelayanan->pembatalanStatusKeluarSementara($id_pendaftaran, $id_layanan_pendaftaran);
        $this->load->model('logs/Logs_model', 'm_logs');
        $this->m_logs->recordAdminLogs($id_layanan_pendaftaran, 'Batal Status keluar Sementara, ' . $response['tindak_lanjut']);
        $this->response($response, REST_Controller::HTTP_OK);
    }

    function pembatalan_status_keluar_sementara_mcu_get()
    {
        if (!$this->get('id_pendaftaran') & !$this->get('id_layanan_pendaftaran')) :
            $this->response(NULL, REST_Controller::HTTP_BAD_REQUEST);
        endif;
        $id_pendaftaran         = $this->get('id_pendaftaran');
        $id_layanan_pendaftaran = $this->get('id_layanan_pendaftaran');
        $response = $this->m_pelayanan->pembatalanStatusKeluarSementaraMCU($id_pendaftaran, $id_layanan_pendaftaran);
        $this->load->model('logs/Logs_model', 'm_logs');
        $this->m_logs->recordAdminLogs($id_layanan_pendaftaran, 'Batal Status keluar Sementara, ' . $response['tindak_lanjut']);
        $this->response($response, REST_Controller::HTTP_OK);
    }

    private function autentikasi_user_post($x = null)
    {

        $this->load->model('satu_sehat/Satu_sehat_model', 'sehat');

        $idUser = $this->session->userdata('id_translucent');

        $dataAkses = $this->sehat->aksesSatuSehat($idUser);

        $xKonfigurasi = $this->sehat->getConfigSatuSehat();

        if(empty($dataAkses)){

            $cekTimeissued = $this->sehat->aksesTimeissued();

            $waktu = (int)$cekTimeissued->timeissued;

            date_default_timezone_set('Asia/Jakarta');
            $tanggalTunggu = (round(microtime(true) * 1000));
            $satuJam = 120000;
            $tglWaktu = (int)$tanggalTunggu - (int)$waktu;

            if((int)$tglWaktu === (int)$satuJam || (int)$tglWaktu > (int)$satuJam){

                $url = $xKonfigurasi->auth."accesstoken?grant_type=client_credentials";

                $header = $this->sehat->authHeader();

                $params=array(
                                "client_id" => $xKonfigurasi->clientid,
                                "client_secret" => $xKonfigurasi->clientsecret
                            );
                
                $data_api = http_build_query($params);

                $output = $this->sehat->postCurl($url, $data_api, $header);

                if($output['result'] !== false){

                    if($output['respon'] === 200){

                        $result = json_decode($output['result']);
                        date_default_timezone_set('Asia/Jakarta');

                        $data_response = array(

                            "userakses"         => (int)$idUser,
                            "nama"              => $this->session->userdata('nama'),
                            "token"             => $result->access_token,
                            "timeissued"        => $result->issued_at,
                            "app_name"          => $result->application_name,
                            "tanggal"           => date('Y-m-d H:i:s')

                        );

                        $this->db->insert('sm_akses_satu_sehat', $data_response);

                    } else {

                        date_default_timezone_set('Asia/Jakarta');

                        $dataResponse = array(

                            "userakses"         => (int)$idUser,
                            "nama"              => $this->session->userdata('nama'),
                            "token"             => $cekTimeissued->token,
                            "timeissued"        => $cekTimeissued->timeissued,
                            "app_name"          => $cekTimeissued->app_name,
                            "tanggal"           => date('Y-m-d H:i:s')

                        );

                        $this->db->insert('sm_akses_satu_sehat', $dataResponse);

                        $xDetailData = ["kategori" => "Autentikasi", "param" => $idUser, "message" => $output['result'], "jenis_data" => 'error', "tanggal" => date('Y-m-d H:i:s'), "user" => $this->session->userdata('nama'), "respon" => $output['respon'], "function" => 'autentikasi_user_post Pelayanan'];
                        $this->db->insert('sm_satu_sehat_log', $xDetailData);

                    }

                } else {

                    date_default_timezone_set('Asia/Jakarta');

                    $dataResponse = array(

                        "userakses"         => (int)$idUser,
                        "nama"              => $this->session->userdata('nama'),
                        "token"             => $cekTimeissued->token,
                        "timeissued"        => $cekTimeissued->timeissued,
                        "app_name"          => $cekTimeissued->app_name,
                        "tanggal"           => date('Y-m-d H:i:s')

                    );

                    $this->db->insert('sm_akses_satu_sehat', $dataResponse);

                    $xDetailData = ["kategori" => "Autentikasi", "param" => $idUser, "message" => 'false', "jenis_data" => 'error', "tanggal" => date('Y-m-d H:i:s'), "user" => $this->session->userdata('nama'), "function" => 'autentikasi_user_post Pelayanan'];
                    $this->db->insert('sm_satu_sehat_log', $xDetailData);

                }

            } else {

                date_default_timezone_set('Asia/Jakarta');

                $dataResponse = array(

                    "userakses"         => (int)$idUser,
                    "nama"              => $this->session->userdata('nama'),
                    "token"             => $cekTimeissued->token,
                    "timeissued"        => $cekTimeissued->timeissued,
                    "app_name"          => $cekTimeissued->app_name,
                    "tanggal"           => date('Y-m-d H:i:s')

                );

                $this->db->insert('sm_akses_satu_sehat', $dataResponse);

            }

        } else {

            $cekTimeissued = $this->sehat->aksesTimeissued();

            if(isset($dataAkses->timeissued) && !is_null($dataAkses->timeissued)){

                $waktu = (int)$cekTimeissued->timeissued;

                date_default_timezone_set('Asia/Jakarta');
                $tanggalTunggu = (round(microtime(true) * 1000));
                $satuJam = 120000;
                $tglWaktu = (int)$tanggalTunggu - (int)$waktu;

                if((int)$tglWaktu === (int)$satuJam || (int)$tglWaktu > (int)$satuJam){

                    $url = $xKonfigurasi->auth."accesstoken?grant_type=client_credentials";

                    $header = $this->sehat->authHeader();

                    $params=array(
                                    "client_id" => $xKonfigurasi->clientid,
                                    "client_secret" => $xKonfigurasi->clientsecret
                                );
                    
                    $data_api = http_build_query($params);

                    $output = $this->sehat->postCurl($url, $data_api, $header);

                    if($output['result'] !== false){

                        if($output['respon'] === 200){

                            $result = json_decode($output['result']);
                            date_default_timezone_set('Asia/Jakarta');

                            $data_response = array(

                                "userakses"         => (int)$idUser,
                                "nama"              => $this->session->userdata('nama'),
                                "token"             => $result->access_token,
                                "timeissued"        => $result->issued_at,
                                "app_name"          => $result->application_name,
                                "tanggal"           => date('Y-m-d H:i:s')

                            );

                            $this->db->insert('sm_akses_satu_sehat', $data_response);

                        } else {

                            date_default_timezone_set('Asia/Jakarta');

                            $dataResponse = array(

                                "userakses"         => (int)$idUser,
                                "nama"              => $this->session->userdata('nama'),
                                "token"             => $cekTimeissued->token,
                                "timeissued"        => $cekTimeissued->timeissued,
                                "app_name"          => $cekTimeissued->app_name,
                                "tanggal"           => date('Y-m-d H:i:s')

                            );

                            $this->db->insert('sm_akses_satu_sehat', $dataResponse);

                            $xDetailData = ["kategori" => "Autentikasi", "param" => $idUser, "message" => $output['result'], "jenis_data" => 'error', "tanggal" => date('Y-m-d H:i:s'), "user" => $this->session->userdata('nama'), "respon" => $output['respon'], "function" => 'autentikasi_user_post Pelayanan'];
                            $this->db->insert('sm_satu_sehat_log', $xDetailData);

                        }

                    } else {

                        date_default_timezone_set('Asia/Jakarta');

                        $dataResponse = array(

                            "userakses"         => (int)$idUser,
                            "nama"              => $this->session->userdata('nama'),
                            "token"             => $cekTimeissued->token,
                            "timeissued"        => $cekTimeissued->timeissued,
                            "app_name"          => $cekTimeissued->app_name,
                            "tanggal"           => date('Y-m-d H:i:s')

                        );

                        $this->db->insert('sm_akses_satu_sehat', $dataResponse);

                        $xDetailData = ["kategori" => "Autentikasi", "param" => $idUser, "message" => 'false', "jenis_data" => 'error', "tanggal" => date('Y-m-d H:i:s'), "user" => $this->session->userdata('nama'), "function" => 'autentikasi_user_post Pelayanan'];
                        $this->db->insert('sm_satu_sehat_log', $xDetailData);

                    }

                } else {

                    date_default_timezone_set('Asia/Jakarta');

                    $update = ["token" => $cekTimeissued->token,"timeissued" => $cekTimeissued->timeissued,"app_name" => $cekTimeissued->app_name,"tanggal" => date('Y-m-d H:i:s')];

                    $id = (int)$idUser;

                    $data = $this->db->where('userakses', $id)->update('sm_akses_satu_sehat', $update);

                }

            } else {

                $url = $xKonfigurasi->auth."accesstoken?grant_type=client_credentials";

                $header = $this->sehat->authHeader();

                $params=array(
                                "client_id" => $xKonfigurasi->clientid,
                                "client_secret" => $xKonfigurasi->clientsecret
                            );
                
                $data_api = http_build_query($params);

                $output = $this->sehat->postCurl($url, $data_api, $header);

                if($output['result'] !== false){

                    if($output['respon'] === 200){

                        $result = json_decode($output['result']);
                        date_default_timezone_set('Asia/Jakarta');

                        $data_response = array(

                            "userakses"         => (int)$idUser,
                            "nama"              => $this->session->userdata('nama'),
                            "token"             => $result->access_token,
                            "timeissued"        => $result->issued_at,
                            "app_name"          => $result->application_name,
                            "tanggal"           => date('Y-m-d H:i:s')

                        );

                        $this->db->insert('sm_akses_satu_sehat', $data_response);

                    } else {

                        date_default_timezone_set('Asia/Jakarta');

                        $dataResponse = array(

                            "userakses"         => (int)$idUser,
                            "nama"              => $this->session->userdata('nama'),
                            "token"             => $cekTimeissued->token,
                            "timeissued"        => $cekTimeissued->timeissued,
                            "app_name"          => $cekTimeissued->app_name,
                            "tanggal"           => date('Y-m-d H:i:s')

                        );

                        $this->db->insert('sm_akses_satu_sehat', $dataResponse);

                        $xDetailData = ["kategori" => "Autentikasi", "param" => $idUser, "message" => $output['result'], "jenis_data" => 'error', "tanggal" => date('Y-m-d H:i:s'), "user" => $this->session->userdata('nama'), "respon" => $output['respon'], "function" => 'autentikasi_user_post Pelayanan'];
                        $this->db->insert('sm_satu_sehat_log', $xDetailData);

                    }

                } else {

                    date_default_timezone_set('Asia/Jakarta');

                    $dataResponse = array(

                        "userakses"         => (int)$idUser,
                        "nama"              => $this->session->userdata('nama'),
                        "token"             => $cekTimeissued->token,
                        "timeissued"        => $cekTimeissued->timeissued,
                        "app_name"          => $cekTimeissued->app_name,
                        "tanggal"           => date('Y-m-d H:i:s')

                    );

                    $this->db->insert('sm_akses_satu_sehat', $dataResponse);

                    $xDetailData = ["kategori" => "Autentikasi", "param" => $idUser, "message" => 'false', "jenis_data" => 'error', "tanggal" => date('Y-m-d H:i:s'), "user" => $this->session->userdata('nama'), "function" => 'autentikasi_user_post pelayanan'];
                    $this->db->insert('sm_satu_sehat_log', $xDetailData);

                }
                
            }

        }

    }

    private function update_encounter_put($idLayanan)
    {

        $this->autentikasi_user_post();

        if ($idLayanan === null) {

            date_default_timezone_set('Asia/Jakarta');

            $xDetailDataRequest = ["kategori" => "updateEncounter", "message" => 'id Layanan Tidak Ada', "jenis_data" => 'error', "tanggal" => date('Y-m-d H:i:s'), "user" => $this->session->userdata('nama'), "function" => 'update_encounter_put pelayanan'];

            $this->db->insert('sm_satu_sehat_log', $xDetailDataRequest);
            return;
            
        }

        $this->load->model('satu_sehat/Satu_sehat_model', 'sehat');

        $data = $this->sehat->cekidLayananPendaftaran($idLayanan);

        if ($data->id_poli !== null) {

            $idSpesial = (int)$data->id_poli;

            $nama = 1;

            $dataPoli = $this->sehat->cekDataPoli($nama, $idSpesial);

            if ($dataPoli !== null && $dataPoli !== '') {

                $lokasi = $dataPoli->integrasi_baru;
                $nama = $dataPoli->nama;

            } else {

                date_default_timezone_set('Asia/Jakarta');

                $xDetailDataRequest = ["kategori" => "updateEncounter", "no_rm" => $data->no_rm, "message" => 'Poli Belum di integrasi, Silakan integrasikan ke satu sehat terlebih dahulu', "jenis_data" => 'error', "tanggal" => date('Y-m-d H:i:s'), "user" => $this->session->userdata('nama'), "function" => 'update_encounter_put pelayanan'];

                $this->db->insert('sm_satu_sehat_log', $xDetailDataRequest);

                return;
            
            }

        } else {

            date_default_timezone_set('Asia/Jakarta');

            $xDetailDataRequest = ["kategori" => "updateEncounter", "no_rm" => $data->no_rm, "message" => 'Id Poli Tidak Ada', "jenis_data" => 'error', "tanggal" => date('Y-m-d H:i:s'), "user" => $this->session->userdata('nama'), "function" => 'update_encounter_put pelayanan'];

            $this->db->insert('sm_satu_sehat_log', $xDetailDataRequest);

            return;
        
        }

        if ($data->ihsn !== null) {

            $dataIhsn = $data->ihsn;
            $namaPasien = $data->nama_pasien;
        
        } else {

            date_default_timezone_set('Asia/Jakarta');

            $xDetailDataRequest = ["kategori" => "updateEncounter", "no_rm" => $data->no_rm, "message" => 'Silakan Integrasikan Pasien Terlebih Dahulu ke Satu Sehat', "jenis_data" => 'error', "tanggal" => date('Y-m-d H:i:s'), "user" => $this->session->userdata('nama'), "function" => 'update_encounter_put pelayanan'];

            $this->db->insert('sm_satu_sehat_log', $xDetailDataRequest);

            return;
        
        }

        if ($data->ihs_number !== null) {

            $dataIhsDokter = $data->ihs_number;
            $namaDokter = $data->nama_dokter;
        
        } else {

            date_default_timezone_set('Asia/Jakarta');

            $xDetailDataRequest = ["kategori" => "updateEncounter", "no_rm" => $data->no_rm, "message" => 'Silakan Integrasikan Dokter Terlebih Dahulu ke Satu Sehat', "jenis_data" => 'error', "tanggal" => date('Y-m-d H:i:s'), "user" => $this->session->userdata('nama'), "function" => 'update_encounter_put pelayanan'];

            $this->db->insert('sm_satu_sehat_log', $xDetailDataRequest);

            return;
        
        }

        $xKonfigurasi = $this->sehat->getConfigSatuSehat();

        $idOrganization = (int)$xKonfigurasi->organization;

        $idUser = $this->session->userdata('id_translucent');

        $getID = $this->sehat->aksesSatuSehat($idUser);

        $tokenBearer = $getID->token;

        $idParams = $data->id_encounter;

        $url = $xKonfigurasi->apiurl . "Encounter/" . $idParams;

        $header = $this->sehat->authBearer($tokenBearer);

        $waktuStart = $data->task_tiga;

        $waktuProgress = $data->task_empat;

        $waktuEnd = $data->task_lima;

        $konvTimeStart = $this->konverTimeStamp($waktuStart);

        $konvTimeProgress = $this->konverTimeStamp($waktuProgress);

        $konvTimeEnd = $this->konverTimeStamp($waktuEnd);

        $timeStart = date('c', $konvTimeStart / 1000);

        $timeProgress = date('c', $konvTimeProgress / 1000);

        $timeEnd = date('c', $konvTimeEnd / 1000);

        $params = array(

            "resourceType"    => "Encounter",
            "id" => $data->id_encounter,
            "identifier"  => [
                array(
                    "system"  => "http://sys-ids.kemkes.go.id/encounter/" . $idOrganization,
                    "value"   => $data->kode_booking
                )
            ],
            "status"  => "in-progress",
            "class"   => array(
                "system"    => "http://terminology.hl7.org/CodeSystem/v3-ActCode",
                "code"      => "AMB",
                "display"   => "ambulatory"
            ),
            "subject"     => array(

                "reference" => "Patient/" . $dataIhsn,
                "display"   => $namaPasien

            ),
            "participant" => [
                array(
                    "type"    => [
                        array(
                            "coding"  => [
                                array(
                                    "system"  => "http://terminology.hl7.org/CodeSystem/v3-ParticipationType",
                                    "code"    => "ATND",
                                    "display" => "attender"
                                )
                            ]
                        )
                    ],
                    "individual" => array(
                        "reference" => "Practitioner/" . $dataIhsDokter,
                        "display"   => $namaDokter
                    )
                )
            ],
            "period"  => array(
                "start" => $timeStart,
                "end"   => $timeEnd
            ),
            "location"  => [array(

                "location" => array(
                    "reference"  => "Location/" . $lokasi,
                    "display"    => $nama
                )
            )],
            "statusHistory"   => [
                array(
                    "status"   => "arrived",
                    "period"   => array(
                        "start"   => $timeStart,
                        "end"   => $timeProgress
                    )
                ),
                array(
                    "status"   => "in-progress",
                    "period"   => array(
                        "start"   => $timeProgress
                    )
                )
            ],
            "serviceProvider"   => array(
                "reference" => "Organization/" . $idOrganization
            )
        );

        $data_api = json_encode($params);

        $output = $this->sehat->putEncounter($url, $data_api, $header);

        if($output['result'] !== false){

            if ($output['respon'] === 200) {

                $result = json_decode($output['result']);

                $update = ["in_progress" => 'OK'];

                $this->db->where('id', (int)$idLayanan)->update('sm_layanan_pendaftaran', $update);

                date_default_timezone_set('Asia/Jakarta');

                $xDetailDataRequest = ["kategori" => "updateEncounter", "no_rm" => $data->no_rm, "message" => json_encode($params), "jenis_data" => 'ok', "tanggal" => date('Y-m-d H:i:s'), "user" => $this->session->userdata('nama'), "function" => 'integrasi_encounter_post pelayanan'];

                $this->db->insert('sm_satu_sehat_log', $xDetailDataRequest);

            } else {

                date_default_timezone_set('Asia/Jakarta');

                $xDetailDataRequest = ["kategori" => "updateEncounter", "no_rm" => $data->no_rm, "message" => $output['result'], "jenis_data" => 'error', "tanggal" => date('Y-m-d H:i:s'), "user" => $this->session->userdata('nama'), "respon" => $output['respon'], "param" => json_encode($params), "function" => 'update_encounter_put pelayanan'];

                $this->db->insert('sm_satu_sehat_log', $xDetailDataRequest);

            }

        }

    }

    private function lakukan_task_lima($id_pendaftaran, $id_layanan_pendaftaran)
    {
        $cekBooking = $this->m_pelayanan->cekBookingPendaftaran($id_pendaftaran);

        if (isset($cekBooking->kode_booking)) {

            $kodeBookingBPJS = $cekBooking->kode_booking;

            if (!empty($kodeBookingBPJS)) {

                $jenis_layanan = $this->db->select('jenis_layanan')->from('sm_layanan_pendaftaran')->where('id', $id_layanan_pendaftaran)->get()->row()->jenis_layanan;

                if ($jenis_layanan === 'Poliklinik') {

                    $cek_booking_pendaftaran = $this->m_pelayanan->cekBookingPendaftaran($id_pendaftaran);

                    $cekBookingAntrean = $this->m_pelayanan->cekBookingAntrean((int)$id_pendaftaran);

                    $cekKodeBooking = $cekBookingAntrean->kode_booking;

                    $cekAntrian = $this->m_pelayanan->cekBookingAntrian($cekKodeBooking);

                    if (isset($cek_booking_pendaftaran->kode_booking)) {

                        $kode_booking_bpjs = $cek_booking_pendaftaran->kode_booking;

                        if ($cekAntrian->task_lima === null) {

                            if (!empty($kode_booking_bpjs)) {

                                date_default_timezone_set('Asia/Jakarta');
                                $tanggalTunggu = (round(microtime(true) * 1000));
                                $new_estimasi  = date('Y-m-d H:i:s', $tanggalTunggu / 1000);

                                $update = ["task_lima" => $new_estimasi];

                                $get_id_antrian = $this->m_pelayanan->getIdAntrean($kode_booking_bpjs);
                                $id_antrian     = (int) $get_id_antrian->id;

                                $data = $this->db->where('id', $id_antrian)->update('sm_antrian_bpjs', $update);

                                $data_response = array(
                                    "nomor_task"     => 5,
                                    "waktu_task"     => $tanggalTunggu,
                                    "kode_booking"   => $kode_booking_bpjs,
                                    "id_antrian"     => $id_antrian,
                                    "konversi_waktu" => $new_estimasi,
                                );

                                $cek_respon_bpjs = $this->m_pelayanan->getResponseBPJS($kode_booking_bpjs, 5);

                                if (!isset($cek_respon_bpjs->id)) {

                                    $hasil = $this->db->insert('sm_update_task_bpjs', $data_response);

                                    $message['decode'] = ["metaData" => ["code" => 200, "message" => 'Task 5 Berhasil di update']];
                                }

                                $taskEmpat = $cekBookingAntrean->task_empat;

                                if ($taskEmpat === null) {

                                    $cekTask = 5;

                                    $noTaskSb = (int)$cekTask - 1;
                                    $noTaskSbb = (int)$cekTask - 2;

                                    $cekResponBpjs = $this->m_pelayanan->getResponseBPJS($cekKodeBooking, (int)$noTaskSb);

                                    if ($cekResponBpjs === null) {

                                        $cekResponBpjsTiga = $this->m_pelayanan->getResponseBPJS($cekKodeBooking, (int)$noTaskSbb);
                                        $cekResponBpjsLima = $this->m_pelayanan->getResponseBPJS($cekKodeBooking, (int)$cekTask);

                                        if (isset($cekResponBpjsTiga) && isset($cekResponBpjsLima)) {

                                            $cekWaktuTiga = $cekResponBpjsTiga->waktu_task;
                                            $cekWaktuLima = $cekResponBpjsLima->waktu_task;

                                            $totalCek = (int)$cekWaktuTiga + (int)$cekWaktuLima;
                                            $totalBagiDua = (int)$totalCek / 2;

                                            date_default_timezone_set('Asia/Jakarta');

                                            $newEstimasi = date('Y-m-d H:i:s', (int)$totalBagiDua / 1000);

                                            if ((int)$noTaskSb === 4) {

                                                $updateTaskEmpat = ["task_empat" => $newEstimasi];
                                            }

                                            $idAntrian = (int)$cekAntrian->id;

                                            $this->db->where('id', (int)$idAntrian)->update('sm_antrian_bpjs', $updateTaskEmpat);

                                            $dataResponse = array(
                                                "nomor_task"        => 4,
                                                "waktu_task"        => $totalBagiDua,
                                                "kode_booking"      => $cekKodeBooking,
                                                "id_antrian"        => (int)$idAntrian,
                                                "konversi_waktu"    => $newEstimasi,
                                                "id_users"          => $this->session->userdata('id_translucent'),
                                            );

                                            $this->db->insert('sm_update_task_bpjs', $dataResponse);
                                        }
                                    }
                                }

                                $jenisLayanan = $this->db->select('id_encounter')->from('sm_layanan_pendaftaran')->where('id', $id_layanan_pendaftaran)->get()->row()->id_encounter;

                                if (empty($jenisLayanan)) {

                                    $this->integrasi_encounter_post($id_layanan_pendaftaran);
                                
                                }

                                if (isset($id_layanan_pendaftaran)) {

                                    $this->update_encounter_put($id_layanan_pendaftaran);
                                }

                            }
                        }
                    }
                }
            }
        }
    }

    function simpan_visit_anestesi_put()
    {
        $this->db->trans_begin();
        $data = array(
            'id_layanan_pendaftaran'    => $this->put('id_layanan_pendaftaran_visit'),
            'id_pegawai'                => $this->put('id_dokter_visit'),
            'visited_at'                => $this->datetime
        );

        $this->db->insert('sm_visit_anestesi', $data);
        if ($this->db->trans_status() === false) :
            $this->db->trans_rollback();
            $status = false;
            $message = 'Gagal melakukan visit pemeriksaan';
        else :
            $this->db->trans_commit();
            $status = true;
            $message = 'Berhasil melakukan visit pemeriksaan';
        endif;

        $this->response(array('status' => $status, 'message' => $message));
    }

    public function get_dokter_spesialisasi_get()
    {
        $id_spesialisasi = $this->get('id_spesialisasi');
        $tanggal         = date('Y-m-d');

        $data = $this->db->select('jd.*, s.nama as nama_poli')
            ->from('sm_jadwal_dokter jd')
            ->join('sm_spesialisasi s', 'jd.id_poli = s.id')
            ->where('id_poli', $id_spesialisasi)
            ->where('tanggal', $tanggal)
            ->get()
            ->result();

        $this->response($data, REST_Controller::HTTP_OK);
    }

    function get_jadwal_spesialisasi_get()
    {
        $id_spesialisasi = $this->get('id_spesialisasi');
        $tanggal = $this->get('tanggal');

        $data = $this->m_pelayanan->getJadwalSpesialisasi($id_spesialisasi, $tanggal);
        $this->response($data, REST_Controller::HTTP_OK);
    }

    function simpan_surat_kontrol_dokter_post($jenis = NULL)
    {
        $this->db->trans_begin();
        $skbtype            = '';
        $skbid              = NULL;
        $skbcode            = '';
        $skbmessage         = '';
        $id_skd             = safe_post('skd_id');
        $id_pendaftaran     = '';
        $id_layanan_pendaftaran = '';
        $jenis              = '';
        $id_spesialisasi    = safe_post('skd_id_unit_layanan_tujuan');
        $id_spesialisasi_asal = safe_post('skd_id_unit_layanan_asal');
		$id_jadwal_dokter   = safe_post('skd_id_jadwal_dokter');
 
        $nosep      = safe_post('skd_nosep');
        $bpjsdokter = safe_post('skd_bpjs_dokter_tujuan');
        $bpjspoli   = safe_post('skd_bpjs_unit_layanan_tujuan');
        $tglkontrol = safe_post('skd_tanggal_kontrol');
        $responskb  = '';

        if (safe_post('skd_id_layanan_pendaftaran') === '') :
            $this->response(NULL, REST_Controller::HTTP_BAD_REQUEST);
        endif;

        $noskb                  = safe_post('skd_noskb') !== '' ? safe_post('skd_noskb') : '';
        $id_penjamin            = safe_post('skd_id_penjamin');
        $id_pendaftaran         = safe_post('skd_id_pendaftaran');
        $id_layanan_pendaftaran = safe_post('skd_id_layanan_pendaftaran');

        $countSKD = $this->db->select('count(sk.id) as jumlah')
            ->from('sm_surat_kontrol sk')
            ->join('sm_antrian_bpjs ab', "sk.id = ab.id_skd", 'left')
            ->where('sk.id_layanan_pendaftaran', $id_layanan_pendaftaran, true)
            ->where('sk.id_spesialisasi', safe_post('skd_id_unit_layanan_tujuan'), true)
            ->where("(ab.id IS NULL OR ab.status <> 'Batal')")
            // ->where('sk.id_pasien <>', '00013671', true)
            ->get()->row()->jumlah;

        $countSKDKnj = $this->db->select('count(sk.id) as jumlah')
            ->from('sm_surat_kontrol sk')
            ->join('sm_antrian_bpjs ab', "sk.id = ab.id_skd ", 'left')
            ->where('sk.id_pasien', safe_post('skd_id_pasien'), true)
            ->where('sk.tanggal', date2mysql(safe_post('skd_tanggal_kontrol')), true)
            ->where("(ab.id IS NULL OR ab.status <> 'Batal')")
            // ->where('sk.id_pasien <>', '00013671', true)
            ->get()->row()->jumlah;

        // Kondisi SKK
        // $countSKD=0;
        // $countSKDKnj =0;

        if ($countSKD >= 1 && $id_skd == '') {
            $status     = false;
            $message    = 'Gagal simpan! Sudah Diterbitkan Rencana Kunjungan Kontrol Di Poli yang sama';
        } else if ($countSKDKnj >= 1 && $id_skd == '') {
            $status     = false;
            $message    = 'Gagal simpan! Sudah Diterbitkan Rencana Kunjungan Kontrol Tanggal yang sama';
        } else {

            if ($id_spesialisasi != '' && $id_spesialisasi_asal != '') {
                $id_spesialisasi === $id_spesialisasi_asal ? $jenis = 'Surat Kontrol' : $jenis = 'Surat Kontrol Internal';
            } else {
                $jenis = 'Surat Kontrol';
            }

            $dataInset = array(
                'id_pendaftaran'         => $id_pendaftaran,
                'id_layanan_pendaftaran' => $id_layanan_pendaftaran,
                'tanggal'                => safe_post('skd_tanggal_kontrol') !== '' ? date2mysql(safe_post('skd_tanggal_kontrol')) : NULL,
                'id_spesialisasi'        => safe_post('skd_id_unit_layanan_tujuan') !== '' ? safe_post('skd_id_unit_layanan_tujuan') : NULL,
                'id_user'                => $this->session->userdata('id_translucent'),
                'jenis'                  => $jenis,
                'id_spesialisasi_asal'   => safe_post('skd_id_unit_layanan_asal') !== '' ? safe_post('skd_id_unit_layanan_asal') : NULL,
                'id_pasien'              => safe_post('skd_id_pasien') !== '' ? safe_post('skd_id_pasien') : NULL,
                'id_penjamin'            => safe_post('skd_id_penjamin') !== '' ? safe_post('skd_id_penjamin') : NULL,
                'alasan_kontrol'         => safe_post('skd_alasan_kontrol') !== '' ? safe_post('skd_alasan_kontrol') : NULL,
                'rencana_tindak_lanjut'  => safe_post('skd_tindak_lanjut') !== '' ? safe_post('skd_tindak_lanjut') : NULL,
                'jenis_bantuan'          => json_encode(array(
                    'konsul' => safe_post('skd_konsul'),
                    'raber'  => safe_post('skd_raber'),
                    'alih'   => safe_post('skd_alih'),
                )),
                'dirawat_dengan'         => safe_post('skd_dirawat_dengan') !== '' ? safe_post('skd_dirawat_dengan') : NULL,
                'keterangan'             => safe_post('skd_keterangan') !== '' ? safe_post('skd_keterangan') : NULL,
                'prb'                    => safe_post('skd_prb') !== '' ? safe_post('skd_prb') : 0,
                'is_preoperasi'          => safe_post('skd_preoperasi') !== '' ? safe_post('skd_preoperasi') : 0,
                'created_date'           => $this->datetime,
                'updated_date'           => $this->datetime,
                'id_dokter_asal'         => safe_post('skd_id_dokter_asal') !== '' ? safe_post('skd_id_dokter_asal') : 0,
                'id_dokter_tujuan'       => safe_post('skd_id_dokter_tujuan') !== '' ? safe_post('skd_id_dokter_tujuan') : NULL,
				'id_jadwal_dokter'       => $id_jadwal_dokter !== '' ? $id_jadwal_dokter : NULL,
            );




            // Start SKB                    
            if ($this->bridgingBpjs) {
                if ($id_penjamin == '1') { //BPJS
                    if ($noskb == '') {
                        if ($nosep != '' && $bpjsdokter != '' && $bpjspoli != '' && $tglkontrol != '' && $jenis == 'Surat Kontrol') {
                            $responskb  = $this->simpan_surat_kontrol_bpjs('create', $nosep, $bpjsdokter, $bpjspoli, $tglkontrol, $noskb);
                            $skbtype    = 'create';
                            $skbid      = $responskb['metaData']['id_skb'];
                            $skbcode    = $responskb['metaData']['code'];
                            $skbmessage = $responskb['metaData']['message'];
                        } else {
                            $datakosong = '';
                            $nosep != ''      ? '' : $datakosong = 'no sep,';
                            $bpjsdokter != '' ? '' : $datakosong = 'kode bpjs dokter,';
                            $bpjspoli != ''   ? '' : $datakosong = 'kode bpjs poli,';
                            $tglkontrol != '' ? '' : $datakosong = 'tgl kontrol,';
                            $skbtype    = 'create';
                            $skbcode    = '';
                            $skbmessage = 'Buat SKB gagal. Data tidak lengkap : ' . $datakosong;
                        }
                    } else {
                        if ($nosep != '' && $bpjsdokter != '' && $bpjspoli != '' && $tglkontrol != '' && $jenis == 'Surat Kontrol') {
                            $responskb  = $this->simpan_surat_kontrol_bpjs('update', $nosep, $bpjsdokter, $bpjspoli, $tglkontrol, $noskb);
                            $skbtype    = 'update';
                            $skbid      = $responskb['metaData']['id_skb'];
                            $skbcode    = $responskb['metaData']['code'];
                            $skbmessage = $responskb['metaData']['message'];
                        } else {
                            //Otomatis hapus SKB jika data edit tidak lengkap
                            $responskb  = $this->simpan_surat_kontrol_bpjs('delete', '', '', '', '', $noskb);
                            $skbtype    = 'update delete';
                            $skbid      = $responskb['metaData']['id_skb'];
                            $skbcode    = $responskb['metaData']['code'];
                            $skbmessage = $responskb['metaData']['message'];
                        }
                    }
                } else {
                    $skbtype    = '';
                    $skbcode    = '';
                    $skbmessage = 'SKB tidak dibuat bukan jaminan BPJS';
                }

                //Simpan hasil SKB ke Surat Kontrol
                $dataInset['skb_code']    = $skbcode;
                $dataInset['skb_message'] = $skbmessage;
            } else {
                $skbtype    = '';
                $skbcode    = '';
                $skbmessage = 'SKB tidak dibuat bridging dimatikan';
                $dataInset['skb_message'] = 'SKB tidak dibuat bridging dimatikan';
            }

            // End SKB

            if ($id_skd == '') {
                $dataInset['id_skb'] = $skbid;
                unset($dataInset['updated_date']);
                $this->db->insert('sm_surat_kontrol', $dataInset);
            } else {
                $this->m_pelayanan->UpdateDataSKD($id_skd);
                // $dataInset['id_skb'] = $skbid;
                $dataWhere = array('id' => $id_skd);
                unset($dataInset['created_date']);
                $this->db->update('sm_surat_kontrol', $dataInset, $dataWhere);
            }

            if ($this->db->trans_status() === false) :
                $this->db->trans_rollback();
                $status  = false;
                $message = "Gagal menyimpam Surat Ket Kontrol Dokter. Hubungi IT";
            else :
                $this->db->trans_commit();
                $status = true;

                $status = true;
                $message = "Berhasil menyimpam Surat Ket Kontrol Dokter";
            endif;
        }

        $this->load->model('logs/Logs_model', 'm_logs');
        $this->m_logs->recordAdminLogs($id_layanan_pendaftaran, 'Surat Kontrol Dokter ' .  $message);
        $response = array('status' => $status, 'token' => $this->security->get_csrf_hash(), 'message' => $message, 'skbtype' => $skbtype, 'skbcode' => $skbcode, 'skbmessage' => $skbmessage);
        $this->response($response, REST_Controller::HTTP_OK);
        // return $response;

    }

    function simpan_surat_kontrol_bpjs($type, $nosep, $bpjsdokter, $bpjspoli, $tglkontrol, $noskb)
    {
        $id_skb = NULL;
        if ($type == 'create') {
            $url = $this->bpjs_configv2->server . "/RencanaKontrol/insert";
            $request = array(
                "request" => array(
                    "noSEP"             => $nosep,
                    "kodeDokter"        => $bpjsdokter,
                    "poliKontrol"       => $bpjspoli,
                    "tglRencanaKontrol" => date2mysql($tglkontrol),
                    "user"              => $this->session->userdata("account")
                )
            );

            $header = $this->m_sep_v2->createHeader($this->bpjs_configv2);
            $header[4] = "Content-type: Application/x-www-form-urlencoded";
            $output = postCurl($url, json_encode($request), $header);
            $decode = json_decode($output);
            if ($decode == null) {
                $decode = ["metaData" => ["code" => $this->code, "message" => $this->message]];
                die(json_encode($decode));
            }
            $decode->response = $this->m_sep_v2->decryptResponse($decode->response, $this->bpjs_configv2);

            //var_dump($decode->response);

            if (isset($decode->response) && $decode->metaData->code === "200") {
                if ($decode->response !== NULL) {
                    $penjamin = $this->db->select('id_pasien')->from('sm_penjamin_pasien')->where('no_polish', $decode->response->noKartu, true)->get()->row();
                    $data_insert = array(
                        'id_pasien'             => isset($penjamin) ? $penjamin->id_pasien : NULL,
                        'jenis'                 => '2',
                        'tgl_rencana_kontrol'   => $decode->response->tglRencanaKontrol,
                        'dokter'                => $decode->response->namaDokter,
                        'no_kartu'              => $decode->response->noKartu,
                        'id_user'               => $this->session->userdata("id_translucent"),
                        'created_date'          => $this->datetime,
                        'id_pendaftaran_asal'   => safe_post('skd_id_pendaftaran'),
                        'id_layanan_pendaftaran_asal' => safe_post('skd_id_layanan_pendaftaran'),
                    );

                    $data_insert['no_surat'] = $decode->response->noSuratKontrol;
                    $this->db->insert('sm_surat_kontrol_bpjs', $data_insert);
                    $id_skb = $this->db->insert_id();
                }
            }
        } else if ($type == 'update') {
            $url = $this->bpjs_configv2->server . "/RencanaKontrol/Update";
            $request = array(
                "request" => array(
                    "noSuratKontrol"    => $noskb,
                    "noSEP"             => $nosep,
                    "kodeDokter"        => $bpjsdokter,
                    "poliKontrol"       => $bpjspoli,
                    "tglRencanaKontrol" => date2mysql($tglkontrol),
                    "user"              => $this->session->userdata("account")
                )
            );
            $header = $this->m_sep_v2->createHeader($this->bpjs_configv2);
            $header[4] = "Content-type: Application/x-www-form-urlencoded";
            $output = customCurl("PUT", $url, json_encode($request), $header);
            $decode = json_decode($output);
            if ($decode == null) {
                $decode = ["metaData" => ["code" => $this->code, "message" => $this->message]];
                die(json_encode($decode));
            }
            $decode->response = $this->m_sep_v2->decryptResponse($decode->response, $this->bpjs_configv2);
            if (isset($decode->response) && $decode->metaData->code === "200") {
                if ($decode->response !== NULL) {

                    $this->m_pelayanan->SuratKontrolBpjsLogs($noskb);
                    $penjamin = $this->db->select('id_pasien')->from('sm_penjamin_pasien')->where('no_polish', $decode->response->noKartu, true)->get()->row();
                    $data_update = array(
                        'id_pasien'             => isset($penjamin) ? $penjamin->id_pasien : NULL,
                        'jenis'                 => '2',
                        'tgl_rencana_kontrol'   => $decode->response->tglRencanaKontrol,
                        'dokter'                => $decode->response->namaDokter,
                        'no_kartu'              => $decode->response->noKartu,
                        'id_user'               => $this->session->userdata("id_translucent"),
                        'updated_date'          => $this->datetime,
                        'id_pendaftaran_asal'   => safe_post('skd_id_pendaftaran'),
                        'id_layanan_pendaftaran_asal' => safe_post('skd_id_layanan_pendaftaran'),
                    );

                    $dataWhere = array('no_surat' => $noskb);
                    $this->db->update('sm_surat_kontrol_bpjs', $data_update, $dataWhere);
                }
            }
        } else if ($type == 'delete') {
            $url = $this->bpjs_configv2->server . "/RencanaKontrol/Delete";
            $request = array(
                "request" => array(
                    "t_suratkontrol" => array(
                        "noSuratKontrol" => $noskb,
                        "user" => $this->session->userdata("account"),
                    )
                )
            );
            $header = $this->m_sep_v2->createHeader($this->bpjs_configv2);
            $header[4] = "Content-type: Application/x-www-form-urlencoded";
            $output = customCurl("DELETE", $url, json_encode($request), $header);
            $decode = json_decode($output);
            if ($decode == null) {
                $decode = ["metaData" => ["code" => $this->code, "message" => $this->message]];
                die(json_encode($decode));
            }
            $decode->response = $this->m_sep_v2->decryptResponse($decode->response, $this->bpjs_configv2);
            if (isset($decode->response) && $decode->metaData->code === "200") {
                if ($decode->response !== NULL) {
                    $this->m_pelayanan->SuratKontrolBpjsLogs($noskb);
                    $this->db->where('no_surat', $noskb)->delete('sm_surat_kontrol_bpjs');
                }
            }
        }

        return ["metaData" => ["id_skb" => $id_skb, "code" => $decode->metaData->code, "message" => $decode->metaData->message]];
    }

    function simpan_surat_kontrol_dokter_internal_post($jenis = NULL)
    {
        $id_skdi_pengirim = safe_post('skdi_id');
        $id_skdi_jawab = safe_post('skdi_id_jawab');
        $id_layanan_pendaftaran = safe_post('skdi_id_layanan_pendaftaran');

        $this->db->trans_begin();

        $dataInset = array(
            'id_sk'         => $id_skdi_pengirim,
            'pemeriksaan'   => safe_post('skdi_hasil_pemeriksaan') !== '' ? safe_post('skdi_hasil_pemeriksaan') : NULL,
            'saran'         => safe_post('skdi_saran') !== '' ? safe_post('skdi_saran') : NULL,
            'id_user'       => $this->session->userdata('id_translucent'),
            'created_date'  => $this->datetime,
            'updated_date'  => $this->datetime,
        );
        // $this->m_pelayanan->simpanSuratKontrolDokter($dataInset);

        if ($id_skdi_jawab == '') {
            unset($dataInset['updated_date']);
            $this->db->insert('sm_surat_kontrol_internal', $dataInset);
        } else {
            $this->m_pelayanan->UpdateDataSKDI($id_skdi_jawab);
            $dataWhere = array('id' => $id_skdi_jawab);
            unset($dataInset['created_date']);
            $this->db->update('sm_surat_kontrol_internal', $dataInset, $dataWhere);
        }

        if ($this->db->trans_status() === false) :
            $this->db->trans_rollback();
            $status  = false;
            $message = "Gagal menyimpam Jawaban Surat Kontrol Internal";
        else :
            $this->db->trans_commit();
            $status = true;

            $status = true;
            $message = "Berhasil menyimpam Jawaban Surat Kontrol Internal";
        endif;

        $this->load->model('logs/Logs_model', 'm_logs');
        $this->m_logs->recordAdminLogs($id_layanan_pendaftaran, 'Surat Kontrol Dokter ' . 'Simpan Berhasil');
        $response = array('status' => $status, 'token' => $this->security->get_csrf_hash(), 'message' => $message);
        $this->response($response, REST_Controller::HTTP_OK);
    }



 




    // MONITORING // GRVK
    function get_data_entri_monitoring_get(){
        if (!$this->get('id')) :
            $this->response(NULL, REST_Controller::HTTP_BAD_REQUEST); // (400)
        endif;       
        $this->load->model('pendaftaran/Pendaftaran_model', 'm_pendaftaran');
        $data = $this->m_pendaftaran->getPendaftaranDetail($this->get('id', true), $this->get('id_layanan', true));
        $data['profil'] = $this->m_pelayanan->getProfilPasien($data['pasien']->id_pasien);   
        // data grafik monitoring
        $data['grafik_monitoring'] = $this->m_pelayanan->getaGrafikMonitoring($this->get('id', true), $this->get('id_layanan', true));
        // MP-A
        $data['monitoring_pasien_1']  = $this->m_pelayanan->getMonitoringPasien1($this->get('id', true));   
        // MPP-C 1 
        $data['monitoring_pasien_2'] = $this->m_pelayanan->getMonitoringPasien2($this->get('id', true));        
        if ($data) :
            $this->response($data, REST_Controller::HTTP_OK); // (200)
        endif;
    }
    
    // MONITORING BARU
    function simpan_grafik_monitoring_post(){
        // Ambil data dari input
        $data = array(
            'id_layanan_pendaftaran' => safe_post('id_layanan_pendaftaran'),
            'id_pendaftaran'         => safe_post('id_pendaftaran'),
            'id_user'                => safe_post('id_user'),
            'mp_suhu'                => safe_post('suhu'),
            'mp_rr'                  => safe_post('rr'),
            'mp_nadi'                => safe_post('nadi'),
            'mp_jam'                 => safe_post('jam'),
            'mp_tgl'                 => safe_post('tgl')
        );

        // Simpan data ke database
        $this->m_pelayanan->insertGrafikMonitoring($data);

        // Ambil data yang baru saja disimpan untuk dikembalikan dalam respons
        $data = $this->m_pelayanan->getaGrafikMonitoring($data['id_pendaftaran'], $data['id_layanan_pendaftaran']);

        // Kembalikan data dalam respons
        $this->response($data, REST_Controller::HTTP_OK);      
    }

    // GRAFIK MONITORING BARU LOGS
    function update_grafik_monitoring_post(){
        $id = safe_post('id');
    
        // Ambil data lama
        $lama = $this->db->get_where('sm_grafik_monitoring', ['id' => $id])->row_array();
    
        // Format tanggal dari dd/mm/yyyy ke yyyy-mm-dd
        $tanggal_input = safe_post('tgl');
        $mp_tanggal = null;
        if (!empty($tanggal_input)) {
            $tanggal_obj = DateTime::createFromFormat('d/m/Y', $tanggal_input);
            if ($tanggal_obj) {
                $mp_tanggal = $tanggal_obj->format('Y-m-d');
            }
        }
    
        // Ambil data baru dari POST
        $data_baru = array(
            'id'                      => $id,
            'id_layanan_pendaftaran' => safe_post('id_layanan_pendaftaran'),
            'id_pendaftaran'         => safe_post('id_pendaftaran'),
            'id_user'                => safe_post('id_user'),
            'mp_suhu'                => safe_post('suhu'),
            'mp_rr'                  => safe_post('rr'),
            'mp_nadi'                => safe_post('nadi'),
            'mp_jam'                 => safe_post('jam'),
            'mp_tanggal'             => $mp_tanggal,
            'updated_at'             => date('Y-m-d H:i:s'),
        );
    
        // Cek apakah ada perubahan dibanding data lama
        if ($lama) {
            $perubahan = false;
            foreach (['mp_suhu', 'mp_rr', 'mp_nadi', 'mp_jam', 'mp_tanggal'] as $key) {
                if ($lama[$key] != $data_baru[$key]) {
                    $perubahan = true;
                    break;
                }
            }
    
            if ($perubahan) {
                $log = $lama;
                unset($log['id']);
                $log['created_at'] = date('Y-m-d H:i:s');
                $log['keterangan'] = 'Update';
                $this->m_pelayanan->insertLogsGrafikMonitoring($log);
            }
        }
    
        // Update data utama
        $this->m_pelayanan->updateGrafikMonitoring($data_baru);
    
        // Ambil data terbaru
        $updatedData = $this->m_pelayanan->getaGrafikMonitoring($data_baru['id_pendaftaran']);
    
        // Kirim response
        $this->response($updatedData, REST_Controller::HTTP_OK);
    }

    // GRAFIK MONITORING BARU LOGS
    function hapus_grafik_monitoring_delete($id, $id_layanan_pendaftaran, $id_pendaftaran){
        // Ambil data sebelum dihapus
        $lama = $this->db->get_where('sm_grafik_monitoring', ['id' => $id])->row_array();
    
        if ($lama) {
            // Simpan ke log
            $log = $lama;
            unset($log['id']); // Hindari konflik primary key
            $log['created_at'] = date('Y-m-d H:i:s');
            $log['keterangan'] = 'Delete'; // Boleh ditambahin biar tahu asalnya dari hapus
            $this->m_pelayanan->insertLogsGrafikMonitoring($log);
        }
    
        // Lakukan penghapusan
        $this->m_pelayanan->deleteGrafikMonitoring($id);
    
        // Ambil data terbaru
        $data = $this->m_pelayanan->getaGrafikMonitoring($id_pendaftaran);
        $this->response($data, REST_Controller::HTTP_OK);
    }
    
    // MONITORING BARU
    function get_grafik_monitoring_by_id_get($id){
        $data = $this->m_pelayanan->getaGrafikMonitoringByID($id);
        $this->response($data, REST_Controller::HTTP_OK);
    }

    // MONITORING 
    function simpan_monitoring_pasien_post(){
        $layanan = array('id' => safe_post('id_layanan_pendaftaran'));
        $this->db->trans_begin();
        $id = $layanan['id'];

        $checkMonitoringPasieeen =  $this->db->select("*")
        ->from('sm_monitoring_pasien_a')
        ->where('id_layanan_pendaftaran', $id, true)
        ->get()->row();

        if ($checkMonitoringPasieeen == NULL) {
        $monitoring_pasieeen = array(
            'id_layanan_pendaftaran'    => $id,
            'tanggal_mp'                => safe_post('tanggal_mp') !== '' ? date('Y-m-d', strtotime(str_replace('/', '-', safe_post('tanggal_mp')))) : NULL,
            'bb_mp'                     => safe_post('bb_mp') !== '' ? safe_post('bb_mp') : NULL,
            'tb_mp'                     => safe_post('tb_mp') !== '' ? safe_post('tb_mp') : NULL,
            // MONITORING PASIEN (NEWS)
            'sews_laju_respirasi'   => safe_post('laju_respirasi_mp') !== '' ? safe_post('laju_respirasi_mp') : NULL,
            'sews_saturasi_2'       => safe_post('saturasi_mp') !== '' ? safe_post('saturasi_mp') : NULL,
            'spo2_skala2_news'      => safe_post('spo2_skala2_news') !== '' ? safe_post('spo2_skala2_news') : NULL,
            'sews_suplemen'         => safe_post('suplemen_mp') !== '' ? safe_post('suplemen_mp') : NULL,
            'td_sistolik_news'      => safe_post('td_sistolik_news') !== '' ? safe_post('td_sistolik_news') : NULL,
            'nadi_news'             => safe_post('nadi_news') !== '' ? safe_post('nadi_news') : NULL,
            'kesadaran_news'        => safe_post('kesadaran_news') !== '' ? safe_post('kesadaran_news') : NULL,
            'suhu_newst'            => safe_post('suhu_newst') !== '' ? safe_post('suhu_newst') : NULL,
            'sews_total_2'          => safe_post('total_mpnews') !== '' ? safe_post('total_mpnews') : NULL,

            // MONITORING PASIEN (MEOWS)
            'sews_respirasi'       => safe_post('respirasi_mpp') !== '' ? safe_post('respirasi_mpp') : NULL,
            'sews_saturasi_1'      => safe_post('saturasi_mpp') !== '' ? safe_post('saturasi_mpp') : NULL,
            'sews_o2'              => safe_post('o2_mpp') !== '' ? safe_post('o2_mpp') : NULL,
            'sews_suhu'            => safe_post('suhu_mpp') !== '' ? safe_post('suhu_mpp') : NULL,
            'sews_td_sistolik'     => safe_post('sintolik_mpp') !== '' ? safe_post('sintolik_mpp') : NULL,
            'sews_td_diastolik'    => safe_post('diastolik_mpp') !== '' ? safe_post('diastolik_mpp') : NULL,
            'sews_nadi'            => safe_post('nadi_mpp') !== '' ? safe_post('nadi_mpp') : NULL,
            'sews_kesadaran_1'     => safe_post('kesadaran_mpp') !== '' ? safe_post('kesadaran_mpp') : NULL,
            'sews_nyeri'           => safe_post('nyeri_11_mpp') !== '' ? safe_post('nyeri_11_mpp') : NULL,
            'sews_pengeluaran'     => safe_post('pengeluwaran_11_mpp') !== '' ? safe_post('pengeluwaran_11_mpp') : NULL,
            'sews_protein_urin'    => safe_post('protein_mpp') !== '' ? safe_post('protein_mpp') : NULL,
            'sews_total_1'         => safe_post('total_mpmeows') !== '' ? safe_post('total_mpmeows') : NULL,

            // MONITORING PASIEN (PEWS)
            'pews_suhu'             => safe_post('suhu2') !== '' ? safe_post('suhu2') : NULL,
            'pews_pernafasan'       => safe_post('pernafasan2') !== '' ? safe_post('pernafasan2') : NULL,
            'pews_subpernafasan'    => safe_post('subpernafasan2') !== '' ? safe_post('subpernafasan2') : NULL,
            'pews_alat_bantu'       => safe_post('alat_bantu2') !== '' ? safe_post('alat_bantu2') : NULL,
            'pews_saturasi'         => safe_post('saturasi2') !== '' ? safe_post('saturasi2') : NULL,
            'pews_nadi'             => safe_post('nadi2') !== '' ? safe_post('nadi2') : NULL,
            'pews_warna_kulit'      => safe_post('warna_kulit2') !== '' ? safe_post('warna_kulit2') : NULL,
            'pews_tds'              => safe_post('tds2') !== '' ? safe_post('tds2') : NULL,
            'pews_kesadaran'        => safe_post('kesadaran2') !== '' ? safe_post('kesadaran2') : NULL,
            'pews_total'            => safe_post('total_skalapews') !== '' ? safe_post('total_skalapews') : NULL,

            'user_created'             => $this->session->userdata('id_translucent'),
        );

        $this->db->insert('sm_monitoring_pasien_a', $monitoring_pasieeen);
        } else {
        $monitoring_pasieeen = array(
            'id_layanan_pendaftaran'    => $id,
            'tanggal_mp'                => safe_post('tanggal_mp') !== '' ? date('Y-m-d', strtotime(str_replace('/', '-', safe_post('tanggal_mp')))) : NULL,
            'bb_mp'                     => safe_post('bb_mp') !== '' ? safe_post('bb_mp') : NULL,
            'tb_mp'                     => safe_post('tb_mp') !== '' ? safe_post('tb_mp') : NULL,
            // MONITORING PASIEN (NEWS)
            'sews_laju_respirasi'   => safe_post('laju_respirasi_mp') !== '' ? safe_post('laju_respirasi_mp') : NULL,
            'sews_saturasi_2'       => safe_post('saturasi_mp') !== '' ? safe_post('saturasi_mp') : NULL,
            'spo2_skala2_news'      => safe_post('spo2_skala2_news') !== '' ? safe_post('spo2_skala2_news') : NULL,
            'sews_suplemen'         => safe_post('suplemen_mp') !== '' ? safe_post('suplemen_mp') : NULL,
            'td_sistolik_news'      => safe_post('td_sistolik_news') !== '' ? safe_post('td_sistolik_news') : NULL,
            'nadi_news'             => safe_post('nadi_news') !== '' ? safe_post('nadi_news') : NULL,
            'kesadaran_news'        => safe_post('kesadaran_news') !== '' ? safe_post('kesadaran_news') : NULL,
            'suhu_newst'            => safe_post('suhu_newst') !== '' ? safe_post('suhu_newst') : NULL,
            'sews_total_2'          => safe_post('total_mpnews') !== '' ? safe_post('total_mpnews') : NULL,

            // MONITORING PASIEN (MEOWS)
            'sews_respirasi'       => safe_post('respirasi_mpp') !== '' ? safe_post('respirasi_mpp') : NULL,
            'sews_saturasi_1'      => safe_post('saturasi_mpp') !== '' ? safe_post('saturasi_mpp') : NULL,
            'sews_o2'              => safe_post('o2_mpp') !== '' ? safe_post('o2_mpp') : NULL,
            'sews_suhu'            => safe_post('suhu_mpp') !== '' ? safe_post('suhu_mpp') : NULL,
            'sews_td_sistolik'     => safe_post('sintolik_mpp') !== '' ? safe_post('sintolik_mpp') : NULL,
            'sews_td_diastolik'    => safe_post('diastolik_mpp') !== '' ? safe_post('diastolik_mpp') : NULL,
            'sews_nadi'            => safe_post('nadi_mpp') !== '' ? safe_post('nadi_mpp') : NULL,
            'sews_kesadaran_1'     => safe_post('kesadaran_mpp') !== '' ? safe_post('kesadaran_mpp') : NULL,
            'sews_nyeri'           => safe_post('nyeri_11_mpp') !== '' ? safe_post('nyeri_11_mpp') : NULL,
            'sews_pengeluaran'     => safe_post('pengeluwaran_11_mpp') !== '' ? safe_post('pengeluwaran_11_mpp') : NULL,
            'sews_protein_urin'    => safe_post('protein_mpp') !== '' ? safe_post('protein_mpp') : NULL,
            'sews_total_1'         => safe_post('total_mpmeows') !== '' ? safe_post('total_mpmeows') : NULL,

            // MONITORING PASIEN (PEWS)
            'pews_suhu'             => safe_post('suhu2') !== '' ? safe_post('suhu2') : NULL,
            'pews_pernafasan'       => safe_post('pernafasan2') !== '' ? safe_post('pernafasan2') : NULL,
            'pews_subpernafasan'    => safe_post('subpernafasan2') !== '' ? safe_post('subpernafasan2') : NULL,
            'pews_alat_bantu'       => safe_post('alat_bantu2') !== '' ? safe_post('alat_bantu2') : NULL,
            'pews_saturasi'         => safe_post('saturasi2') !== '' ? safe_post('saturasi2') : NULL,
            'pews_nadi'             => safe_post('nadi2') !== '' ? safe_post('nadi2') : NULL,
            'pews_warna_kulit'      => safe_post('warna_kulit2') !== '' ? safe_post('warna_kulit2') : NULL,
            'pews_tds'              => safe_post('tds2') !== '' ? safe_post('tds2') : NULL,
            'pews_kesadaran'        => safe_post('kesadaran2') !== '' ? safe_post('kesadaran2') : NULL,
            'pews_total'            => safe_post('total_skalapews') !== '' ? safe_post('total_skalapews') : NULL,
            // 'user_created'       	 	 => $this->session->userdata('id_translucent'),
        );
        $this->db->where('id_layanan_pendaftaran', $id);
        $this->db->update('sm_monitoring_pasien_a', $monitoring_pasieeen);
        }

        $id_users = safe_post('id_user');
        $layanan = array('id' => safe_post('id_layanan_pendaftaran')); 
        $pencegahan_date_mpp = safe_post('pencegahan_date_mpp');  
        // KALAU GA ADA IINI PASTI EROR
        $id_pendaftaran           = safe_post('id_pendaftaran');  

        if (!empty($pencegahan_date_mpp)) {
        // var_dump($pencegahan_date_mpp);die;

        $monitoring_pasien_2 = array(
            'id_pendaftaran'         => $id_pendaftaran,
            'id_layanan_pendaftaran' => $layanan['id'],
            'id_user'                => safe_post('user_pengkajian') !== '' ? safe_post('user_pengkajian') : null,
            'oral_mpp'               => safe_post('oral_mpp') !== '' ? safe_post('oral_mpp') : null,
            'ngt_mpp'                => safe_post('ngt_mpp') !== '' ? safe_post('ngt_mpp') : null,
            'paranteral_mpp'         => safe_post('paranteral_mpp') !== '' ? safe_post('paranteral_mpp') : null,
            'paranteral_mppp'        => safe_post('paranteral_mppp') !== '' ? safe_post('paranteral_mppp') : null,
            'produk_mpp'             => safe_post('produk_mpp') !== '' ? safe_post('produk_mpp') : null,
            'input_mpp'              => safe_post('input_mpp') !== '' ? safe_post('input_mpp') : null,
            'urin_mpp'               => safe_post('urin_mpp') !== '' ? safe_post('urin_mpp') : null,
            'bab_mpp'                => safe_post('bab_mpp') !== '' ? safe_post('bab_mpp') : null,
            'gastrik_mpp'            => safe_post('gastrik_mpp') !== '' ? safe_post('gastrik_mpp') : null,
            'wsd_mpp'                => safe_post('wsd_mpp') !== '' ? safe_post('wsd_mpp') : null,
            'iwl_mpp'                => safe_post('iwl_mpp') !== '' ? safe_post('iwl_mpp') : null,
            'output_mpp'             => safe_post('output_mpp') !== '' ? safe_post('output_mpp') : null,
            'blance_cairan_mpp'      => safe_post('blance_cairan_mpp') !== '' ? safe_post('blance_cairan_mpp') : null,
            'tdarah_mpp'             => safe_post('tdarah_mpp') !== '' ? safe_post('tdarah_mpp') : null,
            'saturasi_mppp'          => safe_post('saturasi_mppp') !== '' ? safe_post('saturasi_mppp') : null,
            'toksigen_mpp'           => safe_post('toksigen_mpp') !== '' ? safe_post('toksigen_mpp') : null,
            'skesadaran_mpp'         => safe_post('skesadaran_mpp') !== '' ? safe_post('skesadaran_mpp') : null,
            'kategori_mpp'           => safe_post('kategori_mpp') !== '' ? safe_post('kategori_mpp') : null,
            'pengawasan_mpp'         => safe_post('pengawasan_mpp') !== '' ? safe_post('pengawasan_mpp') : null,
            'diit_mpp'               => safe_post('diit_mpp') !== '' ? safe_post('diit_mpp') : null,
            'tgl_mpp'                => safe_post('tgl_mpp') !== '' ? safe_post('tgl_mpp') : null,
            'jam_mpp'                => safe_post('jam_mpp') !== '' ? safe_post('jam_mpp') : null,
            'perawat_mpp'            => safe_post('perawat_mpp') !== '' ? safe_post('perawat_mpp') : null,
            'date_created'           => safe_post('pencegahan_date_mpp') !== '' ? safe_post('pencegahan_date_mpp') : null,

        );
        $this->m_pelayanan->insertMonitoringPasien2($monitoring_pasien_2);
        }
    
        if (!empty($respon)) {
        $response = $respon;
        } else {
        $response = null;
        }

        if ($this->db->trans_status() === false) :
        $this->db->trans_rollback();
        $status = false;
        else :
        $this->db->trans_commit();
        $status = true;
        endif;

        $message = array(
        'status' => $status,
        'token' => $this->security->get_csrf_hash(),
        'id' => $layanan['id'],
        'respon' => $response,
        );

        $this->response($message, REST_Controller::HTTP_OK);
    }

    // MPP-C 2 // MONITORING LOGS
	function monitoring_pasien_2_delete($id){
        $this->db->trans_begin();
    
        // Ambil data lama sebelum hapus
        $lama = $this->db->get_where('sm_monitoring_pasien_c', ['id' => $id])->row_array();
        if ($lama) {
            $log = $lama;
            unset($log['id']); // supaya tidak bentrok ID
            $log['updated_at'] = date('Y-m-d H:i:s'); // waktu penghapusan
            $log['created_at'] = date('Y-m-d H:i:s'); // atau created_log sesuai field log kamu
            $log['id_user'] = $this->session->userdata('id_translucent'); // siapa yang hapus
            // $log['deleted'] = true; // optional: tambahin info kalau ini dari delete
            $log['keterangan'] = 'Delete';
            $this->m_pelayanan->insertLogsMonitoringPasien2($log);
        }
    
        // Lanjut hapus datanya
        $status = $this->m_pelayanan->deleteMonitoringPasien2($id);
    
        if ($this->db->trans_status() === false || !$status) {
            $this->db->trans_rollback();
            $response = array('status' => false, 'message' => 'Gagal menghapus data!');
        } else {
            $this->db->trans_commit();
            $response = array('status' => true, 'message' => 'Berhasil menghapus data!');
        }
    
        $this->response($response, REST_Controller::HTTP_OK);
    }

    // MPP-C 3 // MONITORING LOGS
	function update_monitoring_pasien_2_put() {
        $this->db->trans_begin();
    
        $id = $this->put('id', true);
        if (!$id) {
            $this->response(['status' => false], REST_Controller::HTTP_OK);
            return;
        }
    
        // Ambil data lama untuk log
        $lama = $this->db->get_where('sm_monitoring_pasien_c', ['id' => $id])->row_array();
        if ($lama) {
            $log = $lama;
            unset($log['id']); // supaya tidak bentrok dengan auto increment ID logs
            $log['updated_at'] = date('Y-m-d H:i:s');
            $log['created_at'] = date('Y-m-d H:i:s'); // atau created_log kalau nama field-nya beda
            $log['id_user'] = $this->session->userdata('id_translucent'); // pastikan ini dapat id user
            $log['keterangan'] = 'Update';
            $this->m_pelayanan->insertLogsMonitoringPasien2($log);
        }

		$mpp_tgl = $this->put('tgl_mpp', true);
		$mpp_tgl = str_replace('/', '-', $mpp_tgl);
		$mpp_tgl = date('Y-m-d', strtotime($mpp_tgl));
    
        // Update data baru
        $data = [
			'tgl_mpp'           => $mpp_tgl ?: null,
            'jam_mpp'           => $this->put('jam_mpp', true) ?: null,
            'tdarah_mpp'        => $this->put('tdarah_mpp', true) ?: null,
            'saturasi_mppp'     => $this->put('saturasi_mppp', true) ?: null,
            'toksigen_mpp'      => $this->put('toksigen_mpp', true) ?: null,
            'skesadaran_mpp'    => $this->put('skesadaran_mpp', true) ?: null,
            'kategori_mpp'      => $this->put('kategori_mpp', true) ?: null,
            'pengawasan_mpp'    => $this->put('pengawasan_mpp', true) ?: null,
            'diit_mpp'          => $this->put('diit_mpp', true) ?: null,
            'oral_mpp'          => $this->put('oral_mpp', true) ?: null,
            'ngt_mpp'           => $this->put('ngt_mpp', true) ?: null,
            'paranteral_mpp'    => $this->put('paranteral_mpp', true) ?: null,
            'paranteral_mppp'   => $this->put('paranteral_mppp', true) ?: null,
            'produk_mpp'        => $this->put('produk_mpp', true) ?: null,
            'input_mpp'         => $this->put('input_mpp', true) ?: null,
            'urin_mpp'          => $this->put('urin_mpp', true) ?: null,
            'bab_mpp'           => $this->put('bab_mpp', true) ?: null,
            'gastrik_mpp'       => $this->put('gastrik_mpp', true) ?: null,
            'wsd_mpp'           => $this->put('wsd_mpp', true) ?: null,
            'iwl_mpp'           => $this->put('iwl_mpp', true) ?: null,
            'output_mpp'        => $this->put('output_mpp', true) ?: null,
            'blance_cairan_mpp' => $this->put('blance_cairan_mpp', true) ?: null,              
            'perawat_mpp'       => $this->put('perawat_mpp', true) ?: null, 
            'updated_at'        => date('Y-m-d H:i:s'),
            'id_user'           => $this->session->userdata('id_translucent'), // log siapa yg update
        ];
    
        $this->db->where('id', $id);
        $status = $this->db->update('sm_monitoring_pasien_c', $data);
    
        if ($this->db->trans_status() === false) {
            $this->db->trans_rollback();
            $this->response(['status' => false], REST_Controller::HTTP_OK);
        } else {
            $this->db->trans_commit();
            $this->response(['status' => true], REST_Controller::HTTP_OK);
        }
    }

    // MPP-C 4 // MONITORING
    function get_monitoring_pasien_2_get(){
         if (!$this->get('id', true)) :
             $this->response(null, REST_Controller::HTTP_BAD_REQUEST);
         endif;
         $data = $this->m_pelayanan->getMonitoringPasien2ByID($this->get('id', true));
         $this->response($data, REST_Controller::HTTP_OK);
    }











    function get_data_skd_get($id)
    {

        if ($id === NULL) :
            $this->response(NULL, REST_Controller::HTTP_BAD_REQUEST);
        endif;

        if (!$this->get('page')) :
            $this->response(NULL, REST_Controller::HTTP_BAD_REQUEST); // (400)
        endif;

        $start          = ($this->get('page') - 1) * $this->limit;
        $data           = $this->m_pelayanan->getDataSKD($id, $start, $this->limit);
        $data['page']   = (int) $this->get('page');
        $data['limit']  = $this->limit;

        if ($data) :
            $this->response($data, REST_Controller::HTTP_OK); // (200)
        endif;
    }

    function get_data_skd_riwayat_get($id)
    {

        if ($id === NULL) :
            $this->response(NULL, REST_Controller::HTTP_BAD_REQUEST);
        endif;

        if (!$this->get('page')) :
            $this->response(NULL, REST_Controller::HTTP_BAD_REQUEST); // (400)
        endif;

        $start          = ($this->get('page') - 1) * $this->limit;
        $data           = $this->m_pelayanan->getDataSKDRiwayat($id, $start, $this->limit);
        $data['page']   = (int) $this->get('page');
        $data['limit']  = $this->limit;

        if ($data) :
            $this->response($data, REST_Controller::HTTP_OK); // (200)
        endif;
    }

    function get_skd_id_get($id)
    {
        if ($id === NULL) :
            $this->response(NULL, REST_Controller::HTTP_BAD_REQUEST);
        endif;

        if (!$this->get('id', true)) :
            $this->response(NULL, REST_Controller::HTTP_BAD_REQUEST); // (400)
        endif;

        $data = $this->m_pelayanan->getSKDById($id);
        $this->response($data, REST_Controller::HTTP_OK);
    }

    function get_detail_pasien_skd_get($id_pendaftaran, $id_layanan_pendaftaran)
    {
        if ($id_pendaftaran === NULL) :
            $this->response(NULL, REST_Controller::HTTP_BAD_REQUEST);
        endif;

        if ($id_layanan_pendaftaran === NULL) :
            $this->response(NULL, REST_Controller::HTTP_BAD_REQUEST);
        endif;

        if (!$this->get('id_pendaftaran', true)) :
            $this->response(NULL, REST_Controller::HTTP_BAD_REQUEST); // (400)
        endif;

        if (!$this->get('id_layanan_pendaftaran', true)) :
            $this->response(NULL, REST_Controller::HTTP_BAD_REQUEST); // (400)
        endif;

        $data = $this->m_pelayanan->getDetailPasienSkd($id_pendaftaran, $id_layanan_pendaftaran);
        $dataRujukan = $this->m_pelayanan->getDetailRujukan($id_pendaftaran);

        $data->poli_rujukan      = NULL;
        $data->tgl_kadaluarsa    = NULL;
        $data->rujukan_kode_poli = NULL;
        $data->asal_rujukan      = NULL;
        $data->bridgingBpjs      = NULL;

        if($dataRujukan != NULL){
            $this->bridgingBpjs = $dataRujukan->kadaluarsa_rujukan != NULL ? FALSE : TRUE;
        } else {
            $this->bridgingBpjs = TRUE;
        }
		
		 // Sementara full bridging BPJS dulu karena ada bugs
		$this->bridgingBpjs = TRUE; 
		
        if ($data->no_rujukan != NULL) {
            if ($this->bridgingBpjs) {
                $rujukan = $this->get_rujukan_by_no_rujukan($data->no_rujukan);

                if ($rujukan && isset($rujukan->response) && $rujukan->response !== null && isset($rujukan->response->rujukan)) {
					
					
                    $rujukan = $rujukan->response->rujukan;
                    $poli_rujukan = $this->db->get_where('sm_spesialisasi', ['kode' => $rujukan->poliRujukan->kode])->row();

                    if (empty($poli_rujukan)) {
                        $data->poli_rujukan = $rujukan->poliRujukan->nama;
                    } else {
                        $data->poli_rujukan = $poli_rujukan->nama;
                    }

                    // if ($data->poli_rujukan == 'Hemodialisa') {
					if (($data->poli_rujukan == 'Hemodialisa') && ($data->id_unit_layanan == '59')) {
                        /* Khusus HD SKB di tujukan ke IPD */
                        $data->id_unit_layanan = 30; //Penyakit Dalam
                        $data->kode_bpjs_poli  = 'INT'; //Penyakit Dalam
                    }

                    // mendapatakan tanggal kadaluarsa
                    $data->tgl_kadaluarsa = date('Y-m-d', strtotime($rujukan->tglKunjungan . " +90 days"));
                    $data->rujukan_kode_poli = $rujukan->poliRujukan->kode;
                    $data->asal_rujukan = $rujukan->provPerujuk->nama;
                }
            } else {
                if($dataRujukan != NULL){
                    $data->poli_rujukan      = $dataRujukan->bpjs_poli_rujukan;
                    $data->tgl_kadaluarsa    = date("Y-m-d", strtotime($dataRujukan->kadaluarsa_rujukan));
                    $data->rujukan_kode_poli = $dataRujukan->kode_bpjs_poli_rujukan;
                    $data->asal_rujukan      = $dataRujukan->asal_faskes;
                }
            }
        }
		$data->bridgingBpjs = $this->bridgingBpjs;

        $antrian_bpjs = $this->db->get_where('sm_antrian_bpjs', ['id_pendaftaran' => $data->id_pendaftaran,])->row();
        if ($antrian_bpjs && isset($antrian_bpjs->is_kontrol_pasca_ranap) && $antrian_bpjs->is_kontrol_pasca_ranap !== null) {
            $data->kontrol_pasca_ranap = $antrian_bpjs->is_kontrol_pasca_ranap;
        } else {
            $data->kontrol_pasca_ranap = '';
        }


        $this->response($data, REST_Controller::HTTP_OK);
    }

    function delete_data_skd_delete()
    {
        $id = $this->get('id', true);
        $noskb = $this->get('no_skb', true);
        if ($id <= 0) :
            $this->response(NULL, REST_Controller::HTTP_BAD_REQUEST); // (400)
        endif;

        $skbid      = '';
        $skbcode    = '';
        $skbmessage = '';

        if (!empty($noskb)) {
            $responskb  = $this->simpan_surat_kontrol_bpjs('delete', '', '', '', '', $noskb);
            $skbid      = $responskb['metaData']['id_skb'];
            $skbcode    = $responskb['metaData']['code'];
            $skbmessage = $responskb['metaData']['message'];
        }

        $this->m_pelayanan->deleteDataSKD($id);
        // $message = [
        //     'message'    => 'Data SURAT KETERANGAN KONTROL berhasil dihapus.',
        //     'skbid'      => $skbid,
        //     'skbcode'    => $skbcode,
        //     'skbmessage' => $skbmessage
        // ];
        // $this->set_response($message, REST_Controller::HTTP_NO_CONTENT); // (204)

        // $this->load->model('logs/Logs_model', 'm_logs');
        // $this->m_logs->recordAdminLogs($id_layanan_pendaftaran, 'Surat Kontrol Dokter ' .  $message);
        $response = array('message' => 'Data SURAT KETERANGAN KONTROL berhasil dihapus.', 'skbid' => $skbid, 'skbcode' => $skbcode, 'skbmessage' => $skbmessage);
        $this->response($response, REST_Controller::HTTP_OK);
    }

    function get_bpjs_dokter_id_get($id)
    {
        if ($id === NULL) :
            $this->response(NULL, REST_Controller::HTTP_BAD_REQUEST);
        endif;

        if (!$this->get('id', true)) :
            $this->response(NULL, REST_Controller::HTTP_BAD_REQUEST); // (400)
        endif;

        $data = $this->m_pelayanan->getBPJSDokterById($id);
        $this->response($data, REST_Controller::HTTP_OK);
    }

    private function get_rujukan_by_no_rujukan($no_rujukan)
    {			
		$url1 = base_url('vclaim_bpjs/api/vclaim_bpjs_v2/get_rujukan?norujukan=' . $no_rujukan);
        $url2 = base_url('vclaim_bpjs/api/vclaim_bpjs_v2/get_rujukan_rs?norujukan=' . $no_rujukan);

        $header = $this->m_sep_v2->createHeader($this->bpjs_configv2);
        $rujukan = getCurl($url1, $header);
		$rujukan = json_decode($rujukan);
        //if (isset($rujukan->response) && $rujukan->response === null) {
        //if ($rujukan->metaData->code !== 201) {
        if ($rujukan->response === null) {
            $rujukan = getCurl($url2, $header);
            $rujukan = json_decode($rujukan);
        }

        return $rujukan;


        // MENGGABUNGKAN RESPONSE RUJUKAN FASKES 1 DAN FASKES 2
        // $url1 = base_url('vclaim_bpjs/api/vclaim_bpjs_v2/get_rujukan?norujukan=' . $no_rujukan);
        // $url2 = base_url('vclaim_bpjs/api/vclaim_bpjs_v2/get_rujukan_rs?norujukan=' . $no_rujukan);

        // $header = $this->m_sep_v2->createHeader($this->bpjs_configv2);
        // $rujukan1 = getCurl($url1, $header);
        // $rujukan1 = json_decode($rujukan1);
        // $rujukan2 = getCurl($url2, $header);
        // $rujukan2 = json_decode($rujukan2);

        // $rujukan = [];
        // if ($rujukan1->response !== NULL && $rujukan2->response !== NULL) {
        //  $rujukan = array_merge($rujukan1->response->rujukan, $rujukan2->response->rujukan);            
        // } elseif ($rujukan1->response !== NULL) {
        //  $rujukan = $rujukan1->response->rujukan;
        // } elseif ($rujukan2->response !== NULL) {
        //  $rujukan = $rujukan2->response->rujukan;
        // }   

        // if ($rujukan1->metaData->code !== '201') {
        //     $rujukan1->response->rujukan = $rujukan;
        //     $rujukan = $rujukan1;
        // } 

        // if ($rujukan2->metaData->code !== '201') {
        //     $rujukan2->response->rujukan = $rujukan;                
        //     $rujukan = $rujukan2;
        // }                    

        // return $rujukan;
    }

    public function update_selected_aturan_pakai_post()
    {
        $id = safe_post('id');

        $aturan_pakai_obat = $this->db->get_where('sm_aturan_pakai_obat', ['id' => $id])->row();

        // tambah selected_count
        $selected_count = $aturan_pakai_obat->selected_count + 1;
        $this->db->where('id', $id, true)->update('sm_aturan_pakai_obat', ['selected_count' => $selected_count]);

        $this->response(['status' => 'success', 'message' => 'Berhasil mengupdate selected_count']);
    }

    // PR + ubah
    function get_data_pengkajian_restrain_get()
    {
        if (!$this->get('id_layanan_pendaftaran')) :
            $this->response(NULL, REST_Controller::HTTP_BAD_REQUEST); // (400)
        endif;
        $this->load->model('pendaftaran/Pendaftaran_model', 'm_pendaftaran');
        $this->load->model('pelayanan/Pelayanan_model', 'm_pelayanan');
        $data                               = $this->m_pendaftaran->getPendaftaranDetail($this->get('id', true), $this->get('id_layanan', true));
        $data['profil']                     = $this->m_pelayanan->getProfilPasien($data['pasien']->id_pasien);
        $data['pengkajian_restrain']        = $this->m_pelayanan->getPengkajianRestrain($this->get('id', true));
        $data['pengkajian_restrain_logs']   = $this->m_pelayanan->getPengkajianRestrainLogs($this->get('id', true));
        $data['pemantauan_restrain']        = $this->m_pelayanan->getPemantauanRestrain($this->get('id', true));
        if ($data) :
            $this->response($data, REST_Controller::HTTP_OK); // (200)
        endif;
        // var_dump('pemantauan_restrain');die;
    }

    // PR LOGS 
    function get_history_logs_pengkajian_restrain_get()
    {
        if (!$this->get('id_layanan_pendaftaran', true)) :
            $this->response(NULL, REST_Controller::HTTP_BAD_REQUEST); // (400)
        endif;
        $id_layanan_pendaftaran = $this->get('id_layanan_pendaftaran', true);
        $data['pengkajian_restrain_logs']       = $this->m_pelayanan->getPengkajianRestrainLogs($id_layanan_pendaftaran);
        if ($data) :
            $this->response($data, REST_Controller::HTTP_OK); // (200)
        endif;
    }

    // PR
    function simpan_data_pengkajian_restrain_post()
    {

        if (safe_post('id_layanan_pendaftaran') === '') :
            $this->response(NULL, REST_Controller::HTTP_BAD_REQUEST);
        endif;

        $id_layanan_pendaftaran = safe_post('id_layanan_pendaftaran');
        $id_pendaftaran = safe_post('id_pendaftaran');;
        $id_pr = safe_post('id_pr');
        $id_users = safe_post('id_user');

        $PengkajianRestrian = array(
            'id_layanan_pendaftaran' => $id_layanan_pendaftaran,
            'id_pendaftaran' => $id_pendaftaran,
            'id_users' => $id_users,

            'gcs_pr' => json_encode([
                'gcs_pr_1' => safe_post('gcs_pr_1') !== '' ? safe_post('gcs_pr_1') : null,
                'gcs_pr_2' => safe_post('gcs_pr_2') !== '' ? safe_post('gcs_pr_2') : null,
                'gcs_pr_3' => safe_post('gcs_pr_3') !== '' ? safe_post('gcs_pr_3') : null,
                'gcs_pr_4' => safe_post('gcs_pr_4') !== '' ? safe_post('gcs_pr_4') : null,
                'gcs_pr_5' => safe_post('gcs_pr_5') !== '' ? safe_post('gcs_pr_5') : null,
                'gcs_pr_6' => safe_post('gcs_pr_6') !== '' ? safe_post('gcs_pr_6') : null,
            ]),

            'tanda_pr' => json_encode([
                'tanda_pr_1' => safe_post('tanda_pr_1') !== '' ? safe_post('tanda_pr_1') : null,
                'tanda_pr_2' => safe_post('tanda_pr_2') !== '' ? safe_post('tanda_pr_2') : null,
                'tanda_pr_3' => safe_post('tanda_pr_3') !== '' ? safe_post('tanda_pr_3') : null,
                'tanda_pr_4' => safe_post('tanda_pr_4') !== '' ? safe_post('tanda_pr_4') : null,
                'tanda_pr_5' => safe_post('tanda_pr_5') !== '' ? safe_post('tanda_pr_5') : null,
            ]),

            'hasil_pr' => json_encode([
                'hasil_pr_1' => safe_post('hasil_pr_1') !== '' ? safe_post('hasil_pr_1') : null,
                'hasil_pr_2' => safe_post('hasil_pr_2') !== '' ? safe_post('hasil_pr_2') : null,
                'hasil_pr_3' => safe_post('hasil_pr_3') !== '' ? safe_post('hasil_pr_3') : null,
            ]),

            'pertimbangan_pr' => json_encode([
                'pertimbangan_pr_1' => safe_post('pertimbangan_pr_1') !== '' ? safe_post('pertimbangan_pr_1') : null,
                'pertimbangan_pr_2' => safe_post('pertimbangan_pr_2') !== '' ? safe_post('pertimbangan_pr_2') : null,
            ]),

            'penilaian_pr' => json_encode([
                'penilaian_pr_1' => safe_post('penilaian_pr_1') !== '' ? safe_post('penilaian_pr_1') : null,
                'penilaian_pr_2' => safe_post('penilaian_pr_2') !== '' ? safe_post('penilaian_pr_2') : null,
                'penilaian_pr_3' => safe_post('penilaian_pr_3') !== '' ? safe_post('penilaian_pr_3') : null,
                'penilaian_pr_4' => safe_post('penilaian_pr_4') !== '' ? safe_post('penilaian_pr_4') : null,
                'penilaian_pr_5' => safe_post('penilaian_pr_5') !== '' ? safe_post('penilaian_pr_5') : null,
                'penilaian_pr_6' => safe_post('penilaian_pr_6') !== '' ? safe_post('penilaian_pr_6') : null,
                'penilaian_pr_7' => safe_post('penilaian_pr_7') !== '' ? safe_post('penilaian_pr_7') : null,
                'penilaian_pr_8' => safe_post('penilaian_pr_8') !== '' ? safe_post('penilaian_pr_8') : null,
            ]),

            'pendidikan_pr' => (safe_post('pendidikan_pr') !== '' ? safe_post('pendidikan_pr') : NULL),
            'perawat_bidan_pr' => safe_post('perawat_bidan_pr') !== '' ? safe_post('perawat_bidan_pr') : NULL,
            'keluarga_pr' => safe_post('keluarga_pr') !== '' ? safe_post('keluarga_pr') : NULL,
        );

        $layanan = array('id' => safe_post('id_layanan_pendaftaran'));
        $pr_tanggal_pemantauan = safe_post('pr_tanggal_pemantauan');
        $id_pendaftaran           = safe_post('id_pendaftaran');

        if (!empty($pr_tanggal_pemantauan)) {

            $pemantauan_prr_restrain = array(
                'id_pendaftaran'         => $id_pendaftaran,
                'id_layanan_pendaftaran' => $layanan['id'],
                'inisial_perawat_1'           => safe_post('inisial_perawat_1') !== '' ? safe_post('inisial_perawat_1') : null,
                'inisial_perawat_2'           => safe_post('inisial_perawat_2') !== '' ? safe_post('inisial_perawat_2') : null,
                'inisial_perawat_3'           => safe_post('inisial_perawat_3') !== '' ? safe_post('inisial_perawat_3') : null,
                'id_user'                => safe_post('user_pemantauan') !== '' ? safe_post('user_pemantauan') : null,
                'tanggal_pemantauan'     => safe_post('pr_tanggal_pemantauan'),

                'posisi_p_ho'               => safe_post('posisi_p_ho') !== '' ? safe_post('posisi_p_ho') : null,
                'posisi_p_10'               => safe_post('posisi_p_10') !== '' ? safe_post('posisi_p_10') : null,
                'posisi_s_ho'               => safe_post('posisi_s_ho') !== '' ? safe_post('posisi_s_ho') : null,
                'posisi_s_18'               => safe_post('posisi_s_18') !== '' ? safe_post('posisi_s_18') : null,
                'posisi_m_ho'               => safe_post('posisi_m_ho') !== '' ? safe_post('posisi_m_ho') : null,
                'posisi_m_23'               => safe_post('posisi_m_23') !== '' ? safe_post('posisi_m_23') : null,
                'posisi_m_4'                => safe_post('posisi_m_4') !== '' ? safe_post('posisi_m_4') : null,

                'edukasi_p_ho'              => safe_post('edukasi_p_ho') !== '' ? safe_post('edukasi_p_ho') : null,
                'edukasi_p_10'              => safe_post('edukasi_p_10') !== '' ? safe_post('edukasi_p_10') : null,
                'edukasi_s_ho'              => safe_post('edukasi_s_ho') !== '' ? safe_post('edukasi_s_ho') : null,
                'edukasi_s_18'              => safe_post('edukasi_s_18') !== '' ? safe_post('edukasi_s_18') : null,
                'edukasi_m_ho'              => safe_post('edukasi_m_ho') !== '' ? safe_post('edukasi_m_ho') : null,
                'edukasi_m_23'              => safe_post('edukasi_m_23') !== '' ? safe_post('edukasi_m_23') : null,
                'edukasi_m_4'               => safe_post('edukasi_m_4') !== '' ? safe_post('edukasi_m_4') : null,

                'cedera_p_ho'               => safe_post('cedera_p_ho') !== '' ? safe_post('cedera_p_ho') : null,
                'cedera_p_10'               => safe_post('cedera_p_10') !== '' ? safe_post('cedera_p_10') : null,
                'cedera_s_ho'               => safe_post('cedera_s_ho') !== '' ? safe_post('cedera_s_ho') : null,
                'cedera_s_18'               => safe_post('cedera_s_18') !== '' ? safe_post('cedera_s_18') : null,
                'cedera_m_ho'               => safe_post('cedera_m_ho') !== '' ? safe_post('cedera_m_ho') : null,
                'cedera_m_23'               => safe_post('cedera_m_23') !== '' ? safe_post('cedera_m_23') : null,
                'cedera_m_4'                => safe_post('cedera_m_4') !== '' ? safe_post('cedera_m_4') : null,

                'restrain_p_ho'               => safe_post('restrain_p_ho') !== '' ? safe_post('restrain_p_ho') : null,
                'restrain_p_10'               => safe_post('restrain_p_10') !== '' ? safe_post('restrain_p_10') : null,
                'restrain_s_ho'               => safe_post('restrain_s_ho') !== '' ? safe_post('restrain_s_ho') : null,
                'restrain_s_18'               => safe_post('restrain_s_18') !== '' ? safe_post('restrain_s_18') : null,
                'restrain_m_ho'               => safe_post('restrain_m_ho') !== '' ? safe_post('restrain_m_ho') : null,
                'restrain_m_23'               => safe_post('restrain_m_23') !== '' ? safe_post('restrain_m_23') : null,
                'restrain_m_4'                => safe_post('restrain_m_4') !== '' ? safe_post('restrain_m_4') : null,

                'ttd_p_ho'             => safe_post('ttd_p_ho') !== '' ? safe_post('ttd_p_ho') : null,
                'ttd_p_10'             => safe_post('ttd_p_10') !== '' ? safe_post('ttd_p_10') : null,
                'ttd_s_ho'             => safe_post('ttd_s_ho') !== '' ? safe_post('ttd_s_ho') : null,
                'ttd_s_18'             => safe_post('ttd_s_18') !== '' ? safe_post('ttd_s_18') : null,
                'ttd_m_ho'             => safe_post('ttd_m_ho') !== '' ? safe_post('ttd_m_ho') : null,
                'ttd_m_23'             => safe_post('ttd_m_23') !== '' ? safe_post('ttd_m_23') : null,
                'ttd_m_4'              => safe_post('ttd_m_4') !== '' ? safe_post('ttd_m_4') : null,

                'date_created' => safe_post('pencegahan_date_pr') !== '' ? safe_post('pencegahan_date_pr') : null,
            );

            $this->m_pelayanan->insertPemantauanRestrain($pemantauan_prr_restrain);
        }

        $sign = $this->db->select('pr.perawat_bidan_pr')
            ->from('sm_pengkajian_restrain as pr')
            ->where('pr.id_layanan_pendaftaran', $id_layanan_pendaftaran)
            ->get()
            ->row();
        // if (isset($sign)) : 
        //     if ($sign->perawat_bidan_pr !== NULL) :
        //         $PengkajianRestrian['perawat_bidan_pr'] = $sign->perawat_bidan_pr;
        //     else :
        //         $PengkajianRestrian['perawat_bidan_pr'] = (safe_post('perawat_bidan_pr') !== '' ? datetime2mysql(safe_post('perawat_bidan_pr')) : NULL);
        //     endif;           
        // endif;
        $this->m_pelayanan->updatePengkajianRestrian($PengkajianRestrian, $id_pr);
        if (!empty($respon)) {
            $response = $respon;
        } else {
            $response = null;
        }
        if ($this->db->trans_status() === false) :
            $this->db->trans_rollback();
            $status = false;
        else :
            $this->db->trans_commit();
            $status = true;
        endif;
        $message = array(
            'status' => $status,
            'token'  => $this->security->get_csrf_hash(),
            'id_pendaftaran' => ('id_pendaftaran'),
            'id_layanan_pendaftaran' => ('id_layanan_pendaftaran'),
            'respon' => $response,
        );
        $this->response($message, REST_Controller::HTTP_OK);
    }

    // PRR
    function pemantauan_restrain_delete($id)
    {
        $status = $this->m_pelayanan->deletePemantauanRestrain($id);
        if ($status) :
            $response = array('status' => $status, 'message' => 'Berhasil menghapus Pemantauan Restrain!');
        else :
            $response = array('status' => $status, 'message' => 'Gagal menghapus Pemantauan Restrain!');
        endif;
        $this->response($response, REST_Controller::HTTP_OK);
    }

    // PRR 
    function get_pemantauan_restrain_get()
    {
        if (!$this->get('id', true)) :
            $this->response(null, REST_Controller::HTTP_BAD_REQUEST);
        endif;
        // var_dump($this->get('id'));die;
        $data = $this->m_pelayanan->getPemantauanRestrainByID($this->get('id', true));
        $this->response($data, REST_Controller::HTTP_OK);
    }

    // PRR
    function update_pemantauan_restrain_put()
    {
        if (!$this->put('id', true)) :
            $this->response(array('status' => false), REST_Controller::HTTP_OK);
        endif;

        $tanggal_pemantauan = $this->put('pr_tanggal_pemantauan', true);
        $tanggal_pemantauan = str_replace('/', '-', $tanggal_pemantauan);

        $tanggal_pemantauan = date('Y-m-d', strtotime($tanggal_pemantauan));
        $inisial_perawat_1       = $this->put('inisial_perawat_1', true);
        $inisial_perawat_2       = $this->put('inisial_perawat_2', true);
        $inisial_perawat_3       = $this->put('inisial_perawat_3', true);

        $posisi_p_ho = $this->put('posisi_p_ho', true);
        $posisi_p_10 = $this->put('posisi_p_10', true);
        $posisi_s_ho = $this->put('posisi_s_ho', true);
        $posisi_s_18 = $this->put('posisi_s_18', true);
        $posisi_m_ho = $this->put('posisi_m_ho', true);
        $posisi_m_23 = $this->put('posisi_m_23', true);
        $posisi_m_4  = $this->put('posisi_m_4', true);

        $edukasi_p_ho = $this->put('edukasi_p_ho', true);
        $edukasi_p_10 = $this->put('edukasi_p_10', true);
        $edukasi_s_ho = $this->put('edukasi_s_ho', true);
        $edukasi_s_18 = $this->put('edukasi_s_18', true);
        $edukasi_m_ho = $this->put('edukasi_m_ho', true);
        $edukasi_m_23 = $this->put('edukasi_m_23', true);
        $edukasi_m_4  = $this->put('edukasi_m_4', true);

        $cedera_p_ho = $this->put('cedera_p_ho', true);
        $cedera_p_10 = $this->put('cedera_p_10', true);
        $cedera_s_ho = $this->put('cedera_s_ho', true);
        $cedera_s_18 = $this->put('cedera_s_18', true);
        $cedera_m_ho = $this->put('cedera_m_ho', true);
        $cedera_m_23 = $this->put('cedera_m_23', true);
        $cedera_m_4  = $this->put('cedera_m_4', true);

        $restrain_p_ho = $this->put('restrain_p_ho', true);
        $restrain_p_10 = $this->put('restrain_p_10', true);
        $restrain_s_ho = $this->put('restrain_s_ho', true);
        $restrain_s_18 = $this->put('restrain_s_18', true);
        $restrain_m_ho = $this->put('restrain_m_ho', true);
        $restrain_m_23 = $this->put('restrain_m_23', true);
        $restrain_m_4  = $this->put('restrain_m_4', true);

        $ttd_p_ho = $this->put('ttd_p_ho', true);
        $ttd_p_10 = $this->put('ttd_p_10', true);
        $ttd_s_ho = $this->put('ttd_s_ho', true);
        $ttd_s_18 = $this->put('ttd_s_18', true);
        $ttd_m_ho = $this->put('ttd_m_ho', true);
        $ttd_m_23 = $this->put('ttd_m_23', true);
        $ttd_m_4  = $this->put('ttd_m_4', true);

        $data = array(
            'id'                 => $this->put('id', true),
            'tanggal_pemantauan' => $tanggal_pemantauan,
            'inisial_perawat_1'       => $inisial_perawat_1 !== '' ? $inisial_perawat_1 : null,
            'inisial_perawat_2'       => $inisial_perawat_2 !== '' ? $inisial_perawat_2 : null,
            'inisial_perawat_3'       => $inisial_perawat_3 !== '' ? $inisial_perawat_3 : null,

            'posisi_p_ho' => $posisi_p_ho === 'on' ? 1 : 0,
            'posisi_p_10' => $posisi_p_10 === 'on' ? 1 : 0,
            'posisi_s_ho' => $posisi_s_ho === 'on' ? 1 : 0,
            'posisi_s_18' => $posisi_s_18 === 'on' ? 1 : 0,
            'posisi_m_ho' => $posisi_m_ho === 'on' ? 1 : 0,
            'posisi_m_23' => $posisi_m_23 === 'on' ? 1 : 0,
            'posisi_m_4'  => $posisi_m_4 === 'on' ? 1 : 0,

            'edukasi_p_ho' => $edukasi_p_ho === 'on' ? 1 : 0,
            'edukasi_p_10' => $edukasi_p_10 === 'on' ? 1 : 0,
            'edukasi_s_ho' => $edukasi_s_ho === 'on' ? 1 : 0,
            'edukasi_s_18' => $edukasi_s_18 === 'on' ? 1 : 0,
            'edukasi_m_ho' => $edukasi_m_ho === 'on' ? 1 : 0,
            'edukasi_m_23' => $edukasi_m_23 === 'on' ? 1 : 0,
            'edukasi_m_4'  => $edukasi_m_4 === 'on' ? 1 : 0,

            'cedera_p_ho' => $cedera_p_ho === 'on' ? 1 : 0,
            'cedera_p_10' => $cedera_p_10 === 'on' ? 1 : 0,
            'cedera_s_ho' => $cedera_s_ho === 'on' ? 1 : 0,
            'cedera_s_18' => $cedera_s_18 === 'on' ? 1 : 0,
            'cedera_m_ho' => $cedera_m_ho === 'on' ? 1 : 0,
            'cedera_m_23' => $cedera_m_23 === 'on' ? 1 : 0,
            'cedera_m_4'  => $cedera_m_4 === 'on' ? 1 : 0,

            'restrain_p_ho' => $restrain_p_ho === 'on' ? 1 : 0,
            'restrain_p_10' => $restrain_p_10 === 'on' ? 1 : 0,
            'restrain_s_ho' => $restrain_s_ho === 'on' ? 1 : 0,
            'restrain_s_18' => $restrain_s_18 === 'on' ? 1 : 0,
            'restrain_m_ho' => $restrain_m_ho === 'on' ? 1 : 0,
            'restrain_m_23' => $restrain_m_23 === 'on' ? 1 : 0,
            'restrain_m_4'  => $restrain_m_4 === 'on' ? 1 : 0,

            'ttd_p_ho' => $ttd_p_ho === 'on' ? 1 : 0,
            'ttd_p_10' => $ttd_p_10 === 'on' ? 1 : 0,
            'ttd_s_ho' => $ttd_s_ho === 'on' ? 1 : 0,
            'ttd_s_18' => $ttd_s_18 === 'on' ? 1 : 0,
            'ttd_m_ho' => $ttd_m_ho === 'on' ? 1 : 0,
            'ttd_m_23' => $ttd_m_23 === 'on' ? 1 : 0,
            'ttd_m_4'  => $ttd_m_4 === 'on' ? 1 : 0,

            'updated_at' => date('Y-m-d H:i:s', time()),
        );
        // var_dump($data);die;
        $status = $this->m_pelayanan->editPemantauanRestrain($data);
        $this->response(array('status' => $status), REST_Controller::HTTP_OK);
    }

    // PRLTDDP
    function get_data_pengkajian_dekubitus_get()
    {
        if (!$this->get('id_layanan_pendaftaran')) :
            $this->response(NULL, REST_Controller::HTTP_BAD_REQUEST); // (400)
        endif;
        $this->load->model('pendaftaran/Pendaftaran_model', 'm_pendaftaran');
        $this->load->model('pelayanan/Pelayanan_model', 'm_pelayanan');
        $data                               = $this->m_pendaftaran->getPendaftaranDetail($this->get('id', true), $this->get('id_layanan', true));
        $data['profil']                     = $this->m_pelayanan->getProfilPasien($data['pasien']->id_pasien);
        $data['pengkajian_dekubitus']            = $this->m_pelayanan->getPengkajianDekubitus($this->get('id', true));
        // $data['pengkajian_dekubitus_logs']       = $this->m_pelayanan->getPengkajianDekubitusLogs($this->get('id', true)); 
        $data['pemantauan_dekubitus']            = $this->m_pelayanan->getPemantauanDekubitus($this->get('id', true));
        if ($data) :
            $this->response($data, REST_Controller::HTTP_OK); // (200)
        endif;
        // var_dump('pemantauan_restrain');die;
    }

    // PRLTDDP
    function hapus_pengkajian_dekubitus_delete($id)
    {
        $status = $this->m_pelayanan->deletePengkajianDekubitus($id);
        if ($status) :
            $response = array('status' => $status, 'message' => 'Berhasil menghapus Pengkajian Dekubitus!');
        else :
            $response = array('status' => $status, 'message' => 'Gagal menghapus Pengkajian Dekubitus!');
        endif;
        $this->response($response, REST_Controller::HTTP_OK);
    }

    // PRLTDDP 
    function get_pengkajian_dekubitus_get()
    {
        if (!$this->get('id', true)) :
            $this->response(null, REST_Controller::HTTP_BAD_REQUEST);
        endif;
        // var_dump($this->get('id'));die;
        $data = $this->m_pelayanan->getPengkajianDekubitusByID($this->get('id', true));
        $this->response($data, REST_Controller::HTTP_OK);
    }

    // PRLTDDP
    function update_pengkajian_dekubitus_put()
    {
        if (!$this->put('id', true)) :
            $this->response(array('status' => false), REST_Controller::HTTP_OK);
        endif;
        $tanggal_jam_prltddp = $this->put('tanggal_jam_prltddp', true);
        $tanggal_jam_prltddp = str_replace('/', '-', $tanggal_jam_prltddp);
        $tanggal_jam_prltddp = date('Y-m-d', strtotime($tanggal_jam_prltddp));

        $ceklis_prltddp       = $this->put('ceklis_prltddp', true);
        $perawat_bidan_prltddp       = $this->put('perawat_bidan_prltddp', true);
        $prltddp_jam       = $this->put('prltddp_jam', true);
        $prd_fisik       = $this->put('prd_fisik', true);
        $prd_mental       = $this->put('prd_mental', true);
        $prd_aktifitas       = $this->put('prd_aktifitas', true);
        $prd_mobilitas       = $this->put('prd_mobilitas', true);
        $prd_inkontinensia       = $this->put('prd_inkontinensia', true);
        $total_nilai_prd       = $this->put('total_nilai_prd', true);
        $luka_rs_1 = $this->put('luka_rs_1', true);
        $luka_rs_2 = $this->put('luka_rs_2', true);
        $luka_rs_3 = $this->put('luka_rs_3', true);
        $etiologi_luka_1 = $this->put('etiologi_luka_1', true);
        $etiologi_luka_2 = $this->put('etiologi_luka_2', true);
        $etiologi_luka_3 = $this->put('etiologi_luka_3', true);
        $etiologi_luka_4 = $this->put('etiologi_luka_4', true);
        $etiologi_luka_5 = $this->put('etiologi_luka_5', true);
        $gambar_klinis_1 = $this->put('gambar_klinis_1', true);
        $gambar_klinis_2 = $this->put('gambar_klinis_2', true);
        $gambar_klinis_3 = $this->put('gambar_klinis_3', true);
        $gambar_klinis_4 = $this->put('gambar_klinis_4', true);
        $eksudat_1 = $this->put('eksudat_1', true);
        $eksudat_2 = $this->put('eksudat_2', true);
        $eksudat_3 = $this->put('eksudat_3', true);
        $eksudat_4 = $this->put('eksudat_4', true);
        $bau_1 = $this->put('bau_1', true);
        $bau_2 = $this->put('bau_2', true);
        $bau_3 = $this->put('bau_3', true);
        $data = array(
            'id'                    => $this->put('id', true),
            'tanggal_jam_prltddp'   => $tanggal_jam_prltddp,
            'ceklis_prltddp'        => $ceklis_prltddp === 'on' ? 1 : 0,
            'perawat_bidan_prltddp' => $perawat_bidan_prltddp !== '' ? $perawat_bidan_prltddp : null,
            'prltddp_jam'           => $prltddp_jam !== '' ? $prltddp_jam : null,
            'prd_fisik'             => $prd_fisik !== '' ? $prd_fisik : null,
            'prd_mental'            => $prd_mental !== '' ? $prd_mental : null,
            'prd_aktifitas'         => $prd_aktifitas !== '' ? $prd_aktifitas : null,
            'prd_mobilitas'         => $prd_mobilitas !== '' ? $prd_mobilitas : null,
            'prd_inkontinensia'     => $prd_inkontinensia !== '' ? $prd_inkontinensia : null,
            'total_nilai_prd'       => $total_nilai_prd !== '' ? $total_nilai_prd : null,
            'luka_rs_1'             => $luka_rs_1 !== '' ? $luka_rs_1 : null,
            'luka_rs_2'             => $luka_rs_2 !== '' ? $luka_rs_2 : null,
            'luka_rs_3'             => $luka_rs_3 !== '' ? $luka_rs_3 : null,
            'etiologi_luka_1'       => $etiologi_luka_1 !== '' ? $etiologi_luka_1 : null,
            'etiologi_luka_2'       => $etiologi_luka_2 !== '' ? $etiologi_luka_2 : null,
            'etiologi_luka_3'       => $etiologi_luka_3 !== '' ? $etiologi_luka_3 : null,
            'etiologi_luka_4'       => $etiologi_luka_4 !== '' ? $etiologi_luka_4 : null,
            'etiologi_luka_5'       => $etiologi_luka_5 !== '' ? $etiologi_luka_5 : null,
            'gambar_klinis_1'       => $gambar_klinis_1 !== '' ? $gambar_klinis_1 : null,
            'gambar_klinis_2'       => $gambar_klinis_2 !== '' ? $gambar_klinis_2 : null,
            'gambar_klinis_3'       => $gambar_klinis_3 !== '' ? $gambar_klinis_3 : null,
            'gambar_klinis_4'       => $gambar_klinis_4 !== '' ? $gambar_klinis_4 : null,
            'eksudat_1'             => $eksudat_1 !== '' ? $eksudat_1 : null,
            'eksudat_2'             => $eksudat_2 !== '' ? $eksudat_2 : null,
            'eksudat_3'             => $eksudat_3 !== '' ? $eksudat_3 : null,
            'eksudat_4'             => $eksudat_4 !== '' ? $eksudat_4 : null,
            'bau_1'                 => $bau_1 !== '' ? $bau_1 : null,
            'bau_2'                 => $bau_2 !== '' ? $bau_2 : null,
            'bau_3'                 => $bau_3 !== '' ? $bau_3 : null,
            'updated_at' => date('Y-m-d H:i:s', time()),
        );
        // var_dump($data);die;
        $status = $this->m_pelayanan->editPengkajianDekubitus($data);
        $this->response(array('status' => $status), REST_Controller::HTTP_OK);
    }

    // PRLTDDP  + PPRLT
    function simpan_data_pengkajian_dekubitus_post()
    {
        if (safe_post('id_layanan_pendaftaran') === '') :
            $this->response(NULL, REST_Controller::HTTP_BAD_REQUEST);
        endif;
        $layanan = array('id' => safe_post('id_layanan_pendaftaran'));
        $pengkajian_date_prltddp = safe_post('pengkajian_date_prltddp');
        $id_pendaftaran           = safe_post('id_pendaftaran');

        if (!empty($pengkajian_date_prltddp)) {

            $pengkajian_prltddp_dekubitus = array(
                'id_pendaftaran'            => $id_pendaftaran,
                'id_layanan_pendaftaran'    => $layanan['id'],
                'id_user'                   => safe_post('user_pengkajian') !== '' ? safe_post('user_pengkajian') : null,
                // 'tanggal_jam_prltddp'       => safe_post('prltddp_tanggal_jam'),
                'tanggal_jam_prltddp'               => (safe_post('tanggal_jam_prltddp') !== '' ? safe_post('tanggal_jam_prltddp') : NULL),
                'prltddp_jam'               => (safe_post('prltddp_jam') !== '' ? safe_post('prltddp_jam') : NULL),
                'prd_fisik'                 => (safe_post('prd_fisik') !== '' ? safe_post('prd_fisik') : NULL),
                'prd_mental'                => (safe_post('prd_mental') !== '' ? safe_post('prd_mental') : NULL),
                'prd_aktifitas'         => (safe_post('prd_aktifitas') !== '' ? safe_post('prd_aktifitas') : NULL),
                'prd_mobilitas'         => (safe_post('prd_mobilitas') !== '' ? safe_post('prd_mobilitas') : NULL),
                'prd_inkontinensia'     => (safe_post('prd_inkontinensia') !== '' ? safe_post('prd_inkontinensia') : NULL),
                'total_nilai_prd'       => (safe_post('total_nilai_prd') !== '' ? safe_post('total_nilai_prd') : NULL),
                'luka_rs_1'             => safe_post('luka_rs_1') !== '' ? safe_post('luka_rs_1') : null,
                'luka_rs_2'             => safe_post('luka_rs_2') !== '' ? safe_post('luka_rs_2') : null,
                'luka_rs_3'             => safe_post('luka_rs_3') !== '' ? safe_post('luka_rs_3') : null,
                'etiologi_luka_1'       => safe_post('etiologi_luka_1') !== '' ? safe_post('etiologi_luka_1') : null,
                'etiologi_luka_2'       => safe_post('etiologi_luka_2') !== '' ? safe_post('etiologi_luka_2') : null,
                'etiologi_luka_3'       => safe_post('etiologi_luka_3') !== '' ? safe_post('etiologi_luka_3') : null,
                'etiologi_luka_4'       => safe_post('etiologi_luka_4') !== '' ? safe_post('etiologi_luka_4') : null,
                'etiologi_luka_5'       => safe_post('etiologi_luka_5') !== '' ? safe_post('etiologi_luka_5') : null,
                'gambar_klinis_1'       => safe_post('gambar_klinis_1') !== '' ? safe_post('gambar_klinis_1') : null,
                'gambar_klinis_2'       => safe_post('gambar_klinis_2') !== '' ? safe_post('gambar_klinis_2') : null,
                'gambar_klinis_3'       => safe_post('gambar_klinis_3') !== '' ? safe_post('gambar_klinis_3') : null,
                'gambar_klinis_4'       => safe_post('gambar_klinis_4') !== '' ? safe_post('gambar_klinis_4') : null,
                'eksudat_1'             => safe_post('eksudat_1') !== '' ? safe_post('eksudat_1') : null,
                'eksudat_2'             => safe_post('eksudat_2') !== '' ? safe_post('eksudat_2') : null,
                'eksudat_3'             => safe_post('eksudat_3') !== '' ? safe_post('eksudat_3') : null,
                'eksudat_4'             => safe_post('eksudat_4') !== '' ? safe_post('eksudat_4') : null,
                'bau_1'                 => safe_post('bau_1') !== '' ? safe_post('bau_1') : null,
                'bau_2'                 => safe_post('bau_2') !== '' ? safe_post('bau_2') : null,
                'bau_3'                 => safe_post('bau_3') !== '' ? safe_post('bau_3') : null,
                'ceklis_prltddp'        => (safe_post('ceklis_prltddp') !== '' ? safe_post('ceklis_prltddp') : NULL),
                'perawat_bidan_prltddp' => safe_post('perawat_bidan_prltddp') !== '' ? safe_post('perawat_bidan_prltddp') : NULL,
                'date_created'          => safe_post('pengkajian_date_prltddp') !== '' ? safe_post('pengkajian_date_prltddp') : null,
            );
            $this->m_pelayanan->insertPengkajianDekubitus($pengkajian_prltddp_dekubitus);
        }

        $layanan = array('id' => safe_post('id_layanan_pendaftaran'));
        $pprlt_tanggal_pemantauan = safe_post('pprlt_tanggal_pemantauan');
        $id_pendaftaran           = safe_post('id_pendaftaran');

        if (!empty($pprlt_tanggal_pemantauan)) {

            $pemantauan_pprlt_dekubitus = array(
                'id_pendaftaran'         => $id_pendaftaran,
                'id_layanan_pendaftaran' => $layanan['id'],
                'inisialt_perawat_1'           => safe_post('inisialt_perawat_1') !== '' ? safe_post('inisialt_perawat_1') : null,
                'inisialt_perawat_2'           => safe_post('inisialt_perawat_2') !== '' ? safe_post('inisialt_perawat_2') : null,
                'inisialt_perawat_3'           => safe_post('inisialt_perawat_3') !== '' ? safe_post('inisialt_perawat_3') : null,
                'id_user'                => safe_post('user_pemantauan') !== '' ? safe_post('user_pemantauan') : null,
                'tanggal_pemantauan'     => safe_post('pprlt_tanggal_pemantauan'),

                'mengecek_p_ho'               => safe_post('mengecek_p_ho') !== '' ? safe_post('mengecek_p_ho') : null,
                'mengecek_p_10'               => safe_post('mengecek_p_10') !== '' ? safe_post('mengecek_p_10') : null,
                'mengecek_s_ho'               => safe_post('mengecek_s_ho') !== '' ? safe_post('mengecek_s_ho') : null,
                'mengecek_s_18'               => safe_post('mengecek_s_18') !== '' ? safe_post('mengecek_s_18') : null,
                'mengecek_m_ho'               => safe_post('mengecek_m_ho') !== '' ? safe_post('mengecek_m_ho') : null,
                'mengecek_m_23'               => safe_post('mengecek_m_23') !== '' ? safe_post('mengecek_m_23') : null,
                'mengecek_m_4'                => safe_post('mengecek_m_4') !== '' ? safe_post('mengecek_m_4') : null,

                'mempertahankan_p_ho'              => safe_post('mempertahankan_p_ho') !== '' ? safe_post('mempertahankan_p_ho') : null,
                'mempertahankan_p_10'              => safe_post('mempertahankan_p_10') !== '' ? safe_post('mempertahankan_p_10') : null,
                'mempertahankan_s_ho'              => safe_post('mempertahankan_s_ho') !== '' ? safe_post('mempertahankan_s_ho') : null,
                'mempertahankan_s_18'              => safe_post('mempertahankan_s_18') !== '' ? safe_post('mempertahankan_s_18') : null,
                'mempertahankan_m_ho'              => safe_post('mempertahankan_m_ho') !== '' ? safe_post('mempertahankan_m_ho') : null,
                'mempertahankan_m_23'              => safe_post('mempertahankan_m_23') !== '' ? safe_post('mempertahankan_m_23') : null,
                'mempertahankan_m_4'               => safe_post('mempertahankan_m_4') !== '' ? safe_post('mempertahankan_m_4') : null,

                'mengubah_p_ho'               => safe_post('mengubah_p_ho') !== '' ? safe_post('mengubah_p_ho') : null,
                'mengubah_p_10'               => safe_post('mengubah_p_10') !== '' ? safe_post('mengubah_p_10') : null,
                'mengubah_s_ho'               => safe_post('mengubah_s_ho') !== '' ? safe_post('mengubah_s_ho') : null,
                'mengubah_s_18'               => safe_post('mengubah_s_18') !== '' ? safe_post('mengubah_s_18') : null,
                'mengubah_m_ho'               => safe_post('mengubah_m_ho') !== '' ? safe_post('mengubah_m_ho') : null,
                'mengubah_m_23'               => safe_post('mengubah_m_23') !== '' ? safe_post('mengubah_m_23') : null,
                'mengubah_m_4'                => safe_post('mengubah_m_4') !== '' ? safe_post('mengubah_m_4') : null,

                'memeriksa_p_ho'               => safe_post('memeriksa_p_ho') !== '' ? safe_post('memeriksa_p_ho') : null,
                'memeriksa_p_10'               => safe_post('memeriksa_p_10') !== '' ? safe_post('memeriksa_p_10') : null,
                'memeriksa_s_ho'               => safe_post('memeriksa_s_ho') !== '' ? safe_post('memeriksa_s_ho') : null,
                'memeriksa_s_18'               => safe_post('memeriksa_s_18') !== '' ? safe_post('memeriksa_s_18') : null,
                'memeriksa_m_ho'               => safe_post('memeriksa_m_ho') !== '' ? safe_post('memeriksa_m_ho') : null,
                'memeriksa_m_23'               => safe_post('memeriksa_m_23') !== '' ? safe_post('memeriksa_m_23') : null,
                'memeriksa_m_4'                => safe_post('memeriksa_m_4') !== '' ? safe_post('memeriksa_m_4') : null,

                'ttdd_p_ho'             => safe_post('ttdd_p_ho') !== '' ? safe_post('ttdd_p_ho') : null,
                'ttdd_p_10'             => safe_post('ttdd_p_10') !== '' ? safe_post('ttdd_p_10') : null,
                'ttdd_s_ho'             => safe_post('ttdd_s_ho') !== '' ? safe_post('ttdd_s_ho') : null,
                'ttdd_s_18'             => safe_post('ttdd_s_18') !== '' ? safe_post('ttdd_s_18') : null,
                'ttdd_m_ho'             => safe_post('ttdd_m_ho') !== '' ? safe_post('ttdd_m_ho') : null,
                'ttdd_m_23'             => safe_post('ttdd_m_23') !== '' ? safe_post('ttdd_m_23') : null,
                'ttdd_m_4'              => safe_post('ttdd_m_4') !== '' ? safe_post('ttdd_m_4') : null,

                'date_created' => safe_post('pencegahan_date_pprlt') !== '' ? safe_post('pencegahan_date_pprlt') : null,
            );
            $this->m_pelayanan->insertPemantauanDekubitus($pemantauan_pprlt_dekubitus);
        }
        if (!empty($respon)) {
            $response = $respon;
        } else {
            $response = null;
        }
        if ($this->db->trans_status() === false) :
            $this->db->trans_rollback();
            $status = false;
        else :
            $this->db->trans_commit();
            $status = true;
        endif;
        $message = array(
            'status' => $status,
            'token'  => $this->security->get_csrf_hash(),
            'id_pendaftaran' => ('id_pendaftaran'),
            'id_layanan_pendaftaran' => ('id_layanan_pendaftaran'),
            'respon' => $response,
        );
        $this->response($message, REST_Controller::HTTP_OK);
    }

    // PPRLT
    function pemantauan_dekubitus_delete($id)
    {
        $status = $this->m_pelayanan->deletePemantauanDekubitus($id);
        if ($status) :
            $response = array('status' => $status, 'message' => 'Berhasil menghapus Pemantauan Dekubitus!');
        else :
            $response = array('status' => $status, 'message' => 'Gagal menghapus Pemantauan Dekubitus!');
        endif;
        $this->response($response, REST_Controller::HTTP_OK);
    }

    // PPRLT 
    function get_pemantauan_dekubitus_get()
    {
        if (!$this->get('id', true)) :
            $this->response(null, REST_Controller::HTTP_BAD_REQUEST);
        endif;
        // var_dump($this->get('id'));die;
        $data = $this->m_pelayanan->getPemantauanDekubitusByID($this->get('id', true));
        $this->response($data, REST_Controller::HTTP_OK);
    }

    // PPRLT
    function update_pemantauan_dekubitus_put()
    {
        if (!$this->put('id', true)) :
            $this->response(array('status' => false), REST_Controller::HTTP_OK);
        endif;

        $tanggal_pemantauan = $this->put('pprlt_tanggal_pemantauan', true);
        $tanggal_pemantauan = str_replace('/', '-', $tanggal_pemantauan);

        $tanggal_pemantauan = date('Y-m-d', strtotime($tanggal_pemantauan));
        $inisialt_perawat_1       = $this->put('inisialt_perawat_1', true);
        $inisialt_perawat_2       = $this->put('inisialt_perawat_2', true);
        $inisialt_perawat_3       = $this->put('inisialt_perawat_3', true);

        $mengecek_p_ho = $this->put('mengecek_p_ho', true);
        $mengecek_p_10 = $this->put('mengecek_p_10', true);
        $mengecek_s_ho = $this->put('mengecek_s_ho', true);
        $mengecek_s_18 = $this->put('mengecek_s_18', true);
        $mengecek_m_ho = $this->put('mengecek_m_ho', true);
        $mengecek_m_23 = $this->put('mengecek_m_23', true);
        $mengecek_m_4  = $this->put('mengecek_m_4', true);

        $mempertahankan_p_ho = $this->put('mempertahankan_p_ho', true);
        $mempertahankan_p_10 = $this->put('mempertahankan_p_10', true);
        $mempertahankan_s_ho = $this->put('mempertahankan_s_ho', true);
        $mempertahankan_s_18 = $this->put('mempertahankan_s_18', true);
        $mempertahankan_m_ho = $this->put('mempertahankan_m_ho', true);
        $mempertahankan_m_23 = $this->put('mempertahankan_m_23', true);
        $mempertahankan_m_4  = $this->put('mempertahankan_m_4', true);

        $mengubah_p_ho = $this->put('mengubah_p_ho', true);
        $mengubah_p_10 = $this->put('mengubah_p_10', true);
        $mengubah_s_ho = $this->put('mengubah_s_ho', true);
        $mengubah_s_18 = $this->put('mengubah_s_18', true);
        $mengubah_m_ho = $this->put('mengubah_m_ho', true);
        $mengubah_m_23 = $this->put('mengubah_m_23', true);
        $mengubah_m_4  = $this->put('mengubah_m_4', true);

        $memeriksa_p_ho = $this->put('memeriksa_p_ho', true);
        $memeriksa_p_10 = $this->put('memeriksa_p_10', true);
        $memeriksa_s_ho = $this->put('memeriksa_s_ho', true);
        $memeriksa_s_18 = $this->put('memeriksa_s_18', true);
        $memeriksa_m_ho = $this->put('memeriksa_m_ho', true);
        $memeriksa_m_23 = $this->put('memeriksa_m_23', true);
        $memeriksa_m_4  = $this->put('memeriksa_m_4', true);

        $ttdd_p_ho = $this->put('ttdd_p_ho', true);
        $ttdd_p_10 = $this->put('ttdd_p_10', true);
        $ttdd_s_ho = $this->put('ttdd_s_ho', true);
        $ttdd_s_18 = $this->put('ttdd_s_18', true);
        $ttdd_m_ho = $this->put('ttdd_m_ho', true);
        $ttdd_m_23 = $this->put('ttdd_m_23', true);
        $ttdd_m_4  = $this->put('ttdd_m_4', true);

        $data = array(
            'id'                 => $this->put('id', true),
            'tanggal_pemantauan' => $tanggal_pemantauan,
            'inisialt_perawat_1'       => $inisialt_perawat_1 !== '' ? $inisialt_perawat_1 : null,
            'inisialt_perawat_2'       => $inisialt_perawat_2 !== '' ? $inisialt_perawat_2 : null,
            'inisialt_perawat_3'       => $inisialt_perawat_3 !== '' ? $inisialt_perawat_3 : null,

            'mengecek_p_ho' => $mengecek_p_ho === 'on' ? 1 : 0,
            'mengecek_p_10' => $mengecek_p_10 === 'on' ? 1 : 0,
            'mengecek_s_ho' => $mengecek_s_ho === 'on' ? 1 : 0,
            'mengecek_s_18' => $mengecek_s_18 === 'on' ? 1 : 0,
            'mengecek_m_ho' => $mengecek_m_ho === 'on' ? 1 : 0,
            'mengecek_m_23' => $mengecek_m_23 === 'on' ? 1 : 0,
            'mengecek_m_4'  => $mengecek_m_4 === 'on' ? 1 : 0,

            'mempertahankan_p_ho' => $mempertahankan_p_ho === 'on' ? 1 : 0,
            'mempertahankan_p_10' => $mempertahankan_p_10 === 'on' ? 1 : 0,
            'mempertahankan_s_ho' => $mempertahankan_s_ho === 'on' ? 1 : 0,
            'mempertahankan_s_18' => $mempertahankan_s_18 === 'on' ? 1 : 0,
            'mempertahankan_m_ho' => $mempertahankan_m_ho === 'on' ? 1 : 0,
            'mempertahankan_m_23' => $mempertahankan_m_23 === 'on' ? 1 : 0,
            'mempertahankan_m_4'  => $mempertahankan_m_4 === 'on' ? 1 : 0,

            'mengubah_p_ho' => $mengubah_p_ho === 'on' ? 1 : 0,
            'mengubah_p_10' => $mengubah_p_10 === 'on' ? 1 : 0,
            'mengubah_s_ho' => $mengubah_s_ho === 'on' ? 1 : 0,
            'mengubah_s_18' => $mengubah_s_18 === 'on' ? 1 : 0,
            'mengubah_m_ho' => $mengubah_m_ho === 'on' ? 1 : 0,
            'mengubah_m_23' => $mengubah_m_23 === 'on' ? 1 : 0,
            'mengubah_m_4'  => $mengubah_m_4 === 'on' ? 1 : 0,

            'memeriksa_p_ho' => $memeriksa_p_ho === 'on' ? 1 : 0,
            'memeriksa_p_10' => $memeriksa_p_10 === 'on' ? 1 : 0,
            'memeriksa_s_ho' => $memeriksa_s_ho === 'on' ? 1 : 0,
            'memeriksa_s_18' => $memeriksa_s_18 === 'on' ? 1 : 0,
            'memeriksa_m_ho' => $memeriksa_m_ho === 'on' ? 1 : 0,
            'memeriksa_m_23' => $memeriksa_m_23 === 'on' ? 1 : 0,
            'memeriksa_m_4'  => $memeriksa_m_4 === 'on' ? 1 : 0,

            'ttdd_p_ho' => $ttdd_p_ho === 'on' ? 1 : 0,
            'ttdd_p_10' => $ttdd_p_10 === 'on' ? 1 : 0,
            'ttdd_s_ho' => $ttdd_s_ho === 'on' ? 1 : 0,
            'ttdd_s_18' => $ttdd_s_18 === 'on' ? 1 : 0,
            'ttdd_m_ho' => $ttdd_m_ho === 'on' ? 1 : 0,
            'ttdd_m_23' => $ttdd_m_23 === 'on' ? 1 : 0,
            'ttdd_m_4'  => $ttdd_m_4 === 'on' ? 1 : 0,

            'updated_at' => date('Y-m-d H:i:s', time()),
        );
        // var_dump($data);die;
        $status = $this->m_pelayanan->editPemantauanDekubitus($data);
        $this->response(array('status' => $status), REST_Controller::HTTP_OK);
    }

    // FCB 
    function kamar_auto_get()
    {
        $q = safe_get('q');
        $page = safe_get('page');
        $start = $this->start($page);
        $key = 'kamar_auto1_' . $q . '_' . $page;
        if (!$this->redis->get($key)) :
            $data = $this->m_pelayanan->getAutoKamar($q, $start, $this->limit);
            // var_dump($data);die;
            if ((safe_get('page') == 1) & ($q == '')) :
                $pilih[] = array(
                    'id' => '',
                    'nama' => ' ',
                );
                $data['data'] = array_merge($pilih, $data['data']);
                $data['total'] += 1;
            endif;
            $this->redis->setex($key, 86400, json_encode($data));
            $this->response($data, REST_Controller::HTTP_OK);
        else :
            exit($this->redis->get($key));
        endif;
    }

    // FCB + ubah 
    function get_data_code_blue_get()
    {
        if (!$this->get('id_layanan_pendaftaran')) :
            $this->response(NULL, REST_Controller::HTTP_BAD_REQUEST); // (400)
        endif;
        $this->load->model('pendaftaran/Pendaftaran_model', 'm_pendaftaran');
        $this->load->model('pelayanan/Pelayanan_model', 'm_pelayanan');
        $data                               = $this->m_pendaftaran->getPendaftaranDetail($this->get('id', true), $this->get('id_layanan', true));
        $data['profil']                     = $this->m_pelayanan->getProfilPasien($data['pasien']->id_pasien);
        $data['code_blue']            = $this->m_pelayanan->getCodeBlue($this->get('id', true));
        $data['code_blue_logs']       = $this->m_pelayanan->getCodeBlueLogs($this->get('id', true));
        $data['lembar_monitoring']            = $this->m_pelayanan->getLembarMonitoring($this->get('id', true));
        if ($data) :
            $this->response($data, REST_Controller::HTTP_OK); // (200)
        endif;
    }

    // FCB LOGS 
    function get_history_logs_code_blue_get()
    {
        if (!$this->get('id_layanan_pendaftaran', true)) :
            $this->response(NULL, REST_Controller::HTTP_BAD_REQUEST); // (400)
        endif;
        $id_layanan_pendaftaran = $this->get('id_layanan_pendaftaran', true);
        $data['code_blue_logs']       = $this->m_pelayanan->getCodeBlueLogs($id_layanan_pendaftaran);
        if ($data) :
            $this->response($data, REST_Controller::HTTP_OK); // (200)
        endif;
    }

    // FCB 
    // function simpan_data_code_blue_post()
    // {
    //     if (safe_post('id_layanan_pendaftaran') === '') :
    //         $this->response(NULL, REST_Controller::HTTP_BAD_REQUEST);
    //     endif;

    //     $id_layanan_pendaftaran = safe_post('id_layanan_pendaftaran');
    //     $id_pendaftaran = safe_post('id_pendaftaran');;
    //     $id_fcb = safe_post('id_fcb');
    //     $id_users = safe_post('id_user');

    //     $FormCodeBlue = array(
    //         'id_layanan_pendaftaran' => $id_layanan_pendaftaran,
    //         'id_pendaftaran' => $id_pendaftaran,
    //         'id_users' => $id_users,

    //         'respon_fcb' => json_encode([
    //             'respon_fcb_1' => safe_post('respon_fcb_1') !== '' ? safe_post('respon_fcb_1') : null,
    //             'respon_fcb_2' => safe_post('respon_fcb_2') !== '' ? safe_post('respon_fcb_2') : null,
    //             'respon_fcb_3' => safe_post('respon_fcb_3') !== '' ? safe_post('respon_fcb_3') : null,
    //             'respon_fcb_4' => safe_post('respon_fcb_4') !== '' ? safe_post('respon_fcb_4') : null,
    //             'respon_fcb_5' => safe_post('respon_fcb_5') !== '' ? safe_post('respon_fcb_5') : null,
    //             'respon_fcb_6' => safe_post('respon_fcb_6') !== '' ? safe_post('respon_fcb_6') : null,
    //             'respon_fcb_7' => safe_post('respon_fcb_7') !== '' ? safe_post('respon_fcb_7') : null,
    //             'respon_fcb_8' => safe_post('respon_fcb_8') !== '' ? safe_post('respon_fcb_8') : null,
    //         ]),

    //         'tgl_jam_fcb' => (safe_post('tgl_jam_fcb') !== '' ? datetime2mysql(safe_post('tgl_jam_fcb')) : NULL),

    //         'bansal_fcb' => safe_post('bansal_fcb') !== '' ? safe_post('bansal_fcb') : NULL,

    //         'kriteria_fcb' => json_encode([
    //             'kriteria_fcb_1' => safe_post('kriteria_fcb_1') !== '' ? safe_post('kriteria_fcb_1') : null,
    //             'kriteria_fcb_2' => safe_post('kriteria_fcb_2') !== '' ? safe_post('kriteria_fcb_2') : null,
    //             'kriteria_fcb_3' => safe_post('kriteria_fcb_3') !== '' ? safe_post('kriteria_fcb_3') : null,
    //             'kriteria_fcb_4' => safe_post('kriteria_fcb_4') !== '' ? safe_post('kriteria_fcb_4') : null,
    //             'kriteria_fcb_5' => safe_post('kriteria_fcb_5') !== '' ? safe_post('kriteria_fcb_5') : null,
    //             'kriteria_fcb_6' => safe_post('kriteria_fcb_6') !== '' ? safe_post('kriteria_fcb_6') : null,
    //             'kriteria_fcb_7' => safe_post('kriteria_fcb_7') !== '' ? safe_post('kriteria_fcb_7') : null,
    //             'kriteria_fcb_8' => safe_post('kriteria_fcb_8') !== '' ? safe_post('kriteria_fcb_8') : null,
    //         ]),

    //         'awal_fcb' => json_encode([
    //             'awal_fcb_1' => safe_post('awal_fcb_1') !== '' ? safe_post('awal_fcb_1') : null,
    //             'awal_fcb_2' => safe_post('awal_fcb_2') !== '' ? safe_post('awal_fcb_2') : null,
    //             'awal_fcb_3' => safe_post('awal_fcb_3') !== '' ? safe_post('awal_fcb_3') : null,
    //             'awal_fcb_4' => safe_post('awal_fcb_4') !== '' ? safe_post('awal_fcb_4') : null,
    //         ]),

    //         'jalan_fcb' => json_encode([
    //             'jalan_fcb_1' => safe_post('jalan_fcb_1') !== '' ? safe_post('jalan_fcb_1') : null,
    //             'jalan_fcb_2' => safe_post('jalan_fcb_2') !== '' ? safe_post('jalan_fcb_2') : null,
    //             'jalan_fcb_3' => safe_post('jalan_fcb_3') !== '' ? safe_post('jalan_fcb_3') : null,
    //             'jalan_fcb_4' => safe_post('jalan_fcb_4') !== '' ? safe_post('jalan_fcb_4') : null,
    //             'jalan_fcb_5' => safe_post('jalan_fcb_5') !== '' ? safe_post('jalan_fcb_5') : null,
    //             'jalan_fcb_6' => safe_post('jalan_fcb_6') !== '' ? safe_post('jalan_fcb_6') : null,
    //             'jalan_fcb_7' => safe_post('jalan_fcb_7') !== '' ? safe_post('jalan_fcb_7') : null,
    //             'jalan_fcb_8' => safe_post('jalan_fcb_8') !== '' ? safe_post('jalan_fcb_8') : null,
    //             'jalan_fcb_9' => safe_post('jalan_fcb_9') !== '' ? safe_post('jalan_fcb_9') : null,
    //             'jalan_fcb_10' => safe_post('jalan_fcb_10') !== '' ? safe_post('jalan_fcb_10') : null,
    //             'jalan_fcb_11' => safe_post('jalan_fcb_11') !== '' ? safe_post('jalan_fcb_11') : null,
    //             'jalan_fcb_12' => safe_post('jalan_fcb_12') !== '' ? safe_post('jalan_fcb_12') : null,
    //             'jalan_fcb_13' => safe_post('jalan_fcb_13') !== '' ? safe_post('jalan_fcb_13') : null,
    //             'jalan_fcb_14' => safe_post('jalan_fcb_14') !== '' ? safe_post('jalan_fcb_14') : null,
    //             'jalan_fcb_15' => safe_post('jalan_fcb_15') !== '' ? safe_post('jalan_fcb_15') : null,
    //             'jalan_fcb_16' => safe_post('jalan_fcb_16') !== '' ? safe_post('jalan_fcb_16') : null,
    //             'jalan_fcb_17' => safe_post('jalan_fcb_17') !== '' ? safe_post('jalan_fcb_17') : null,
    //             'jalan_fcb_18' => safe_post('jalan_fcb_18') !== '' ? safe_post('jalan_fcb_18') : null,
    //         ]),

    //         'sirkulasi_fcb' => json_encode([
    //             'sirkulasi_fcb_1' => safe_post('sirkulasi_fcb_1') !== '' ? safe_post('sirkulasi_fcb_1') : null,
    //             'sirkulasi_fcb_2' => safe_post('sirkulasi_fcb_2') !== '' ? safe_post('sirkulasi_fcb_2') : null,
    //             'sirkulasi_fcb_3' => safe_post('sirkulasi_fcb_3') !== '' ? safe_post('sirkulasi_fcb_3') : null,
    //             'sirkulasi_fcb_4' => safe_post('sirkulasi_fcb_4') !== '' ? safe_post('sirkulasi_fcb_4') : null,
    //             'sirkulasi_fcb_5' => safe_post('sirkulasi_fcb_5') !== '' ? safe_post('sirkulasi_fcb_5') : null,
    //             'sirkulasi_fcb_6' => safe_post('sirkulasi_fcb_6') !== '' ? safe_post('sirkulasi_fcb_6') : null,
    //             'sirkulasi_fcb_7' => safe_post('sirkulasi_fcb_7') !== '' ? safe_post('sirkulasi_fcb_7') : null,
    //             'sirkulasi_fcb_8' => safe_post('sirkulasi_fcb_8') !== '' ? safe_post('sirkulasi_fcb_8') : null,
    //             'sirkulasi_fcb_9' => safe_post('sirkulasi_fcb_9') !== '' ? safe_post('sirkulasi_fcb_9') : null,
    //             'sirkulasi_fcb_10' => safe_post('sirkulasi_fcb_10') !== '' ? safe_post('sirkulasi_fcb_10') : null,
    //             'sirkulasi_fcb_11' => safe_post('sirkulasi_fcb_11') !== '' ? safe_post('sirkulasi_fcb_11') : null,
    //             'sirkulasi_fcb_12' => safe_post('sirkulasi_fcb_12') !== '' ? safe_post('sirkulasi_fcb_12') : null,
    //             'sirkulasi_fcb_13' => safe_post('sirkulasi_fcb_13') !== '' ? safe_post('sirkulasi_fcb_13') : null,
    //             'sirkulasi_fcb_14' => safe_post('sirkulasi_fcb_14') !== '' ? safe_post('sirkulasi_fcb_14') : null,
    //             'sirkulasi_fcb_15' => safe_post('sirkulasi_fcb_15') !== '' ? safe_post('sirkulasi_fcb_15') : null,
    //             'sirkulasi_fcb_16' => safe_post('sirkulasi_fcb_16') !== '' ? safe_post('sirkulasi_fcb_16') : null,
    //             'sirkulasi_fcb_17' => safe_post('sirkulasi_fcb_17') !== '' ? safe_post('sirkulasi_fcb_17') : null,
    //         ]),

    //         'gcs_fcb' => json_encode([
    //             'gcs_fcb_1' => safe_post('gcs_fcb_1') !== '' ? safe_post('gcs_fcb_1') : null,
    //             'gcs_fcb_2' => safe_post('gcs_fcb_2') !== '' ? safe_post('gcs_fcb_2') : null,
    //             'gcs_fcb_3' => safe_post('gcs_fcb_3') !== '' ? safe_post('gcs_fcb_3') : null,
    //             'gcs_fcb_4' => safe_post('gcs_fcb_4') !== '' ? safe_post('gcs_fcb_4') : null,
    //         ]),

    //         'tanda_vital_fcb' => json_encode([
    //             'tanda_vital_fcb_1' => safe_post('tanda_vital_fcb_1') !== '' ? safe_post('tanda_vital_fcb_1') : null,
    //             'tanda_vital_fcb_2' => safe_post('tanda_vital_fcb_2') !== '' ? safe_post('tanda_vital_fcb_2') : null,
    //             'tanda_vital_fcb_3' => safe_post('tanda_vital_fcb_3') !== '' ? safe_post('tanda_vital_fcb_3') : null,
    //             'tanda_vital_fcb_4' => safe_post('tanda_vital_fcb_4') !== '' ? safe_post('tanda_vital_fcb_4') : null,
    //             'tanda_vital_fcb_5' => safe_post('tanda_vital_fcb_5') !== '' ? safe_post('tanda_vital_fcb_5') : null,
    //             'tanda_vital_fcb_6' => safe_post('tanda_vital_fcb_6') !== '' ? safe_post('tanda_vital_fcb_6') : null,
    //         ]),

    //         'anamnesa_fcb' => (safe_post('anamnesa_fcb') !== '' ? safe_post('anamnesa_fcb') : NULL),

    //         'alergi_fcb' => json_encode([
    //             'alergi_fcb_1' => safe_post('alergi_fcb_1') !== '' ? safe_post('alergi_fcb_1') : null,
    //             'alergi_fcb_2' => safe_post('alergi_fcb_2') !== '' ? safe_post('alergi_fcb_2') : null,
    //             'alergi_fcb_3' => safe_post('alergi_fcb_3') !== '' ? safe_post('alergi_fcb_3') : null,
    //             'alergi_fcb_4' => safe_post('alergi_fcb_4') !== '' ? safe_post('alergi_fcb_4') : null,
    //             'alergi_fcb_5' => safe_post('alergi_fcb_5') !== '' ? safe_post('alergi_fcb_5') : null,
    //         ]),

    //         'pemeriksaan_fcb' => (safe_post('pemeriksaan_fcb') !== '' ? safe_post('pemeriksaan_fcb') : NULL),

    //         'diagnosis_fcb' => (safe_post('diagnosis_fcb') !== '' ? safe_post('diagnosis_fcb') : NULL),

    //         'paska_fcb' => json_encode([
    //             'paska_fcb_1' => safe_post('paska_fcb_1') !== '' ? safe_post('paska_fcb_1') : null,
    //             'paska_fcb_2' => safe_post('paska_fcb_2') !== '' ? safe_post('paska_fcb_2') : null,
    //             'paska_fcb_3' => safe_post('paska_fcb_3') !== '' ? safe_post('paska_fcb_3') : null,
    //             'paska_fcb_4' => safe_post('paska_fcb_4') !== '' ? safe_post('paska_fcb_4') : null,
    //             'paska_fcb_5' => safe_post('paska_fcb_5') !== '' ? safe_post('paska_fcb_5') : null,
    //             'paska_fcb_6' => safe_post('paska_fcb_6') !== '' ? safe_post('paska_fcb_6') : null,
    //             'paska_fcb_7' => safe_post('paska_fcb_7') !== '' ? safe_post('paska_fcb_7') : null,
    //             'paska_fcb_8' => safe_post('paska_fcb_8') !== '' ? safe_post('paska_fcb_8') : null,
    //         ]),

    //         'keterangan_fcb' => (safe_post('keterangan_fcb') !== '' ? safe_post('keterangan_fcb') : NULL),

    //         'ttd_fcb' => (safe_post('ttd_fcb') !== '' ? safe_post('ttd_fcb') : NULL),

    //         'dokter_fcb' => safe_post('dokter_fcb') !== '' ? safe_post('dokter_fcb') : NULL,

    //     );

    //     $layanan = array('id' => safe_post('id_layanan_pendaftaran'));
    //     $pencegahan_date_lmdt = safe_post('pencegahan_date_lmdt');
    //     $id_pendaftaran       = safe_post('id_pendaftaran');
    //     $tgl_fcb              = safe_post('tgl_fcb');

    //     if (!empty($pencegahan_date_lmdt)) {

    //         $lembar_monitoring = array(
    //             'id_pendaftaran'         => $id_pendaftaran,
    //             'id_layanan_pendaftaran' => $layanan['id'],
    //             'id_user'                   => safe_post('user_pemantauan') !== '' ? safe_post('user_pemantauan') : null,
    //             'tgl_fcb'                   => safe_post('tgl_fcb') !== '' ? safe_post('tgl_fcb') : null,
    //             'jam_fcb'                   => safe_post('jam_fcb') !== '' ? safe_post('jam_fcb') : null,
    //             'terapi_eva_fcb'            => safe_post('terapi_eva_fcb') !== '' ? safe_post('terapi_eva_fcb') : null,
    //             'date_created'              => safe_post('pencegahan_date_lmdt') !== '' ? safe_post('pencegahan_date_lmdt') : null,
    //         );

    //         $this->m_pelayanan->insertLembarMonitoring($lembar_monitoring);
    //     }

    //     $sign = $this->db->select('fcb.dokter_fcb, fcb.bansal_fcb')
    //         ->from('sm_code_blue as fcb')
    //         ->where('fcb.id_layanan_pendaftaran', $id_layanan_pendaftaran)
    //         ->get()
    //         ->row();
    //     $this->m_pelayanan->updateCodeBlue($FormCodeBlue, $id_fcb);
    //     if (!empty($respon)) {
    //         $response = $respon;
    //     } else {
    //         $response = null;
    //     }
    //     if ($this->db->trans_status() === false) :
    //         $this->db->trans_rollback();
    //         $status = false;
    //     else :
    //         $this->db->trans_commit();
    //         $status = true;
    //     endif;
    //     $message = array(
    //         'status' => $status,
    //         'token'  => $this->security->get_csrf_hash(),
    //         'id_pendaftaran' => ('id_pendaftaran'),
    //         'id_layanan_pendaftaran' => ('id_layanan_pendaftaran'),
    //         'respon' => $response,
    //     );
    //     $this->response($message, REST_Controller::HTTP_OK);
    // }

    // FCB 
    function simpan_data_code_blue_post(){      
        if (safe_post('id_layanan_pendaftaran') === '') :
            $this->response(NULL, REST_Controller::HTTP_BAD_REQUEST);
        endif;

        $id_layanan_pendaftaran = safe_post('id_layanan_pendaftaran');
        $id_pendaftaran = safe_post('id_pendaftaran');;
        $id_fcb = safe_post('id_fcb');
        $id_users = safe_post('id_user');

        $FormCodeBlue = array(		
            'id_layanan_pendaftaran' => $id_layanan_pendaftaran,
            'id_pendaftaran' => $id_pendaftaran,
            'id_users' => $id_users,

            'respon_fcb' => json_encode([
                'respon_fcb_1' => safe_post('respon_fcb_1') !== '' ? safe_post('respon_fcb_1') : null,
				'respon_fcb_2' => safe_post('respon_fcb_2') !== '' ? safe_post('respon_fcb_2') : null,
				'respon_fcb_3' => safe_post('respon_fcb_3') !== '' ? safe_post('respon_fcb_3') : null,
				'respon_fcb_4' => safe_post('respon_fcb_4') !== '' ? safe_post('respon_fcb_4') : null,
				'respon_fcb_5' => safe_post('respon_fcb_5') !== '' ? safe_post('respon_fcb_5') : null,
				'respon_fcb_6' => safe_post('respon_fcb_6') !== '' ? safe_post('respon_fcb_6') : null,
				'respon_fcb_7' => safe_post('respon_fcb_7') !== '' ? safe_post('respon_fcb_7') : null,
				'respon_fcb_8' => safe_post('respon_fcb_8') !== '' ? safe_post('respon_fcb_8') : null,
				'respon_fcb_9' => safe_post('respon_fcb_9') !== '' ? safe_post('respon_fcb_9') : null,
            ]),

            'tgl_jam_fcb' => (safe_post('tgl_jam_fcb') !== '' ? datetime2mysql(safe_post('tgl_jam_fcb')) : NULL),

            'bansal_fcb' => safe_post('bansal_fcb') !== '' ? safe_post('bansal_fcb') : NULL,
           
            'kriteria_fcb' => json_encode([
                'kriteria_fcb_1' => safe_post('kriteria_fcb_1') !== '' ? safe_post('kriteria_fcb_1') : null,
				'kriteria_fcb_2' => safe_post('kriteria_fcb_2') !== '' ? safe_post('kriteria_fcb_2') : null,
				'kriteria_fcb_3' => safe_post('kriteria_fcb_3') !== '' ? safe_post('kriteria_fcb_3') : null,
				'kriteria_fcb_4' => safe_post('kriteria_fcb_4') !== '' ? safe_post('kriteria_fcb_4') : null,
				'kriteria_fcb_5' => safe_post('kriteria_fcb_5') !== '' ? safe_post('kriteria_fcb_5') : null,
				'kriteria_fcb_6' => safe_post('kriteria_fcb_6') !== '' ? safe_post('kriteria_fcb_6') : null,
				'kriteria_fcb_7' => safe_post('kriteria_fcb_7') !== '' ? safe_post('kriteria_fcb_7') : null,
				'kriteria_fcb_8' => safe_post('kriteria_fcb_8') !== '' ? safe_post('kriteria_fcb_8') : null,
				'kriteria_fcb_9' => safe_post('kriteria_fcb_9') !== '' ? safe_post('kriteria_fcb_9') : null,
				'kriteria_fcb_10' => safe_post('kriteria_fcb_10') !== '' ? safe_post('kriteria_fcb_10') : null,
            ]),

            'awal_fcb' => json_encode([
                'awal_fcb_1' => safe_post('awal_fcb_1') !== '' ? safe_post('awal_fcb_1') : null,
				'awal_fcb_2' => safe_post('awal_fcb_2') !== '' ? safe_post('awal_fcb_2') : null,
				'awal_fcb_3' => safe_post('awal_fcb_3') !== '' ? safe_post('awal_fcb_3') : null,
				'awal_fcb_4' => safe_post('awal_fcb_4') !== '' ? safe_post('awal_fcb_4') : null,
            ]),

            'jalan_fcb' => json_encode([
                'jalan_fcb_1' => safe_post('jalan_fcb_1') !== '' ? safe_post('jalan_fcb_1') : null,
				'jalan_fcb_2' => safe_post('jalan_fcb_2') !== '' ? safe_post('jalan_fcb_2') : null,
				'jalan_fcb_3' => safe_post('jalan_fcb_3') !== '' ? safe_post('jalan_fcb_3') : null,
				'jalan_fcb_4' => safe_post('jalan_fcb_4') !== '' ? safe_post('jalan_fcb_4') : null,
				'jalan_fcb_5' => safe_post('jalan_fcb_5') !== '' ? safe_post('jalan_fcb_5') : null,
				'jalan_fcb_6' => safe_post('jalan_fcb_6') !== '' ? safe_post('jalan_fcb_6') : null,
				'jalan_fcb_7' => safe_post('jalan_fcb_7') !== '' ? safe_post('jalan_fcb_7') : null,
				'jalan_fcb_8' => safe_post('jalan_fcb_8') !== '' ? safe_post('jalan_fcb_8') : null,
                'jalan_fcb_9' => safe_post('jalan_fcb_9') !== '' ? safe_post('jalan_fcb_9') : null,
				'jalan_fcb_10' => safe_post('jalan_fcb_10') !== '' ? safe_post('jalan_fcb_10') : null,
				'jalan_fcb_11' => safe_post('jalan_fcb_11') !== '' ? safe_post('jalan_fcb_11') : null,
				'jalan_fcb_12' => safe_post('jalan_fcb_12') !== '' ? safe_post('jalan_fcb_12') : null,
				'jalan_fcb_13' => safe_post('jalan_fcb_13') !== '' ? safe_post('jalan_fcb_13') : null,
				'jalan_fcb_14' => safe_post('jalan_fcb_14') !== '' ? safe_post('jalan_fcb_14') : null,
				'jalan_fcb_15' => safe_post('jalan_fcb_15') !== '' ? safe_post('jalan_fcb_15') : null,
				'jalan_fcb_16' => safe_post('jalan_fcb_16') !== '' ? safe_post('jalan_fcb_16') : null,
				'jalan_fcb_17' => safe_post('jalan_fcb_17') !== '' ? safe_post('jalan_fcb_17') : null,
				'jalan_fcb_18' => safe_post('jalan_fcb_18') !== '' ? safe_post('jalan_fcb_18') : null,
            ]),

            'sirkulasi_fcb' => json_encode([
                'sirkulasi_fcb_1' => safe_post('sirkulasi_fcb_1') !== '' ? safe_post('sirkulasi_fcb_1') : null,
				'sirkulasi_fcb_2' => safe_post('sirkulasi_fcb_2') !== '' ? safe_post('sirkulasi_fcb_2') : null,
				'sirkulasi_fcb_3' => safe_post('sirkulasi_fcb_3') !== '' ? safe_post('sirkulasi_fcb_3') : null,
				'sirkulasi_fcb_4' => safe_post('sirkulasi_fcb_4') !== '' ? safe_post('sirkulasi_fcb_4') : null,
				'sirkulasi_fcb_5' => safe_post('sirkulasi_fcb_5') !== '' ? safe_post('sirkulasi_fcb_5') : null,
				'sirkulasi_fcb_6' => safe_post('sirkulasi_fcb_6') !== '' ? safe_post('sirkulasi_fcb_6') : null,
				'sirkulasi_fcb_7' => safe_post('sirkulasi_fcb_7') !== '' ? safe_post('sirkulasi_fcb_7') : null,
				'sirkulasi_fcb_8' => safe_post('sirkulasi_fcb_8') !== '' ? safe_post('sirkulasi_fcb_8') : null,
                'sirkulasi_fcb_9' => safe_post('sirkulasi_fcb_9') !== '' ? safe_post('sirkulasi_fcb_9') : null,
				'sirkulasi_fcb_10' => safe_post('sirkulasi_fcb_10') !== '' ? safe_post('sirkulasi_fcb_10') : null,
				'sirkulasi_fcb_11' => safe_post('sirkulasi_fcb_11') !== '' ? safe_post('sirkulasi_fcb_11') : null,
				'sirkulasi_fcb_12' => safe_post('sirkulasi_fcb_12') !== '' ? safe_post('sirkulasi_fcb_12') : null,
				'sirkulasi_fcb_13' => safe_post('sirkulasi_fcb_13') !== '' ? safe_post('sirkulasi_fcb_13') : null,
				'sirkulasi_fcb_14' => safe_post('sirkulasi_fcb_14') !== '' ? safe_post('sirkulasi_fcb_14') : null,
				'sirkulasi_fcb_15' => safe_post('sirkulasi_fcb_15') !== '' ? safe_post('sirkulasi_fcb_15') : null,
				'sirkulasi_fcb_16' => safe_post('sirkulasi_fcb_16') !== '' ? safe_post('sirkulasi_fcb_16') : null,
				'sirkulasi_fcb_17' => safe_post('sirkulasi_fcb_17') !== '' ? safe_post('sirkulasi_fcb_17') : null,
            ]),

            'gcs_fcb' => json_encode([
                'gcs_fcb_1' => safe_post('gcs_fcb_1') !== '' ? safe_post('gcs_fcb_1') : null,
				'gcs_fcb_2' => safe_post('gcs_fcb_2') !== '' ? safe_post('gcs_fcb_2') : null,
				'gcs_fcb_3' => safe_post('gcs_fcb_3') !== '' ? safe_post('gcs_fcb_3') : null,
				'gcs_fcb_4' => safe_post('gcs_fcb_4') !== '' ? safe_post('gcs_fcb_4') : null,
            ]),

            'tanda_vital_fcb' => json_encode([
                'tanda_vital_fcb_1' => safe_post('tanda_vital_fcb_1') !== '' ? safe_post('tanda_vital_fcb_1') : null,
				'tanda_vital_fcb_2' => safe_post('tanda_vital_fcb_2') !== '' ? safe_post('tanda_vital_fcb_2') : null,
				'tanda_vital_fcb_3' => safe_post('tanda_vital_fcb_3') !== '' ? safe_post('tanda_vital_fcb_3') : null,
				'tanda_vital_fcb_4' => safe_post('tanda_vital_fcb_4') !== '' ? safe_post('tanda_vital_fcb_4') : null,
				'tanda_vital_fcb_5' => safe_post('tanda_vital_fcb_5') !== '' ? safe_post('tanda_vital_fcb_5') : null,
				'tanda_vital_fcb_6' => safe_post('tanda_vital_fcb_6') !== '' ? safe_post('tanda_vital_fcb_6') : null,
            ]),

            'anamnesa_fcb' => (safe_post('anamnesa_fcb') !== '' ? safe_post('anamnesa_fcb') : NULL),   
            
            'alergi_fcb' => json_encode([
                'alergi_fcb_1' => safe_post('alergi_fcb_1') !== '' ? safe_post('alergi_fcb_1') : null,
				'alergi_fcb_2' => safe_post('alergi_fcb_2') !== '' ? safe_post('alergi_fcb_2') : null,
				'alergi_fcb_3' => safe_post('alergi_fcb_3') !== '' ? safe_post('alergi_fcb_3') : null,
				'alergi_fcb_4' => safe_post('alergi_fcb_4') !== '' ? safe_post('alergi_fcb_4') : null,
				'alergi_fcb_5' => safe_post('alergi_fcb_5') !== '' ? safe_post('alergi_fcb_5') : null,
            ]),

            'pemeriksaan_fcb' => (safe_post('pemeriksaan_fcb') !== '' ? safe_post('pemeriksaan_fcb') : NULL),   

            'diagnosis_fcb' => (safe_post('diagnosis_fcb') !== '' ? safe_post('diagnosis_fcb') : NULL),   

            'paska_fcb' => json_encode([
                'paska_fcb_1' => safe_post('paska_fcb_1') !== '' ? safe_post('paska_fcb_1') : null,
				'paska_fcb_2' => safe_post('paska_fcb_2') !== '' ? safe_post('paska_fcb_2') : null,
				'paska_fcb_3' => safe_post('paska_fcb_3') !== '' ? safe_post('paska_fcb_3') : null,
				'paska_fcb_4' => safe_post('paska_fcb_4') !== '' ? safe_post('paska_fcb_4') : null,
				'paska_fcb_5' => safe_post('paska_fcb_5') !== '' ? safe_post('paska_fcb_5') : null,
				'paska_fcb_6' => safe_post('paska_fcb_6') !== '' ? safe_post('paska_fcb_6') : null,
				'paska_fcb_7' => safe_post('paska_fcb_7') !== '' ? safe_post('paska_fcb_7') : null,
				'paska_fcb_8' => safe_post('paska_fcb_8') !== '' ? safe_post('paska_fcb_8') : null,
            ]),
            
            'keterangan_fcb' => (safe_post('keterangan_fcb') !== '' ? safe_post('keterangan_fcb') : NULL),   

            'ttd_fcb' => (safe_post('ttd_fcb') !== '' ? safe_post('ttd_fcb') : NULL),     

            'dokter_fcb' => safe_post('dokter_fcb') !== '' ? safe_post('dokter_fcb') : NULL,
       
        );	

        $layanan = array('id' => safe_post('id_layanan_pendaftaran'));
        $pencegahan_date_lmdt = safe_post('pencegahan_date_lmdt');
        $id_pendaftaran       = safe_post('id_pendaftaran');
        $tgl_fcb              = safe_post('tgl_fcb');
     
        if (!empty($pencegahan_date_lmdt)) {
          
            $lembar_monitoring = array(
                'id_pendaftaran'         => $id_pendaftaran,
                'id_layanan_pendaftaran' => $layanan['id'],
                'id_user'                   => safe_post('user_pemantauan') !== '' ? safe_post('user_pemantauan') : null,
                'tgl_fcb'                   => safe_post('tgl_fcb') !== '' ? safe_post('tgl_fcb') : null,
                'jam_fcb'                   => safe_post('jam_fcb') !== '' ? safe_post('jam_fcb') : null,
                'terapi_eva_fcb'            => safe_post('terapi_eva_fcb') !== '' ? safe_post('terapi_eva_fcb') : null,
                'date_created'              => safe_post('pencegahan_date_lmdt') !== '' ? safe_post('pencegahan_date_lmdt') : null,
            );
           
            $this->m_pelayanan->insertLembarMonitoring($lembar_monitoring);          
        }

		$sign = $this->db->select('fcb.dokter_fcb, fcb.bansal_fcb')
        ->from('sm_code_blue as fcb')     
        ->where('fcb.id_layanan_pendaftaran', $id_layanan_pendaftaran)
        ->get()
        ->row();   
        $this->m_pelayanan->updateCodeBlue($FormCodeBlue, $id_fcb);
		if (!empty($respon)) {
			$response = $respon;
		} else {
			$response = null;
		}
		if ($this->db->trans_status() === false) :
			$this->db->trans_rollback();
			$status = false;
		else :
			$this->db->trans_commit();
			$status = true;
		endif;
		$message = array(
			'status' => $status,
			'token'  => $this->security->get_csrf_hash(),
            'id_pendaftaran' => ('id_pendaftaran'),
            'id_layanan_pendaftaran' => ('id_layanan_pendaftaran'),
			'respon' => $response,
		);
		$this->response($message, REST_Controller::HTTP_OK);
	}

    // LMDT
    function lembar_monitoring_delete($id)
    {
        $status = $this->m_pelayanan->deleteLembarMonitoring($id);
        if ($status) :
            $response = array('status' => $status, 'message' => 'Berhasil menghapus Lembar Monitoring!');
        else :
            $response = array('status' => $status, 'message' => 'Gagal menghapus Lembar Monitoring!');
        endif;
        $this->response($response, REST_Controller::HTTP_OK);
    }

    // LMDT 
    function get_lembar_monitoring_get()
    {
        if (!$this->get('id', true)) :
            $this->response(null, REST_Controller::HTTP_BAD_REQUEST);
        endif;
        // var_dump($this->get('id'));die;
        $data = $this->m_pelayanan->getLembarMonitoringByID($this->get('id', true));
        $this->response($data, REST_Controller::HTTP_OK);
    }

    // LMDT
    function update_lembar_monitoring_put()
    {
        if (!$this->put('id', true)) :
            $this->response(array('status' => false), REST_Controller::HTTP_OK);
        endif;

        $tgl_fcb = $this->put('tgl_fcb', true);
        $tgl_fcb = str_replace('/', '-', $tgl_fcb);
        $tgl_fcb = date('Y-m-d', strtotime($tgl_fcb));
        $jam_fcb                    = $this->put('jam_fcb', true);
        $terapi_eva_fcb             = $this->put('terapi_eva_fcb', true);

        $data = array(
            'id'                    => $this->put('id', true),
            'tgl_fcb'               => $tgl_fcb,
            'jam_fcb'               => $jam_fcb !== '' ? $jam_fcb : null,
            'terapi_eva_fcb'        => $terapi_eva_fcb !== '' ? $terapi_eva_fcb : null,
            'updated_at'            => date('Y-m-d H:i:s', time()),
        );
        // var_dump($data);die;
        $status = $this->m_pelayanan->editLembarMonitoring($data);
        $this->response(array('status' => $status), REST_Controller::HTTP_OK);
    }

    // PNCS
    function get_data_pengkajian_nyeri_comfort_scale_get()
    {
        if (!$this->get('id_layanan_pendaftaran')) :
            $this->response(NULL, REST_Controller::HTTP_BAD_REQUEST); // (400)
        endif;
        $this->load->model('pendaftaran/Pendaftaran_model', 'm_pendaftaran');
        $this->load->model('pelayanan/Pelayanan_model', 'm_pelayanan');
        $data                               = $this->m_pendaftaran->getPendaftaranDetail($this->get('id', true), $this->get('id_layanan', true));
        $data['profil']                     = $this->m_pelayanan->getProfilPasien($data['pasien']->id_pasien);
        // $data['pengkajian_nyeri_comfort_scale']        = $this->m_pelayanan->getPengkajianNyeriComfortScale($data['layanan']->id); 
        $data['pengkajian_nyeri_comfort_scale']            = $this->m_pelayanan->getPengkajianNyeriComfortScale($this->get('id', true));
        if ($data) :
            $this->response($data, REST_Controller::HTTP_OK); // (200)
        endif;
    }

    // PNCS
    function simpan_data_pengkajian_nyeri_comfort_scale_post()
    {
        $id_users = safe_post('id_user');
        $layanan = array('id' => safe_post('id_layanan_pendaftaran'));
        $pncs_tanggal_pengkajian = safe_post('pncs_tanggal_pengkajian');
        $id_pendaftaran           = safe_post('id_pendaftaran');
        if (!empty($pncs_tanggal_pengkajian)) {
            $pengkajian_pncs = array(
                'id_pendaftaran'         => $id_pendaftaran,
                'id_layanan_pendaftaran' => $layanan['id'],
                'id_user'                => safe_post('user_pengkajian') !== '' ? safe_post('user_pengkajian') : null,
                'pncs_jam'               => safe_post('pncs_jam') !== '' ? safe_post('pncs_jam') : null,
                'tanggal_pengkajian'     => safe_post('pncs_tanggal_pengkajian'),
                'perawat_pncs'           => safe_post('perawat_pncs') !== '' ? safe_post('perawat_pncs') : null,
                'kewaspadaan_pncs'                  => safe_post('kewaspadaan_pncs') !== '' ? safe_post('kewaspadaan_pncs') : null,
                'ketenangan_pncs'                   => safe_post('ketenangan_pncs') !== '' ? safe_post('ketenangan_pncs') : null,
                'distress_pncs'                     => safe_post('distress_pncs') !== '' ? safe_post('distress_pncs') : null,
                'menangis_pncs'                     => safe_post('menangis_pncs') !== '' ? safe_post('menangis_pncs') : null,
                'pergerakan_pncs'                   => safe_post('pergerakan_pncs') !== '' ? safe_post('pergerakan_pncs') : null,
                'tonus_pncs'                        => safe_post('tonus_pncs') !== '' ? safe_post('tonus_pncs') : null,
                'tegangan_pncs'                     => safe_post('tegangan_pncs') !== '' ? safe_post('tegangan_pncs') : null,
                'tekanan_pncs'                      => safe_post('tekanan_pncs') !== '' ? safe_post('tekanan_pncs') : null,
                'denyut_pncs'                       => safe_post('denyut_pncs') !== '' ? safe_post('denyut_pncs') : null,
                'jumlah_skor_pncs'                  => safe_post('jumlah_skor_pncs') !== '' ? safe_post('jumlah_skor_pncs') : null,
                'paraf_pncs'        => (safe_post('paraf_pncs') !== '' ? safe_post('paraf_pncs') : NULL),
                'perawat_pncs'      => safe_post('perawat_pncs') !== '' ? safe_post('perawat_pncs') : NULL,
                'date_created'      => safe_post('pengkajian_date_nyeri_comfort_scale') !== '' ? safe_post('pengkajian_date_nyeri_comfort_scale') : null,
            );
            $this->m_pelayanan->insertPengkajianNyeriComfortScale($pengkajian_pncs);
            // var_dump($pengkajian_pncs);die;
        }
        if (!empty($respon)) {
            $response = $respon;
        } else {
            $response = null;
        }
        if ($this->db->trans_status() === false) :
            $this->db->trans_rollback();
            $status = false;
        else :
            $this->db->trans_commit();
            $status = true;
        endif;
        $message = array(
            'status' => $status,
            'token'  => $this->security->get_csrf_hash(),
            'id_pendaftaran' => ('id_pendaftaran'),
            'id_layanan_pendaftaran' => ('id_layanan_pendaftaran'),
            'respon' => $response,
        );
        $this->response($message, REST_Controller::HTTP_OK);
    }

    // PNCS
    function hapus_pengkajian_nyeri_comfort_scale_delete($id)
    {
        $status = $this->m_pelayanan->deletePengkajiannyericomfortscale($id);
        if ($status) :
            $response = array('status' => $status, 'message' => 'Berhasil menghapus Pengkajian Nyeri Comfort Scale!');
        else :
            $response = array('status' => $status, 'message' => 'Gagal menghapus Pengkajian Nyeri Comfort Scale!');
        endif;
        $this->response($response, REST_Controller::HTTP_OK);
    }

    // PNCS 
    function get_pengkajian_nyeri_comfort_scale_get()
    {
        if (!$this->get('id', true)) :
            $this->response(null, REST_Controller::HTTP_BAD_REQUEST);
        endif;
        $data = $this->m_pelayanan->getPengkajianNyeriComfortScaleByID($this->get('id', true));
        $this->response($data, REST_Controller::HTTP_OK);
    }

    // PNCS
    function update_pengkajian_nyeri_comfort_scale_put()
    {
        if (!$this->put('id', true)) :
            $this->response(array('status' => false), REST_Controller::HTTP_OK);
        endif;
        $tanggal_pengkajian = $this->put('pncs_tanggal_pengkajian', true);
        $tanggal_pengkajian = str_replace('/', '-', $tanggal_pengkajian);
        $tanggal_pengkajian = date('Y-m-d', strtotime($tanggal_pengkajian));
        $perawat_pncs       = $this->put('perawat_pncs', true);
        $pncs_jam           = $this->put('pncs_jam', true);
        $paraf_pncs         = $this->put('paraf_pncs', true);
        $kewaspadaan_pncs   = $this->put('kewaspadaan_pncs', true);
        $ketenangan_pncs    = $this->put('ketenangan_pncs', true);
        $distress_pncs      = $this->put('distress_pncs', true);
        $menangis_pncs      = $this->put('menangis_pncs', true);
        $pergerakan_pncs    = $this->put('pergerakan_pncs', true);
        $tonus_pncs         = $this->put('tonus_pncs', true);
        $tegangan_pncs      = $this->put('tegangan_pncs', true);
        $tekanan_pncs       = $this->put('tekanan_pncs', true);
        $denyut_pncs        = $this->put('denyut_pncs', true);
        $jumlah_skor_pncs  = $this->put('jumlah_skor_pncs', true);
        $data = array(
            'id'                    => $this->put('id', true),
            'tanggal_pengkajian'    => $tanggal_pengkajian,
            'perawat_pncs'          => $perawat_pncs !== '' ? $perawat_pncs : null,
            'pncs_jam'              => $pncs_jam !== '' ? $pncs_jam : null,
            'paraf_pncs'            => $paraf_pncs === 'on' ? 1 : 0,
            'kewaspadaan_pncs'          => $kewaspadaan_pncs !== '' ? $kewaspadaan_pncs : null,
            'ketenangan_pncs'           => $ketenangan_pncs !== '' ? $ketenangan_pncs : null,
            'distress_pncs'             => $distress_pncs !== '' ? $distress_pncs : null,
            'menangis_pncs'             => $menangis_pncs !== '' ? $menangis_pncs : null,
            'pergerakan_pncs'           => $pergerakan_pncs !== '' ? $pergerakan_pncs : null,
            'tonus_pncs'                => $tonus_pncs !== '' ? $tonus_pncs : null,
            'tegangan_pncs'             => $tegangan_pncs !== '' ? $tegangan_pncs : null,
            'tekanan_pncs'              => $tekanan_pncs !== '' ? $tekanan_pncs : null,
            'denyut_pncs'               => $denyut_pncs !== '' ? $denyut_pncs : null,
            'jumlah_skor_pncs'          => $jumlah_skor_pncs !== '' ? $jumlah_skor_pncs : null,
            'updated_at' => date('Y-m-d H:i:s', time()),
        );
        $status = $this->m_pelayanan->editPengkajianNyeriComfortScale($data);
        $this->response(array('status' => $status), REST_Controller::HTTP_OK);
    }


    public function show_edit_pasang_alat_get($id)
    {
        $data = $this->db->select("spa.*, COALESCE(sl.nama, '') as tindakan, COALESCE(ga.nama, '') as nama_petugas, COALESCE(pg.nama, '') as perawat_pasang, COALESCE(spg.nama, '') as perawat_lepas")
            ->from('sm_pemasangan_alat as spa')
            ->join('sm_translucent as st', 'st.id = spa.sirs_pemasang_alat', 'left')
            ->join('sm_pegawai as ga', 'ga.id = st.id', 'left')
            ->join('sm_layanan as sl', 'sl.id = spa.sirs_tindakan', 'left')
            ->join('sm_tenaga_medis as tm', 'tm.id = spa.sirs_perawat_pasang', 'left')
            ->join('sm_pegawai as pg', 'pg.id = tm.id_pegawai', 'left')
            ->join('sm_tenaga_medis as stm', 'stm.id = spa.sirs_perawat_lepas', 'left')
            ->join('sm_pegawai as spg', 'spg.id = stm.id_pegawai', 'left')
            ->where('spa.id', $id, true)
            ->get()
            ->row();

        $this->response([
            'status' => true,
            'data' => $data
        ], REST_Controller::HTTP_OK);
    }

    public function simpan_edit_pasang_alat_post()
    {
        $id = !empty(safe_post('sirs_edit_id')) ? safe_post('sirs_edit_id') : null;

        if (!$id) {
            $this->response([
                'status' => false,
                'message' => 'Data tidak ditemukan'
            ], self::HTTP_NOT_FOUND);

            return;
        }

        $data = [
            'sirs_tindakan' => !empty(safe_post('pasang_sirs_tindakan_edit')) ? safe_post('pasang_sirs_tindakan_edit') : null,
            'sirs_tanggal_pasang' => !empty(safe_post('sirs_tanggal_pasang_edit')) ? date2mysql(safe_post('sirs_tanggal_pasang_edit')) : null,
            'sirs_tanggal_lepas' => !empty(safe_post('sirs_tanggal_lepas_edit')) ? date2mysql(safe_post('sirs_tanggal_lepas_edit')) : null,
            'sirs_lokasi' => !empty(safe_post('sirs_lokasi_edit')) ? safe_post('sirs_lokasi_edit') : null,
            'sirs_alasan_pasang' => !empty(safe_post('sirs_alasan_pasang_edit')) ? safe_post('sirs_alasan_pasang_edit') : null,
            'sirs_alasan_lepas' => !empty(safe_post('sirs_alasan_lepas_edit')) ? safe_post('sirs_alasan_lepas_edit') : null,
            'sirs_perawat_pasang' => !empty(safe_post('sirs_perawat_pasang_edit')) ? safe_post('sirs_perawat_pasang_edit') : null,
            'sirs_perawat_lepas' => !empty(safe_post('sirs_perawat_lepas_edit')) ? safe_post('sirs_perawat_lepas_edit') : null,
        ];

        $update = $this->db->where('id', $id)->update('sm_pemasangan_alat', $data);

        if ($update) {
            $dataPasangAlat = $this->db->select('lp.id_pendaftaran')
                ->from('sm_pemasangan_alat pa')
                ->join('sm_layanan_pendaftaran lp', 'lp.id = pa.id_layanan_pendaftaran')
                ->where('pa.id', $id)
                ->get()
                ->row();

            $idPendaftaran = $dataPasangAlat->id_pendaftaran;

            $data = $this->m_pelayanan->getPemasanganAlat($idPendaftaran);

            $this->response([
                'status' => true,
                'message' => 'Berhasil mengedit data',
                'data' => $data,
            ]);
        } else {
            $this->response([
                'status' => false,
                'message' => 'Gagal mengedit data'
            ], self::HTTP_BAD_REQUEST);
        }
    }


    // SSCKO 1
    function get_data_surgical_safety_cheklist_kamar_operasi_get()
    {
        if (!$this->get('id')) :
            $this->response(NULL, REST_Controller::HTTP_BAD_REQUEST); // (400)
        endif;
        $this->load->model('pendaftaran/Pendaftaran_model', 'm_pendaftaran');
        $this->load->model('pelayanan/Pelayanan_model', 'm_pelayanan');
        $data                               = $this->m_pendaftaran->getPendaftaranDetail($this->get('id', true), $this->get('id_layanan', true));
        $data['profil']                     = $this->m_pelayanan->getProfilPasien($data['pasien']->id_pasien);
        $data['surgical_safety_cheklist_kamar_operasi']            = $this->m_pelayanan->getSurgicalSafetyCheklisKamarOperasi($data['layanan']->id_pendaftaran);
        if ($data) :
            $this->response($data, REST_Controller::HTTP_OK); // (200)
        endif;
        // var_dump('surgical_safety_cheklist_kamar_operasi');die;
    }

    // SSCKO 2
    function simpan_data_surgical_safety_cheklist_kamar_operasi_post()
    {
        $id_users = safe_post('id_user');
        $layanan = array('id' => safe_post('id_layanan_pendaftaran'));
        $sscko_tanggal_tindakan = safe_post('sscko_tanggal_tindakan');
        $id_pendaftaran           = safe_post('id_pendaftaran');
        if (!empty($sscko_tanggal_tindakan)) {
            $pengkajian_sscko = array(
                'id_pendaftaran'         => $id_pendaftaran,
                'id_layanan_pendaftaran' => $layanan['id'],
                'id_user'                   => safe_post('user_pengkajian') !== '' ? safe_post('user_pengkajian') : null,
                'sscko_jam_1'               => safe_post('sscko_jam_1') !== '' ? safe_post('sscko_jam_1') : null,
                'sscko_jam_2'               => safe_post('sscko_jam_2') !== '' ? safe_post('sscko_jam_2') : null,
                'sscko_jam_3'               => safe_post('sscko_jam_3') !== '' ? safe_post('sscko_jam_3') : null,
                'tanggal_tindakan'          => safe_post('sscko_tanggal_tindakan'),

                // sign in = SSCKO H
                'sscko_igp'             => safe_post('sscko_igp')          !== '' ? safe_post('sscko_igp') : NULL,
                'sscko_lo'           => safe_post('sscko_lo')             !== '' ? safe_post('sscko_lo') : NULL,
                'sscko_prosedur'     => safe_post('sscko_prosedur')     !== '' ? safe_post('sscko_prosedur') : NULL,
                'sscko_sio'          => safe_post('sscko_sio')             !== '' ? safe_post('sscko_sio') : NULL,

                'sscko_tanda'        => safe_post('sscko_tanda')          !== '' ? safe_post('sscko_tanda') : NULL,

                'sscko_kemungkinan'  => safe_post('sscko_kemungkinan')  !== '' ? safe_post('sscko_kemungkinan') : NULL,

                'sscko_alergi'       => safe_post('sscko_alergi')       !== '' ? safe_post('sscko_alergi') : NULL,

                'sscko_resiko'       => safe_post('sscko_resiko')       !== '' ? safe_post('sscko_resiko') : NULL,

                'sscko_rencana'      => safe_post('sscko_rencana')      !== '' ? safe_post('sscko_rencana') : NULL,

                'sscko_adakah'      => safe_post('sscko_adakah')          !== '' ? safe_post('sscko_adakah') : NULL,

                'sscko_foto'        => safe_post('sscko_foto')                    !== '' ? safe_post('sscko_foto') : NULL,

                'sscko_anastesi'     => safe_post('sscko_anastesi')     !== '' ? safe_post('sscko_anastesi') : NULL,

                'sscko_mesin'        => safe_post('sscko_mesin')          !== '' ? safe_post('sscko_mesin') : NULL,
                'sscko_monitor'      => safe_post('sscko_monitor')        !== '' ? safe_post('sscko_monitor') : NULL,
                'sscko_sebut'          => safe_post('sscko_sebut')        !== '' ? safe_post('sscko_sebut') : NULL,
                'sscko_jenis'           => safe_post('sscko_jenis')        !== '' ? safe_post('sscko_jenis') : NULL,


                'sscko_paraf_perawat_sign_in'            => safe_post('sscko_paraf_perawat_sign_in')           !== '' ? safe_post('sscko_paraf_perawat_sign_in') : NULL,
                'sscko_perawat_sign_in'                  => safe_post('sscko_perawat_sign_in')                 !== '' ? safe_post('sscko_perawat_sign_in') : NULL,
                'sscko_paraf_dokter_anestesi_sign_in'    => safe_post('sscko_paraf_dokter_anestesi_sign_in')      !== '' ? safe_post('sscko_paraf_dokter_anestesi_sign_in') : NULL,
                'sscko_dokter_anestesi_sign_in'          => safe_post('sscko_dokter_anestesi_sign_in')         !== '' ? safe_post('sscko_dokter_anestesi_sign_in') : NULL,

                // time out = SSCKO H
                'sscko_konfirmasi'  => safe_post('sscko_konfirmasi')              !== '' ? safe_post('sscko_konfirmasi') : NULL,
                'sscko_np'          => safe_post('sscko_np')                       !== '' ? safe_post('sscko_np') : NULL,
                'sscko_prosedurr'   => safe_post('sscko_prosedurr')             !== '' ? safe_post('sscko_prosedurr') : NULL,
                'sscko_lokasi'      => safe_post('sscko_lokasi')                !== '' ? safe_post('sscko_lokasi') : NULL,
                'sscko_antibiotik'  => safe_post('sscko_antibiotik')            !== '' ? safe_post('sscko_antibiotik') : NULL,
                'sscko_bedah'       => safe_post('sscko_bedah')                 !== '' ? safe_post('sscko_bedah') : NULL,
                'sscko_anastesiii'  => safe_post('sscko_anastesiii')             !== '' ? safe_post('sscko_anastesiii') : NULL,
                'sscko_perawat'     => safe_post('sscko_perawat')                  !== '' ? safe_post('sscko_perawat') : NULL,

                'sscko_paraf_perawat_time_out'            => safe_post('sscko_paraf_perawat_time_out')          !== '' ? safe_post('sscko_paraf_perawat_time_out') : NULL,
                'sscko_perawat_time_out'                  => safe_post('sscko_perawat_time_out')                !== '' ? safe_post('sscko_perawat_time_out') : NULL,
                'sscko_paraf_dokter_anestesi_time_out'     => safe_post('sscko_paraf_dokter_anestesi_time_out')     !== '' ? safe_post('sscko_paraf_dokter_anestesi_time_out') : NULL,
                'sscko_dokter_anestesi_time_out'          => safe_post('sscko_dokter_anestesi_time_out')        !== '' ? safe_post('sscko_dokter_anestesi_time_out') : NULL,
                'sscko_operator_1'                      => safe_post('sscko_operator_1')        !== '' ? safe_post('sscko_operator_1') : NULL,
                'sscko_paraf_operator_1'                  => safe_post('sscko_paraf_operator_1')        !== '' ? safe_post('sscko_paraf_operator_1') : NULL,

                // sign out = SSCKO H
                'sscko_npt'         => safe_post('sscko_npt')              !== '' ? safe_post('sscko_npt') : NULL,
                'sscko_instrumen'   => safe_post('sscko_instrumen')       !== '' ? safe_post('sscko_instrumen') : NULL,
                'sscko_specimen'    => safe_post('sscko_specimen')        !== '' ? safe_post('sscko_specimen') : NULL,

                'sscko_operator'    => safe_post('sscko_operator')        !== '' ? safe_post('sscko_operator') : NULL,
                'sscko_paraf_operator_2'         => safe_post('sscko_paraf_operator_2')          !== '' ? safe_post('sscko_paraf_operator_2') : NULL,
                'sscko_operator_2'               => safe_post('sscko_operator_2')                !== '' ? safe_post('sscko_operator_2') : NULL,
                'sscko_paraf_dokter_anestesi_sign_out' => safe_post('sscko_paraf_dokter_anestesi_sign_out')  !== '' ? safe_post('sscko_paraf_dokter_anestesi_sign_out') : NULL,
                'sscko_dokter_anestesi_sign_out'       => safe_post('sscko_dokter_anestesi_sign_out')        !== '' ? safe_post('sscko_dokter_anestesi_sign_out') : NULL,
                'date_created'                         => safe_post('pengkajian_date_surgical_safety_cheklis_kamar_operasi') !== '' ? safe_post('pengkajian_date_surgical_safety_cheklis_kamar_operasi') : null,
            );
            //  var_dump($pengkajian_sscko);die;    
            $this->m_pelayanan->insertSurgicalSafetyCeklisKamarOperasi($pengkajian_sscko);
        }
        if (!empty($respon)) {
            $response = $respon;
        } else {
            $response = null;
        }
        if ($this->db->trans_status() === false) :
            $this->db->trans_rollback();
            $status = false;
        else :
            $this->db->trans_commit();
            $status = true;
        endif;

        $message = array(
            'status' => $status,
            'token'  => $this->security->get_csrf_hash(),
            'id_pendaftaran' => ('id_pendaftaran'),
            'id_layanan_pendaftaran' => ('id_layanan_pendaftaran'),
            'respon' => $response,
        );
        $this->response($message, REST_Controller::HTTP_OK);
    }

    // SSCKO 3
    function hapus_surgical_safety_cheklist_kamar_operasi_delete($id)
    {
        $status = $this->m_pelayanan->deleteSurgicalSafetyCeklisKamarOperasi($id);
        if ($status) :
            $response = array('status' => $status, 'message' => 'Berhasil menghapus Surgical Safety Ceklis Kamar Operasi!');
        else :
            $response = array('status' => $status, 'message' => 'Gagal menghapus Surgical Safety Ceklis Kamar Operasi!');
        endif;
        $this->response($response, REST_Controller::HTTP_OK);
    }

    // SSCKO 4
    function get_surgical_safety_cheklist_kamar_operasi_get()
    {
        if (!$this->get('id', true)) :
            $this->response(null, REST_Controller::HTTP_BAD_REQUEST);
        endif;
        $data = $this->m_pelayanan->getSurgicalSafetyCheklisKamarOperasiByID($this->get('id', true));
        $this->response($data, REST_Controller::HTTP_OK);
    }

    // SSCKO 5
    function update_surgical_safety_cheklist_kamar_operasi_put()
    {
        if (!$this->put('id', true)) :
            $this->response(array('status' => false), REST_Controller::HTTP_OK);
        endif;
        $tanggal_tindakan = $this->put('sscko_tanggal_tindakan', true);
        $tanggal_tindakan = str_replace('/', '-', $tanggal_tindakan);
        $tanggal_tindakan = date('Y-m-d', strtotime($tanggal_tindakan));
        $sscko_jam_1                            = $this->put('sscko_jam_1', true);
        $sscko_jam_2                            = $this->put('sscko_jam_2', true);
        $sscko_jam_3                            = $this->put('sscko_jam_3', true);
        $sscko_igp                               = $this->put('sscko_igp', true);
        $sscko_lo                               = $this->put('sscko_lo', true);
        $sscko_prosedur                           = $this->put('sscko_prosedur', true);
        $sscko_sio                               = $this->put('sscko_sio', true);

        $sscko_tanda                               = $this->put('sscko_tanda', true);

        $sscko_alergi                           = $this->put('sscko_alergi', true);

        $sscko_kemungkinan                       = $this->put('sscko_kemungkinan', true);

        $sscko_resiko                           = $this->put('sscko_resiko', true);

        $sscko_rencana                           = $this->put('sscko_rencana', true);

        $sscko_adakah                           = $this->put('sscko_adakah', true);

        $sscko_foto                               = $this->put('sscko_foto', true);

        $sscko_anastesi                           = $this->put('sscko_anastesi', true);

        $sscko_mesin                               = $this->put('sscko_mesin', true);
        $sscko_monitor                           = $this->put('sscko_monitor', true);
        $sscko_sebut                               = $this->put('sscko_sebut', true);
        $sscko_jenis                               = $this->put('sscko_jenis', true);
        $sscko_paraf_perawat_sign_in            = $this->put('sscko_paraf_perawat_sign_in', true);
        $sscko_perawat_sign_in                   = $this->put('sscko_perawat_sign_in', true);
        $sscko_paraf_dokter_anestesi_sign_in    = $this->put('sscko_paraf_dokter_anestesi_sign_in', true);
        $sscko_dokter_anestesi_sign_in           = $this->put('sscko_dokter_anestesi_sign_in', true);
        $sscko_konfirmasi                       = $this->put('sscko_konfirmasi', true);
        $sscko_np                               = $this->put('sscko_np', true);
        $sscko_prosedurr                           = $this->put('sscko_prosedurr', true);
        $sscko_lokasi                           = $this->put('sscko_lokasi', true);
        $sscko_antibiotik                       = $this->put('sscko_antibiotik', true);
        $sscko_bedah                               = $this->put('sscko_bedah', true);
        $sscko_anastesiii                       = $this->put('sscko_anastesiii', true);
        $sscko_perawat                           = $this->put('sscko_perawat', true);
        $sscko_paraf_perawat_time_out           = $this->put('sscko_paraf_perawat_time_out', true);
        $sscko_perawat_time_out                   = $this->put('sscko_perawat_time_out', true);
        $sscko_paraf_dokter_anestesi_time_out   = $this->put('sscko_paraf_dokter_anestesi_time_out', true);
        $sscko_dokter_anestesi_time_out           = $this->put('sscko_dokter_anestesi_time_out', true);
        $sscko_operator_1                       = $this->put('sscko_operator_1', true);
        $sscko_paraf_operator_1                   = $this->put('sscko_paraf_operator_1', true);
        $sscko_npt                               = $this->put('sscko_npt', true);
        $sscko_instrumen                           = $this->put('sscko_instrumen', true);
        $sscko_specimen                           = $this->put('sscko_specimen', true);
        $sscko_operator                           = $this->put('sscko_operator', true);
        $sscko_paraf_operator_2                   = $this->put('sscko_paraf_operator_2', true);
        $sscko_operator_2                       = $this->put('sscko_operator_2', true);
        $sscko_paraf_dokter_anestesi_sign_out   = $this->put('sscko_paraf_dokter_anestesi_sign_out', true);
        $sscko_dokter_anestesi_sign_out           = $this->put('sscko_dokter_anestesi_sign_out', true);

        $data = array(
            'id'                                    => $this->put('id', true),
            'tanggal_tindakan'                      => $tanggal_tindakan,
            'sscko_jam_1'                           => $sscko_jam_1 !== '' ? $sscko_jam_1 : null,
            'sscko_jam_2'                           => $sscko_jam_2 !== '' ? $sscko_jam_2 : null,
            'sscko_jam_3'                           => $sscko_jam_3 !== '' ? $sscko_jam_3 : null,
            'sscko_igp'                              => $sscko_igp !== '' ? $sscko_igp : null,
            'sscko_lo'                              => $sscko_lo !== '' ? $sscko_lo : null,
            'sscko_prosedur'                          => $sscko_prosedur !== '' ? $sscko_prosedur : null,
            'sscko_sio'                              => $sscko_sio !== '' ? $sscko_sio : null,

            'sscko_tanda'                              => $sscko_tanda !== '' ? $sscko_tanda : null,

            'sscko_alergi'                          => $sscko_alergi !== '' ? $sscko_alergi : null,

            'sscko_kemungkinan'                      => $sscko_kemungkinan !== '' ? $sscko_kemungkinan : null,

            'sscko_resiko'                          => $sscko_resiko !== '' ? $sscko_resiko : null,

            'sscko_rencana'                          => $sscko_rencana !== '' ? $sscko_rencana : null,

            'sscko_adakah'                          => $sscko_adakah !== '' ? $sscko_adakah : null,

            'sscko_foto'                              => $sscko_foto !== '' ? $sscko_foto : null,

            'sscko_anastesi'                          => $sscko_anastesi !== '' ? $sscko_anastesi : null,

            'sscko_mesin'                              => $sscko_mesin !== '' ? $sscko_mesin : null,
            'sscko_monitor'                          => $sscko_monitor !== '' ? $sscko_monitor : null,
            'sscko_sebut'                              => $sscko_sebut !== '' ? $sscko_sebut : null,
            'sscko_jenis'                              => $sscko_jenis !== '' ? $sscko_jenis : null,
            'sscko_perawat_sign_in'                  => $sscko_perawat_sign_in !== '' ? $sscko_perawat_sign_in : null,
            'sscko_dokter_anestesi_sign_in'         => $sscko_dokter_anestesi_sign_in !== '' ? $sscko_dokter_anestesi_sign_in : null,
            'sscko_konfirmasi'                      => $sscko_konfirmasi !== '' ? $sscko_konfirmasi : null,
            'sscko_np'                              => $sscko_np !== '' ? $sscko_np : null,
            'sscko_prosedurr'                          => $sscko_prosedurr !== '' ? $sscko_prosedurr : null,
            'sscko_lokasi'                          => $sscko_lokasi !== '' ? $sscko_lokasi : null,
            'sscko_antibiotik'                      => $sscko_antibiotik !== '' ? $sscko_antibiotik : null,
            'sscko_bedah'                              => $sscko_bedah !== '' ? $sscko_bedah : null,
            'sscko_anastesiii'                      => $sscko_anastesiii !== '' ? $sscko_anastesiii : null,
            'sscko_perawat'                          => $sscko_perawat !== '' ? $sscko_perawat : null,
            'sscko_perawat_time_out'                  => $sscko_perawat_time_out !== '' ? $sscko_perawat_time_out : null,
            'sscko_dokter_anestesi_time_out'        => $sscko_dokter_anestesi_time_out !== '' ? $sscko_dokter_anestesi_time_out : null,
            'sscko_operator_1'                      => $sscko_operator_1 !== '' ? $sscko_operator_1 : null,
            'sscko_npt'                              => $sscko_npt !== '' ? $sscko_npt : null,
            'sscko_instrumen'                          => $sscko_instrumen !== '' ? $sscko_instrumen : null,
            'sscko_specimen'                          => $sscko_specimen !== '' ? $sscko_specimen : null,
            'sscko_operator'                          => $sscko_operator !== '' ? $sscko_operator : null,
            'sscko_operator_2'                      => $sscko_operator_2 !== '' ? $sscko_operator_2 : null,
            'sscko_dokter_anestesi_sign_out'        => $sscko_dokter_anestesi_sign_out !== '' ? $sscko_dokter_anestesi_sign_out : null,
            'sscko_paraf_perawat_sign_in'           => $sscko_paraf_perawat_sign_in === 'on' ? 1 : 0,
            'sscko_paraf_perawat_time_out'          => $sscko_paraf_perawat_time_out === 'on' ? 1 : 0,
            'sscko_paraf_operator_2'                => $sscko_paraf_operator_2 === 'on' ? 1 : 0,
            'sscko_paraf_dokter_anestesi_sign_in'   => $sscko_paraf_dokter_anestesi_sign_in === 'on' ? 1 : 0,
            'sscko_paraf_dokter_anestesi_time_out'  => $sscko_paraf_dokter_anestesi_time_out === 'on' ? 1 : 0,
            'sscko_paraf_dokter_anestesi_sign_out'  => $sscko_paraf_dokter_anestesi_sign_out === 'on' ? 1 : 0,
            'sscko_paraf_operator_1'                => $sscko_paraf_operator_1 === 'on' ? 1 : 0,
            'updated_at'                            => date('Y-m-d H:i:s', time()),
        );
        // var_dump($data);die;
        $status = $this->m_pelayanan->editSurgicalSafetyCheklistKamarOperasi($data);
        $this->response(array('status' => $status), REST_Controller::HTTP_OK);
    }

    // surgical luar kamar operasi
    function get_surgical_luar_kamar_get()
    {
        if (!$this->get('id', true)) :
            $this->response(null, REST_Controller::HTTP_BAD_REQUEST);
        endif;

        $data = $this->m_pelayanan->getLKOByID($this->get('id', true));
        $this->response($data, REST_Controller::HTTP_OK);
    }

    function update_surgical_luar_kamar_put()
    {
        if (!$this->put('id', true)) :
            $this->response(array('status' => false), REST_Controller::HTTP_OK);
        endif;

        $tanggal_verifikasi = $this->put('tanggal_verifikasi', true);
        if ($tanggal_verifikasi !== '') {
            $tanggal_verifikasi = str_replace('/', '-', $tanggal_verifikasi);
            $tanggal_verifikasi = date('Y-m-d', strtotime($tanggal_verifikasi));
        }

        $jam_sign_in = $this->put('dko_jam_sign_in', true);
        if ($jam_sign_in == '') {
            $jam_sign_in = null;
        }

        $jam_time_out = $this->put('dko_jam_time_out', true);
        if ($jam_time_out == '') {
            $jam_time_out = null;
        }

        $jam_sign_out = $this->put('dko_jam_sign_out', true);
        if ($jam_sign_out == '') {
            $jam_sign_out = null;
        }

        $data = array(
            'user_dko' => $this->put('user_dko', true),
            'id' => $this->put('id', true),
            'dko_tanggal_verifikasi' => $tanggal_verifikasi !== null ? $tanggal_verifikasi : null,
            'updated_date' => date('Y-m-d H:i:s'),

            // kiri nama untuk model dan database. contoh :     'ssc_gelang' 
            // kanan nama dari view. contoh :   => $this->put('ssc_gelang', true) !== null ? $this->put('ssc_gelang', true) : 0,

            // sign in
            'dko_jam_sign_in' => $jam_sign_in !== null ? $jam_sign_in : null,
            'dko_gelang' => $this->put('dko_gelang', true) !== null ? $this->put('dko_gelang', true) : null,
            'dko_lokasi' => $this->put('dko_lokasi', true) !== null ? $this->put('dko_lokasi', true) : null,
            'dko_prosedur' => $this->put('dko_prosedur', true) !== null ? $this->put('dko_prosedur', true) : null,
            'dko_tanda' => $this->put('dko_izin', true) !== null ? $this->put('dko_izin', true) : null,
            'dko_tanda' => $this->put('dko_tanda', true) !== null ? $this->put('dko_tanda', true) : null,
            'dko_obat' => $this->put('dko_obat', true) !== null ? $this->put('dko_obat', true) : null,
            'dko_alergi' => $this->put('dko_alergi', true) !== null ? $this->put('dko_alergi', true) : null,
            'dko_alergi_ket' => $this->put('dko_alergi_ket', true) !== '' ? $this->put('dko_alergi_ket', true) : null,
            'dko_aspirasi' => $this->put('dko_aspirasi', true) !== null ? $this->put('dko_aspirasi', true) : null,
            'dko_darah' => $this->put('dko_darah', true) !== null ? $this->put('dko_darah', true) : null,
            'dko_anestesi' => $this->put('dko_anestesi', true) !== null ? $this->put('dko_anestesi', true) : null,

            // time out
            'dko_jam_time_out' => $jam_time_out !== null ? $jam_time_out : null,
            'dko_konfirmasi' => $this->put('dko_konfirmasi', true) !== null ? $this->put('dko_konfirmasi', true) : null,
            'dko_nama' => $this->put('dko_nama', true) !== null ? $this->put('dko_nama', true) : null,
            'dko_prosedur_time_out' => $this->put('dko_prosedur_time_out', true) !== null ? $this->put('dko_prosedur_time_out', true) : null,
            'dko_insisi' => $this->put('dko_insisi', true) !== null ? $this->put('dko_insisi', true) : null,
            'dko_profilaksis' => $this->put('dko_profilaksis', true) !== null ? $this->put('dko_profilaksis', true) : null,
            'dko_dokter_bedah_ket' => $this->put('dko_dokter_bedah_ket', true) !== '' ? $this->put('dko_dokter_bedah_ket', true) : null,
            'dko_dokter_anestesi_ket' => $this->put('dko_dokter_anestesi_ket', true) !== '' ? $this->put('dko_dokter_anestesi_ket', true) : null,
            'dko_perawat_ket' => $this->put('dko_perawat_ket', true) !== '' ? $this->put('dko_perawat_ket', true) : null,
            'dko_foto' => $this->put('dko_foto', true) !== null ? $this->put('dko_foto', true) : null,

            // sign out
            'dko_jam_sign_out' => $jam_sign_out !== null ? $jam_sign_out : null,
            'dko_tindakan' => $this->put('dko_tindakan', true) !== null ? $this->put('dko_tindakan', true) : null,
            'dko_instrumen' => $this->put('dko_instrumen', true) !== null ? $this->put('dko_instrumen', true) : null,
            'dko_specimen' => $this->put('dko_specimen', true) !== null ? $this->put('dko_specimen', true) : null,
            'dko_masalah' => $this->put('dko_masalah', true) !== null ? $this->put('dko_masalah', true) : null,
            'dko_review' => $this->put('dko_review', true) !== null ? $this->put('dko_review', true) : null,

            // perawat dan dokter
            'dko_perawat_sign_in' => $this->put('dko_perawat_sign_in', true) !== '' ? $this->put('dko_perawat_sign_in', true) : null,
            'dko_ttd_perawat_sign_in' => $this->put('dko_ttd_perawat_sign_in', true) !== null ? $this->put('dko_ttd_perawat_sign_in', true) : null,
            'dko_dokter_sign_in' => $this->put('dko_dokter_sign_in', true) !== '' ? $this->put('dko_dokter_sign_in', true) : null,
            'dko_ttd_dokter_sign_in' => $this->put('dko_ttd_dokter_sign_in', true) !== null ? $this->put('dko_ttd_dokter_sign_in', true) : null,

            'dko_operator_time_out' => $this->put('dko_operator_time_out', true) !== '' ? $this->put('dko_operator_time_out', true) : null,
            'dko_ttd_operator_time_out' => $this->put('dko_ttd_operator_time_out', true) !== null ? $this->put('dko_ttd_operator_time_out', true) : null,
            'dko_dokter_time_out' => $this->put('dko_dokter_time_out', true) !== '' ? $this->put('dko_dokter_time_out', true) : null,
            'dko_ttd_dokter_time_out' => $this->put('dko_ttd_dokter_time_out', true) !== null ? $this->put('dko_ttd_dokter_time_out', true) : null,
            'dko_perawat_time_out' => $this->put('dko_perawat_time_out', true) !== '' ? $this->put('dko_perawat_time_out', true) : null,
            'dko_ttd_perawat_time_out' => $this->put('dko_ttd_perawat_time_out', true) !== null ? $this->put('dko_ttd_perawat_time_out', true) : null,

            'dko_operator_sign_out' => $this->put('dko_operator_sign_out', true) !== '' ? $this->put('dko_operator_sign_out', true) : null,
            'dko_ttd_operator_sign_out' => $this->put('dko_ttd_operator_sign_out', true) !== null ? $this->put('dko_ttd_operator_sign_out', true) : null,
            'dko_dokter_sign_out' => $this->put('dko_dokter_sign_out', true) !== '' ? $this->put('dko_dokter_sign_out', true) : null,
            'dko_ttd_dokter_sign_out' => $this->put('dko_ttd_dokter_sign_out', true) !== null ? $this->put('dko_ttd_dokter_sign_out', true) : null,


        );
        // untuk cek data yang di kirim
        // var_dump($data);
        // die();

        $status = $this->m_pelayanan->simpanUpdateDKO($data);
        $this->response(array('status' => $status), REST_Controller::HTTP_OK);
    }

    function hapus_surgical_luar_kamar_delete($id)
    {
        $status = $this->m_pelayanan->deleteDKO($id);
        if ($status) :
            $response = array('status' => $status, 'message' => 'Berhasil menghapus Surgical Safety Ceklis!');
        else :
            $response = array('status' => $status, 'message' => 'Gagal menghapus Surgical Safety Ceklis!');
        endif;
        $this->response($response, REST_Controller::HTTP_OK);
    }


    // SPPIP
    function form_sppip_get()
    {
        if (!$this->get('id')) :
            $this->response(NULL, REST_Controller::HTTP_BAD_REQUEST); // (400)
        endif;

        $this->load->model('pendaftaran/Pendaftaran_model', 'm_pendaftaran');
        $data = $this->m_pendaftaran->getPendaftaranDetail($this->get('id', true), $this->get('id_layanan', true));
        $data['profil'] = $this->m_pelayanan->getProfilPasien($data['pasien']->id_pasien);
        // $data['surat_peryataan_pembaharuan_identitas_pasien'] = $this->m_pelayanan->getSuratPeryataanPembaharuanIdentitasPasien($this->get('id'));
        $data['surat_peryataan_pembaharuan_identitas_pasien'] = $this->m_pelayanan->getSuratPeryataanPembaharuanIdentitasPasien($this->get('id'), $this->m_pendaftaran->getPendaftaranDetail($this->get('id')));
        if ($data) :
            $this->response($data, REST_Controller::HTTP_OK); // (200)
        endif;
    }

   
    // TI 1
    function get_data_terapi_insulin_get(){
        if (!$this->get('id_layanan_pendaftaran')) :
            $this->response(NULL, REST_Controller::HTTP_BAD_REQUEST); // (400)
        endif;
        $this->load->model('pendaftaran/Pendaftaran_model', 'm_pendaftaran'); 
        $this->load->model('pelayanan/Pelayanan_model', 'm_pelayanan');
        $data                               = $this->m_pendaftaran->getPendaftaranDetail($this->get('id', true), $this->get('id_layanan', true));
        $data['profil']                     = $this->m_pelayanan->getProfilPasien($data['pasien']->id_pasien);
        $data['terapi_insulin']            = $this->m_pelayanan->getTerapiInsulin($this->get('id', true));
        if ($data) :
            $this->response($data, REST_Controller::HTTP_OK); // (200)
        endif;
        // var_dump('terapi_insulin');die;
    }

    // TI 2
    function simpan_data_terapi_insulin_post(){
        $id_users = safe_post('id_user');
        $layanan = array('id' => safe_post('id_layanan_pendaftaran')); 
        $ti_tanggal_pengkajian = safe_post('ti_tanggal_pengkajian');
        $id_pendaftaran           = safe_post('id_pendaftaran');   
        if (!empty($ti_tanggal_pengkajian)) {        
            $pengkajian_ti = array(
                'id_pendaftaran'            => $id_pendaftaran,
                'id_layanan_pendaftaran'    => $layanan['id'],
                'id_user'                   => safe_post('user_pengkajian') !== '' ? safe_post('user_pengkajian') : null,
                'tanggal_pengkajian'        => safe_post('ti_tanggal_pengkajian'),
                'jam_ti'                    => safe_post('jam_ti') !== '' ? safe_post('jam_ti') : null,
                'jenis_insulin_ti'          => safe_post('jenis_insulin_ti') !== '' ? safe_post('jenis_insulin_ti') : null,
                'dosis_ti'                  => safe_post('dosis_ti') !== '' ? safe_post('dosis_ti') : null,		      
                'gula_darah_ti'             => safe_post('gula_darah_ti')          !== '' ? safe_post('gula_darah_ti') : NULL,
                'reduksi_ti'                => safe_post('reduksi_ti')         	!== '' ? safe_post('reduksi_ti') : NULL,
                'keterangan_ti'             => safe_post('keterangan_ti')     !== '' ? safe_post('keterangan_ti') : NULL,
                'ttd_ti'                    => safe_post('ttd_ti')         	!== '' ? safe_post('ttd_ti') : NULL,
                'dokter_ti'                 => safe_post('dokter_ti')         	!== '' ? safe_post('dokter_ti') : NULL,
                'perawat_ti'                => safe_post('perawat_ti')         	!== '' ? safe_post('perawat_ti') : NULL,
                'date_created'              => safe_post('pengkajian_date_terapi_insulin') !== '' ? safe_post('pengkajian_date_terapi_insulin') : null,
            );       
            // var_dump($pengkajian_ti);die;                      
            $this->m_pelayanan->insertTerapiInsulasi($pengkajian_ti);    
        }
        if (!empty($respon)) {
            $response = $respon;
        } else {
            $response = null;
        }
        if ($this->db->trans_status() === false) :
            $this->db->trans_rollback();
            $status = false;
        else :
            $this->db->trans_commit();
            $status = true;
        endif;

        $message = array(
            'status' => $status,
            'token'  => $this->security->get_csrf_hash(),
            'id_pendaftaran' => ('id_pendaftaran'),
            'id_layanan_pendaftaran' => ('id_layanan_pendaftaran'),
            'respon' => $response,
        );
        $this->response($message, REST_Controller::HTTP_OK);
    }


    // TI LOGS
    function hapus_terapi_insulin_delete($id){
        $this->db->trans_begin();
    
        // Ambil data lama sebelum hapus
        $lama = $this->db->get_where('sm_terapi_insulin', ['id' => $id])->row_array();
        if ($lama) {
            $log = $lama;
            unset($log['id']); // supaya tidak bentrok ID
            $log['updated_at'] = date('Y-m-d H:i:s'); // waktu penghapusan
            $log['created_at'] = date('Y-m-d H:i:s'); // atau created_log sesuai field log kamu
            $log['id_user'] = $this->session->userdata('id_translucent'); // siapa yang hapus
            // $log['deleted'] = true; // optional: tambahin info kalau ini dari delete
            $log['keterangan'] = 'Delete';
            $this->m_pelayanan->insertLogsTerapiInsulasi($log);
        }
    
        // Lanjut hapus datanya
        $status = $this->m_pelayanan->deleteTerapiInsulin($id);
    
        if ($this->db->trans_status() === false || !$status) {
            $this->db->trans_rollback();
            $response = array('status' => false, 'message' => 'Gagal menghapus data!');
        } else {
            $this->db->trans_commit();
            $response = array('status' => true, 'message' => 'Berhasil menghapus data!');
        }
    
        $this->response($response, REST_Controller::HTTP_OK);
    }

    // TI 4
    function get_terapi_insulin_get(){
        if (!$this->get('id', true)) :
            $this->response(null, REST_Controller::HTTP_BAD_REQUEST);
        endif;
        $data = $this->m_pelayanan->getTerapiInsulinByID($this->get('id', true));
        $this->response($data, REST_Controller::HTTP_OK);
    }


    // TI LOGS
    function update_terapi_insulin_put() {
        $this->db->trans_begin();
    
        $id = $this->put('id', true);
        if (!$id) {
            $this->response(['status' => false], REST_Controller::HTTP_OK);
            return;
        }
    
        // Ambil data lama untuk log
        $lama = $this->db->get_where('sm_terapi_insulin', ['id' => $id])->row_array();
        if ($lama) {
            $log = $lama;
            unset($log['id']); // supaya tidak bentrok dengan auto increment ID logs
            $log['updated_at'] = date('Y-m-d H:i:s');
            $log['created_at'] = date('Y-m-d H:i:s'); // atau created_log kalau nama field-nya beda
            $log['id_user'] = $this->session->userdata('id_translucent'); // pastikan ini dapat id user
            $log['keterangan'] = 'Update';
            $this->m_pelayanan->insertLogsTerapiInsulasi($log);
        }

        $tanggal_pengkajian = $this->put('ti_tanggal_pengkajian', true);
		$tanggal_pengkajian = str_replace('/', '-', $tanggal_pengkajian);
		$tanggal_pengkajian = date('Y-m-d', strtotime($tanggal_pengkajian));
    
        // Update data baru
          $data = [
			'tanggal_pengkajian'    => $tanggal_pengkajian ?: null,
            'jam_ti'                => $this->put('jam_ti', true) ?: null,
            'jenis_insulin_ti'      => $this->put('jenis_insulin_ti', true) ?: null,
            'dosis_ti'              => $this->put('dosis_ti', true) ?: null,
            'gula_darah_ti'         => $this->put('gula_darah_ti', true) ?: null,
            'reduksi_ti'            => $this->put('reduksi_ti', true) ?: null,
            'keterangan_ti'         => $this->put('keterangan_ti', true) ?: null,
            'ttd_ti'                => $this->put('ttd_ti', true) ?: null,
            'dokter_ti'             => $this->put('dokter_ti', true) ?: null,
            'perawat_ti'            => $this->put('perawat_ti', true) ?: null,
            'updated_at'            => date('Y-m-d H:i:s'),
            'id_user'               => $this->session->userdata('id_translucent'), // log siapa yg update
        ];
    
        $this->db->where('id', $id);
        $status = $this->db->update('sm_terapi_insulin', $data);
    
        if ($this->db->trans_status() === false) {
            $this->db->trans_rollback();
            $this->response(['status' => false], REST_Controller::HTTP_OK);
        } else {
            $this->db->trans_commit();
            $this->response(['status' => true], REST_Controller::HTTP_OK);
        }
    }

    // PRDNR
    function form_penolakan_resusitas_get(){
        if (!$this->get('id')) :
            $this->response(NULL, REST_Controller::HTTP_BAD_REQUEST); // (400)
        endif;
        $this->load->model('pendaftaran/Pendaftaran_model', 'm_pendaftaran');
        $data = $this->m_pendaftaran->getPendaftaranDetail($this->get('id', true), $this->get('id_layanan', true));
        $data['profil'] = $this->m_pelayanan->getProfilPasien($data['pasien']->id_pasien);
        $data['penolakan_resusitas'] = $this->m_pelayanan->getSuratPenolakanResusitas($this->get('id'), $this->m_pendaftaran->getPendaftaranDetail($this->get('id')));
        $data['penolakan_resusitas_logs']  = $this->m_pelayanan->getLogSuratPenolakanResusitas($this->get('id_layanan', true));
        // var_dump( $data['penolakan_resusitas']);die;
        if ($data) :
            $this->response($data, REST_Controller::HTTP_OK); // (200)
        endif;
    }






    // TPERS / OPST
    function form_transfer_pasien_exstra_rs_get()
    {
        if (!$this->get('id')) :
            $this->response(NULL, REST_Controller::HTTP_BAD_REQUEST); // (400)
        endif;
        $this->load->model('pendaftaran/Pendaftaran_model', 'm_pendaftaran');
        $data = $this->m_pendaftaran->getPendaftaranDetail($this->get('id', true), $this->get('id_layanan', true));
        $data['profil'] = $this->m_pelayanan->getProfilPasien($data['pasien']->id_pasien);
        $data['transfer_pasien_exstra_rs'] = $this->m_pelayanan->getTransferPasienExstraRS($this->get('id'), $this->m_pendaftaran->getPendaftaranDetail($this->get('id')));
        $data['transfer_pasien_exstra_rs_logs']  = $this->m_pelayanan->getLogTransferPasienExstraRS($this->get('id_layanan', true));

        $data['terapi_resume'] = [];
        $terapiResume = $this->m_pelayanan->getObatTerapiPulang($this->get('id_layanan'));
        if (!empty($terapiResume)) {
            $data['terapi_resume'] = $terapiResume;
        }

        $data['diagnosa_sekunder'] = [];
        $diagnosa_sekunders = $this->m_pelayanan->getDiagnosaSekunder($this->get('id', true));
        if (!empty($diagnosa_sekunders)) {
            $data['diagnosa_sekunder'] = $diagnosa_sekunders;
        }

        // var_dump($data['diagnosa_sekunder']);die;

        $data['ds_manual_utama'] = [];
        $ds_manual_utamas = $this->m_pelayanan->getDiagnosaManualUtama($this->get('id', true));
        if (!empty($ds_manual_utamas)) {
            $data['ds_manual_utama'] = $ds_manual_utamas;
        }

        $data['ds_manual_sekunder'] = [];
        $ds_manual_sekunders = $this->m_pelayanan->getDiagnosaManualSekunder($this->get('id', true));
        if (!empty($ds_manual_sekunders)) {
            $data['ds_manual_sekunder'] = $ds_manual_sekunders;
        }

        $data['diagnosa_utama'] = [];
        $diagnosa_utamas = $this->m_pelayanan->getDiagnosa($this->get('id', true));
        if (!empty($diagnosa_utamas)) {
            $data['diagnosa_utama'] = $diagnosa_utamas;
        }
        if ($data) :
            $this->response($data, REST_Controller::HTTP_OK); // (200)
        endif;
    }

    // DOA_D_O_A
    function form_doa_get()
    {
        if (!$this->get('id')) :
            $this->response(NULL, REST_Controller::HTTP_BAD_REQUEST); // (400)
        endif;
        // var_dump($this->get('id'));die;
        $this->load->model('pendaftaran/Pendaftaran_model', 'm_pendaftaran');
        $data = $this->m_pendaftaran->getPendaftaranDetail($this->get('id', true), $this->get('id_layanan', true));
        $data['profil'] = $this->m_pelayanan->getProfilPasien($data['pasien']->id_pasien);
        $data['sk_doa'] = $this->m_pelayanan->getSuratKeteranganDOA($this->get('id'), $this->m_pendaftaran->getPendaftaranDetail($this->get('id')));
        // var_dump($data['sk_doa']);die;
        if ($data) :
            $this->response($data, REST_Controller::HTTP_OK); // (200)
        endif;
    }

    // ICPMK
    function get_form_informed_consent_pmk_get(){
        if (!$this->get('id')) :
            $this->response(NULL, REST_Controller::HTTP_BAD_REQUEST); // (400)
        endif;
        $this->load->model('pendaftaran/Pendaftaran_model', 'm_pendaftaran');
        $data = $this->m_pendaftaran->getPendaftaranDetail($this->get('id', true), $this->get('id_layanan', true));
        $data['profil'] = $this->m_pelayanan->getProfilPasien($data['pasien']->id_pasien);
        $data['informed_constant_pmk'] = $this->m_pelayanan->getSuratInformedConsentPMK($this->get('id'), $this->m_pendaftaran->getPendaftaranDetail($this->get('id')));
        if ($data) :
            $this->response($data, REST_Controller::HTTP_OK); // (200)
        endif;
    }



    // SKKM 
    function get_surat_keterangan_kesediaan_membayar_get(){
        if (!$this->get('id')) :
            $this->response(NULL, REST_Controller::HTTP_BAD_REQUEST); // (400)
        endif;
        $this->load->model('pendaftaran/Pendaftaran_model', 'm_pendaftaran');
        $data = $this->m_pendaftaran->getPendaftaranDetail($this->get('id', true), $this->get('id_layanan', true)); 
        $data['profil'] = $this->m_pelayanan->getProfilPasien($data['pasien']->id_pasien);
        $data['surat_keterangan_kesediaan_membayar'] = $this->m_pelayanan->getSuratKeteranganKesediaanMembayar($this->get('id'), $this->m_pendaftaran->getPendaftaranDetail($this->get('id')));
        // var_dump($data['surat_keterangan_kesediaan_membayar']);die;
        if ($data) :
            $this->response($data, REST_Controller::HTTP_OK); // (200)
        endif;
    }

    // // SPPPMK 
    // function get_surat_pernyataan_persetujuan_pmk_get(){
    //     if (!$this->get('id')) :
    //         $this->response(NULL, REST_Controller::HTTP_BAD_REQUEST); // (400)
    //     endif;
    //     $this->load->model('pendaftaran/Pendaftaran_model', 'm_pendaftaran');
    //     $data = $this->m_pendaftaran->getPendaftaranDetail($this->get('id', true), $this->get('id_layanan', true)); 
    //     $data['profil'] = $this->m_pelayanan->getProfilPasien($data['pasien']->id_pasien);
    //     $data['surat_pernyataan_persetujuan_penolakan_medis_khusus'] = $this->m_pelayanan->getSuratPernyataanPersetujuanPenolakanMedisKhusus($this->get('id'), $this->m_pendaftaran->getPendaftaranDetail($this->get('id')));
    //     // var_dump($data['surat_pernyataan_persetujuan_penolakan_medis_khusus']);die;
    //     if ($data) :
    //         $this->response($data, REST_Controller::HTTP_OK); // (200)
    //     endif;
    // }




    // RAK 1
    function get_data_kebidanan_asuhan_rencana_get()
    {
        if (!$this->get('id_layanan_pendaftaran')) :
            $this->response(NULL, REST_Controller::HTTP_BAD_REQUEST); // (400)
        endif;
        $this->load->model('pendaftaran/Pendaftaran_model', 'm_pendaftaran');
        $this->load->model('pelayanan/Pelayanan_model', 'm_pelayanan');
        $data                               = $this->m_pendaftaran->getPendaftaranDetail($this->get('id', true), $this->get('id_layanan', true));
        $data['profil']                     = $this->m_pelayanan->getProfilPasien($data['pasien']->id_pasien);
        $data['kebidanan_asuhan_rencana']   = $this->m_pelayanan->getRencanaAsuhanKebidanan($this->get('id', true));
        if ($data) :
            $this->response($data, REST_Controller::HTTP_OK); // (200)
        endif;
        // var_dump('rencana_asuhan_kebidanan');die;
    }

    // RAK 2
    function simpan_data_rencana_asuhan_kebidanan_post()
    {
        $id_users = safe_post('id_user');
        $layanan = array('id' => safe_post('id_layanan_pendaftaran'));

        $pengkajian_date_rak = safe_post('pengkajian_date_rak');
        // KALAU GA ADA IINI PASTI EROR
        $id_pendaftaran           = safe_post('id_pendaftaran');

        if (!empty($pengkajian_date_rak)) {
            $chek_data_rak = array(
                'id_pendaftaran'          => $id_pendaftaran,
                'id_layanan_pendaftaran'  => $layanan['id'],
                'id_user'                 => safe_post('user_rak') !== '' ? safe_post('user_rak') : null,
                'tanggal_rak'              => safe_post('tanggal_rak') !== '' ? safe_post('tanggal_rak') : null,

                'g_rak_1'                 => safe_post('g_rak_1')             !== '' ? safe_post('g_rak_1') : NULL,
                'p_rak_1'                 => safe_post('p_rak_1')             !== '' ? safe_post('p_rak_1') : NULL,
                'a_rak_1'                 => safe_post('a_rak_1')             !== '' ? safe_post('a_rak_1') : NULL,

                'losp_rak'                => safe_post('losp_rak')             !== '' ? safe_post('losp_rak') : NULL,
                'pagi_rak_1'              => safe_post('pagi_rak_1')        !== '' ? safe_post('pagi_rak_1') : NULL,

                'siang_rak_1'             => safe_post('siang_rak_1')       !== '' ? safe_post('siang_rak_1') : NULL,
                'malam_rak_1'             => safe_post('malam_rak_1')       !== '' ? safe_post('malam_rak_1') : NULL,

                'hm_rak_1'                => safe_post('hm_rak_1')             !== '' ? safe_post('hm_rak_1') : NULL,
                'ds3m_rak'                => safe_post('ds3m_rak')             !== '' ? safe_post('ds3m_rak') : NULL,
                'pagi_rak_2'              => safe_post('pagi_rak_2')        !== '' ? safe_post('pagi_rak_2') : NULL,
                'siang_rak_2'             => safe_post('siang_rak_2')       !== '' ? safe_post('siang_rak_2') : NULL,
                'malam_rak_2'             => safe_post('malam_rak_2')       !== '' ? safe_post('malam_rak_2') : NULL,

                'pkI_rak'                 => safe_post('pkI_rak')             !== '' ? safe_post('pkI_rak') : NULL,
                'hks3m_rak'               => safe_post('hks3m_rak')         !== '' ? safe_post('hks3m_rak') : NULL,
                'pagi_rak_3'              => safe_post('pagi_rak_3')        !== '' ? safe_post('pagi_rak_3') : NULL,
                'siang_rak_3'             => safe_post('siang_rak_3')       !== '' ? safe_post('siang_rak_3') : NULL,
                'malam_rak_3'             => safe_post('malam_rak_3')       !== '' ? safe_post('malam_rak_3') : NULL,

                'bI_rak'                  => safe_post('bI_rak')             !== '' ? safe_post('bI_rak') : NULL,
                'ns3m_rak'                => safe_post('ns3m_rak')             !== '' ? safe_post('ns3m_rak') : NULL,
                'pagi_rak_4'              => safe_post('pagi_rak_4')        !== '' ? safe_post('pagi_rak_4') : NULL,
                'siang_rak_4'             => safe_post('siang_rak_4')       !== '' ? safe_post('siang_rak_4') : NULL,
                'malam_rak_4'             => safe_post('malam_rak_4')       !== '' ? safe_post('malam_rak_4') : NULL,

                'rptm_rak'                => safe_post('rptm_rak')             !== '' ? safe_post('rptm_rak') : NULL,
                'pss4j_rak'               => safe_post('pss4j_rak')         !== '' ? safe_post('pss4j_rak') : NULL,
                'pagi_rak_5'              => safe_post('pagi_rak_5')        !== '' ? safe_post('pagi_rak_5') : NULL,
                'siang_rak_5'             => safe_post('siang_rak_5')       !== '' ? safe_post('siang_rak_5') : NULL,
                'malam_rak_5'             => safe_post('malam_rak_5')       !== '' ? safe_post('malam_rak_5') : NULL,

                'cemas_rak'               => safe_post('cemas_rak')         !== '' ? safe_post('cemas_rak') : NULL,
                'tddss4j_rak'             => safe_post('tddss4j_rak')       !== '' ? safe_post('tddss4j_rak') : NULL,
                'pagi_rak_6'              => safe_post('pagi_rak_6')        !== '' ? safe_post('pagi_rak_6') : NULL,
                'siang_rak_6'             => safe_post('siang_rak_6')       !== '' ? safe_post('siang_rak_6') : NULL,
                'malam_rak_6'             => safe_post('malam_rak_6')       !== '' ? safe_post('malam_rak_6') : NULL,

                'N_rak'                   => safe_post('N_rak')             !== '' ? safe_post('N_rak') : NULL,
                'pus24j_rak'              => safe_post('pus24j_rak')        !== '' ? safe_post('pus24j_rak') : NULL,
                'pagi_rak_7'              => safe_post('pagi_rak_7')        !== '' ? safe_post('pagi_rak_7') : NULL,
                'siang_rak_7'             => safe_post('siang_rak_7')       !== '' ? safe_post('siang_rak_7') : NULL,
                'malam_rak_7'             => safe_post('malam_rak_7')       !== '' ? safe_post('malam_rak_7') : NULL,

                'ke_rak'                  => safe_post('ke_rak')             !== '' ? safe_post('ke_rak') : NULL,
                'fiumpp_rak'              => safe_post('fiumpp_rak')        !== '' ? safe_post('fiumpp_rak') : NULL,
                'pagi_rak_8'              => safe_post('pagi_rak_8')        !== '' ? safe_post('pagi_rak_8') : NULL,
                'siang_rak_8'             => safe_post('siang_rak_8')       !== '' ? safe_post('siang_rak_8') : NULL,
                'malam_rak_8'             => safe_post('malam_rak_8')       !== '' ? safe_post('malam_rak_8') : NULL,

                'fiumdm_rak'              => safe_post('fiumdm_rak')        !== '' ? safe_post('fiumdm_rak') : NULL,
                'pagi_rak_9'              => safe_post('pagi_rak_9')        !== '' ? safe_post('pagi_rak_9') : NULL,
                'siang_rak_9'             => safe_post('siang_rak_9')       !== '' ? safe_post('siang_rak_9') : NULL,
                'malam_rak_9'             => safe_post('malam_rak_9')       !== '' ? safe_post('malam_rak_9') : NULL,

                'fiub_rak'                => safe_post('fiub_rak')             !== '' ? safe_post('fiub_rak') : NULL,
                'pagi_rak_10'             => safe_post('pagi_rak_10')       !== '' ? safe_post('pagi_rak_10') : NULL,
                'siang_rak_10'            => safe_post('siang_rak_10')      !== '' ? safe_post('siang_rak_10') : NULL,
                'malam_rak_10'            => safe_post('malam_rak_10')      !== '' ? safe_post('malam_rak_10') : NULL,

                'ajiumk_rak'              => safe_post('ajiumk_rak')        !== '' ? safe_post('ajiumk_rak') : NULL,
                'pagi_rak_11'             => safe_post('pagi_rak_11')       !== '' ? safe_post('pagi_rak_11') : NULL,
                'siang_rak_11'            => safe_post('siang_rak_11')      !== '' ? safe_post('siang_rak_11') : NULL,
                'malam_rak_11'            => safe_post('malam_rak_11')      !== '' ? safe_post('malam_rak_11') : NULL,

                'atrumn_rak'              => safe_post('atrumn_rak')        !== '' ? safe_post('atrumn_rak') : NULL,
                'pagi_rak_12'             => safe_post('pagi_rak_12')       !== '' ? safe_post('pagi_rak_12') : NULL,
                'siang_rak_12'            => safe_post('siang_rak_12')      !== '' ? safe_post('siang_rak_12') : NULL,
                'malam_rak_12'            => safe_post('malam_rak_12')      !== '' ? safe_post('malam_rak_12') : NULL,

                'lsppsh_rak'              => safe_post('lsppsh_rak')        !== '' ? safe_post('lsppsh_rak') : NULL,
                'pagi_rak_13'             => safe_post('pagi_rak_13')       !== '' ? safe_post('pagi_rak_13') : NULL,
                'siang_rak_13'            => safe_post('siang_rak_13')      !== '' ? safe_post('siang_rak_13') : NULL,
                'malam_rak_13'            => safe_post('malam_rak_13')      !== '' ? safe_post('malam_rak_13') : NULL,

                'akumd_rak'               => safe_post('akumd_rak')         !== '' ? safe_post('akumd_rak') : NULL,
                'pagi_rak_14'             => safe_post('pagi_rak_14')       !== '' ? safe_post('pagi_rak_14') : NULL,
                'siang_rak_14'            => safe_post('siang_rak_14')      !== '' ? safe_post('siang_rak_14') : NULL,
                'malam_rak_14'            => safe_post('malam_rak_14')      !== '' ? safe_post('malam_rak_14') : NULL,

                'bepdkk_rak'              => safe_post('bepdkk_rak')        !== '' ? safe_post('bepdkk_rak') : NULL,
                'pagi_rak_15'             => safe_post('pagi_rak_15')       !== '' ? safe_post('pagi_rak_15') : NULL,
                'siang_rak_15'            => safe_post('siang_rak_15')      !== '' ? safe_post('siang_rak_15') : NULL,
                'malam_rak_15'            => safe_post('malam_rak_15')      !== '' ? safe_post('malam_rak_15') : NULL,

                'bepp_rak'                => safe_post('bepp_rak')             !== '' ? safe_post('bepp_rak') : NULL,
                'pagi_rak_16'             => safe_post('pagi_rak_16')       !== '' ? safe_post('pagi_rak_16') : NULL,
                'siang_rak_16'            => safe_post('siang_rak_16')      !== '' ? safe_post('siang_rak_16') : NULL,
                'malam_rak_16'            => safe_post('malam_rak_16')      !== '' ? safe_post('malam_rak_16') : NULL,

                'BetI_rak'                => safe_post('BetI_rak')             !== '' ? safe_post('BetI_rak') : NULL,
                'pagi_rak_17'             => safe_post('pagi_rak_17')       !== '' ? safe_post('pagi_rak_17') : NULL,
                'siang_rak_17'            => safe_post('siang_rak_17')      !== '' ? safe_post('siang_rak_17') : NULL,
                'malam_rak_17'            => safe_post('malam_rak_17')      !== '' ? safe_post('malam_rak_17') : NULL,

                'Saap_rak'                => safe_post('Saap_rak')             !== '' ? safe_post('Saap_rak') : NULL,
                'pagi_rak_18'             => safe_post('pagi_rak_18')       !== '' ? safe_post('pagi_rak_18') : NULL,
                'siang_rak_18'            => safe_post('siang_rak_18')      !== '' ? safe_post('siang_rak_18') : NULL,
                'malam_rak_18'            => safe_post('malam_rak_18')      !== '' ? safe_post('malam_rak_18') : NULL,

                'Kddaadpt_rak'            => safe_post('Kddaadpt_rak')      !== '' ? safe_post('Kddaadpt_rak') : NULL,
                'pagi_rak_19'             => safe_post('pagi_rak_19')       !== '' ? safe_post('pagi_rak_19') : NULL,
                'siang_rak_19'            => safe_post('siang_rak_19')      !== '' ? safe_post('siang_rak_19') : NULL,
                'malam_rak_19'            => safe_post('malam_rak_19')      !== '' ? safe_post('malam_rak_19') : NULL,

                'JP_rak'                  => safe_post('JP_rak')             !== '' ? safe_post('JP_rak') : NULL,
                'LoDdkj_rak'              => safe_post('LoDdkj_rak')        !== '' ? safe_post('LoDdkj_rak') : NULL,
                'pagi_rak_20'             => safe_post('pagi_rak_20')       !== '' ? safe_post('pagi_rak_20') : NULL,
                'siang_rak_20'            => safe_post('siang_rak_20')      !== '' ? safe_post('siang_rak_20') : NULL,
                'malam_rak_20'            => safe_post('malam_rak_20')      !== '' ? safe_post('malam_rak_20') : NULL,

                'TH_rak'                  => safe_post('TH_rak')             !== '' ? safe_post('TH_rak') : NULL,
                'Logj_rak'                => safe_post('Logj_rak')             !== '' ? safe_post('Logj_rak') : NULL,
                'pagi_rak_21'             => safe_post('pagi_rak_21')       !== '' ? safe_post('pagi_rak_21') : NULL,
                'siang_rak_21'            => safe_post('siang_rak_21')      !== '' ? safe_post('siang_rak_21') : NULL,
                'malam_rak_21'            => safe_post('malam_rak_21')      !== '' ? safe_post('malam_rak_21') : NULL,

                'kosong_rak'              => safe_post('kosong_rak')        !== '' ? safe_post('kosong_rak') : NULL,
                'kosoong_rak'             => safe_post('kosoong_rak')       !== '' ? safe_post('kosoong_rak') : NULL,
                'siapkan_rak'             => safe_post('siapkan_rak')       !== '' ? safe_post('siapkan_rak') : NULL,
                'pagi_rak_22'             => safe_post('pagi_rak_22')       !== '' ? safe_post('pagi_rak_22') : NULL,
                'siang_rak_22'            => safe_post('siang_rak_22')      !== '' ? safe_post('siang_rak_22') : NULL,
                'malam_rak_22'            => safe_post('malam_rak_22')      !== '' ? safe_post('malam_rak_22') : NULL,

                'Rgj_rak'                 => safe_post('Rgj_rak')             !== '' ? safe_post('Rgj_rak') : NULL,
                'Kddaadp_rak'             => safe_post('Kddaadp_rak')       !== '' ? safe_post('Kddaadp_rak') : NULL,
                'pagi_rak_23'             => safe_post('pagi_rak_23')       !== '' ? safe_post('pagi_rak_23') : NULL,
                'siang_rak_23'            => safe_post('siang_rak_23')      !== '' ? safe_post('siang_rak_23') : NULL,
                'malam_rak_23'            => safe_post('malam_rak_23')      !== '' ? safe_post('malam_rak_23') : NULL,

                'GG_rak'                  => safe_post('GG_rak')             !== '' ? safe_post('GG_rak') : NULL,
                'PP_rak'                  => safe_post('PP_rak')             !== '' ? safe_post('PP_rak') : NULL,
                'AA_rak'                  => safe_post('AA_rak')             !== '' ? safe_post('AA_rak') : NULL,
                'PtkII_rak'               => safe_post('PtkII_rak')         !== '' ? safe_post('PtkII_rak') : NULL,
                'pagi_rak_24'             => safe_post('pagi_rak_24')       !== '' ? safe_post('pagi_rak_24') : NULL,
                'siang_rak_24'            => safe_post('siang_rak_24')      !== '' ? safe_post('siang_rak_24') : NULL,
                'malam_rak_24'            => safe_post('malam_rak_24')      !== '' ? safe_post('malam_rak_24') : NULL,

                'Hmm_rak'                 => safe_post('Hmm_rak')             !== '' ? safe_post('Hmm_rak') : NULL,
                'Api_rak'                 => safe_post('Api_rak')             !== '' ? safe_post('Api_rak') : NULL,
                'pagi_rak_25'             => safe_post('pagi_rak_25')       !== '' ? safe_post('pagi_rak_25') : NULL,
                'siang_rak_25'            => safe_post('siang_rak_25')      !== '' ? safe_post('siang_rak_25') : NULL,
                'malam_rak_25'            => safe_post('malam_rak_25')      !== '' ? safe_post('malam_rak_25') : NULL,

                'PkII_rak'                => safe_post('PkII_rak')             !== '' ? safe_post('PkII_rak') : NULL,
                'pagi_rak_26'             => safe_post('pagi_rak_26')       !== '' ? safe_post('pagi_rak_26') : NULL,
                'siang_rak_26'            => safe_post('siang_rak_26')      !== '' ? safe_post('siang_rak_26') : NULL,
                'malam_rak_26'            => safe_post('malam_rak_26')      !== '' ? safe_post('malam_rak_26') : NULL,

                'Rpm_rak'                 => safe_post('Rpm_rak')             !== '' ? safe_post('Rpm_rak') : NULL,
                'Pmjah_rak'               => safe_post('Pmjah_rak')         !== '' ? safe_post('Pmjah_rak') : NULL,
                'pagi_rak_27'             => safe_post('pagi_rak_27')       !== '' ? safe_post('pagi_rak_27') : NULL,
                'siang_rak_27'            => safe_post('siang_rak_27')      !== '' ? safe_post('siang_rak_27') : NULL,
                'malam_rak_27'            => safe_post('malam_rak_27')      !== '' ? safe_post('malam_rak_27') : NULL,

                'Raj_rak'                 => safe_post('Raj_rak')             !== '' ? safe_post('Raj_rak') : NULL,
                'oDsm_rak'                => safe_post('oDsm_rak')             !== '' ? safe_post('oDsm_rak') : NULL,
                'pagi_rak_28'             => safe_post('pagi_rak_28')       !== '' ? safe_post('pagi_rak_28') : NULL,
                'siang_rak_28'            => safe_post('siang_rak_28')      !== '' ? safe_post('siang_rak_28') : NULL,
                'malam_rak_28'            => safe_post('malam_rak_28')      !== '' ? safe_post('malam_rak_28') : NULL,

                'Pk_rak'                  => safe_post('Pk_rak')             !== '' ? safe_post('Pk_rak') : NULL,
                'pagi_rak_29'             => safe_post('pagi_rak_29')       !== '' ? safe_post('pagi_rak_29') : NULL,
                'siang_rak_29'            => safe_post('siang_rak_29')      !== '' ? safe_post('siang_rak_29') : NULL,
                'malam_rak_29'            => safe_post('malam_rak_29')      !== '' ? safe_post('malam_rak_29') : NULL,

                'Lebp_rak'                => safe_post('Lebp_rak')             !== '' ? safe_post('Lebp_rak') : NULL,
                'pagi_rak_30'             => safe_post('pagi_rak_30')       !== '' ? safe_post('pagi_rak_30') : NULL,
                'siang_rak_30'            => safe_post('siang_rak_30')      !== '' ? safe_post('siang_rak_30') : NULL,
                'malam_rak_30'            => safe_post('malam_rak_30')      !== '' ? safe_post('malam_rak_30') : NULL,

                'Lb_rak'                  => safe_post('Lb_rak')             !== '' ? safe_post('Lb_rak') : NULL,
                'pagi_rak_31'             => safe_post('pagi_rak_31')       !== '' ? safe_post('pagi_rak_31') : NULL,
                'siang_rak_31'            => safe_post('siang_rak_31')      !== '' ? safe_post('siang_rak_31') : NULL,
                'malam_rak_31'            => safe_post('malam_rak_31')      !== '' ? safe_post('malam_rak_31') : NULL,

                'Lbdpi_rak'               => safe_post('Lbdpi_rak')         !== '' ? safe_post('Lbdpi_rak') : NULL,
                'pagi_rak_32'             => safe_post('pagi_rak_32')       !== '' ? safe_post('pagi_rak_32') : NULL,
                'siang_rak_32'            => safe_post('siang_rak_32')      !== '' ? safe_post('siang_rak_32') : NULL,
                'malam_rak_32'            => safe_post('malam_rak_32')      !== '' ? safe_post('malam_rak_32') : NULL,

                'Bjnb_rak'                => safe_post('Bjnb_rak')             !== '' ? safe_post('Bjnb_rak') : NULL,
                'pagi_rak_33'             => safe_post('pagi_rak_33')       !== '' ? safe_post('pagi_rak_33') : NULL,
                'siang_rak_33'            => safe_post('siang_rak_33')      !== '' ? safe_post('siang_rak_33') : NULL,
                'malam_rak_33'            => safe_post('malam_rak_33')      !== '' ? safe_post('malam_rak_33') : NULL,

                'Kbslr_rak'               => safe_post('Kbslr_rak')         !== '' ? safe_post('Kbslr_rak') : NULL,
                'pagi_rak_34'             => safe_post('pagi_rak_34')       !== '' ? safe_post('pagi_rak_34') : NULL,
                'siang_rak_34'            => safe_post('siang_rak_34')      !== '' ? safe_post('siang_rak_34') : NULL,
                'malam_rak_34'            => safe_post('malam_rak_34')      !== '' ? safe_post('malam_rak_34') : NULL,

                'Gkyb_rak'                => safe_post('Gkyb_rak')             !== '' ? safe_post('Gkyb_rak') : NULL,
                'pagi_rak_35'             => safe_post('pagi_rak_35')       !== '' ? safe_post('pagi_rak_35') : NULL,
                'siang_rak_35'            => safe_post('siang_rak_35')      !== '' ? safe_post('siang_rak_35') : NULL,
                'malam_rak_35'            => safe_post('malam_rak_35')      !== '' ? safe_post('malam_rak_35') : NULL,

                'Nsabm_rak'               => safe_post('Nsabm_rak')         !== '' ? safe_post('Nsabm_rak') : NULL,
                'pagi_rak_36'             => safe_post('pagi_rak_36')       !== '' ? safe_post('pagi_rak_36') : NULL,
                'siang_rak_36'            => safe_post('siang_rak_36')      !== '' ? safe_post('siang_rak_36') : NULL,
                'malam_rak_36'            => safe_post('malam_rak_36')      !== '' ? safe_post('malam_rak_36') : NULL,

                'Cjk_rak'                 => safe_post('Cjk_rak')             !== '' ? safe_post('Cjk_rak') : NULL,
                'pagi_rak_37'             => safe_post('pagi_rak_37')       !== '' ? safe_post('pagi_rak_37') : NULL,
                'siang_rak_37'            => safe_post('siang_rak_37')      !== '' ? safe_post('siang_rak_37') : NULL,
                'malam_rak_37'            => safe_post('malam_rak_37')      !== '' ? safe_post('malam_rak_37') : NULL,

                'Kddaakp_rak'             => safe_post('Kddaakp_rak')       !== '' ? safe_post('Kddaakp_rak') : NULL,
                'pagi_rak_38'             => safe_post('pagi_rak_38')       !== '' ? safe_post('pagi_rak_38') : NULL,
                'siang_rak_38'            => safe_post('siang_rak_38')      !== '' ? safe_post('siang_rak_38') : NULL,
                'malam_rak_38'            => safe_post('malam_rak_38')      !== '' ? safe_post('malam_rak_38') : NULL,

                'p2_rak'                  => safe_post('p2_rak')             !== '' ? safe_post('p2_rak') : NULL,
                'a2_rak'                  => safe_post('a2_rak')             !== '' ? safe_post('a2_rak') : NULL,
                'ls1_rak'                 => safe_post('ls1_rak')             !== '' ? safe_post('ls1_rak') : NULL,
                'pagi_rak_39'             => safe_post('pagi_rak_39')       !== '' ? safe_post('pagi_rak_39') : NULL,
                'siang_rak_39'            => safe_post('siang_rak_39')      !== '' ? safe_post('siang_rak_39') : NULL,
                'malam_rak_39'            => safe_post('malam_rak_39')      !== '' ? safe_post('malam_rak_39') : NULL,

                'Jdptp_rak'               => safe_post('Jdptp_rak')         !== '' ? safe_post('Jdptp_rak') : NULL,
                'pagi_rak_40'             => safe_post('pagi_rak_40')       !== '' ? safe_post('pagi_rak_40') : NULL,
                'siang_rak_40'            => safe_post('siang_rak_40')      !== '' ? safe_post('siang_rak_40') : NULL,
                'malam_rak_40'            => safe_post('malam_rak_40')      !== '' ? safe_post('malam_rak_40') : NULL,

                'Rrp_rak'                 => safe_post('Rrp_rak')             !== '' ? safe_post('Rrp_rak') : NULL,
                'FbuI_rak'                => safe_post('FbuI_rak')             !== '' ? safe_post('FbuI_rak') : NULL,
                'pagi_rak_41'             => safe_post('pagi_rak_41')       !== '' ? safe_post('pagi_rak_41') : NULL,
                'siang_rak_41'            => safe_post('siang_rak_41')      !== '' ? safe_post('siang_rak_41') : NULL,
                'malam_rak_41'            => safe_post('malam_rak_41')      !== '' ? safe_post('malam_rak_41') : NULL,

                'Bidpp_rak'               => safe_post('Bidpp_rak')         !== '' ? safe_post('Bidpp_rak') : NULL,
                'pagi_rak_42'             => safe_post('pagi_rak_42')       !== '' ? safe_post('pagi_rak_42') : NULL,
                'siang_rak_42'            => safe_post('siang_rak_42')      !== '' ? safe_post('siang_rak_42') : NULL,
                'malam_rak_42'            => safe_post('malam_rak_42')      !== '' ? safe_post('malam_rak_42') : NULL,

                'Lptpt_rak'               => safe_post('Lptpt_rak')         !== '' ? safe_post('Lptpt_rak') : NULL,
                'pagi_rak_43'             => safe_post('pagi_rak_43')       !== '' ? safe_post('pagi_rak_43') : NULL,
                'siang_rak_43'            => safe_post('siang_rak_43')      !== '' ? safe_post('siang_rak_43') : NULL,
                'malam_rak_43'            => safe_post('malam_rak_43')      !== '' ? safe_post('malam_rak_43') : NULL,

                'llp_rak'                 => safe_post('llp_rak')             !== '' ? safe_post('llp_rak') : NULL,
                'pagi_rak_44'             => safe_post('pagi_rak_44')       !== '' ? safe_post('pagi_rak_44') : NULL,
                'siang_rak_44'            => safe_post('siang_rak_44')      !== '' ? safe_post('siang_rak_44') : NULL,
                'malam_rak_44'            => safe_post('malam_rak_44')      !== '' ? safe_post('malam_rak_44') : NULL,

                'Mum_rak'                 => safe_post('Mum_rak')             !== '' ? safe_post('Mum_rak') : NULL,
                'pagi_rak_45'             => safe_post('pagi_rak_45')       !== '' ? safe_post('pagi_rak_45') : NULL,
                'siang_rak_45'            => safe_post('siang_rak_45')      !== '' ? safe_post('siang_rak_45') : NULL,
                'malam_rak_45'            => safe_post('malam_rak_45')      !== '' ? safe_post('malam_rak_45') : NULL,

                'Pjl_rak'                 => safe_post('Pjl_rak')             !== '' ? safe_post('Pjl_rak') : NULL,
                'pagi_rak_46'             => safe_post('pagi_rak_46')       !== '' ? safe_post('pagi_rak_46') : NULL,
                'siang_rak_46'            => safe_post('siang_rak_46')      !== '' ? safe_post('siang_rak_46') : NULL,
                'malam_rak_46'            => safe_post('malam_rak_46')      !== '' ? safe_post('malam_rak_46') : NULL,

                'Nkp_rak'                 => safe_post('Nkp_rak')             !== '' ? safe_post('Nkp_rak') : NULL,
                'pagi_rak_47'             => safe_post('pagi_rak_47')       !== '' ? safe_post('pagi_rak_47') : NULL,
                'siang_rak_47'            => safe_post('siang_rak_47')      !== '' ? safe_post('siang_rak_47') : NULL,
                'malam_rak_47'            => safe_post('malam_rak_47')      !== '' ? safe_post('malam_rak_47') : NULL,

                'Kddaakpy_rak'            => safe_post('Kddaakpy_rak')      !== '' ? safe_post('Kddaakpy_rak') : NULL,
                'pagi_rak_48'             => safe_post('pagi_rak_48')       !== '' ? safe_post('pagi_rak_48') : NULL,
                'siang_rak_48'            => safe_post('siang_rak_48')      !== '' ? safe_post('siang_rak_48') : NULL,
                'malam_rak_48'            => safe_post('malam_rak_48')      !== '' ? safe_post('malam_rak_48') : NULL,

                'PP3_rak'                 => safe_post('PP3_rak')             !== '' ? safe_post('PP3_rak') : NULL,
                'AA3_rak'                 => safe_post('AA3_rak')             !== '' ? safe_post('AA3_rak') : NULL,
                'Lbttv_rak'               => safe_post('Lbttv_rak')         !== '' ? safe_post('Lbttv_rak') : NULL,
                'pagi_rak_49'             => safe_post('pagi_rak_49')       !== '' ? safe_post('pagi_rak_49') : NULL,
                'siang_rak_49'            => safe_post('siang_rak_49')      !== '' ? safe_post('siang_rak_49') : NULL,
                'malam_rak_49'            => safe_post('malam_rak_49')      !== '' ? safe_post('malam_rak_49') : NULL,

                'Pjll_rak'                => safe_post('Pjll_rak')             !== '' ? safe_post('Pjll_rak') : NULL,
                'pagi_rak_50'             => safe_post('pagi_rak_50')       !== '' ? safe_post('pagi_rak_50') : NULL,
                'siang_rak_50'            => safe_post('siang_rak_50')      !== '' ? safe_post('siang_rak_50') : NULL,
                'malam_rak_50'            => safe_post('malam_rak_50')      !== '' ? safe_post('malam_rak_50') : NULL,

                'RP_rak'                  => safe_post('RP_rak')             !== '' ? safe_post('RP_rak') : NULL,
                'Gal_rak'                 => safe_post('Gal_rak')             !== '' ? safe_post('Gal_rak') : NULL,
                'pagi_rak_51'             => safe_post('pagi_rak_51')       !== '' ? safe_post('pagi_rak_51') : NULL,
                'siang_rak_51'            => safe_post('siang_rak_51')      !== '' ? safe_post('siang_rak_51') : NULL,
                'malam_rak_51'            => safe_post('malam_rak_51')      !== '' ? safe_post('malam_rak_51') : NULL,

                'Kee_rak'                 => safe_post('Kee_rak')             !== '' ? safe_post('Kee_rak') : NULL,
                'Lhp_rak'                 => safe_post('Lhp_rak')             !== '' ? safe_post('Lhp_rak') : NULL,
                'pagi_rak_52'             => safe_post('pagi_rak_52')       !== '' ? safe_post('pagi_rak_52') : NULL,
                'siang_rak_52'            => safe_post('siang_rak_52')      !== '' ? safe_post('siang_rak_52') : NULL,
                'malam_rak_52'            => safe_post('malam_rak_52')      !== '' ? safe_post('malam_rak_52') : NULL,

                'Kbpdp_rak'               => safe_post('Kbpdp_rak')         !== '' ? safe_post('Kbpdp_rak') : NULL,
                'pagi_rak_53'             => safe_post('pagi_rak_53')       !== '' ? safe_post('pagi_rak_53') : NULL,
                'siang_rak_53'            => safe_post('siang_rak_53')      !== '' ? safe_post('siang_rak_53') : NULL,
                'malam_rak_53'            => safe_post('malam_rak_53')      !== '' ? safe_post('malam_rak_53') : NULL,

                'Ottv_rak'                => safe_post('Ottv_rak')             !== '' ? safe_post('Ottv_rak') : NULL,
                'pagi_rak_54'             => safe_post('pagi_rak_54')       !== '' ? safe_post('pagi_rak_54') : NULL,
                'siang_rak_54'            => safe_post('siang_rak_54')      !== '' ? safe_post('siang_rak_54') : NULL,
                'malam_rak_54'            => safe_post('malam_rak_54')      !== '' ? safe_post('malam_rak_54') : NULL,

                'Aium_rak'                => safe_post('Aium_rak')             !== '' ? safe_post('Aium_rak') : NULL,
                'pagi_rak_55'             => safe_post('pagi_rak_55')       !== '' ? safe_post('pagi_rak_55') : NULL,
                'siang_rak_55'            => safe_post('siang_rak_55')      !== '' ? safe_post('siang_rak_55') : NULL,
                'malam_rak_55'            => safe_post('malam_rak_55')      !== '' ? safe_post('malam_rak_55') : NULL,

                'Becpjp_rak'              => safe_post('Becpjp_rak')        !== '' ? safe_post('Becpjp_rak') : NULL,
                'pagi_rak_56'             => safe_post('pagi_rak_56')       !== '' ? safe_post('pagi_rak_56') : NULL,
                'siang_rak_56'            => safe_post('siang_rak_56')      !== '' ? safe_post('siang_rak_56') : NULL,
                'malam_rak_56'            => safe_post('malam_rak_56')      !== '' ? safe_post('malam_rak_56') : NULL,

                'Betbpp_rak'              => safe_post('Betbpp_rak')        !== '' ? safe_post('Betbpp_rak') : NULL,
                'pagi_rak_57'             => safe_post('pagi_rak_57')       !== '' ? safe_post('pagi_rak_57') : NULL,
                'siang_rak_57'            => safe_post('siang_rak_57')      !== '' ? safe_post('siang_rak_57') : NULL,
                'malam_rak_57'            => safe_post('malam_rak_57')      !== '' ? safe_post('malam_rak_57') : NULL,

                'PkRr_rak'                => safe_post('PkRr_rak')             !== '' ? safe_post('PkRr_rak') : NULL,
                'pagi_rak_58'             => safe_post('pagi_rak_58')       !== '' ? safe_post('pagi_rak_58') : NULL,
                'siang_rak_58'            => safe_post('siang_rak_58')      !== '' ? safe_post('siang_rak_58') : NULL,
                'malam_rak_58'            => safe_post('malam_rak_58')      !== '' ? safe_post('malam_rak_58') : NULL,

                'Kddaa_rak'               => safe_post('Kddaa_rak')         !== '' ? safe_post('Kddaa_rak') : NULL,
                'pagi_rak_59'             => safe_post('pagi_rak_59')       !== '' ? safe_post('pagi_rak_59') : NULL,
                'siang_rak_59'            => safe_post('siang_rak_59')      !== '' ? safe_post('siang_rak_59') : NULL,
                'malam_rak_59'            => safe_post('malam_rak_59')      !== '' ? safe_post('malam_rak_59') : NULL,
                'lain_rak'                => safe_post('lain_rak')             !== '' ? safe_post('lain_rak') : NULL,
                'date_created'            => safe_post('pengkajian_date_rak') !== '' ? safe_post('pengkajian_date_rak') : null,
            );
            // var_dump($chek_data_rak);die;                      
            $this->m_pelayanan->insertRencanaAsuhanKebidanan($chek_data_rak);
        }
        if (!empty($respon)) {
            $response = $respon;
        } else {
            $response = null;
        }
        if ($this->db->trans_status() === false) :
            $this->db->trans_rollback();
            $status = false;
        else :
            $this->db->trans_commit();
            $status = true;
        endif;

        $message = array(
            'status' => $status,
            'token'  => $this->security->get_csrf_hash(),
            'id_pendaftaran' => ('id_pendaftaran'),
            'id_layanan_pendaftaran' => ('id_layanan_pendaftaran'),
            'respon' => $response,
        );
        $this->response($message, REST_Controller::HTTP_OK);
    }

    // RAK 3
    function hapus_rencana_asuhan_kebidanan_delete($id)
    {
        $status = $this->m_pelayanan->deleteRencanaAsuhanKebidanan($id);
        if ($status) :
            $response = array('status' => $status, 'message' => 'Berhasil menghapus Rencana Asuhan Kebidanan!');
        else :
            $response = array('status' => $status, 'message' => 'Gagal menghapus Rencana Asuhan Kebidanan!');
        endif;
        $this->response($response, REST_Controller::HTTP_OK);
    }

    // RAK 4
    function get_edit_rencana_asuhan_kebidanan_get()
    {
        if (!$this->get('id', true)) :
            $this->response(null, REST_Controller::HTTP_BAD_REQUEST);
        endif;
        $data = $this->m_pelayanan->getRencanaAsuhanKebidananTByID($this->get('id', true));
        $this->response($data, REST_Controller::HTTP_OK);
    }

    // INI DI KASIH _ NYA DARI EDIT CUMA DISINI DOANK YANG DIKASIH YANG LAINYA NORMAL
    function update_rencana_asuhan_kebidanan_put()
    {
        $id = $this->put('id', true);
        if (!$id) {
            $this->response(['status' => false], REST_Controller::HTTP_OK);
            return;
        }

        $data = [
            'id'            => $id,
            'tanggal_rak'   => date('Y-m-d', strtotime(str_replace('/', '-', $this->put('tanggal_rak', true)))),
            'g_rak_1'       => $this->put('g_rak_1', true) ?: null,
            'p_rak_1'       => $this->put('p_rak_1', true) ?: null,
            'a_rak_1'       => $this->put('a_rak_1', true) ?: null,
            'losp_rak'      => $this->put('losp_rak_', true) ?: null,
            'pagi_rak_1'    => $this->put('pagi_rak_1_', true) ?: null,
            'siang_rak_1'   => $this->put('siang_rak_1_', true) ?: null,
            'malam_rak_1'   => $this->put('malam_rak_1_', true) ?: null,
            'hm_rak_1'      => $this->put('hm_rak_1', true) ?: null,
            'ds3m_rak'      => $this->put('ds3m_rak_', true) ?: null,
            'pagi_rak_2'    => $this->put('pagi_rak_2_', true) ?: null,
            'siang_rak_2'   => $this->put('siang_rak_2_', true) ?: null,
            'malam_rak_2'   => $this->put('malam_rak_2_', true) ?: null,
            'pkI_rak'       => $this->put('pkI_rak_', true) ?: null,
            'hks3m_rak'     => $this->put('hks3m_rak_', true) ?: null,
            'pagi_rak_3'    => $this->put('pagi_rak_3_', true) ?: null,
            'siang_rak_3'   => $this->put('siang_rak_3_', true) ?: null,
            'malam_rak_3'   => $this->put('malam_rak_3_', true) ?: null,
            'bI_rak'        => $this->put('bI_rak_', true) ?: null,
            'ns3m_rak'      => $this->put('ns3m_rak_', true) ?: null,
            'pagi_rak_4'    => $this->put('pagi_rak_4_', true) ?: null,
            'siang_rak_4'   => $this->put('siang_rak_4_', true) ?: null,
            'malam_rak_4'   => $this->put('malam_rak_4_', true) ?: null,
            'rptm_rak'      => $this->put('rptm_rak_', true) ?: null,
            'pss4j_rak'     => $this->put('pss4j_rak_', true) ?: null,
            'pagi_rak_5'    => $this->put('pagi_rak_5_', true) ?: null,
            'siang_rak_5'   => $this->put('siang_rak_5_', true) ?: null,
            'malam_rak_5'   => $this->put('malam_rak_5_', true) ?: null,
            'cemas_rak'     => $this->put('cemas_rak_', true) ?: null,
            'tddss4j_rak'   => $this->put('tddss4j_rak_', true) ?: null,
            'pagi_rak_6'    => $this->put('pagi_rak_6_', true) ?: null,
            'siang_rak_6'   => $this->put('siang_rak_6_', true) ?: null,
            'malam_rak_6'   => $this->put('malam_rak_6_', true) ?: null,
            'N_rak'         => $this->put('N_rak_', true) ?: null,
            'pus24j_rak'    => $this->put('pus24j_rak_', true) ?: null,
            'pagi_rak_7'    => $this->put('pagi_rak_7_', true) ?: null,
            'siang_rak_7'   => $this->put('siang_rak_7_', true) ?: null,
            'malam_rak_7'   => $this->put('malam_rak_7_', true) ?: null,
            'ke_rak'        => $this->put('ke_rak_', true) ?: null,
            'fiumpp_rak'    => $this->put('fiumpp_rak_', true) ?: null,
            'pagi_rak_8'    => $this->put('pagi_rak_8_', true) ?: null,
            'siang_rak_8'   => $this->put('siang_rak_8_', true) ?: null,
            'malam_rak_8'   => $this->put('malam_rak_8_', true) ?: null,
            'fiumdm_rak'    => $this->put('fiumdm_rak_', true) ?: null,
            'pagi_rak_9'    => $this->put('pagi_rak_9_', true) ?: null,
            'siang_rak_9'   => $this->put('siang_rak_9_', true) ?: null,
            'malam_rak_9'   => $this->put('malam_rak_9_', true) ?: null,
            'fiub_rak'      => $this->put('fiub_rak_', true) ?: null,
            'pagi_rak_10'   => $this->put('pagi_rak_10_', true) ?: null,
            'siang_rak_10'  => $this->put('siang_rak_10_', true) ?: null,
            'malam_rak_10'  => $this->put('malam_rak_10_', true) ?: null,
            'ajiumk_rak'    => $this->put('ajiumk_rak_', true) ?: null,
            'pagi_rak_11'   => $this->put('pagi_rak_11_', true) ?: null,
            'siang_rak_11'  => $this->put('siang_rak_11_', true) ?: null,
            'malam_rak_11'  => $this->put('malam_rak_11_', true) ?: null,
            'atrumn_rak'    => $this->put('atrumn_rak_', true) ?: null,
            'pagi_rak_12'   => $this->put('pagi_rak_12_', true) ?: null,
            'siang_rak_12'  => $this->put('siang_rak_12_', true) ?: null,
            'malam_rak_12'  => $this->put('malam_rak_12_', true) ?: null,
            'lsppsh_rak'    => $this->put('lsppsh_rak_', true) ?: null,
            'pagi_rak_13'   => $this->put('pagi_rak_13_', true) ?: null,
            'siang_rak_13'  => $this->put('siang_rak_13_', true) ?: null,
            'malam_rak_13'  => $this->put('malam_rak_13_', true) ?: null,
            'akumd_rak'     => $this->put('akumd_rak_', true) ?: null,
            'pagi_rak_14'   => $this->put('pagi_rak_14_', true) ?: null,
            'siang_rak_14'  => $this->put('siang_rak_14_', true) ?: null,
            'malam_rak_14'  => $this->put('malam_rak_14_', true) ?: null,
            'bepdkk_rak'    => $this->put('bepdkk_rak_', true) ?: null,
            'pagi_rak_15'   => $this->put('pagi_rak_15_', true) ?: null,
            'siang_rak_15'  => $this->put('siang_rak_15_', true) ?: null,
            'malam_rak_15'  => $this->put('malam_rak_15_', true) ?: null,
            'bepp_rak'      => $this->put('bepp_rak_', true) ?: null,
            'pagi_rak_16'   => $this->put('pagi_rak_16_', true) ?: null,
            'siang_rak_16'  => $this->put('siang_rak_16_', true) ?: null,
            'malam_rak_16'  => $this->put('malam_rak_16_', true) ?: null,
            'BetI_rak'      => $this->put('BetI_rak_', true) ?: null,
            'pagi_rak_17'   => $this->put('pagi_rak_17_', true) ?: null,
            'siang_rak_17'  => $this->put('siang_rak_17_', true) ?: null,
            'malam_rak_17'  => $this->put('malam_rak_17_', true) ?: null,
            'Saap_rak'      => $this->put('Saap_rak_', true) ?: null,
            'pagi_rak_18'   => $this->put('pagi_rak_18_', true) ?: null,
            'siang_rak_18'  => $this->put('siang_rak_18_', true) ?: null,
            'malam_rak_18'  => $this->put('malam_rak_18_', true) ?: null,
            'Kddaadpt_rak'  => $this->put('Kddaadpt_rak_', true) ?: null,
            'pagi_rak_19'   => $this->put('pagi_rak_19_', true) ?: null,
            'siang_rak_19'  => $this->put('siang_rak_19_', true) ?: null,
            'malam_rak_19'  => $this->put('malam_rak_19_', true) ?: null,
            'JP_rak'        => $this->put('JP_rak', true) ?: null,
            'LoDdkj_rak'    => $this->put('LoDdkj_rak_', true) ?: null,
            'pagi_rak_20'   => $this->put('pagi_rak_20_', true) ?: null,
            'siang_rak_20'  => $this->put('siang_rak_20_', true) ?: null,
            'malam_rak_20'  => $this->put('malam_rak_20_', true) ?: null,
            'TH_rak'        => $this->put('TH_rak_', true) ?: null,
            'Logj_rak'      => $this->put('Logj_rak_', true) ?: null,
            'pagi_rak_21'   => $this->put('pagi_rak_21_', true) ?: null,
            'siang_rak_21'  => $this->put('siang_rak_21_', true) ?: null,
            'malam_rak_21'  => $this->put('malam_rak_21_', true) ?: null,
            'kosong_rak'    => $this->put('kosong_rak_', true) ?: null,
            'kosoong_rak'   => $this->put('kosoong_rak', true) ?: null,
            'siapkan_rak'   => $this->put('siapkan_rak_', true) ?: null,
            'pagi_rak_22'   => $this->put('pagi_rak_22_', true) ?: null,
            'siang_rak_22'  => $this->put('siang_rak_22_', true) ?: null,
            'malam_rak_22'  => $this->put('malam_rak_22_', true) ?: null,
            'Rgj_rak'       => $this->put('Rgj_rak_', true) ?: null,
            'Kddaadp_rak'   => $this->put('Kddaadp_rak_', true) ?: null,
            'pagi_rak_23'   => $this->put('pagi_rak_23_', true) ?: null,
            'siang_rak_23'  => $this->put('siang_rak_23_', true) ?: null,
            'malam_rak_23'  => $this->put('malam_rak_23_', true) ?: null,
            'GG_rak'        => $this->put('GG_rak', true) ?: null,
            'PP_rak'        => $this->put('PP_rak', true) ?: null,
            'AA_rak'        => $this->put('AA_rak', true) ?: null,
            'PtkII_rak'     => $this->put('PtkII_rak_', true) ?: null,
            'pagi_rak_24'   => $this->put('pagi_rak_24_', true) ?: null,
            'siang_rak_24'  => $this->put('siang_rak_24_', true) ?: null,
            'malam_rak_24'  => $this->put('malam_rak_24_', true) ?: null,
            'Hmm_rak'       => $this->put('Hmm_rak', true) ?: null,
            'Api_rak'       => $this->put('Api_rak_', true) ?: null,
            'pagi_rak_25'   => $this->put('pagi_rak_25_', true) ?: null,
            'siang_rak_25'  => $this->put('siang_rak_25_', true) ?: null,
            'malam_rak_25'  => $this->put('malam_rak_25_', true) ?: null,
            'PkII_rak'      => $this->put('PkII_rak_', true) ?: null,
            'pagi_rak_26'   => $this->put('pagi_rak_26_', true) ?: null,
            'siang_rak_26'  => $this->put('siang_rak_26_', true) ?: null,
            'malam_rak_26'  => $this->put('malam_rak_26_', true) ?: null,
            'Rpm_rak'       => $this->put('Rpm_rak_', true) ?: null,
            'Pmjah_rak'     => $this->put('Pmjah_rak_', true) ?: null,
            'pagi_rak_27'   => $this->put('pagi_rak_27_', true) ?: null,
            'siang_rak_27'  => $this->put('siang_rak_27_', true) ?: null,
            'malam_rak_27'  => $this->put('malam_rak_27_', true) ?: null,
            'Raj_rak'       => $this->put('Raj_rak_', true) ?: null,
            'oDsm_rak'      => $this->put('oDsm_rak_', true) ?: null,
            'pagi_rak_28'   => $this->put('pagi_rak_28_', true) ?: null,
            'siang_rak_28'  => $this->put('siang_rak_28_', true) ?: null,
            'malam_rak_28'  => $this->put('malam_rak_28_', true) ?: null,
            'Pk_rak'        => $this->put('Pk_rak_', true) ?: null,
            'pagi_rak_29'   => $this->put('pagi_rak_29_', true) ?: null,
            'siang_rak_29'  => $this->put('siang_rak_29_', true) ?: null,
            'malam_rak_29'  => $this->put('malam_rak_29_', true) ?: null,
            'Lebp_rak'      => $this->put('Lebp_rak_', true) ?: null,
            'pagi_rak_30'   => $this->put('pagi_rak_30_', true) ?: null,
            'siang_rak_30'  => $this->put('siang_rak_30_', true) ?: null,
            'malam_rak_30'  => $this->put('malam_rak_30_', true) ?: null,
            'Lb_rak'        => $this->put('Lb_rak_', true) ?: null,
            'pagi_rak_31'   => $this->put('pagi_rak_31_', true) ?: null,
            'siang_rak_31'  => $this->put('siang_rak_31_', true) ?: null,
            'malam_rak_31'  => $this->put('malam_rak_31_', true) ?: null,
            'Lbdpi_rak'     => $this->put('Lbdpi_rak_', true) ?: null,
            'pagi_rak_32'   => $this->put('pagi_rak_32_', true) ?: null,
            'siang_rak_32'  => $this->put('siang_rak_32_', true) ?: null,
            'malam_rak_32'  => $this->put('malam_rak_32_', true) ?: null,
            'Bjnb_rak'      => $this->put('Bjnb_rak_', true) ?: null,
            'pagi_rak_33'   => $this->put('pagi_rak_33_', true) ?: null,
            'siang_rak_33'  => $this->put('siang_rak_33_', true) ?: null,
            'malam_rak_33'  => $this->put('malam_rak_33_', true) ?: null,
            'Kbslr_rak'     => $this->put('Kbslr_rak_', true) ?: null,
            'pagi_rak_34'   => $this->put('pagi_rak_34_', true) ?: null,
            'siang_rak_34'  => $this->put('siang_rak_34_', true) ?: null,
            'malam_rak_34'  => $this->put('malam_rak_34_', true) ?: null,
            'Gkyb_rak'      => $this->put('Gkyb_rak_', true) ?: null,
            'pagi_rak_35'   => $this->put('pagi_rak_35_', true) ?: null,
            'siang_rak_35'  => $this->put('siang_rak_35_', true) ?: null,
            'malam_rak_35'  => $this->put('malam_rak_35_', true) ?: null,
            'Nsabm_rak'     => $this->put('Nsabm_rak_', true) ?: null,
            'pagi_rak_36'   => $this->put('pagi_rak_36_', true) ?: null,
            'siang_rak_36'  => $this->put('siang_rak_36_', true) ?: null,
            'malam_rak_36'  => $this->put('malam_rak_36_', true) ?: null,
            'Cjk_rak'       => $this->put('Cjk_rak_', true) ?: null,
            'pagi_rak_37'   => $this->put('pagi_rak_37_', true) ?: null,
            'siang_rak_37'  => $this->put('siang_rak_37_', true) ?: null,
            'malam_rak_37'  => $this->put('malam_rak_37_', true) ?: null,
            'Kddaakp_rak'   => $this->put('Kddaakp_rak_', true) ?: null,
            'pagi_rak_38'   => $this->put('pagi_rak_38_', true) ?: null,
            'siang_rak_38'  => $this->put('siang_rak_38_', true) ?: null,
            'malam_rak_38'  => $this->put('malam_rak_38_', true) ?: null,
            'p2_rak'        => $this->put('p2_rak', true) ?: null,
            'a2_rak'        => $this->put('a2_rak', true) ?: null,
            'ls1_rak'       => $this->put('ls1_rak_', true) ?: null,
            'pagi_rak_39'   => $this->put('pagi_rak_39_', true) ?: null,
            'siang_rak_39'  => $this->put('siang_rak_39_', true) ?: null,
            'malam_rak_39'  => $this->put('malam_rak_39_', true) ?: null,
            'Jdptp_rak'     => $this->put('Jdptp_rak_', true) ?: null,
            'pagi_rak_40'   => $this->put('pagi_rak_40_', true) ?: null,
            'siang_rak_40'  => $this->put('siang_rak_40_', true) ?: null,
            'malam_rak_40'  => $this->put('malam_rak_40_', true) ?: null,
            'Rrp_rak'       => $this->put('Rrp_rak_', true) ?: null,
            'FbuI_rak'      => $this->put('FbuI_rak_', true) ?: null,
            'pagi_rak_41'   => $this->put('pagi_rak_41_', true) ?: null,
            'siang_rak_41'  => $this->put('siang_rak_41_', true) ?: null,
            'malam_rak_41'  => $this->put('malam_rak_41_', true) ?: null,
            'Bidpp_rak'     => $this->put('Bidpp_rak_', true) ?: null,
            'pagi_rak_43'   => $this->put('pagi_rak_43_', true) ?: null,
            'siang_rak_43'  => $this->put('siang_rak_43_', true) ?: null,
            'malam_rak_43'  => $this->put('malam_rak_43_', true) ?: null,
            'llp_rak'       => $this->put('llp_rak_', true) ?: null,
            'pagi_rak_44'   => $this->put('pagi_rak_44_', true) ?: null,
            'siang_rak_44'  => $this->put('siang_rak_44_', true) ?: null,
            'malam_rak_44'  => $this->put('malam_rak_44_', true) ?: null,
            'Mum_rak'       => $this->put('Mum_rak_', true) ?: null,
            'pagi_rak_45'   => $this->put('pagi_rak_45', true) ?: null,
            'siang_rak_45'  => $this->put('siang_rak_45', true) ?: null,
            'malam_rak_45'  => $this->put('malam_rak_45', true) ?: null,
            'Pjl_rak'       => $this->put('Pjl_rak_', true) ?: null,
            'pagi_rak_46'   => $this->put('pagi_rak_46_', true) ?: null,
            'siang_rak_46'  => $this->put('siang_rak_46_', true) ?: null,
            'malam_rak_46'  => $this->put('malam_rak_46_', true) ?: null,
            'Nkp_rak'       => $this->put('Nkp_rak_', true) ?: null,
            'pagi_rak_47'   => $this->put('pagi_rak_47_', true) ?: null,
            'siang_rak_47'  => $this->put('siang_rak_47_', true) ?: null,
            'malam_rak_47'  => $this->put('malam_rak_47_', true) ?: null,
            'Kddaakpy_rak'  => $this->put('Kddaakpy_rak_', true) ?: null,
            'pagi_rak_48'   => $this->put('pagi_rak_48_', true) ?: null,
            'siang_rak_48'  => $this->put('siang_rak_48_', true) ?: null,
            'malam_rak_48'  => $this->put('malam_rak_48_', true) ?: null,
            'PP3_rak'       => $this->put('PP3_rak', true) ?: null,
            'AA3_rak'       => $this->put('AA3_rak', true) ?: null,
            'Lbttv_rak'     => $this->put('Lbttv_rak_', true) ?: null,
            'pagi_rak_49'   => $this->put('pagi_rak_49_', true) ?: null,
            'siang_rak_49'  => $this->put('siang_rak_49_', true) ?: null,
            'malam_rak_49'  => $this->put('malam_rak_49_', true) ?: null,
            'Pjll_rak'      => $this->put('Pjll_rak_', true) ?: null,
            'pagi_rak_50'   => $this->put('pagi_rak_50_', true) ?: null,
            'siang_rak_50'  => $this->put('siang_rak_50_', true) ?: null,
            'malam_rak_50'  => $this->put('malam_rak_50_', true) ?: null,
            'RP_rak'        => $this->put('RP_rak_', true) ?: null,
            'Gal_rak'       => $this->put('Gal_rak_', true) ?: null,
            'pagi_rak_51'   => $this->put('pagi_rak_51_', true) ?: null,
            'siang_rak_51'  => $this->put('siang_rak_51_', true) ?: null,
            'malam_rak_51'  => $this->put('malam_rak_51_', true) ?: null,
            'Kee_rak'       => $this->put('Kee_rak_', true) ?: null,
            'Lhp_rak'       => $this->put('Lhp_rak_', true) ?: null,
            'pagi_rak_52'   => $this->put('pagi_rak_52_', true) ?: null,
            'siang_rak_52'  => $this->put('siang_rak_52_', true) ?: null,
            'malam_rak_52'  => $this->put('malam_rak_52_', true) ?: null,
            'Kbpdp_rak'     => $this->put('Kbpdp_rak_', true) ?: null,
            'pagi_rak_53'   => $this->put('pagi_rak_53_', true) ?: null,
            'siang_rak_53'  => $this->put('siang_rak_53_', true) ?: null,
            'malam_rak_53'  => $this->put('malam_rak_53_', true) ?: null,
            'Ottv_rak'      => $this->put('Ottv_rak_', true) ?: null,
            'pagi_rak_54'   => $this->put('pagi_rak_54_', true) ?: null,
            'siang_rak_54'  => $this->put('siang_rak_54_', true) ?: null,
            'malam_rak_54'  => $this->put('malam_rak_54_', true) ?: null,
            'Aium_rak'      => $this->put('Aium_rak_', true) ?: null,
            'pagi_rak_55'   => $this->put('pagi_rak_55_', true) ?: null,
            'siang_rak_55'  => $this->put('siang_rak_55_', true) ?: null,
            'malam_rak_55'  => $this->put('malam_rak_55_', true) ?: null,
            'Becpjp_rak'    => $this->put('Becpjp_rak_', true) ?: null,
            'pagi_rak_56'   => $this->put('pagi_rak_56_', true) ?: null,
            'siang_rak_56'  => $this->put('siang_rak_56_', true) ?: null,
            'malam_rak_56'  => $this->put('malam_rak_56_', true) ?: null,
            'Betbpp_rak'    => $this->put('Betbpp_rak_', true) ?: null,
            'pagi_rak_57'   => $this->put('pagi_rak_57_', true) ?: null,
            'siang_rak_57'  => $this->put('siang_rak_57_', true) ?: null,
            'malam_rak_57'  => $this->put('malam_rak_57_', true) ?: null,
            'PkRr_rak'      => $this->put('PkRr_rak_', true) ?: null,
            'pagi_rak_58'   => $this->put('pagi_rak_58_', true) ?: null,
            'siang_rak_58'  => $this->put('siang_rak_58_', true) ?: null,
            'malam_rak_58'  => $this->put('malam_rak_58_', true) ?: null,
            'Kddaa_rak'     => $this->put('Kddaa_rak_', true) ?: null,
            'pagi_rak_59'   => $this->put('pagi_rak_59_', true) ?: null,
            'siang_rak_59'  => $this->put('siang_rak_59_', true) ?: null,
            'malam_rak_59'  => $this->put('malam_rak_59_', true) ?: null,
            'lain_rak'      => $this->put('lain_rak', true) ?: null,
            'updated_at'    => date('Y-m-d H:i:s'),
        ];
        // var_dump($this->put('pagi_rak_14', true));die;   
        $status = $this->m_pelayanan->editRencanaAsuhanKebidanan($data);
        $this->response(['status' => $status], REST_Controller::HTTP_OK);
    }

    // SP_WE
    function get_form_surat_pernyataan_get()
    {
        if (!$this->get('id')) :
            $this->response(NULL, REST_Controller::HTTP_BAD_REQUEST); // (400)
        endif;
        // var_dump($this->get('id'));die;
        $this->load->model('pendaftaran/Pendaftaran_model', 'm_pendaftaran');
        $data = $this->m_pendaftaran->getPendaftaranDetail($this->get('id', true), $this->get('id_layanan', true));
        $data['profil'] = $this->m_pelayanan->getProfilPasien($data['pasien']->id_pasien);
        $data['surat_pernyataan'] = $this->m_pelayanan->getSuratPernyataan($this->get('id'), $this->m_pendaftaran->getPendaftaranDetail($this->get('id')));
        // var_dump($data['surat_pernyataan']);die;
        if ($data) :
            $this->response($data, REST_Controller::HTTP_OK); // (200)
        endif;
    }



    // TPI B
    function get_data_travelling_patient_information_get()
    {
        if (!$this->get('id')) :
            $this->response(NULL, REST_Controller::HTTP_BAD_REQUEST); // (400)
        endif;
        $this->load->model('pendaftaran/Pendaftaran_model', 'm_pendaftaran');
        $data = $this->m_pendaftaran->getPendaftaranDetail($this->get('id', true), $this->get('id_layanan', true));
        $data['profil'] = $this->m_pelayanan->getProfilPasien($data['pasien']->id_pasien);
        $data['travelling_patient_information'] = $this->m_pelayanan->getTravellingPatientInformation($this->get('id'), $this->m_pendaftaran->getPendaftaranDetail($this->get('id')));
        $data['diagnosa'] = $this->m_pelayanan->getDiagnosaPemeriksaan($data['layanan']->id);  // Ada data yang sama jadi ga usah bikin queri
        if ($data) :
            $this->response($data, REST_Controller::HTTP_OK); // (200)
        endif;
    }




    // SAFR 1
    function get_data_skrining_admisi_get(){
        if (!$this->get('id_layanan_pendaftaran')) :
            $this->response(NULL, REST_Controller::HTTP_BAD_REQUEST); // (400)
        endif;
        $this->load->model('pendaftaran/Pendaftaran_model', 'm_pendaftaran');
        $this->load->model('pelayanan/Pelayanan_model', 'm_pelayanan');
        $data                               = $this->m_pendaftaran->getPendaftaranDetail($this->get('id', true), $this->get('id_layanan', true));
        $data['profil']                     = $this->m_pelayanan->getProfilPasien($data['pasien']->id_pasien);
        $data['skrining_admisi']   = $this->m_pelayanan->getSkriningAdmisi($this->get('id', true));

        $data['ds_manual_utama'] = [];
        $ds_manual_utamas = $this->m_pelayanan->getDiagnosaManualUtama($this->get('id', true));
        if (!empty($ds_manual_utamas)) {
            $data['ds_manual_utama'] = $ds_manual_utamas;
        }

        if ($data) :
            $this->response($data, REST_Controller::HTTP_OK); // (200)
        endif;
        // var_dump('skrining_admisi');die;
    }

    // SAFR 2
    function simpan_data_skrining_admisi_post(){
        $id_users = safe_post('id_user');
        $layanan = array('id' => safe_post('id_layanan_pendaftaran'));
        $pengkajian_date_skrining_admisi = safe_post('pengkajian_date_skrining_admisi');
        // KALAU GA ADA IINI PASTI EROR
        $id_pendaftaran           = safe_post('id_pendaftaran');
        if (!empty($pengkajian_date_skrining_admisi)) {
            $chek_data_safr = array(
                'id_pendaftaran'            => $id_pendaftaran,
                'id_layanan_pendaftaran'    => $layanan['id'],
                'id_user'                   => safe_post('user_skrining') !== '' ? safe_post('user_skrining') : null,
                'tanggal_safr'                => safe_post('tanggal_safr') !== '' ? safe_post('tanggal_safr') : null,
                'jam_safr'                    => safe_post('jam_safr') !== '' ? safe_post('jam_safr') : null,
                'rendah_safr_1'             => safe_post('rendah_safr_1')             !== '' ? safe_post('rendah_safr_1') : NULL,
                'medium_safr_1'             => safe_post('medium_safr_1')             !== '' ? safe_post('medium_safr_1') : NULL,
                'tinggi_safr_1'             => safe_post('tinggi_safr_1')             !== '' ? safe_post('tinggi_safr_1') : NULL,
                'rendah_safr_2'             => safe_post('rendah_safr_2')             !== '' ? safe_post('rendah_safr_2') : NULL,
                'medium_safr_2'             => safe_post('medium_safr_2')             !== '' ? safe_post('medium_safr_2') : NULL,
                'tinggi_safr_2'             => safe_post('tinggi_safr_2')             !== '' ? safe_post('tinggi_safr_2') : NULL,
                'rendah_safr_3'             => safe_post('rendah_safr_3')             !== '' ? safe_post('rendah_safr_3') : NULL,
                'medium_safr_3'             => safe_post('medium_safr_3')             !== '' ? safe_post('medium_safr_3') : NULL,
                'tinggi_safr_3'             => safe_post('tinggi_safr_3')             !== '' ? safe_post('tinggi_safr_3') : NULL,
                'rendah_safr_4'             => safe_post('rendah_safr_4')             !== '' ? safe_post('rendah_safr_4') : NULL,
                'medium_safr_4'             => safe_post('medium_safr_4')             !== '' ? safe_post('medium_safr_4') : NULL,
                'tinggi_safr_4'             => safe_post('tinggi_safr_4')             !== '' ? safe_post('tinggi_safr_4') : NULL,
                'rendah_safr_5'             => safe_post('rendah_safr_5')             !== '' ? safe_post('rendah_safr_5') : NULL,
                'medium_safr_5'             => safe_post('medium_safr_5')             !== '' ? safe_post('medium_safr_5') : NULL,
                'tinggi_safr_5'             => safe_post('tinggi_safr_5')             !== '' ? safe_post('tinggi_safr_5') : NULL,
                'rendah_safr_6'             => safe_post('rendah_safr_6')             !== '' ? safe_post('rendah_safr_6') : NULL,
                'medium_safr_6'             => safe_post('medium_safr_6')             !== '' ? safe_post('medium_safr_6') : NULL,
                'tinggi_safr_6'             => safe_post('tinggi_safr_6')             !== '' ? safe_post('tinggi_safr_6') : NULL,
                'medium_safr_7'             => safe_post('medium_safr_7')             !== '' ? safe_post('medium_safr_7') : NULL,
                'tinggi_safr_7'             => safe_post('tinggi_safr_7')             !== '' ? safe_post('tinggi_safr_7') : NULL,
                'medium_safr_8'             => safe_post('medium_safr_8')             !== '' ? safe_post('medium_safr_8') : NULL,
                'tinggi_safr_8'             => safe_post('tinggi_safr_8')             !== '' ? safe_post('tinggi_safr_8') : NULL,
                'medium_safr_9'             => safe_post('medium_safr_9')             !== '' ? safe_post('medium_safr_9') : NULL,
                'tinggi_safr_9'             => safe_post('tinggi_safr_9')             !== '' ? safe_post('tinggi_safr_9') : NULL,
                'medium_safr_10'            => safe_post('medium_safr_10')             !== '' ? safe_post('medium_safr_10') : NULL,
                'tinggi_safr_10'            => safe_post('tinggi_safr_10')             !== '' ? safe_post('tinggi_safr_10') : NULL,
                'medium_safr_11'            => safe_post('medium_safr_11')             !== '' ? safe_post('medium_safr_11') : NULL,
                'medium_safr_12'            => safe_post('medium_safr_12')             !== '' ? safe_post('medium_safr_12') : NULL,
                'rendah_safr_13'            => safe_post('rendah_safr_13')             !== '' ? safe_post('rendah_safr_13') : NULL,
                'medium_safr_13'            => safe_post('medium_safr_13')             !== '' ? safe_post('medium_safr_13') : NULL,
                'tinggi_safr_13'            => safe_post('tinggi_safr_13')             !== '' ? safe_post('tinggi_safr_13') : NULL,
                'medium_safr_14'            => safe_post('medium_safr_14')             !== '' ? safe_post('medium_safr_14') : NULL,
                'tinggi_safr_14'            => safe_post('tinggi_safr_14')             !== '' ? safe_post('tinggi_safr_14') : NULL,
                'tinggi_safr_15'            => safe_post('tinggi_safr_15')             !== '' ? safe_post('tinggi_safr_15') : NULL,
                'perawat_safr'              => safe_post('perawat_safr')             !== '' ? safe_post('perawat_safr') : NULL,
                'date_created'              => safe_post('pengkajian_date_skrining_admisi') !== '' ? safe_post('pengkajian_date_skrining_admisi') : null,
            );
            // var_dump($chek_data_safr);die;                      
            $this->m_pelayanan->insertSkriningAdmisi($chek_data_safr);
        }
        if (!empty($respon)) {
            $response = $respon;
        } else {
            $response = null;
        }
        if ($this->db->trans_status() === false) :
            $this->db->trans_rollback();
            $status = false;
        else :
            $this->db->trans_commit();
            $status = true;
        endif;

        $message = array(
            'status' => $status,
            'token'  => $this->security->get_csrf_hash(),
            'id_pendaftaran' => ('id_pendaftaran'),
            'id_layanan_pendaftaran' => ('id_layanan_pendaftaran'),
            'respon' => $response,
        );
        $this->response($message, REST_Controller::HTTP_OK);
    }

    // SAFR 4
    function get_edit_skrining_admisi_get(){
        if (!$this->get('id', true)) :
            $this->response(null, REST_Controller::HTTP_BAD_REQUEST);
        endif;
        $data = $this->m_pelayanan->getSkriningAdmisiByID($this->get('id', true));
        $this->response($data, REST_Controller::HTTP_OK);
    }

    // SAFR 3
    function hapus_skrining_admisi_delete($id) {
        $this->db->trans_begin();

        // User yang menghapus (dari session / GET)
        $id_user_logs = $this->session->userdata('id_translucent') ?: $this->input->get('id_user');

        // Ambil data lama sebelum dihapus
        $lama = $this->db->get_where('sm_skrining_admisi_130', ['id' => $id])->row_array();
        if ($lama) {
            $log = $lama;
            unset($log['id']); // hilangkan ID asli

            // Pemilik data awal
            $log['id_user']      = $lama['id_user'];
            // User yang menghapus
            $log['id_user_logs'] = $id_user_logs;

            $log['keterangan'] = 'Delete';
            // $log['created_at'] = date('Y-m-d H:i:s');

            $log['created_at'] = $lama['created_at'];

            $log['updated_at'] = date('Y-m-d H:i:s');

            $this->m_pelayanan->insertLogsSkriningAdmisi($log);
        }

        // Hapus data utama
        $status = $this->m_pelayanan->deleteSkriningAdmisi($id);

        if ($this->db->trans_status() === false || !$status) {
            $this->db->trans_rollback();
            $response = array('status' => false, 'message' => 'Gagal menghapus data!');
        } else {
            $this->db->trans_commit();
            $response = array('status' => true, 'message' => 'Berhasil menghapus data!');
        }

        $this->response($response, REST_Controller::HTTP_OK);
    }

    // SAFR INI DI KASIH _ NYA DARI EDIT CUMA DISINI DOANK YANG DIKASIH YANG LAINYA NORMAL
    function update_skrining_admisi_put() {
        $this->db->trans_begin();

        $id = $this->put('id', true);
        if (!$id) {
            $this->response(['status' => false], REST_Controller::HTTP_OK);
            return;
        }

        // Ambil data lama untuk log
        $lama = $this->db->get_where('sm_skrining_admisi_130', ['id' => $id])->row_array();
        if ($lama) {
            $log = $lama;
            unset($log['id']);
            $log['id_user'] = $lama['id_user']; // simpan pemilik data awal
            $log['id_user_logs'] = $this->session->userdata('id_translucent') ?: $this->put('id_user'); // user yg edit
            $log['keterangan'] = 'Update';
            // $log['created_at'] = date('Y-m-d H:i:s');

            $log['created_at'] = $lama['created_at'];


            $log['updated_at'] = date('Y-m-d H:i:s');
            $this->m_pelayanan->insertLogsSkriningAdmisi($log);
        }

        // Data untuk update (id_user asli tidak diubah)
        $data = [
            'id'                    => $id,
            'tanggal_safr'          => date('Y-m-d', strtotime(str_replace('/', '-', $this->put('tanggal_safr', true)))),
            'jam_safr'              => $this->put('jam_safr', true) ?: null,
            'rendah_safr_1'         => $this->put('rendah_safr_1_', true) ?: null,
            'medium_safr_1'         => $this->put('medium_safr_1_', true) ?: null,
            'tinggi_safr_1'         => $this->put('tinggi_safr_1_', true) ?: null,
            'rendah_safr_2'         => $this->put('rendah_safr_2_', true) ?: null,
            'medium_safr_2'         => $this->put('medium_safr_2_', true) ?: null,
            'tinggi_safr_2'         => $this->put('tinggi_safr_2_', true) ?: null,
            'rendah_safr_3'         => $this->put('rendah_safr_3_', true) ?: null,
            'medium_safr_3'         => $this->put('medium_safr_3_', true) ?: null,
            'tinggi_safr_3'         => $this->put('tinggi_safr_3_', true) ?: null,
            'rendah_safr_4'         => $this->put('rendah_safr_4_', true) ?: null,
            'medium_safr_4'         => $this->put('medium_safr_4_', true) ?: null,
            'tinggi_safr_4'         => $this->put('tinggi_safr_4_', true) ?: null,
            'rendah_safr_5'         => $this->put('rendah_safr_5_', true) ?: null,
            'medium_safr_5'         => $this->put('medium_safr_5_', true) ?: null,
            'tinggi_safr_5'         => $this->put('tinggi_safr_5_', true) ?: null,
            'rendah_safr_6'         => $this->put('rendah_safr_6_', true) ?: null,
            'medium_safr_6'         => $this->put('medium_safr_6_', true) ?: null,
            'tinggi_safr_6'         => $this->put('tinggi_safr_6_', true) ?: null,
            'medium_safr_7'         => $this->put('medium_safr_7_', true) ?: null,
            'tinggi_safr_7'         => $this->put('tinggi_safr_7_', true) ?: null,
            'medium_safr_8'         => $this->put('medium_safr_8_', true) ?: null,
            'tinggi_safr_8'         => $this->put('tinggi_safr_8_', true) ?: null,
            'medium_safr_9'         => $this->put('medium_safr_9_', true) ?: null,
            'tinggi_safr_9'         => $this->put('tinggi_safr_9_', true) ?: null,
            'medium_safr_10'        => $this->put('medium_safr_10_', true) ?: null,
            'tinggi_safr_10'        => $this->put('tinggi_safr_10_', true) ?: null,
            'medium_safr_11'        => $this->put('medium_safr_11_', true) ?: null,
            'medium_safr_12'        => $this->put('medium_safr_12_', true) ?: null,
            'rendah_safr_13'        => $this->put('rendah_safr_13_', true) ?: null,
            'medium_safr_13'        => $this->put('medium_safr_13_', true) ?: null,
            'tinggi_safr_13'        => $this->put('tinggi_safr_13_', true) ?: null,
            'medium_safr_14'        => $this->put('medium_safr_14_', true) ?: null,
            'tinggi_safr_14'        => $this->put('tinggi_safr_14_', true) ?: null,
            'tinggi_safr_15'        => $this->put('tinggi_safr_15_', true) ?: null,
            'perawat_safr'          => $this->put('perawat_safr', true) ?: null,
            'updated_at'            => date('Y-m-d H:i:s'),
            'id_user'               => $this->session->userdata('id_translucent') ?: $this->put('id_user'), // fallback
        ];

        $this->db->where('id', $id);
        $status = $this->db->update('sm_skrining_admisi_130', $data);

        if ($this->db->trans_status() === false) {
            $this->db->trans_rollback();
            $this->response(['status' => false], REST_Controller::HTTP_OK);
        } else {
            $this->db->trans_commit();
            $this->response(['status' => true], REST_Controller::HTTP_OK);
        }
    }
    

    // // SAFR 3
    // function hapus_skrining_admisi_delete($id)
    // {
    //     $status = $this->m_pelayanan->deleteSkriningAdmisi($id);
    //     if ($status) :
    //         $response = array('status' => $status, 'message' => 'Berhasil menghapus Skrining Admisi Faktor Risiko!');
    //     else :
    //         $response = array('status' => $status, 'message' => 'Gagal menghapus Skrining Admisi Faktor Risiko!');
    //     endif;
    //     $this->response($response, REST_Controller::HTTP_OK);
    // }

    // // SAFR INI DI KASIH _ NYA DARI EDIT CUMA DISINI DOANK YANG DIKASIH YANG LAINYA NORMAL
    // function update_skrining_admisi_put()
    // {
    //     $id = $this->put('id', true);
    //     if (!$id) {
    //         $this->response(['status' => false], REST_Controller::HTTP_OK);
    //         return;
    //     }
    //     $data = [
    //         'id'                    => $id,
    //         'tanggal_safr'          => date('Y-m-d', strtotime(str_replace('/', '-', $this->put('tanggal_safr', true)))),
    //         'jam_safr'              => $this->put('jam_safr', true) ?: null,
    //         'rendah_safr_1'         => $this->put('rendah_safr_1_', true) ?: null,
    //         'medium_safr_1'         => $this->put('medium_safr_1_', true) ?: null,
    //         'tinggi_safr_1'         => $this->put('tinggi_safr_1_', true) ?: null,
    //         'rendah_safr_2'         => $this->put('rendah_safr_2_', true) ?: null,
    //         'medium_safr_2'         => $this->put('medium_safr_2_', true) ?: null,
    //         'tinggi_safr_2'         => $this->put('tinggi_safr_2_', true) ?: null,
    //         'rendah_safr_3'         => $this->put('rendah_safr_3_', true) ?: null,
    //         'medium_safr_3'         => $this->put('medium_safr_3_', true) ?: null,
    //         'tinggi_safr_3'         => $this->put('tinggi_safr_3_', true) ?: null,
    //         'rendah_safr_4'         => $this->put('rendah_safr_4_', true) ?: null,
    //         'medium_safr_4'         => $this->put('medium_safr_4_', true) ?: null,
    //         'tinggi_safr_4'         => $this->put('tinggi_safr_4_', true) ?: null,
    //         'rendah_safr_5'         => $this->put('rendah_safr_5_', true) ?: null,
    //         'medium_safr_5'         => $this->put('medium_safr_5_', true) ?: null,
    //         'tinggi_safr_5'         => $this->put('tinggi_safr_5_', true) ?: null,
    //         'rendah_safr_6'         => $this->put('rendah_safr_6_', true) ?: null,
    //         'medium_safr_6'         => $this->put('medium_safr_6_', true) ?: null,
    //         'tinggi_safr_6'         => $this->put('tinggi_safr_6_', true) ?: null,
    //         'medium_safr_7'         => $this->put('medium_safr_7_', true) ?: null,
    //         'tinggi_safr_7'         => $this->put('tinggi_safr_7_', true) ?: null,
    //         'medium_safr_8'         => $this->put('medium_safr_8_', true) ?: null,
    //         'tinggi_safr_8'         => $this->put('tinggi_safr_8_', true) ?: null,
    //         'medium_safr_9'         => $this->put('medium_safr_9_', true) ?: null,
    //         'tinggi_safr_9'         => $this->put('tinggi_safr_9_', true) ?: null,
    //         'medium_safr_10'        => $this->put('medium_safr_10_', true) ?: null,
    //         'tinggi_safr_10'        => $this->put('tinggi_safr_10_', true) ?: null,
    //         'medium_safr_11'        => $this->put('medium_safr_11_', true) ?: null,
    //         'medium_safr_12'        => $this->put('medium_safr_12_', true) ?: null,
    //         'rendah_safr_13'        => $this->put('rendah_safr_13_', true) ?: null,
    //         'medium_safr_13'        => $this->put('medium_safr_13_', true) ?: null,
    //         'tinggi_safr_13'        => $this->put('tinggi_safr_13_', true) ?: null,
    //         'medium_safr_14'        => $this->put('medium_safr_14_', true) ?: null,
    //         'tinggi_safr_14'        => $this->put('tinggi_safr_14_', true) ?: null,
    //         'tinggi_safr_15'        => $this->put('tinggi_safr_15_', true) ?: null,
    //         'perawat_safr'          => $this->put('perawat_safr', true) ?: null,
    //         'updated_at'    => date('Y-m-d H:i:s'),
    //     ];
    //     // var_dump($this->put('tinggi_safr_15', true));die;   
    //     $status = $this->m_pelayanan->editSkriningAdmisi($data);
    //     $this->response(['status' => $status], REST_Controller::HTTP_OK);
    // }

   











    // PERT 1
    function get_data_preeklampsia_early_get(){
        if (!$this->get('id_layanan_pendaftaran')) :
            $this->response(NULL, REST_Controller::HTTP_BAD_REQUEST); // (400)
        endif;
        $this->load->model('pendaftaran/Pendaftaran_model', 'm_pendaftaran');
        $this->load->model('pelayanan/Pelayanan_model', 'm_pelayanan');
        $data                               = $this->m_pendaftaran->getPendaftaranDetail($this->get('id', true), $this->get('id_layanan', true));
        $data['profil']                     = $this->m_pelayanan->getProfilPasien($data['pasien']->id_pasien);
        $data['preeklampsia_early']         = $this->m_pelayanan->getPreeklampsiaEarly($this->get('id', true));

        $data['ds_manual_utama'] = [];
        $ds_manual_utamas = $this->m_pelayanan->getDiagnosaManualUtama($this->get('id', true));
        if (!empty($ds_manual_utamas)) {
            $data['ds_manual_utama'] = $ds_manual_utamas;
        }

        if ($data) :
            $this->response($data, REST_Controller::HTTP_OK); // (200)
        endif;
        // var_dump('preeklampsia_early');die;
    }

    // PERT 2
    function simpan_data_preeklampsia_early_post(){
        $id_users = safe_post('id_user');
        $layanan = array('id' => safe_post('id_layanan_pendaftaran'));
        $pengkajian_date_preeklampsia = safe_post('pengkajian_date_preeklampsia');
        // KALAU GA ADA IINI PASTI EROR
        $id_pendaftaran           = safe_post('id_pendaftaran');
        if (!empty($pengkajian_date_preeklampsia)) {
            $chek_data_pert = array(
                'id_pendaftaran'            => $id_pendaftaran,
                'id_layanan_pendaftaran'    => $layanan['id'],
                'id_user'                   => safe_post('user_preeklampsia') !== '' ? safe_post('user_preeklampsia') : null,
                'tanggal_pert'                => safe_post('tanggal_pert') !== '' ? safe_post('tanggal_pert') : null,
                'jam_pert'                    => safe_post('jam_pert') !== '' ? safe_post('jam_pert') : null,
                'hijau_1'      => safe_post('hijau_1')      !== '' ? safe_post('hijau_1') : NULL,
                'kuning_1'     => safe_post('kuning_1')     !== '' ? safe_post('kuning_1') : NULL,
                'merah_1'      => safe_post('merah_1')      !== '' ? safe_post('merah_1') : NULL,
                'hijau_2'      => safe_post('hijau_2')      !== '' ? safe_post('hijau_2') : NULL,
                'kuning_2'     => safe_post('kuning_2')     !== '' ? safe_post('kuning_2') : NULL,
                'merah_2'      => safe_post('merah_2')      !== '' ? safe_post('merah_2') : NULL,
                'hijau_3'      => safe_post('hijau_3')      !== '' ? safe_post('hijau_3') : NULL,
                'kuning_3'     => safe_post('kuning_3')     !== '' ? safe_post('kuning_3') : NULL,
                'merah_3'      => safe_post('merah_3')      !== '' ? safe_post('merah_3') : NULL,
                'hijau_4'      => safe_post('hijau_4')      !== '' ? safe_post('hijau_4') : NULL,
                'kuning_4'     => safe_post('kuning_4')     !== '' ? safe_post('kuning_4') : NULL,
                'merah_4'      => safe_post('merah_4')      !== '' ? safe_post('merah_4') : NULL,
                'hijau_5'      => safe_post('hijau_5')      !== '' ? safe_post('hijau_5') : NULL,
                'kuning_5'     => safe_post('kuning_5')     !== '' ? safe_post('kuning_5') : NULL,
                'merah_5'      => safe_post('merah_5')      !== '' ? safe_post('merah_5') : NULL,
                'hijau_6'      => safe_post('hijau_6')      !== '' ? safe_post('hijau_6') : NULL,
                'kuning_6'     => safe_post('kuning_6')     !== '' ? safe_post('kuning_6') : NULL,
                'merah_6'      => safe_post('merah_6')      !== '' ? safe_post('merah_6') : NULL,
                'hijau_7'      => safe_post('hijau_7')      !== '' ? safe_post('hijau_7') : NULL,
                'kuning_7'     => safe_post('kuning_7')     !== '' ? safe_post('kuning_7') : NULL,
                'merah_7'      => safe_post('merah_7')      !== '' ? safe_post('merah_7') : NULL,
                'hijau_8'      => safe_post('hijau_8')      !== '' ? safe_post('hijau_8') : NULL,
                'kuning_8'     => safe_post('kuning_8')     !== '' ? safe_post('kuning_8') : NULL,
                'merah_8'      => safe_post('merah_8')      !== '' ? safe_post('merah_8') : NULL,
                'hijau_9'      => safe_post('hijau_9')      !== '' ? safe_post('hijau_9') : NULL,
                'kuning_9'     => safe_post('kuning_9')     !== '' ? safe_post('kuning_9') : NULL,
                'merah_9'      => safe_post('merah_9')      !== '' ? safe_post('merah_9') : NULL,
                'hijau_10'     => safe_post('hijau_10')     !== '' ? safe_post('hijau_10') : NULL,
                'kuning_10'    => safe_post('kuning_10')    !== '' ? safe_post('kuning_10') : NULL,
                'merah_10'     => safe_post('merah_10')     !== '' ? safe_post('merah_10') : NULL,
                'hijau_11'     => safe_post('hijau_11')     !== '' ? safe_post('hijau_11') : NULL,
                'kuning_11'    => safe_post('kuning_11')    !== '' ? safe_post('kuning_11') : NULL,
                'merah_11'     => safe_post('merah_11')     !== '' ? safe_post('merah_11') : NULL,
                'hijau_12'     => safe_post('hijau_12')     !== '' ? safe_post('hijau_12') : NULL,
                'kuning_12'    => safe_post('kuning_12')    !== '' ? safe_post('kuning_12') : NULL,
                'merah_12'     => safe_post('merah_12')     !== '' ? safe_post('merah_12') : NULL,
                'hijau_13'     => safe_post('hijau_13')     !== '' ? safe_post('hijau_13') : NULL,
                'kuning_13'    => safe_post('kuning_13')    !== '' ? safe_post('kuning_13') : NULL,
                'merah_13'     => safe_post('merah_13')     !== '' ? safe_post('merah_13') : NULL,
                'hijau_14'     => safe_post('hijau_14')     !== '' ? safe_post('hijau_14') : NULL,
                'kuning_14'    => safe_post('kuning_14')    !== '' ? safe_post('kuning_14') : NULL,
                'merah_14'     => safe_post('merah_14')     !== '' ? safe_post('merah_14') : NULL,
                'hijau_15'     => safe_post('hijau_15')     !== '' ? safe_post('hijau_15') : NULL,
                'kuning_15'    => safe_post('kuning_15')    !== '' ? safe_post('kuning_15') : NULL,
                'merah_15'     => safe_post('merah_15')     !== '' ? safe_post('merah_15') : NULL,
                'hijau_16'     => safe_post('hijau_16')     !== '' ? safe_post('hijau_16') : NULL,
                'kuning_16'    => safe_post('kuning_16')    !== '' ? safe_post('kuning_16') : NULL,
                'merah_16'     => safe_post('merah_16')     !== '' ? safe_post('merah_16') : NULL,
                'hijau_17'     => safe_post('hijau_17')     !== '' ? safe_post('hijau_17') : NULL,
                'kuning_17'    => safe_post('kuning_17')    !== '' ? safe_post('kuning_17') : NULL,
                'merah_17'     => safe_post('merah_17')     !== '' ? safe_post('merah_17') : NULL,
                'perawat_pert'              => safe_post('perawat_pert')             !== '' ? safe_post('perawat_pert') : NULL,
                'date_created'              => safe_post('pengkajian_date_preeklampsia') !== '' ? safe_post('pengkajian_date_preeklampsia') : null,
            );
            // var_dump($chek_data_pert);die;                      
            $this->m_pelayanan->insertPreeklampsiaEarly($chek_data_pert);
        }
        if (!empty($respon)) {
            $response = $respon;
        } else {
            $response = null;
        }
        if ($this->db->trans_status() === false) :
            $this->db->trans_rollback();
            $status = false;
        else :
            $this->db->trans_commit();
            $status = true;
        endif;

        $message = array(
            'status' => $status,
            'token'  => $this->security->get_csrf_hash(),
            'id_pendaftaran' => ('id_pendaftaran'),
            'id_layanan_pendaftaran' => ('id_layanan_pendaftaran'),
            'respon' => $response,
        );
        $this->response($message, REST_Controller::HTTP_OK);
    }

    // PERT 4
    function get_edit_preeklampsia_early_get(){
        if (!$this->get('id', true)) :
            $this->response(null, REST_Controller::HTTP_BAD_REQUEST);
        endif;
        $data = $this->m_pelayanan->getPreeklampsiaEarlyByID($this->get('id', true));
        $this->response($data, REST_Controller::HTTP_OK);
    }

    // PERT 3
    function hapus_preeklampsia_early_delete($id) {
        $this->db->trans_begin();

        // User yang menghapus (dari session / GET)
        $id_user_logs = $this->session->userdata('id_translucent') ?: $this->input->get('id_user');

        // Ambil data lama sebelum dihapus
        $lama = $this->db->get_where('sm_preeklampsia_early', ['id' => $id])->row_array();
        if ($lama) {
            $log = $lama;
            unset($log['id']); // hilangkan ID asli

            // Pemilik data awal
            $log['id_user']      = $lama['id_user'];
            // User yang menghapus
            $log['id_user_logs'] = $id_user_logs;

            $log['keterangan'] = 'Delete';
            // $log['created_at'] = date('Y-m-d H:i:s');

            $log['created_at'] = $lama['created_at'];

            $log['updated_at'] = date('Y-m-d H:i:s');

            $this->m_pelayanan->insertLogsdeletePreeklampsiaEarly($log);
        }

        // Hapus data utama
        $status = $this->m_pelayanan->deletePreeklampsiaEarly($id);

        if ($this->db->trans_status() === false || !$status) {
            $this->db->trans_rollback();
            $response = array('status' => false, 'message' => 'Gagal menghapus data!');
        } else {
            $this->db->trans_commit();
            $response = array('status' => true, 'message' => 'Berhasil menghapus data!');
        }

        $this->response($response, REST_Controller::HTTP_OK);
    }

    // PERT 5
    function update_preeklampsia_early_put() {
        $this->db->trans_begin();

        $id = $this->put('id', true);
        if (!$id) {
            $this->response(['status' => false], REST_Controller::HTTP_OK);
            return;
        }

        // Ambil data lama untuk log
        $lama = $this->db->get_where('sm_preeklampsia_early', ['id' => $id])->row_array();
        if ($lama) {
            $log = $lama;
            unset($log['id']);
            $log['id_user'] = $lama['id_user']; // simpan pemilik data awal
            $log['id_user_logs'] = $this->session->userdata('id_translucent') ?: $this->put('id_user'); // user yg edit
            $log['keterangan'] = 'Update';
            // $log['created_at'] = date('Y-m-d H:i:s');

            $log['created_at'] = $lama['created_at'];


            $log['updated_at'] = date('Y-m-d H:i:s');
            $this->m_pelayanan->insertLogsdeletePreeklampsiaEarly($log);
        }

        // Data untuk update (id_user asli tidak diubah)
        $data = [
            'id'             => $id,
            'tanggal_pert'   => date('Y-m-d', strtotime(str_replace('/', '-', $this->put('tanggal_pert', true)))),
            'jam_pert'       => $this->put('jam_pert', true) ?: null,
            'hijau_1'  => $this->put('hijau_1_', true) ?: null,
            'kuning_1' => $this->put('kuning_1_', true) ?: null,
            'merah_1'  => $this->put('merah_1_', true) ?: null,
            'hijau_2'  => $this->put('hijau_2_', true) ?: null,
            'kuning_2' => $this->put('kuning_2_', true) ?: null,
            'merah_2'  => $this->put('merah_2_', true) ?: null,
            'hijau_3'  => $this->put('hijau_3_', true) ?: null,
            'kuning_3' => $this->put('kuning_3_', true) ?: null,
            'merah_3'  => $this->put('merah_3_', true) ?: null,
            'hijau_4'  => $this->put('hijau_4_', true) ?: null,
            'kuning_4' => $this->put('kuning_4_', true) ?: null,
            'merah_4'  => $this->put('merah_4_', true) ?: null,
            'hijau_5'  => $this->put('hijau_5_', true) ?: null,
            'kuning_5' => $this->put('kuning_5_', true) ?: null,
            'merah_5'  => $this->put('merah_5_', true) ?: null,
            'hijau_6'  => $this->put('hijau_6_', true) ?: null,
            'kuning_6' => $this->put('kuning_6_', true) ?: null,
            'merah_6'  => $this->put('merah_6_', true) ?: null,
            'hijau_7'  => $this->put('hijau_7_', true) ?: null,
            'kuning_7' => $this->put('kuning_7_', true) ?: null,
            'merah_7'  => $this->put('merah_7_', true) ?: null,
            'hijau_8'  => $this->put('hijau_8_', true) ?: null,
            'kuning_8' => $this->put('kuning_8_', true) ?: null,
            'merah_8'  => $this->put('merah_8_', true) ?: null,
            'hijau_9'  => $this->put('hijau_9_', true) ?: null,
            'kuning_9' => $this->put('kuning_9_', true) ?: null,
            'merah_9'  => $this->put('merah_9_', true) ?: null,
            'hijau_10'  => $this->put('hijau_10_', true) ?: null,
            'kuning_10' => $this->put('kuning_10_', true) ?: null,
            'merah_10'  => $this->put('merah_10_', true) ?: null,
            'hijau_11'  => $this->put('hijau_11_', true) ?: null,
            'kuning_11' => $this->put('kuning_11_', true) ?: null,
            'merah_11'  => $this->put('merah_11_', true) ?: null,
            'hijau_12'  => $this->put('hijau_12_', true) ?: null,
            'kuning_12' => $this->put('kuning_12_', true) ?: null,
            'merah_12'  => $this->put('merah_12_', true) ?: null,
            'hijau_13'  => $this->put('hijau_13_', true) ?: null,
            'kuning_13' => $this->put('kuning_13_', true) ?: null,
            'merah_13'  => $this->put('merah_13_', true) ?: null,
            'hijau_14'  => $this->put('hijau_14_', true) ?: null,
            'kuning_14' => $this->put('kuning_14_', true) ?: null,
            'merah_14'  => $this->put('merah_14_', true) ?: null,
            'hijau_15'  => $this->put('hijau_15_', true) ?: null,
            'kuning_15' => $this->put('kuning_15_', true) ?: null,
            'merah_15'  => $this->put('merah_15_', true) ?: null,
            'hijau_16'  => $this->put('hijau_16_', true) ?: null,
            'kuning_16' => $this->put('kuning_16_', true) ?: null,
            'merah_16'  => $this->put('merah_16_', true) ?: null,
            'hijau_17'  => $this->put('hijau_17_', true) ?: null,
            'kuning_17' => $this->put('kuning_17_', true) ?: null,
            'merah_17'  => $this->put('merah_17_', true) ?: null,
            'perawat_pert'  => $this->put('perawat_pert', true) ?: null,
            'updated_at'    => date('Y-m-d H:i:s'),
            'id_user'       => $this->session->userdata('id_translucent') ?: $this->put('id_user'), // fallback
        ];

        $this->db->where('id', $id);
        $status = $this->db->update('sm_preeklampsia_early', $data);

        if ($this->db->trans_status() === false) {
            $this->db->trans_rollback();
            $this->response(['status' => false], REST_Controller::HTTP_OK);
        } else {
            $this->db->trans_commit();
            $this->response(['status' => true], REST_Controller::HTTP_OK);
        }
    }
    
    // PERT 3
    // function hapus_preeklampsia_early_delete($id)
    // {
    //     $status = $this->m_pelayanan->deletePreeklampsiaEarly($id);
    //     if ($status) :
    //         $response = array('status' => $status, 'message' => 'Berhasil menghapus Preeklampsia Early Recognition Tool (PERT)!');
    //     else :
    //         $response = array('status' => $status, 'message' => 'Gagal menghapus Preeklampsia Early Recognition Tool (PERT)!');
    //     endif;
    //     $this->response($response, REST_Controller::HTTP_OK);
    // }

    // PERT INI DI KASIH _ NYA DARI EDIT CUMA DISINI DOANK YANG DIKASIH YANG LAINYA NORMAL
    // function update_preeklampsia_early_put()
    // {
    //     $id = $this->put('id', true);
    //     if (!$id) {
    //         $this->response(['status' => false], REST_Controller::HTTP_OK);
    //         return;
    //     }
    //     $data = [
    //         'id'             => $id,
    //         'tanggal_pert'   => date('Y-m-d', strtotime(str_replace('/', '-', $this->put('tanggal_pert', true)))),
    //         'jam_pert'       => $this->put('jam_pert', true) ?: null,
    //         'hijau_1'  => $this->put('hijau_1_', true) ?: null,
    //         'kuning_1' => $this->put('kuning_1_', true) ?: null,
    //         'merah_1'  => $this->put('merah_1_', true) ?: null,
    //         'hijau_2'  => $this->put('hijau_2_', true) ?: null,
    //         'kuning_2' => $this->put('kuning_2_', true) ?: null,
    //         'merah_2'  => $this->put('merah_2_', true) ?: null,
    //         'hijau_3'  => $this->put('hijau_3_', true) ?: null,
    //         'kuning_3' => $this->put('kuning_3_', true) ?: null,
    //         'merah_3'  => $this->put('merah_3_', true) ?: null,
    //         'hijau_4'  => $this->put('hijau_4_', true) ?: null,
    //         'kuning_4' => $this->put('kuning_4_', true) ?: null,
    //         'merah_4'  => $this->put('merah_4_', true) ?: null,
    //         'hijau_5'  => $this->put('hijau_5_', true) ?: null,
    //         'kuning_5' => $this->put('kuning_5_', true) ?: null,
    //         'merah_5'  => $this->put('merah_5_', true) ?: null,
    //         'hijau_6'  => $this->put('hijau_6_', true) ?: null,
    //         'kuning_6' => $this->put('kuning_6_', true) ?: null,
    //         'merah_6'  => $this->put('merah_6_', true) ?: null,
    //         'hijau_7'  => $this->put('hijau_7_', true) ?: null,
    //         'kuning_7' => $this->put('kuning_7_', true) ?: null,
    //         'merah_7'  => $this->put('merah_7_', true) ?: null,
    //         'hijau_8'  => $this->put('hijau_8_', true) ?: null,
    //         'kuning_8' => $this->put('kuning_8_', true) ?: null,
    //         'merah_8'  => $this->put('merah_8_', true) ?: null,
    //         'hijau_9'  => $this->put('hijau_9_', true) ?: null,
    //         'kuning_9' => $this->put('kuning_9_', true) ?: null,
    //         'merah_9'  => $this->put('merah_9_', true) ?: null,
    //         'hijau_10'  => $this->put('hijau_10_', true) ?: null,
    //         'kuning_10' => $this->put('kuning_10_', true) ?: null,
    //         'merah_10'  => $this->put('merah_10_', true) ?: null,
    //         'hijau_11'  => $this->put('hijau_11_', true) ?: null,
    //         'kuning_11' => $this->put('kuning_11_', true) ?: null,
    //         'merah_11'  => $this->put('merah_11_', true) ?: null,
    //         'hijau_12'  => $this->put('hijau_12_', true) ?: null,
    //         'kuning_12' => $this->put('kuning_12_', true) ?: null,
    //         'merah_12'  => $this->put('merah_12_', true) ?: null,
    //         'hijau_13'  => $this->put('hijau_13_', true) ?: null,
    //         'kuning_13' => $this->put('kuning_13_', true) ?: null,
    //         'merah_13'  => $this->put('merah_13_', true) ?: null,
    //         'hijau_14'  => $this->put('hijau_14_', true) ?: null,
    //         'kuning_14' => $this->put('kuning_14_', true) ?: null,
    //         'merah_14'  => $this->put('merah_14_', true) ?: null,
    //         'hijau_15'  => $this->put('hijau_15_', true) ?: null,
    //         'kuning_15' => $this->put('kuning_15_', true) ?: null,
    //         'merah_15'  => $this->put('merah_15_', true) ?: null,
    //         'hijau_16'  => $this->put('hijau_16_', true) ?: null,
    //         'kuning_16' => $this->put('kuning_16_', true) ?: null,
    //         'merah_16'  => $this->put('merah_16_', true) ?: null,
    //         'hijau_17'  => $this->put('hijau_17_', true) ?: null,
    //         'kuning_17' => $this->put('kuning_17_', true) ?: null,
    //         'merah_17'  => $this->put('merah_17_', true) ?: null,
    //         'perawat_pert'          => $this->put('perawat_pert', true) ?: null,
    //         'updated_at'    => date('Y-m-d H:i:s'),
    //     ];
    //     // var_dump($this->put('kuning_17', true));die;   
    //     $status = $this->m_pelayanan->editPreeklampsiaEarly($data);
    //     $this->response(['status' => $status], REST_Controller::HTTP_OK);
    // }





    // SAUIKR 1
    function get_data_skrining_admisi_uikr_get(){
        if (!$this->get('id_layanan_pendaftaran')) :
            $this->response(NULL, REST_Controller::HTTP_BAD_REQUEST); // (400)
        endif;
        $this->load->model('pendaftaran/Pendaftaran_model', 'm_pendaftaran');
        $this->load->model('pelayanan/Pelayanan_model', 'm_pelayanan');
        $data                               = $this->m_pendaftaran->getPendaftaranDetail($this->get('id', true), $this->get('id_layanan', true));
        $data['profil']                     = $this->m_pelayanan->getProfilPasien($data['pasien']->id_pasien);
        $data['skrining_admisi_uikr']         = $this->m_pelayanan->getSkriningAdmisiUikr($this->get('id', true));
        // $data['ds_manual_utama'] = [];
        // $ds_manual_utamas = $this->m_pelayanan->getDiagnosaManualUtama($this->get('id', true));
        // if (!empty($ds_manual_utamas)) {
        //     $data['ds_manual_utama'] = $ds_manual_utamas;
        // }

        if ($data) :
            $this->response($data, REST_Controller::HTTP_OK); // (200)
        endif;
        // var_dump('skrining_admisi_uikr');die;
    }

    // SAUIKR 2
    function simpan_data_skrining_admisi_uikr_post(){
        $id_users = safe_post('id_user');
        $layanan = array('id' => safe_post('id_layanan_pendaftaran'));
        $pengkajian_date_skrining_admisi_uikr = safe_post('pengkajian_date_skrining_admisi_uikr');
        // KALAU GA ADA IINI PASTI EROR
        $id_pendaftaran           = safe_post('id_pendaftaran');
        if (!empty($pengkajian_date_skrining_admisi_uikr)) {
            $chek_data_sauikr = array(
                'id_pendaftaran'            => $id_pendaftaran,
                'id_layanan_pendaftaran'    => $layanan['id'],
                'id_user'                   => safe_post('user_skrining_admisi_uikr') !== '' ? safe_post('user_skrining_admisi_uikr') : null,
                'tanggal_sauikr'            => safe_post('tanggal_sauikr') !== '' ? safe_post('tanggal_sauikr') : null,
                'jam_sauikr'                => safe_post('jam_sauikr') !== '' ? safe_post('jam_sauikr') : null,
                'diagnosa_sauikr'           => safe_post('diagnosa_sauikr') !== '' ? safe_post('diagnosa_sauikr') : null,
                'jenispersalinan_sauikr'    => safe_post('jenispersalinan_sauikr') !== '' ? safe_post('jenispersalinan_sauikr') : null,
                'aspekmaternal1'      => safe_post('aspekmaternal1')      !== '' ? safe_post('aspekmaternal1') : NULL,
                'aspekmaternal2'      => safe_post('aspekmaternal2')      !== '' ? safe_post('aspekmaternal2') : NULL,
                'aspekmaternal3'      => safe_post('aspekmaternal3')      !== '' ? safe_post('aspekmaternal3') : NULL,
                'aspekmaternal4'      => safe_post('aspekmaternal4')      !== '' ? safe_post('aspekmaternal4') : NULL,
                'aspekmaternal5'      => safe_post('aspekmaternal5')      !== '' ? safe_post('aspekmaternal5') : NULL,
                'aspekmaternal6'      => safe_post('aspekmaternal6')      !== '' ? safe_post('aspekmaternal6') : NULL,
                'aspekmaternal7'      => safe_post('aspekmaternal7')      !== '' ? safe_post('aspekmaternal7') : NULL,
                'aspekjanin1'      => safe_post('aspekjanin1')      !== '' ? safe_post('aspekjanin1') : NULL,
                'aspekjanin2'      => safe_post('aspekjanin2')      !== '' ? safe_post('aspekjanin2') : NULL,
                'aspekjanin3'      => safe_post('aspekjanin3')      !== '' ? safe_post('aspekjanin3') : NULL,
                'aspekjanin4'      => safe_post('aspekjanin4')      !== '' ? safe_post('aspekjanin4') : NULL,
                'aspekjanin5'      => safe_post('aspekjanin5')      !== '' ? safe_post('aspekjanin5') : NULL,
                'aspekjanin6'      => safe_post('aspekjanin6')      !== '' ? safe_post('aspekjanin6') : NULL,
                'aspekjanin7'      => safe_post('aspekjanin7')      !== '' ? safe_post('aspekjanin7') : NULL,
                'aspekjanin8'      => safe_post('aspekjanin8')      !== '' ? safe_post('aspekjanin8') : NULL,
                'aspekjanin9'      => safe_post('aspekjanin9')      !== '' ? safe_post('aspekjanin9') : NULL,
                'aspekjanin10'     => safe_post('aspekjanin10')     !== '' ? safe_post('aspekjanin10') : NULL,
                'aspekpenyulitpersalinan1'      => safe_post('aspekpenyulitpersalinan1')      !== '' ? safe_post('aspekpenyulitpersalinan1') : NULL,
                'aspekpenyulitpersalinan2'      => safe_post('aspekpenyulitpersalinan2')      !== '' ? safe_post('aspekpenyulitpersalinan2') : NULL,
                'aspekpenyulitpersalinan3'      => safe_post('aspekpenyulitpersalinan3')      !== '' ? safe_post('aspekpenyulitpersalinan3') : NULL,
                'aspekpenyulitpersalinan4'      => safe_post('aspekpenyulitpersalinan4')      !== '' ? safe_post('aspekpenyulitpersalinan4') : NULL,
                'aspekpenyulitpersalinan5'      => safe_post('aspekpenyulitpersalinan5')      !== '' ? safe_post('aspekpenyulitpersalinan5') : NULL,
                'aspekpenyulitpersalinan6'      => safe_post('aspekpenyulitpersalinan6')      !== '' ? safe_post('aspekpenyulitpersalinan6') : NULL,
                'aspekpenyulitpersalinan7'      => safe_post('aspekpenyulitpersalinan7')      !== '' ? safe_post('aspekpenyulitpersalinan7') : NULL,
                'aspekpenyulitpersalinan8'      => safe_post('aspekpenyulitpersalinan8')      !== '' ? safe_post('aspekpenyulitpersalinan8') : NULL,
                'aspekpenyulitpersalinan9'      => safe_post('aspekpenyulitpersalinan9')      !== '' ? safe_post('aspekpenyulitpersalinan9') : NULL,
                'aspekpenyulitpersalinan10'     => safe_post('aspekpenyulitpersalinan10')      !== '' ? safe_post('aspekpenyulitpersalinan10') : NULL,
                'aspekpenyulitpersalinan11'     => safe_post('aspekpenyulitpersalinan11')      !== '' ? safe_post('aspekpenyulitpersalinan11') : NULL,
                'aspekpenyulitpersalinan12'     => safe_post('aspekpenyulitpersalinan12')      !== '' ? safe_post('aspekpenyulitpersalinan12') : NULL,
                'aspekpenyulitpersalinan13'     => safe_post('aspekpenyulitpersalinan13')      !== '' ? safe_post('aspekpenyulitpersalinan13') : NULL,
                'aspekpenyulitpersalinan14'     => safe_post('aspekpenyulitpersalinan14')      !== '' ? safe_post('aspekpenyulitpersalinan14') : NULL,
                'aspekpenyulitpersalinan15'     => safe_post('aspekpenyulitpersalinan15')      !== '' ? safe_post('aspekpenyulitpersalinan15') : NULL,
                'aspekpenyulitpersalinan16'     => safe_post('aspekpenyulitpersalinan16')      !== '' ? safe_post('aspekpenyulitpersalinan16') : NULL,
                'aspekpenyulitpersalinan17'     => safe_post('aspekpenyulitpersalinan17')      !== '' ? safe_post('aspekpenyulitpersalinan17') : NULL,
                'aspekpenyulitpersalinan18'     => safe_post('aspekpenyulitpersalinan18')      !== '' ? safe_post('aspekpenyulitpersalinan18') : NULL,
                'aspekpenyulitpersalinan19'     => safe_post('aspekpenyulitpersalinan19')      !== '' ? safe_post('aspekpenyulitpersalinan19') : NULL,
                'jikaresikorendah1'      => safe_post('jikaresikorendah1')      !== '' ? safe_post('jikaresikorendah1') : NULL,
                'jikaresikorendah2'      => safe_post('jikaresikorendah2')      !== '' ? safe_post('jikaresikorendah2') : NULL,
                'jikaresikosedang1'      => safe_post('jikaresikosedang1')      !== '' ? safe_post('jikaresikosedang1') : NULL,
                'jikaresikosedang2'      => safe_post('jikaresikosedang2')      !== '' ? safe_post('jikaresikosedang2') : NULL,
                'jikaresikotinggi1'      => safe_post('jikaresikotinggi1')      !== '' ? safe_post('jikaresikotinggi1') : NULL,
                'jikaresikotinggi2'      => safe_post('jikaresikotinggi2')      !== '' ? safe_post('jikaresikotinggi2') : NULL,
                'jikaresikorendah3'      => safe_post('jikaresikorendah3')      !== '' ? safe_post('jikaresikorendah3') : NULL,
                'jikaresikorendah4'      => safe_post('jikaresikorendah4')      !== '' ? safe_post('jikaresikorendah4') : NULL,
                'perawatsauikr'          => safe_post('perawatsauikr')             !== '' ? safe_post('perawatsauikr') : NULL,
                'date_created'           => safe_post('pengkajian_date_skrining_admisi_uikr') !== '' ? safe_post('pengkajian_date_skrining_admisi_uikr') : null,
            );
            // var_dump($chek_data_sauikr);die;                      
            $this->m_pelayanan->insertSkriningAdmisiUikr($chek_data_sauikr);
        }
        if (!empty($respon)) {
            $response = $respon;
        } else {
            $response = null;
        }
        if ($this->db->trans_status() === false) :
            $this->db->trans_rollback();
            $status = false;
        else :
            $this->db->trans_commit();
            $status = true;
        endif;

        $message = array(
            'status' => $status,
            'token'  => $this->security->get_csrf_hash(),
            'id_pendaftaran' => ('id_pendaftaran'),
            'id_layanan_pendaftaran' => ('id_layanan_pendaftaran'),
            'respon' => $response,
        );
        $this->response($message, REST_Controller::HTTP_OK);
    }

    // SAUIKR 4
    function get_edit_skrining_admisi_uikr_get(){
        if (!$this->get('id', true)) :
            $this->response(null, REST_Controller::HTTP_BAD_REQUEST);
        endif;
        $data = $this->m_pelayanan->getSkriningAdmisiUikrByID($this->get('id', true));
        $this->response($data, REST_Controller::HTTP_OK);
    }

    // SAUIKR 3
    function hapus_skrining_admisi_uikr_delete($id) {
        $this->db->trans_begin();

        // User yang menghapus (dari session / GET)
        $id_user_logs = $this->session->userdata('id_translucent') ?: $this->input->get('id_user');

        // Ambil data lama sebelum dihapus
        $lama = $this->db->get_where('sm_skrining_admisi_uikr', ['id' => $id])->row_array();
        if ($lama) {
            $log = $lama;
            unset($log['id']); // hilangkan ID asli

            // Pemilik data awal
            $log['id_user']      = $lama['id_user'];
            // User yang menghapus
            $log['id_user_logs'] = $id_user_logs;

            $log['keterangan'] = 'Delete';
            // $log['created_at'] = date('Y-m-d H:i:s');

            $log['created_at'] = $lama['created_at'];

            $log['updated_at'] = date('Y-m-d H:i:s');

            $this->m_pelayanan->insertLogsSkriningAdmisiUikr($log);
        }

        // Hapus data utama
        $status = $this->m_pelayanan->deleteSkriningAdmisiUikr($id);

        if ($this->db->trans_status() === false || !$status) {
            $this->db->trans_rollback();
            $response = array('status' => false, 'message' => 'Gagal menghapus data!');
        } else {
            $this->db->trans_commit();
            $response = array('status' => true, 'message' => 'Berhasil menghapus data!');
        }

        $this->response($response, REST_Controller::HTTP_OK);
    }

    // SAUIKR 5
    function update_skrining_admisi_uikr_put() {
        $this->db->trans_begin();

        $id = $this->put('id', true);
        if (!$id) {
            $this->response(['status' => false], REST_Controller::HTTP_OK);
            return;
        }

        // Ambil data lama untuk log
        $lama = $this->db->get_where('sm_skrining_admisi_uikr', ['id' => $id])->row_array();
        if ($lama) {
            $log = $lama;
            unset($log['id']);
            $log['id_user'] = $lama['id_user']; // simpan pemilik data awal
            $log['id_user_logs'] = $this->session->userdata('id_translucent') ?: $this->put('id_user'); // user yg edit
            $log['keterangan'] = 'Update';
            // $log['created_at'] = date('Y-m-d H:i:s');

            $log['created_at'] = $lama['created_at'];


            $log['updated_at'] = date('Y-m-d H:i:s');
            $this->m_pelayanan->insertLogsSkriningAdmisiUikr($log);
        }

        // Data untuk update (id_user asli tidak diubah)

        $data = [
            'id'                     => $id,
            'tanggal_sauikr'         => date('Y-m-d', strtotime(str_replace('/', '-', $this->put('tanggal_sauikr', true)))),
            'jam_sauikr'             => $this->put('jam_sauikr', true) ?: null,
            'diagnosa_sauikr'        => $this->put('diagnosa_sauikr', true) ?: null,
            'jenispersalinan_sauikr' => $this->put('jenispersalinan_sauikr', true) ?: null,
            'aspekmaternal1'  => $this->put('aspekmaternal1', true) ?: null,
            'aspekmaternal2'  => $this->put('aspekmaternal2', true) ?: null,
            'aspekmaternal3'  => $this->put('aspekmaternal3', true) ?: null,
            'aspekmaternal4'  => $this->put('aspekmaternal4', true) ?: null,
            'aspekmaternal5'  => $this->put('aspekmaternal5', true) ?: null,
            'aspekmaternal6'  => $this->put('aspekmaternal6', true) ?: null,
            'aspekmaternal7'  => $this->put('aspekmaternal7', true) ?: null,
            'aspekjanin1'  => $this->put('aspekjanin1', true) ?: null,
            'aspekjanin2'  => $this->put('aspekjanin2', true) ?: null,
            'aspekjanin3'  => $this->put('aspekjanin3', true) ?: null,
            'aspekjanin4'  => $this->put('aspekjanin4', true) ?: null,
            'aspekjanin5'  => $this->put('aspekjanin5', true) ?: null,
            'aspekjanin6'  => $this->put('aspekjanin6', true) ?: null,
            'aspekjanin7'  => $this->put('aspekjanin7', true) ?: null,
            'aspekjanin8'  => $this->put('aspekjanin8', true) ?: null,
            'aspekjanin9'  => $this->put('aspekjanin9', true) ?: null,
            'aspekjanin10'  => $this->put('aspekjanin10', true) ?: null,
            'aspekpenyulitpersalinan1'  => $this->put('aspekpenyulitpersalinan1', true) ?: null,
            'aspekpenyulitpersalinan2'  => $this->put('aspekpenyulitpersalinan2', true) ?: null,
            'aspekpenyulitpersalinan3'  => $this->put('aspekpenyulitpersalinan3', true) ?: null,
            'aspekpenyulitpersalinan4'  => $this->put('aspekpenyulitpersalinan4', true) ?: null,
            'aspekpenyulitpersalinan5'  => $this->put('aspekpenyulitpersalinan5', true) ?: null,
            'aspekpenyulitpersalinan6'  => $this->put('aspekpenyulitpersalinan6', true) ?: null,
            'aspekpenyulitpersalinan7'  => $this->put('aspekpenyulitpersalinan7', true) ?: null,
            'aspekpenyulitpersalinan8'  => $this->put('aspekpenyulitpersalinan8', true) ?: null,
            'aspekpenyulitpersalinan9'  => $this->put('aspekpenyulitpersalinan9', true) ?: null,
            'aspekpenyulitpersalinan10'  => $this->put('aspekpenyulitpersalinan10', true) ?: null,
            'aspekpenyulitpersalinan11'  => $this->put('aspekpenyulitpersalinan11', true) ?: null,
            'aspekpenyulitpersalinan12'  => $this->put('aspekpenyulitpersalinan12', true) ?: null,
            'aspekpenyulitpersalinan13'  => $this->put('aspekpenyulitpersalinan13', true) ?: null,
            'aspekpenyulitpersalinan14'  => $this->put('aspekpenyulitpersalinan14', true) ?: null,
            'aspekpenyulitpersalinan15'  => $this->put('aspekpenyulitpersalinan15', true) ?: null,
            'aspekpenyulitpersalinan16'  => $this->put('aspekpenyulitpersalinan16', true) ?: null,
            'aspekpenyulitpersalinan17'  => $this->put('aspekpenyulitpersalinan17', true) ?: null,
            'aspekpenyulitpersalinan18'  => $this->put('aspekpenyulitpersalinan18', true) ?: null,
            'aspekpenyulitpersalinan19'  => $this->put('aspekpenyulitpersalinan19', true) ?: null,
            'jikaresikorendah1'  => $this->put('jikaresikorendah1', true) ?: null,
            'jikaresikorendah2'  => $this->put('jikaresikorendah2', true) ?: null,
            'jikaresikosedang1'  => $this->put('jikaresikosedang1', true) ?: null,
            'jikaresikosedang2'  => $this->put('jikaresikosedang2', true) ?: null,
            'jikaresikotinggi1'  => $this->put('jikaresikotinggi1', true) ?: null,
            'jikaresikotinggi2'  => $this->put('jikaresikotinggi2', true) ?: null,
            'jikaresikorendah3'  => $this->put('jikaresikorendah3', true) ?: null,
            'jikaresikorendah4'  => $this->put('jikaresikorendah4', true) ?: null,
            'perawatsauikr'      => $this->put('perawatsauikr', true) ?: null,
            'updated_at'         => date('Y-m-d H:i:s'),
            'id_user'       => $this->session->userdata('id_translucent') ?: $this->put('id_user'), // fallback
        ];

        $this->db->where('id', $id);
        $status = $this->db->update('sm_skrining_admisi_uikr', $data);

        if ($this->db->trans_status() === false) {
            $this->db->trans_rollback();
            $this->response(['status' => false], REST_Controller::HTTP_OK);
        } else {
            $this->db->trans_commit();
            $this->response(['status' => true], REST_Controller::HTTP_OK);
        }
    }


    // // SAUIKR 3
    // function hapus_skrining_admisi_uikr_delete($id)
    // {
    //     $status = $this->m_pelayanan->deleteSkriningAdmisiUikr($id);
    //     if ($status) :
    //         $response = array('status' => $status, 'message' => 'Berhasil menghapus Skrining Admisi Untuk Identifikasi Kebutuhan Resusitasi!');
    //     else :
    //         $response = array('status' => $status, 'message' => 'Gagal menghapus Skrining Admisi Untuk Identifikasi Kebutuhan Resusitasi!');
    //     endif;
    //     $this->response($response, REST_Controller::HTTP_OK);
    // }

    // // KALAU YANG INI BEDA SAUIKR INI DI KASIH _ NYA PAS DI  EDIT MALAH GA BISA HARUS DI HILANGKAN SPASI
    // function update_skrining_admisi_uikr_put()
    // {
    //     $id = $this->put('id', true);
    //     if (!$id) {
    //         $this->response(['status' => false], REST_Controller::HTTP_OK);
    //         return;
    //     }
    //     $data = [
    //         'id'                     => $id,
    //         'tanggal_sauikr'         => date('Y-m-d', strtotime(str_replace('/', '-', $this->put('tanggal_sauikr', true)))),
    //         'jam_sauikr'             => $this->put('jam_sauikr', true) ?: null,
    //         'diagnosa_sauikr'        => $this->put('diagnosa_sauikr', true) ?: null,
    //         'jenispersalinan_sauikr' => $this->put('jenispersalinan_sauikr', true) ?: null,
    //         'aspekmaternal1'  => $this->put('aspekmaternal1', true) ?: null,
    //         'aspekmaternal2'  => $this->put('aspekmaternal2', true) ?: null,
    //         'aspekmaternal3'  => $this->put('aspekmaternal3', true) ?: null,
    //         'aspekmaternal4'  => $this->put('aspekmaternal4', true) ?: null,
    //         'aspekmaternal5'  => $this->put('aspekmaternal5', true) ?: null,
    //         'aspekmaternal6'  => $this->put('aspekmaternal6', true) ?: null,
    //         'aspekmaternal7'  => $this->put('aspekmaternal7', true) ?: null,
    //         'aspekjanin1'  => $this->put('aspekjanin1', true) ?: null,
    //         'aspekjanin2'  => $this->put('aspekjanin2', true) ?: null,
    //         'aspekjanin3'  => $this->put('aspekjanin3', true) ?: null,
    //         'aspekjanin4'  => $this->put('aspekjanin4', true) ?: null,
    //         'aspekjanin5'  => $this->put('aspekjanin5', true) ?: null,
    //         'aspekjanin6'  => $this->put('aspekjanin6', true) ?: null,
    //         'aspekjanin7'  => $this->put('aspekjanin7', true) ?: null,
    //         'aspekjanin8'  => $this->put('aspekjanin8', true) ?: null,
    //         'aspekjanin9'  => $this->put('aspekjanin9', true) ?: null,
    //         'aspekjanin10'  => $this->put('aspekjanin10', true) ?: null,
    //         'aspekpenyulitpersalinan1'  => $this->put('aspekpenyulitpersalinan1', true) ?: null,
    //         'aspekpenyulitpersalinan2'  => $this->put('aspekpenyulitpersalinan2', true) ?: null,
    //         'aspekpenyulitpersalinan3'  => $this->put('aspekpenyulitpersalinan3', true) ?: null,
    //         'aspekpenyulitpersalinan4'  => $this->put('aspekpenyulitpersalinan4', true) ?: null,
    //         'aspekpenyulitpersalinan5'  => $this->put('aspekpenyulitpersalinan5', true) ?: null,
    //         'aspekpenyulitpersalinan6'  => $this->put('aspekpenyulitpersalinan6', true) ?: null,
    //         'aspekpenyulitpersalinan7'  => $this->put('aspekpenyulitpersalinan7', true) ?: null,
    //         'aspekpenyulitpersalinan8'  => $this->put('aspekpenyulitpersalinan8', true) ?: null,
    //         'aspekpenyulitpersalinan9'  => $this->put('aspekpenyulitpersalinan9', true) ?: null,
    //         'aspekpenyulitpersalinan10'  => $this->put('aspekpenyulitpersalinan10', true) ?: null,
    //         'aspekpenyulitpersalinan11'  => $this->put('aspekpenyulitpersalinan11', true) ?: null,
    //         'aspekpenyulitpersalinan12'  => $this->put('aspekpenyulitpersalinan12', true) ?: null,
    //         'aspekpenyulitpersalinan13'  => $this->put('aspekpenyulitpersalinan13', true) ?: null,
    //         'aspekpenyulitpersalinan14'  => $this->put('aspekpenyulitpersalinan14', true) ?: null,
    //         'aspekpenyulitpersalinan15'  => $this->put('aspekpenyulitpersalinan15', true) ?: null,
    //         'aspekpenyulitpersalinan16'  => $this->put('aspekpenyulitpersalinan16', true) ?: null,
    //         'aspekpenyulitpersalinan17'  => $this->put('aspekpenyulitpersalinan17', true) ?: null,
    //         'aspekpenyulitpersalinan18'  => $this->put('aspekpenyulitpersalinan18', true) ?: null,
    //         'aspekpenyulitpersalinan19'  => $this->put('aspekpenyulitpersalinan19', true) ?: null,
    //         'jikaresikorendah1'  => $this->put('jikaresikorendah1', true) ?: null,
    //         'jikaresikorendah2'  => $this->put('jikaresikorendah2', true) ?: null,
    //         'jikaresikosedang1'  => $this->put('jikaresikosedang1', true) ?: null,
    //         'jikaresikosedang2'  => $this->put('jikaresikosedang2', true) ?: null,
    //         'jikaresikotinggi1'  => $this->put('jikaresikotinggi1', true) ?: null,
    //         'jikaresikotinggi2'  => $this->put('jikaresikotinggi2', true) ?: null,
    //         'jikaresikorendah3'  => $this->put('jikaresikorendah3', true) ?: null,
    //         'jikaresikorendah4'  => $this->put('jikaresikorendah4', true) ?: null,
    //         'perawatsauikr'      => $this->put('perawatsauikr', true) ?: null,
    //         'updated_at'         => date('Y-m-d H:i:s'),
    //     ];
    //     // var_dump($data);die;
    //     $status = $this->m_pelayanan->editSkriningAdmisiUikr($data);
    //     $this->response(['status' => $status], REST_Controller::HTTP_OK);
    // }








  













    function set_pasca_ranap_get()
    {
        if (!$this->get('id')) :
            $this->response(NULL, REST_Controller::HTTP_BAD_REQUEST); // (400)
        endif;

        $data = $this->m_pelayanan->setPascaRanap($this->get('id', true));

        if ($data) :
            $this->response($data, REST_Controller::HTTP_OK); // (200)
        endif;
    }


    function check_resep_2_minggu_sebelum_get()
    {
        $id_pasien = safe_get('id_pasien');
        $id_barang = safe_get('id_barang');

        $data = $this->db->query("
		select rrd.id_barang, r.tanggal_resep::date, b.nama_lengkap, rrd.jumlah_pakai
		from sm_resep r
		join sm_resep_r rr on r.id = rr.id_resep
		join sm_resep_r_detail rrd on rr.id = rrd.id_resep_r
		join sm_barang b on rrd.id_barang = b.id
		where id_pasien = '$id_pasien'
		and tanggal_resep::date between (now() - interval '2 week')::date and now()::date
		and rrd.id_barang = $id_barang
        and b.id_kategori = 1
		and b.is_obat_kronis = '1'
		order by r.id desc
		limit 1
		")->row();

        if (!empty($data)) {
            $this->response([
                'status' => true,
                'tanggal_resep' => $data->tanggal_resep,
                'nama_barang' => $data->nama_lengkap,
                'jumlah_pakai' => $data->jumlah_pakai
            ], REST_Controller::HTTP_OK);
            return;
        }

        $this->response(['status' => false], REST_Controller::HTTP_OK);
    }

    function check_layanan_pasien_get()
    {
        $id_layanan_pendaftaran = safe_get('id_layanan_pendaftaran');

        $data = $this->db->get_where('sm_layanan_pendaftaran', ['id' => $id_layanan_pendaftaran])->row();

        $this->response(['status' => $data->jenis_layanan === 'Poliklinik'], REST_Controller::HTTP_OK);
    }













                
    // GRAFIK PARTOLOGI // GRAFIK SERVIKS // CP // TABEL // GRAFIK NT 
    function get_data_partograf_get(){
        if (!$this->get('id_layanan_pendaftaran')) :
            $this->response(NULL, REST_Controller::HTTP_BAD_REQUEST); // (400)
        endif;
        $this->load->model('pendaftaran/Pendaftaran_model', 'm_pendaftaran'); 
        $this->load->model('pelayanan/Pelayanan_model', 'm_pelayanan');
        $data                                   = $this->m_pendaftaran->getPendaftaranDetail($this->get('id', true), $this->get('id_layanan', true));
        $data['profil']                         = $this->m_pelayanan->getProfilPasien($data['pasien']->id_pasien);
        $data['grafik_partograf']               = $this->m_pelayanan->getGrafikPartograf($this->get('id', true));
        $data['grafik_serviks']                 = $this->m_pelayanan->getGrafikServiks($this->get('id', true));
        $data['grafik_nt']                      = $this->m_pelayanan->getGrafikNT($this->get('id', true));
        $data['catatan_persalinan']             = $this->m_pelayanan->getCatatanPersalinan($this->get('id', true));
        $data['catatan_persalinan_logs']        = $this->m_pelayanan->getCatatanPersalinanLogs($this->get('id', true));
        // $data['tabel_pemantauan_vi']            = $this->m_pelayanan->getTabel($this->get('id', true));
        if ($data) :
            $this->response($data, REST_Controller::HTTP_OK); // (200)
        endif;
    }
 
    // GRAFIK PARTOLOGI
    function simpan_grafik_partograf_post(){
        $data = array(
                    'id_layanan_pendaftaran'    => safe_post('id_layanan_pendaftaran'),
                    'id_pendaftaran'            => safe_post('id_pendaftaran'),
                    'id_user'                   => safe_post('id_user'),                  
                    'denyut_partograf'        	=> safe_post('denyut') !== '' ? safe_post('denyut') : null,
                );
                // var_dump($data);die;
        $this->m_pelayanan->insertGrafikPartograf($data);
        $data = $this->m_pelayanan->getGrafikPartograf($data['id_pendaftaran']);
        $this->response($data, REST_Controller::HTTP_OK);      
    }

    // GRAFIK PARTOLOGI LOG
    function update_grafik_partograf_post(){
        $id = safe_post('id');
    
        // Cek apakah data lama tersedia
        $lama = $this->db->get_where('sm_grafik_partograf', ['id' => $id])->row_array();
        if ($lama) {
            // Cek apakah denyut lama sama dengan yang baru
            $denyut_baru = safe_post('denyut_edit');
    
            if ($lama['denyut_partograf'] != $denyut_baru) {
                // Simpan ke log hanya jika ada perubahan
                $log = $lama;
                unset($log['id']); // supaya gak konflik PK
                $log['created_at'] = date('Y-m-d H:i:s'); // waktu simpan log
                $log['keterangan'] = 'Update'; // Boleh ditambahin biar tahu asalnya dari Update
                $this->m_pelayanan->insertLogGrafikPartograf($log);
            }
        }
        
        // Siapkan data untuk update
        $data = array(
            'id'                       => $id,
            'id_layanan_pendaftaran'   => safe_post('id_layanan_pendaftaran'),
            'id_pendaftaran'           => safe_post('id_pendaftaran'),
            'id_user'                  => safe_post('id_user'),
            'denyut_partograf'         => safe_post('denyut_edit'),
            'updated_at'               => date('Y-m-d H:i:s'),
        );
    
        $this->m_pelayanan->updateGrafikPartograf($data);
    
        // Ambil data terbaru
        $updatedData = $this->m_pelayanan->getGrafikPartograf($data['id_pendaftaran']);
    
        // Kirim response
        $this->response($updatedData, REST_Controller::HTTP_OK);
    }

    // GRAFIK PARTOLOGI LOGS
    function hapus_grafik_partograf_delete($id, $id_layanan_pendaftaran, $id_pendaftaran){
        // Ambil data sebelum dihapus
        $lama = $this->db->get_where('sm_grafik_partograf', ['id' => $id])->row_array();
    
        if ($lama) {
            // Simpan ke log
            $log = $lama;
            unset($log['id']); // Hindari konflik primary key
            $log['created_at'] = date('Y-m-d H:i:s');
            $log['keterangan'] = 'hapus'; // Boleh ditambahin biar tahu asalnya dari hapus
            $this->m_pelayanan->insertLogGrafikPartograf($log);
        }
    
        // Lakukan penghapusan
        $this->m_pelayanan->deleteGrafikPartograf($id);
    
        // Ambil data terbaru
        $data = $this->m_pelayanan->getGrafikPartograf($id_pendaftaran);
        $this->response($data, REST_Controller::HTTP_OK);
    }

    // GRAFIK PARTOLOGI
    function get_grafik_partograf_by_id_get($id){
        $data = $this->m_pelayanan->getGrafikPartografByID($id);
        $this->response($data, REST_Controller::HTTP_OK);
    }

    // GRAFIK SERVIKS
    function simpan_grafik_serviks_post(){
        $data = array(
                    'id_layanan_pendaftaran'    => safe_post('id_layanan_pendaftaran'),
                    'id_pendaftaran'            => safe_post('id_pendaftaran'),
                    'id_user'                   => safe_post('id_user'),                  
                    'number_serviks'        	=> safe_post('Number') !== '' ? safe_post('Number') : null,
                    'pembukaan_serviks'        	=> safe_post('Serviks') !== '' ? safe_post('Serviks') : null,
                    'kepala_serviks'        	=> safe_post('Kepala') !== '' ? safe_post('Kepala') : null,
                );
                // var_dump($data);die;
        $this->m_pelayanan->insertGrafikServiks($data);
        $data = $this->m_pelayanan->getGrafikServiks($data['id_pendaftaran']);
        $this->response($data, REST_Controller::HTTP_OK);      
    }

    // GRAFIK SERVIKS LOGS
    function update_grafik_serviks_post(){
        $id = safe_post('id');
    
        // Ambil data lama
        $lama = $this->db->get_where('sm_grafik_serviks', ['id' => $id])->row_array();
    
        // Ambil data baru dari POST
        $data_baru = array(
            'id'                       => $id,
            'id_layanan_pendaftaran'  => safe_post('id_layanan_pendaftaran'),
            'id_pendaftaran'          => safe_post('id_pendaftaran'),
            'id_user'                 => safe_post('id_user'),
            'number_serviks'          => safe_post('Number') !== '' ? safe_post('Number') : null,
            'pembukaan_serviks'       => safe_post('Serviks') !== '' ? safe_post('Serviks') : null,
            'kepala_serviks'          => safe_post('Kepala') !== '' ? safe_post('Kepala') : null,
            'updated_at'              => date('Y-m-d H:i:s'),
        );
    
        // Cek apakah ada perubahan dibanding data lama
        if ($lama) {
            $perubahan = false;
            foreach (['number_serviks', 'pembukaan_serviks', 'kepala_serviks'] as $key) {
                if ($lama[$key] != $data_baru[$key]) {
                    $perubahan = true;
                    break;
                }
            }
    
            if ($perubahan) {
                $log = $lama;
                unset($log['id']);
                $log['created_at'] = date('Y-m-d H:i:s');
                $log['keterangan'] = 'Update';
                $this->m_pelayanan->insertLogGrafikServiks($log);
            }
        }
    
        // Update data utama
        $this->m_pelayanan->updateGrafikServiks($data_baru);
    
        // Ambil data terbaru
        $updatedData = $this->m_pelayanan->getGrafikServiks($data_baru['id_pendaftaran']);
    
        // Kirim response
        $this->response($updatedData, REST_Controller::HTTP_OK);
    }

    // GRAFIK SERVIKS LOGS
    function hapus_grafik_serviks_delete($id, $id_layanan_pendaftaran, $id_pendaftaran){
        // Ambil data sebelum dihapus
        $lama = $this->db->get_where('sm_grafik_serviks', ['id' => $id])->row_array();
    
        if ($lama) {
            // Simpan ke log
            $log = $lama;
            unset($log['id']); // Hindari konflik primary key
            $log['created_at'] = date('Y-m-d H:i:s');
            $log['keterangan'] = 'hapus'; // Boleh ditambahin biar tahu asalnya dari hapus
            $this->m_pelayanan->insertLogGrafikServiks($log);
        }
    
        // Lakukan penghapusan
        $this->m_pelayanan->deleteGrafikServiks($id);
    
        // Ambil data terbaru
        $data = $this->m_pelayanan->getGrafikServiks($id_pendaftaran);
        $this->response($data, REST_Controller::HTTP_OK);
    }

    // GRAFIK SERVIKS
    function get_grafik_serviks_by_id_get($id){
        $data = $this->m_pelayanan->getGrafikServiksByID($id);
        $this->response($data, REST_Controller::HTTP_OK);
    }

    // GRAFIK NT
    function simpan_grafik_nt_post(){
        $data = array(
                    'id_layanan_pendaftaran'    => safe_post('id_layanan_pendaftaran'),
                    'id_pendaftaran'            => safe_post('id_pendaftaran'),
                    'id_user'                   => safe_post('id_user'),
                    'number_nt'        	        => safe_post('Nomert') !== '' ? safe_post('Nomert') : null,
                    'atas_nt'        	        => safe_post('Atas') !== '' ? safe_post('Atas') : null,
                    'nadi_nt'        	        => safe_post('Nadi') !== '' ? safe_post('Nadi') : null,
                    'tekanan_nt'                => safe_post('Tekanan') !== '' ? safe_post('Tekanan') : null,
                    'tekanan_nt_3'              => safe_post('TekananA') !== '' ? safe_post('TekananA') : null,
                    'tekanan_nt_4'              => safe_post('TekananB') !== '' ? safe_post('TekananB') : null,
                    'tekanan_nt_5'              => safe_post('TekananC') !== '' ? safe_post('TekananC') : null,
                    'tekanan_nt_6'              => safe_post('TekananD') !== '' ? safe_post('TekananD') : null,
                    'tekanan_nt_7'              => safe_post('TekananE') !== '' ? safe_post('TekananE') : null,
                    'tekanan_nt_8'              => safe_post('TekananF') !== '' ? safe_post('TekananF') : null,
                );
                // var_dump($data);die;
        $this->m_pelayanan->insertGrafikNT($data);
        $data = $this->m_pelayanan->getGrafikNT($data['id_pendaftaran']);
        $this->response($data, REST_Controller::HTTP_OK);      
    }

    // GRAFIK NT LOGS
    function update_grafik_nt_post(){
        $id = safe_post('id');
    
        // Ambil data lama
        $lama = $this->db->get_where('sm_grafik_nt', ['id' => $id])->row_array();
    
        // Ambil data baru dari POST
        $data_baru = array(
            'id'                       => $id,
            'id_layanan_pendaftaran'  => safe_post('id_layanan_pendaftaran'),
            'id_pendaftaran'          => safe_post('id_pendaftaran'),
            'id_user'                 => safe_post('id_user'),
            'number_nt'        	        => safe_post('Nomert') !== '' ? safe_post('Nomert') : null,
            'atas_nt'        	        => safe_post('Atas') !== '' ? safe_post('Atas') : null,
            'nadi_nt'        	        => safe_post('Nadi') !== '' ? safe_post('Nadi') : null,
            'tekanan_nt'                => safe_post('Tekanan') !== '' ? safe_post('Tekanan') : null,
            'tekanan_nt_3'              => safe_post('TekananA') !== '' ? safe_post('TekananA') : null,
            'tekanan_nt_4'              => safe_post('TekananB') !== '' ? safe_post('TekananB') : null,
            'tekanan_nt_5'              => safe_post('TekananC') !== '' ? safe_post('TekananC') : null,
            'tekanan_nt_6'              => safe_post('TekananD') !== '' ? safe_post('TekananD') : null,
            'tekanan_nt_7'              => safe_post('TekananE') !== '' ? safe_post('TekananE') : null,
            'tekanan_nt_8'              => safe_post('TekananF') !== '' ? safe_post('TekananF') : null,
            'updated_at'              => date('Y-m-d H:i:s'),
        );
    
        // Cek apakah ada perubahan dibanding data lama
        if ($lama) {
            $perubahan = false;
            foreach (['number_nt', 'atas_nt', 'nadi_nt', 'tekanan_nt', 'tekanan_nt_3', 'tekanan_nt_4', 'tekanan_nt_5', 'tekanan_nt_6', 'tekanan_nt_7', 'tekanan_nt_8'] as $key) {
                if ($lama[$key] != $data_baru[$key]) {
                    $perubahan = true;
                    break;
                }
            }
    
            if ($perubahan) {
                $log = $lama;
                unset($log['id']);
                $log['created_at'] = date('Y-m-d H:i:s');
                $log['keterangan'] = 'Update';
                $this->m_pelayanan->insertLogGrafikNt($log);
            }
        }
    
        // Update data utama
        $this->m_pelayanan->updateGrafikNT($data_baru);
    
        // Ambil data terbaru
        $updatedData = $this->m_pelayanan->getGrafikNT($data_baru['id_pendaftaran']);
    
        // Kirim response
        $this->response($updatedData, REST_Controller::HTTP_OK);
    }

    // GRAFIK NT LOGS
    function hapus_grafik_nt_delete($id, $id_layanan_pendaftaran, $id_pendaftaran){
        // Ambil data sebelum dihapus
        $lama = $this->db->get_where('sm_grafik_nt', ['id' => $id])->row_array();
    
        if ($lama) {
            // Simpan ke log
            $log = $lama;
            unset($log['id']); // Hindari konflik primary key
            $log['created_at'] = date('Y-m-d H:i:s');
            $log['keterangan'] = 'hapus'; // Boleh ditambahin biar tahu asalnya dari hapus
            $this->m_pelayanan->insertLogGrafikNt($log);
        }
    
        // Lakukan penghapusan
        $this->m_pelayanan->deleteGrafikNT($id);
    
        // Ambil data terbaru
        $data = $this->m_pelayanan->getGrafikNT($id_pendaftaran);
        $this->response($data, REST_Controller::HTTP_OK);
    }

    // GRAFIK NT
    function get_grafik_nt_by_id_get($id){
        $data = $this->m_pelayanan->getGrafikNTByID($id);
        $this->response($data, REST_Controller::HTTP_OK);
    }

    // PARTOGRAF LOGS 
    function get_history_logs_catatan_persalinan_get(){
        if (!$this->get('id_layanan_pendaftaran', true)) :
            $this->response(NULL, REST_Controller::HTTP_BAD_REQUEST); // (400)
        endif;
        $id_layanan_pendaftaran = $this->get('id_layanan_pendaftaran', true);
        $data['catatan_persalinan_logs']       = $this->m_pelayanan->getCatatanPersalinanLogs($id_layanan_pendaftaran);
        if ($data) :
            $this->response($data, REST_Controller::HTTP_OK); // (200)
        endif;
    }

    // PARTOGRAF // CP // TABEL // WARNA
    function simpan_data_partograf_post(){      
        if (safe_post('id_layanan_pendaftaran') === '') :
            $this->response(NULL, REST_Controller::HTTP_BAD_REQUEST);
        endif;

        $id_layanan_pendaftaran = safe_post('id_layanan_pendaftaran');
        $id_pendaftaran = safe_post('id_pendaftaran');;
        $id_partograf = safe_post('id_partograf');
        $id_users = safe_post('id_user');

        $data_cp = array(		
            'id_layanan_pendaftaran' => $id_layanan_pendaftaran,
            'id_pendaftaran' => $id_pendaftaran,
            'id_users' => $id_users,

            'g_partograf'        	        => safe_post('g_partograf') !== '' ? safe_post('g_partograf') : null,
            'p_partograf'        	        => safe_post('p_partograf') !== '' ? safe_post('p_partograf') : null,
            'a_partograf'        	        => safe_post('a_partograf') !== '' ? safe_post('a_partograf') : null,
            'hamil_partograf'        	    => safe_post('hamil_partograf') !== '' ? safe_post('hamil_partograf') : null,
            'tgl_mulas_partograf'        	=> safe_post('tgl_mulas_partograf') !== '' ? safe_post('tgl_mulas_partograf') : null,
            'pukul_mulas_partograf'        	=> safe_post('pukul_mulas_partograf') !== '' ? safe_post('pukul_mulas_partograf') : null,
            'tgl_masuk_partograf'        	=> safe_post('tgl_masuk_partograf') !== '' ? safe_post('tgl_masuk_partograf') : null,
            'pukul_masuk_partograf'        	=> safe_post('pukul_masuk_partograf') !== '' ? safe_post('pukul_masuk_partograf') : null,
            'tbj_partograf'        	=> safe_post('tbj_partograf') !== '' ? safe_post('tbj_partograf') : null,
            'tgl_pecah_partograf'        	=> safe_post('tgl_pecah_partograf') !== '' ? safe_post('tgl_pecah_partograf') : null,
            'pukul_pecah_partograf'        	=> safe_post('pukul_pecah_partograf') !== '' ? safe_post('pukul_pecah_partograf') : null,

            // 'air_ket_penyusupan' => json_encode([
            //     'air_ket_penyusupan_1' => safe_post('air_ket_penyusupan_1') !== '' ? safe_post('air_ket_penyusupan_1') : null,
			// 	'air_ket_penyusupan_2' => safe_post('air_ket_penyusupan_2') !== '' ? safe_post('air_ket_penyusupan_2') : null,
			// 	'air_ket_penyusupan_3' => safe_post('air_ket_penyusupan_3') !== '' ? safe_post('air_ket_penyusupan_3') : null,
			// 	'air_ket_penyusupan_4' => safe_post('air_ket_penyusupan_4') !== '' ? safe_post('air_ket_penyusupan_4') : null,
			// 	'air_ket_penyusupan_5' => safe_post('air_ket_penyusupan_5') !== '' ? safe_post('air_ket_penyusupan_5') : null,
			// 	'air_ket_penyusupan_6' => safe_post('air_ket_penyusupan_6') !== '' ? safe_post('air_ket_penyusupan_6') : null,
			// 	'air_ket_penyusupan_7' => safe_post('air_ket_penyusupan_7') !== '' ? safe_post('air_ket_penyusupan_7') : null,
			// 	'air_ket_penyusupan_8' => safe_post('air_ket_penyusupan_8') !== '' ? safe_post('air_ket_penyusupan_8') : null,
			// 	'air_ket_penyusupan_9' => safe_post('air_ket_penyusupan_9') !== '' ? safe_post('air_ket_penyusupan_9') : null,
			// 	'air_ket_penyusupan_10' => safe_post('air_ket_penyusupan_10') !== '' ? safe_post('air_ket_penyusupan_10') : null,
			// 	'air_ket_penyusupan_11' => safe_post('air_ket_penyusupan_11') !== '' ? safe_post('air_ket_penyusupan_11') : null,
			// 	'air_ket_penyusupan_12' => safe_post('air_ket_penyusupan_12') !== '' ? safe_post('air_ket_penyusupan_12') : null,
			// 	'air_ket_penyusupan_13' => safe_post('air_ket_penyusupan_13') !== '' ? safe_post('air_ket_penyusupan_13') : null,
			// 	'air_ket_penyusupan_14' => safe_post('air_ket_penyusupan_14') !== '' ? safe_post('air_ket_penyusupan_14') : null,
			// 	'air_ket_penyusupan_15' => safe_post('air_ket_penyusupan_15') !== '' ? safe_post('air_ket_penyusupan_15') : null,
			// 	'air_ket_penyusupan_16' => safe_post('air_ket_penyusupan_16') !== '' ? safe_post('air_ket_penyusupan_16') : null,
			// 	'air_ket_penyusupan_17' => safe_post('air_ket_penyusupan_17') !== '' ? safe_post('air_ket_penyusupan_17') : null,
			// 	'air_ket_penyusupan_18' => safe_post('air_ket_penyusupan_18') !== '' ? safe_post('air_ket_penyusupan_18') : null,
			// 	'air_ket_penyusupan_19' => safe_post('air_ket_penyusupan_19') !== '' ? safe_post('air_ket_penyusupan_19') : null,
			// 	'air_ket_penyusupan_20' => safe_post('air_ket_penyusupan_20') !== '' ? safe_post('air_ket_penyusupan_20') : null,
			// 	// 'air_ket_penyusupan_21' => safe_post('air_ket_penyusupan_21') !== '' ? safe_post('air_ket_penyusupan_21') : null,
			// 	// 'air_ket_penyusupan_22' => safe_post('air_ket_penyusupan_22') !== '' ? safe_post('air_ket_penyusupan_22') : null,
			// 	// 'air_ket_penyusupan_23' => safe_post('air_ket_penyusupan_23') !== '' ? safe_post('air_ket_penyusupan_23') : null,
			// 	// 'air_ket_penyusupan_24' => safe_post('air_ket_penyusupan_24') !== '' ? safe_post('air_ket_penyusupan_24') : null,
            // ]),


            // 'air_ket_penyusupan' => json_encode([
            //     'air_ket_penyusupan_1' => safe_post('air_ket_penyusupan_1') !== '' ? safe_post('air_ket_penyusupan_1') : null,
			// 	'air_ket_penyusupan_2' => safe_post('air_ket_penyusupan_2') !== '' ? safe_post('air_ket_penyusupan_2') : null,
			// 	'air_ket_penyusupan_3' => safe_post('air_ket_penyusupan_3') !== '' ? safe_post('air_ket_penyusupan_3') : null,
			// 	'air_ket_penyusupan_4' => safe_post('air_ket_penyusupan_4') !== '' ? safe_post('air_ket_penyusupan_4') : null,
			// 	'air_ket_penyusupan_5' => safe_post('air_ket_penyusupan_5') !== '' ? safe_post('air_ket_penyusupan_5') : null,
			// 	'air_ket_penyusupan_6' => safe_post('air_ket_penyusupan_6') !== '' ? safe_post('air_ket_penyusupan_6') : null,
			// 	'air_ket_penyusupan_7' => safe_post('air_ket_penyusupan_7') !== '' ? safe_post('air_ket_penyusupan_7') : null,
			// 	'air_ket_penyusupan_8' => safe_post('air_ket_penyusupan_8') !== '' ? safe_post('air_ket_penyusupan_8') : null,
			// 	'air_ket_penyusupan_9' => safe_post('air_ket_penyusupan_9') !== '' ? safe_post('air_ket_penyusupan_9') : null,
			// 	'air_ket_penyusupan_10' => safe_post('air_ket_penyusupan_10') !== '' ? safe_post('air_ket_penyusupan_10') : null,
			// 	'air_ket_penyusupan_11' => safe_post('air_ket_penyusupan_11') !== '' ? safe_post('air_ket_penyusupan_11') : null,
			// 	'air_ket_penyusupan_12' => safe_post('air_ket_penyusupan_12') !== '' ? safe_post('air_ket_penyusupan_12') : null,
			// 	'air_ket_penyusupan_13' => safe_post('air_ket_penyusupan_13') !== '' ? safe_post('air_ket_penyusupan_13') : null,
			// 	'air_ket_penyusupan_14' => safe_post('air_ket_penyusupan_14') !== '' ? safe_post('air_ket_penyusupan_14') : null,
			// 	'air_ket_penyusupan_15' => safe_post('air_ket_penyusupan_15') !== '' ? safe_post('air_ket_penyusupan_15') : null,
			// 	'air_ket_penyusupan_16' => safe_post('air_ket_penyusupan_16') !== '' ? safe_post('air_ket_penyusupan_16') : null,
			// 	'air_ket_penyusupan_17' => safe_post('air_ket_penyusupan_17') !== '' ? safe_post('air_ket_penyusupan_17') : null,
			// 	'air_ket_penyusupan_18' => safe_post('air_ket_penyusupan_18') !== '' ? safe_post('air_ket_penyusupan_18') : null,
			// 	'air_ket_penyusupan_19' => safe_post('air_ket_penyusupan_19') !== '' ? safe_post('air_ket_penyusupan_19') : null,
			// 	'air_ket_penyusupan_20' => safe_post('air_ket_penyusupan_20') !== '' ? safe_post('air_ket_penyusupan_20') : null,
			// 	'air_ket_penyusupan_21' => safe_post('air_ket_penyusupan_21') !== '' ? safe_post('air_ket_penyusupan_21') : null,
			// 	'air_ket_penyusupan_22' => safe_post('air_ket_penyusupan_22') !== '' ? safe_post('air_ket_penyusupan_22') : null,
			// 	'air_ket_penyusupan_23' => safe_post('air_ket_penyusupan_23') !== '' ? safe_post('air_ket_penyusupan_23') : null,
			// 	'air_ket_penyusupan_24' => safe_post('air_ket_penyusupan_24') !== '' ? safe_post('air_ket_penyusupan_24') : null,
			// 	'air_ket_penyusupan_25' => safe_post('air_ket_penyusupan_25') !== '' ? safe_post('air_ket_penyusupan_25') : null,
			// 	'air_ket_penyusupan_26' => safe_post('air_ket_penyusupan_26') !== '' ? safe_post('air_ket_penyusupan_26') : null,
			// 	'air_ket_penyusupan_27' => safe_post('air_ket_penyusupan_27') !== '' ? safe_post('air_ket_penyusupan_27') : null,
			// 	'air_ket_penyusupan_28' => safe_post('air_ket_penyusupan_28') !== '' ? safe_post('air_ket_penyusupan_28') : null,
			// 	'air_ket_penyusupan_29' => safe_post('air_ket_penyusupan_29') !== '' ? safe_post('air_ket_penyusupan_29') : null,
			// 	'air_ket_penyusupan_30' => safe_post('air_ket_penyusupan_30') !== '' ? safe_post('air_ket_penyusupan_30') : null,
			// 	'air_ket_penyusupan_31' => safe_post('air_ket_penyusupan_31') !== '' ? safe_post('air_ket_penyusupan_31') : null,
			// 	'air_ket_penyusupan_32' => safe_post('air_ket_penyusupan_32') !== '' ? safe_post('air_ket_penyusupan_32') : null,
            // ]),


            'air_ket_penyusupan' => json_encode(array_reduce(range(1, 32), function ($carry, $i) {
                $key = "air_ket_penyusupan_$i";
                $value = safe_post($key);
                $carry[$key] = $value !== '' ? $value : null;
                return $carry;
            }, [])),

            'air_ketu_penyusupan' => json_encode(array_reduce(range(1, 32), function ($carry, $i) {
                $key = "air_ketu_penyusupan_$i";
                $value = safe_post($key);
                $carry[$key] = $value !== '' ? $value : null;
                return $carry;
            }, [])),



            // 'air_ketu_penyusupan' => json_encode([
            //     'air_ketu_penyusupan_1' => safe_post('air_ketu_penyusupan_1') !== '' ? safe_post('air_ketu_penyusupan_1') : null,
			// 	'air_ketu_penyusupan_2' => safe_post('air_ketu_penyusupan_2') !== '' ? safe_post('air_ketu_penyusupan_2') : null,
			// 	'air_ketu_penyusupan_3' => safe_post('air_ketu_penyusupan_3') !== '' ? safe_post('air_ketu_penyusupan_3') : null,
			// 	'air_ketu_penyusupan_4' => safe_post('air_ketu_penyusupan_4') !== '' ? safe_post('air_ketu_penyusupan_4') : null,
			// 	'air_ketu_penyusupan_5' => safe_post('air_ketu_penyusupan_5') !== '' ? safe_post('air_ketu_penyusupan_5') : null,
			// 	'air_ketu_penyusupan_6' => safe_post('air_ketu_penyusupan_6') !== '' ? safe_post('air_ketu_penyusupan_6') : null,
			// 	'air_ketu_penyusupan_7' => safe_post('air_ketu_penyusupan_7') !== '' ? safe_post('air_ketu_penyusupan_7') : null,
			// 	'air_ketu_penyusupan_8' => safe_post('air_ketu_penyusupan_8') !== '' ? safe_post('air_ketu_penyusupan_8') : null,
			// 	'air_ketu_penyusupan_9' => safe_post('air_ketu_penyusupan_9') !== '' ? safe_post('air_ketu_penyusupan_9') : null,
			// 	'air_ketu_penyusupan_10' => safe_post('air_ketu_penyusupan_10') !== '' ? safe_post('air_ketu_penyusupan_10') : null,
			// 	'air_ketu_penyusupan_11' => safe_post('air_ketu_penyusupan_11') !== '' ? safe_post('air_ketu_penyusupan_11') : null,
			// 	'air_ketu_penyusupan_12' => safe_post('air_ketu_penyusupan_12') !== '' ? safe_post('air_ketu_penyusupan_12') : null,
			// 	'air_ketu_penyusupan_13' => safe_post('air_ketu_penyusupan_13') !== '' ? safe_post('air_ketu_penyusupan_13') : null,
			// 	'air_ketu_penyusupan_14' => safe_post('air_ketu_penyusupan_14') !== '' ? safe_post('air_ketu_penyusupan_14') : null,
			// 	'air_ketu_penyusupan_15' => safe_post('air_ketu_penyusupan_15') !== '' ? safe_post('air_ketu_penyusupan_15') : null,
			// 	'air_ketu_penyusupan_16' => safe_post('air_ketu_penyusupan_16') !== '' ? safe_post('air_ketu_penyusupan_16') : null,
			// 	'air_ketu_penyusupan_17' => safe_post('air_ketu_penyusupan_17') !== '' ? safe_post('air_ketu_penyusupan_17') : null,
			// 	'air_ketu_penyusupan_18' => safe_post('air_ketu_penyusupan_18') !== '' ? safe_post('air_ketu_penyusupan_18') : null,
			// 	'air_ketu_penyusupan_19' => safe_post('air_ketu_penyusupan_19') !== '' ? safe_post('air_ketu_penyusupan_19') : null,
			// 	'air_ketu_penyusupan_20' => safe_post('air_ketu_penyusupan_20') !== '' ? safe_post('air_ketu_penyusupan_20') : null,
			// 	// 'air_ketu_penyusupan_21' => safe_post('air_ketu_penyusupan_21') !== '' ? safe_post('air_ketu_penyusupan_21') : null,
			// 	// 'air_ketu_penyusupan_22' => safe_post('air_ketu_penyusupan_22') !== '' ? safe_post('air_ketu_penyusupan_22') : null,
			// 	// 'air_ketu_penyusupan_23' => safe_post('air_ketu_penyusupan_23') !== '' ? safe_post('air_ketu_penyusupan_23') : null,
			// 	// 'air_ketu_penyusupan_24' => safe_post('air_ketu_penyusupan_24') !== '' ? safe_post('air_ketu_penyusupan_24') : null,
            // ]),

            // 'air_ketu_penyusupan' => json_encode(array_reduce(range(1, 32), function ($carry, $i) {
            //     $key = "air_ketu_penyusupan_$i";
            //     $value = safe_post($key);
            //     $carry[$key] = $value !== '' ? $value : null;
            //     return $carry;
            // }, [])),


            'tgl_cp' => safe_post('tgl_cp') !== '' ? safe_post('tgl_cp') : NULL,
            'bidan_cp' => safe_post('bidan_cp') !== '' ? safe_post('bidan_cp') : NULL,

            'tp_cp' => json_encode([
                'tp_cp_1' => safe_post('tp_cp_1') !== '' ? safe_post('tp_cp_1') : null,
				'tp_cp_2' => safe_post('tp_cp_2') !== '' ? safe_post('tp_cp_2') : null,
				'tp_cp_3' => safe_post('tp_cp_3') !== '' ? safe_post('tp_cp_3') : null,
				'tp_cp_4' => safe_post('tp_cp_4') !== '' ? safe_post('tp_cp_4') : null,
				'tp_cp_5' => safe_post('tp_cp_5') !== '' ? safe_post('tp_cp_5') : null,
				'tp_cp_6' => safe_post('tp_cp_6') !== '' ? safe_post('tp_cp_6') : null,
				'tp_cp_7' => safe_post('tp_cp_7') !== '' ? safe_post('tp_cp_7') : null,
				'tp_cp_8' => safe_post('tp_cp_8') !== '' ? safe_post('tp_cp_8') : null,
            ]),

            'alamat_cp' => safe_post('alamat_cp') !== '' ? safe_post('alamat_cp') : NULL,

            'catatan_cp' => json_encode([
                'catatan_cp_1' => safe_post('catatan_cp_1') !== '' ? safe_post('catatan_cp_1') : null,
				'catatan_cp_2' => safe_post('catatan_cp_2') !== '' ? safe_post('catatan_cp_2') : null,
				'catatan_cp_3' => safe_post('catatan_cp_3') !== '' ? safe_post('catatan_cp_3') : null,
				'catatan_cp_4' => safe_post('catatan_cp_4') !== '' ? safe_post('catatan_cp_4') : null,
				'catatan_cp_5' => safe_post('catatan_cp_5') !== '' ? safe_post('catatan_cp_5') : null,
            ]),

            'as_cp' => safe_post('as_cp') !== '' ? safe_post('as_cp') : NULL,
            'tr_cp' => safe_post('tr_cp') !== '' ? safe_post('tr_cp') : NULL,

            'juk_cp' => json_encode([
                'juk_cp_1' => safe_post('juk_cp_1') !== '' ? safe_post('juk_cp_1') : null,
				'juk_cp_2' => safe_post('juk_cp_2') !== '' ? safe_post('juk_cp_2') : null,
				'juk_cp_3' => safe_post('juk_cp_3') !== '' ? safe_post('juk_cp_3') : null,
				'juk_cp_4' => safe_post('juk_cp_4') !== '' ? safe_post('juk_cp_4') : null,
				'juk_cp_5' => safe_post('juk_cp_5') !== '' ? safe_post('juk_cp_5') : null,
				'juk_cp_6' => safe_post('juk_cp_6') !== '' ? safe_post('juk_cp_6') : null,
            ]),

            'mas_cp' => json_encode([
                'mas_cp_1' => safe_post('mas_cp_1') !== '' ? safe_post('mas_cp_1') : null,
				'mas_cp_2' => safe_post('mas_cp_2') !== '' ? safe_post('mas_cp_2') : null,
				'mas_cp_3' => safe_post('mas_cp_3') !== '' ? safe_post('mas_cp_3') : null,
				'mas_cp_4' => safe_post('mas_cp_4') !== '' ? safe_post('mas_cp_4') : null,
				'mas_cp_5' => safe_post('mas_cp_5') !== '' ? safe_post('mas_cp_5') : null,
            ]),

            'part_cp' => safe_post('part_cp') !== '' ? safe_post('part_cp') : NULL,
            'kan_cp' => safe_post('kan_cp') !== '' ? safe_post('kan_cp') : NULL,
            'but_cp' => safe_post('but_cp') !== '' ? safe_post('but_cp') : NULL,
            'sil_cp' => safe_post('sil_cp') !== '' ? safe_post('sil_cp') : NULL,

            'episiotomi_cp' => json_encode([
                'episiotomi_cp_1' => safe_post('episiotomi_cp_1') !== '' ? safe_post('episiotomi_cp_1') : null,
				'episiotomi_cp_2' => safe_post('episiotomi_cp_2') !== '' ? safe_post('episiotomi_cp_2') : null,
				'episiotomi_cp_3' => safe_post('episiotomi_cp_3') !== '' ? safe_post('episiotomi_cp_3') : null,
				'episiotomi_cp_4' => safe_post('episiotomi_cp_4') !== '' ? safe_post('episiotomi_cp_4') : null,
            ]),

            'pendm_cp' => json_encode([
                'pendm_cp_1' => safe_post('pendm_cp_1') !== '' ? safe_post('pendm_cp_1') : null,
				'pendm_cp_2' => safe_post('pendm_cp_2') !== '' ? safe_post('pendm_cp_2') : null,
				'pendm_cp_3' => safe_post('pendm_cp_3') !== '' ? safe_post('pendm_cp_3') : null,
				'pendm_cp_4' => safe_post('pendm_cp_4') !== '' ? safe_post('pendm_cp_4') : null,
				'pendm_cp_5' => safe_post('pendm_cp_5') !== '' ? safe_post('pendm_cp_5') : null,
            ]),

            'gwt_cp' => json_encode([
                'gwt_cp_1' => safe_post('gwt_cp_1') !== '' ? safe_post('gwt_cp_1') : null,
				'gwt_cp_2' => safe_post('gwt_cp_2') !== '' ? safe_post('gwt_cp_2') : null,
				'gwt_cp_3' => safe_post('gwt_cp_3') !== '' ? safe_post('gwt_cp_3') : null,
            ]),

            'distosia_cp' => json_encode([
                'distosia_cp_1' => safe_post('distosia_cp_1') !== '' ? safe_post('distosia_cp_1') : null,
				'distosia_cp_2' => safe_post('distosia_cp_2') !== '' ? safe_post('distosia_cp_2') : null,
				'distosia_cp_3' => safe_post('distosia_cp_3') !== '' ? safe_post('distosia_cp_3') : null,
            ]),

            'tsb_cp' => safe_post('tsb_cp') !== '' ? safe_post('tsb_cp') : NULL,

            'ini_cp' => json_encode([
                'ini_cp_1' => safe_post('ini_cp_1') !== '' ? safe_post('ini_cp_1') : null,
				'ini_cp_2' => safe_post('ini_cp_2') !== '' ? safe_post('ini_cp_2') : null,
				'ini_cp_3' => safe_post('ini_cp_3') !== '' ? safe_post('ini_cp_3') : null,
            ]),

            'iii_cp' => safe_post('iii_cp') !== '' ? safe_post('iii_cp') : NULL,

            'im_cp' => json_encode([
                'im_cp_1' => safe_post('im_cp_1') !== '' ? safe_post('im_cp_1') : null,
				'im_cp_2' => safe_post('im_cp_2') !== '' ? safe_post('im_cp_2') : null,
				'im_cp_3' => safe_post('im_cp_3') !== '' ? safe_post('im_cp_3') : null,
				'im_cp_4' => safe_post('im_cp_4') !== '' ? safe_post('im_cp_4') : null,
            ]),

            'tali_cp' => safe_post('tali_cp') !== '' ? safe_post('tali_cp') : NULL,


            'pb_cp' => json_encode([
                'pb_cp_1' => safe_post('pb_cp_1') !== '' ? safe_post('pb_cp_1') : null,
				'pb_cp_2' => safe_post('pb_cp_2') !== '' ? safe_post('pb_cp_2') : null,
				'pb_cp_3' => safe_post('pb_cp_3') !== '' ? safe_post('pb_cp_3') : null,
				'pb_cp_4' => safe_post('pb_cp_4') !== '' ? safe_post('pb_cp_4') : null,
            ]),

            'penegangan_cp' => json_encode([
                'penegangan_cp_1' => safe_post('penegangan_cp_1') !== '' ? safe_post('penegangan_cp_1') : null,
				'penegangan_cp_2' => safe_post('penegangan_cp_2') !== '' ? safe_post('penegangan_cp_2') : null,
				'penegangan_cp_3' => safe_post('penegangan_cp_3') !== '' ? safe_post('penegangan_cp_3') : null,
            ]),

            'masase_cp' => json_encode([
                'masase_cp_1' => safe_post('masase_cp_1') !== '' ? safe_post('masase_cp_1') : null,
				'masase_cp_2' => safe_post('masase_cp_2') !== '' ? safe_post('masase_cp_2') : null,
				'masase_cp_3' => safe_post('masase_cp_3') !== '' ? safe_post('masase_cp_3') : null,
            ]),

            'lahi_cp' => json_encode([
                'lahi_cp_1' => safe_post('lahi_cp_1') !== '' ? safe_post('lahi_cp_1') : null,
				'lahi_cp_2' => safe_post('lahi_cp_2') !== '' ? safe_post('lahi_cp_2') : null,
				'lahi_cp_3' => safe_post('lahi_cp_3') !== '' ? safe_post('lahi_cp_3') : null,
            ]),

            'senta_cp' => json_encode([
                'senta_cp_1' => safe_post('senta_cp_1') !== '' ? safe_post('senta_cp_1') : null,
				'senta_cp_2' => safe_post('senta_cp_2') !== '' ? safe_post('senta_cp_2') : null,
				'senta_cp_3' => safe_post('senta_cp_3') !== '' ? safe_post('senta_cp_3') : null,
            ]),

            'laser_cp' => json_encode([
                'laser_cp_1' => safe_post('laser_cp_1') !== '' ? safe_post('laser_cp_1') : null,
				'laser_cp_2' => safe_post('laser_cp_2') !== '' ? safe_post('laser_cp_2') : null,
				'laser_cp_3' => safe_post('laser_cp_3') !== '' ? safe_post('laser_cp_3') : null,
            ]),

            'jika_cp' => json_encode([
                'jika_cp_1' => safe_post('jika_cp_1') !== '' ? safe_post('jika_cp_1') : null,
				'jika_cp_2' => safe_post('jika_cp_2') !== '' ? safe_post('jika_cp_2') : null,
				'jika_cp_3' => safe_post('jika_cp_3') !== '' ? safe_post('jika_cp_3') : null,
				'jika_cp_4' => safe_post('jika_cp_4') !== '' ? safe_post('jika_cp_4') : null,
				'jika_cp_5' => safe_post('jika_cp_5') !== '' ? safe_post('jika_cp_5') : null,
				'jika_cp_6' => safe_post('jika_cp_6') !== '' ? safe_post('jika_cp_6') : null,
				'jika_cp_7' => safe_post('jika_cp_7') !== '' ? safe_post('jika_cp_7') : null,
				'jika_cp_8' => safe_post('jika_cp_8') !== '' ? safe_post('jika_cp_8') : null,
            ]),

            'atoni_cp' => json_encode([
                'atoni_cp_1' => safe_post('atoni_cp_1') !== '' ? safe_post('atoni_cp_1') : null,
				'atoni_cp_2' => safe_post('atoni_cp_2') !== '' ? safe_post('atoni_cp_2') : null,
				'atoni_cp_3' => safe_post('atoni_cp_3') !== '' ? safe_post('atoni_cp_3') : null,
            ]),

            'jum_cp' => safe_post('jum_cp') !== '' ? safe_post('jum_cp') : NULL,
            'penatalaksanaan_cp' => safe_post('penatalaksanaan_cp') !== '' ? safe_post('penatalaksanaan_cp') : NULL,

            'Masalah_cp' => safe_post('Masalah_cp') !== '' ? safe_post('Masalah_cp') : NULL,
            'bb_cp' => safe_post('bb_cp') !== '' ? safe_post('bb_cp') : NULL,
            'panjang_cp' => safe_post('panjang_cp') !== '' ? safe_post('panjang_cp') : NULL,

            'jk_cp' => json_encode([
                'jk_cp_1' => safe_post('jk_cp_1') !== '' ? safe_post('jk_cp_1') : null,
				'jk_cp_2' => safe_post('jk_cp_2') !== '' ? safe_post('jk_cp_2') : null,
            ]),

            'by_cp' => json_encode([
                'by_cp_1' => safe_post('by_cp_1') !== '' ? safe_post('by_cp_1') : null,
				'by_cp_2' => safe_post('by_cp_2') !== '' ? safe_post('by_cp_2') : null,
            ]),

            'by_cplh' => json_encode([
                'by_cplh_1' => safe_post('by_cplh_1') !== '' ? safe_post('by_cplh_1') : null,
				'by_cplh_2' => safe_post('by_cplh_2') !== '' ? safe_post('by_cplh_2') : null,
				'by_cplh_3' => safe_post('by_cplh_3') !== '' ? safe_post('by_cplh_3') : null,
				'by_cplh_4' => safe_post('by_cplh_4') !== '' ? safe_post('by_cplh_4') : null,
				'by_cplh_5' => safe_post('by_cplh_5') !== '' ? safe_post('by_cplh_5') : null,
				'by_cplh_6' => safe_post('by_cplh_6') !== '' ? safe_post('by_cplh_6') : null,
				'by_cplh_7' => safe_post('by_cplh_7') !== '' ? safe_post('by_cplh_7') : null,
				'by_cplh_8' => safe_post('by_cplh_8') !== '' ? safe_post('by_cplh_8') : null,
				'by_cplh_9' => safe_post('by_cplh_9') !== '' ? safe_post('by_cplh_9') : null,
				'by_cplh_10' => safe_post('by_cplh_10') !== '' ? safe_post('by_cplh_10') : null,
				'by_cplh_11' => safe_post('by_cplh_11') !== '' ? safe_post('by_cplh_11') : null,
				'by_cplh_12' => safe_post('by_cplh_12') !== '' ? safe_post('by_cplh_12') : null,
            ]),

            'asi_cp' => json_encode([
                'asi_cp_1' => safe_post('asi_cp_1') !== '' ? safe_post('asi_cp_1') : null,
				'asi_cp_2' => safe_post('asi_cp_2') !== '' ? safe_post('asi_cp_2') : null,
				'asi_cp_3' => safe_post('asi_cp_3') !== '' ? safe_post('asi_cp_3') : null,
				'asi_cp_4' => safe_post('asi_cp_4') !== '' ? safe_post('asi_cp_4') : null,
            ]),

            'sebutkan_cp' => json_encode([
                'sebutkan_cp_1' => safe_post('sebutkan_cp_1') !== '' ? safe_post('sebutkan_cp_1') : null,
				'sebutkan_cp_2' => safe_post('sebutkan_cp_2') !== '' ? safe_post('sebutkan_cp_2') : null,
            ]), 
            
            // WARNA PUTIH ARSIR HITAM
            'putih' => json_encode([
                'putih_1' => safe_post('putih_1') !== '' ? safe_post('putih_1') : null,
				'putih_2' => safe_post('putih_2') !== '' ? safe_post('putih_2') : null,
				'putih_3' => safe_post('putih_3') !== '' ? safe_post('putih_3') : null,
				'putih_4' => safe_post('putih_4') !== '' ? safe_post('putih_4') : null,
				'putih_5' => safe_post('putih_5') !== '' ? safe_post('putih_5') : null,
				'putih_6' => safe_post('putih_6') !== '' ? safe_post('putih_6') : null,
				'putih_7' => safe_post('putih_7') !== '' ? safe_post('putih_7') : null,
				'putih_8' => safe_post('putih_8') !== '' ? safe_post('putih_8') : null,
				'putih_9' => safe_post('putih_9') !== '' ? safe_post('putih_9') : null,
				'putih_10' => safe_post('putih_10') !== '' ? safe_post('putih_10') : null,
				'putih_11' => safe_post('putih_11') !== '' ? safe_post('putih_11') : null,
				'putih_12' => safe_post('putih_12') !== '' ? safe_post('putih_12') : null,
				'putih_13' => safe_post('putih_13') !== '' ? safe_post('putih_13') : null,
				'putih_14' => safe_post('putih_14') !== '' ? safe_post('putih_14') : null,
				'putih_15' => safe_post('putih_15') !== '' ? safe_post('putih_15') : null,
				'putih_16' => safe_post('putih_16') !== '' ? safe_post('putih_16') : null,
				'putih_17' => safe_post('putih_17') !== '' ? safe_post('putih_17') : null,
				'putih_18' => safe_post('putih_18') !== '' ? safe_post('putih_18') : null,
				'putih_19' => safe_post('putih_19') !== '' ? safe_post('putih_19') : null,
				'putih_20' => safe_post('putih_20') !== '' ? safe_post('putih_20') : null,
				'putih_21' => safe_post('putih_21') !== '' ? safe_post('putih_21') : null,
				'putih_22' => safe_post('putih_22') !== '' ? safe_post('putih_22') : null,
				'putih_23' => safe_post('putih_23') !== '' ? safe_post('putih_23') : null,
				'putih_24' => safe_post('putih_24') !== '' ? safe_post('putih_24') : null,
				'putih_25' => safe_post('putih_25') !== '' ? safe_post('putih_25') : null,
				'putih_26' => safe_post('putih_26') !== '' ? safe_post('putih_26') : null,
				'putih_27' => safe_post('putih_27') !== '' ? safe_post('putih_27') : null,
				'putih_28' => safe_post('putih_28') !== '' ? safe_post('putih_28') : null,
				'putih_29' => safe_post('putih_29') !== '' ? safe_post('putih_29') : null,
				'putih_30' => safe_post('putih_30') !== '' ? safe_post('putih_30') : null,
				'putih_31' => safe_post('putih_31') !== '' ? safe_post('putih_31') : null,
				'putih_32' => safe_post('putih_32') !== '' ? safe_post('putih_32') : null,
				'putih_33' => safe_post('putih_33') !== '' ? safe_post('putih_33') : null,
				'putih_34' => safe_post('putih_34') !== '' ? safe_post('putih_34') : null,
				'putih_35' => safe_post('putih_35') !== '' ? safe_post('putih_35') : null,
				'putih_36' => safe_post('putih_36') !== '' ? safe_post('putih_36') : null,
				'putih_37' => safe_post('putih_37') !== '' ? safe_post('putih_37') : null,
				'putih_38' => safe_post('putih_38') !== '' ? safe_post('putih_38') : null,
				'putih_39' => safe_post('putih_39') !== '' ? safe_post('putih_39') : null,
				'putih_40' => safe_post('putih_40') !== '' ? safe_post('putih_40') : null,
				'putih_41' => safe_post('putih_41') !== '' ? safe_post('putih_41') : null,
				'putih_42' => safe_post('putih_42') !== '' ? safe_post('putih_42') : null,
				'putih_43' => safe_post('putih_43') !== '' ? safe_post('putih_43') : null,
				'putih_44' => safe_post('putih_44') !== '' ? safe_post('putih_44') : null,
				'putih_45' => safe_post('putih_45') !== '' ? safe_post('putih_45') : null,
				'putih_46' => safe_post('putih_46') !== '' ? safe_post('putih_46') : null,
				'putih_47' => safe_post('putih_47') !== '' ? safe_post('putih_47') : null,
				'putih_48' => safe_post('putih_48') !== '' ? safe_post('putih_48') : null,
				'putih_49' => safe_post('putih_49') !== '' ? safe_post('putih_49') : null,
				'putih_50' => safe_post('putih_50') !== '' ? safe_post('putih_50') : null,
				'putih_51' => safe_post('putih_51') !== '' ? safe_post('putih_51') : null,
				'putih_52' => safe_post('putih_52') !== '' ? safe_post('putih_52') : null,
				'putih_53' => safe_post('putih_53') !== '' ? safe_post('putih_53') : null,
				'putih_54' => safe_post('putih_54') !== '' ? safe_post('putih_54') : null,
				'putih_55' => safe_post('putih_55') !== '' ? safe_post('putih_55') : null,
				'putih_56' => safe_post('putih_56') !== '' ? safe_post('putih_56') : null,
				'putih_57' => safe_post('putih_57') !== '' ? safe_post('putih_57') : null,
				'putih_58' => safe_post('putih_58') !== '' ? safe_post('putih_58') : null,
				'putih_59' => safe_post('putih_59') !== '' ? safe_post('putih_59') : null,
				'putih_60' => safe_post('putih_60') !== '' ? safe_post('putih_60') : null,
				'putih_61' => safe_post('putih_61') !== '' ? safe_post('putih_61') : null,
				'putih_62' => safe_post('putih_62') !== '' ? safe_post('putih_62') : null,
				'putih_63' => safe_post('putih_63') !== '' ? safe_post('putih_63') : null,
				'putih_64' => safe_post('putih_64') !== '' ? safe_post('putih_64') : null,
				'putih_65' => safe_post('putih_65') !== '' ? safe_post('putih_65') : null,
				'putih_66' => safe_post('putih_66') !== '' ? safe_post('putih_66') : null,
				'putih_67' => safe_post('putih_67') !== '' ? safe_post('putih_67') : null,
				'putih_68' => safe_post('putih_68') !== '' ? safe_post('putih_68') : null,
				'putih_69' => safe_post('putih_69') !== '' ? safe_post('putih_69') : null,
				'putih_70' => safe_post('putih_70') !== '' ? safe_post('putih_70') : null,
				'putih_71' => safe_post('putih_71') !== '' ? safe_post('putih_71') : null,
				'putih_72' => safe_post('putih_72') !== '' ? safe_post('putih_72') : null,
				'putih_73' => safe_post('putih_73') !== '' ? safe_post('putih_73') : null,
				'putih_74' => safe_post('putih_74') !== '' ? safe_post('putih_74') : null,
				'putih_75' => safe_post('putih_75') !== '' ? safe_post('putih_75') : null,
				'putih_76' => safe_post('putih_76') !== '' ? safe_post('putih_76') : null,
				'putih_77' => safe_post('putih_77') !== '' ? safe_post('putih_77') : null,
				'putih_78' => safe_post('putih_78') !== '' ? safe_post('putih_78') : null,
				'putih_79' => safe_post('putih_79') !== '' ? safe_post('putih_79') : null,
				'putih_80' => safe_post('putih_80') !== '' ? safe_post('putih_80') : null,
				'putih_81' => safe_post('putih_81') !== '' ? safe_post('putih_81') : null,
				'putih_82' => safe_post('putih_82') !== '' ? safe_post('putih_82') : null,
				'putih_83' => safe_post('putih_83') !== '' ? safe_post('putih_83') : null,
				'putih_84' => safe_post('putih_84') !== '' ? safe_post('putih_84') : null,
				'putih_85' => safe_post('putih_85') !== '' ? safe_post('putih_85') : null,

				'putih_86' => safe_post('putih_86') !== '' ? safe_post('putih_86') : null,
				'putih_87' => safe_post('putih_87') !== '' ? safe_post('putih_87') : null,
				'putih_88' => safe_post('putih_88') !== '' ? safe_post('putih_88') : null,
				'putih_89' => safe_post('putih_89') !== '' ? safe_post('putih_89') : null,
				'putih_90' => safe_post('putih_90') !== '' ? safe_post('putih_90') : null,
				'putih_91' => safe_post('putih_91') !== '' ? safe_post('putih_91') : null,
				'putih_92' => safe_post('putih_92') !== '' ? safe_post('putih_92') : null,
				'putih_93' => safe_post('putih_93') !== '' ? safe_post('putih_93') : null,
				'putih_94' => safe_post('putih_94') !== '' ? safe_post('putih_94') : null,
				'putih_95' => safe_post('putih_95') !== '' ? safe_post('putih_95') : null,
				'putih_96' => safe_post('putih_96') !== '' ? safe_post('putih_96') : null,
				'putih_97' => safe_post('putih_97') !== '' ? safe_post('putih_97') : null,
				'putih_98' => safe_post('putih_98') !== '' ? safe_post('putih_98') : null,
				'putih_99' => safe_post('putih_99') !== '' ? safe_post('putih_99') : null,
				'putih_100' => safe_post('putih_100') !== '' ? safe_post('putih_100') : null,
				'putih_101' => safe_post('putih_101') !== '' ? safe_post('putih_101') : null,
				'putih_102' => safe_post('putih_102') !== '' ? safe_post('putih_102') : null,
				'putih_103' => safe_post('putih_103') !== '' ? safe_post('putih_103') : null,
				'putih_104' => safe_post('putih_104') !== '' ? safe_post('putih_104') : null,
				'putih_105' => safe_post('putih_105') !== '' ? safe_post('putih_105') : null,
				'putih_106' => safe_post('putih_106') !== '' ? safe_post('putih_106') : null,
				'putih_107' => safe_post('putih_107') !== '' ? safe_post('putih_107') : null,
				'putih_108' => safe_post('putih_108') !== '' ? safe_post('putih_108') : null,
				'putih_109' => safe_post('putih_109') !== '' ? safe_post('putih_109') : null,
				'putih_110' => safe_post('putih_110') !== '' ? safe_post('putih_110') : null,
				'putih_111' => safe_post('putih_111') !== '' ? safe_post('putih_111') : null,
				'putih_112' => safe_post('putih_112') !== '' ? safe_post('putih_112') : null,
				'putih_113' => safe_post('putih_113') !== '' ? safe_post('putih_113') : null,
				'putih_114' => safe_post('putih_114') !== '' ? safe_post('putih_114') : null,
				'putih_115' => safe_post('putih_115') !== '' ? safe_post('putih_115') : null,
				'putih_116' => safe_post('putih_116') !== '' ? safe_post('putih_116') : null,
				'putih_117' => safe_post('putih_117') !== '' ? safe_post('putih_117') : null,
				'putih_118' => safe_post('putih_118') !== '' ? safe_post('putih_118') : null,
				'putih_119' => safe_post('putih_119') !== '' ? safe_post('putih_119') : null,
				'putih_120' => safe_post('putih_120') !== '' ? safe_post('putih_120') : null,
				'putih_121' => safe_post('putih_121') !== '' ? safe_post('putih_121') : null,
				'putih_122' => safe_post('putih_122') !== '' ? safe_post('putih_122') : null,
				'putih_123' => safe_post('putih_123') !== '' ? safe_post('putih_123') : null,
				'putih_124' => safe_post('putih_124') !== '' ? safe_post('putih_124') : null,
				'putih_125' => safe_post('putih_125') !== '' ? safe_post('putih_125') : null,
				'putih_126' => safe_post('putih_126') !== '' ? safe_post('putih_126') : null,
				'putih_127' => safe_post('putih_127') !== '' ? safe_post('putih_127') : null,
				'putih_128' => safe_post('putih_128') !== '' ? safe_post('putih_128') : null,
				'putih_129' => safe_post('putih_129') !== '' ? safe_post('putih_129') : null,
				'putih_130' => safe_post('putih_130') !== '' ? safe_post('putih_130') : null,
				'putih_131' => safe_post('putih_131') !== '' ? safe_post('putih_131') : null,
				'putih_132' => safe_post('putih_132') !== '' ? safe_post('putih_132') : null,
				'putih_133' => safe_post('putih_133') !== '' ? safe_post('putih_133') : null,
				'putih_134' => safe_post('putih_134') !== '' ? safe_post('putih_134') : null,
				'putih_135' => safe_post('putih_135') !== '' ? safe_post('putih_135') : null,
				'putih_136' => safe_post('putih_136') !== '' ? safe_post('putih_136') : null,
				'putih_137' => safe_post('putih_137') !== '' ? safe_post('putih_137') : null,
				'putih_138' => safe_post('putih_138') !== '' ? safe_post('putih_138') : null,
				'putih_139' => safe_post('putih_139') !== '' ? safe_post('putih_139') : null,
				'putih_140' => safe_post('putih_140') !== '' ? safe_post('putih_140') : null,
				'putih_141' => safe_post('putih_141') !== '' ? safe_post('putih_141') : null,
				'putih_142' => safe_post('putih_142') !== '' ? safe_post('putih_142') : null,
				'putih_143' => safe_post('putih_143') !== '' ? safe_post('putih_143') : null,
				'putih_144' => safe_post('putih_144') !== '' ? safe_post('putih_144') : null,
				'putih_145' => safe_post('putih_145') !== '' ? safe_post('putih_145') : null,
				'putih_146' => safe_post('putih_146') !== '' ? safe_post('putih_146') : null,
				'putih_147' => safe_post('putih_147') !== '' ? safe_post('putih_147') : null,
				'putih_148' => safe_post('putih_148') !== '' ? safe_post('putih_148') : null,
				'putih_149' => safe_post('putih_149') !== '' ? safe_post('putih_149') : null,
				'putih_150' => safe_post('putih_150') !== '' ? safe_post('putih_150') : null,
				'putih_151' => safe_post('putih_151') !== '' ? safe_post('putih_151') : null,
				'putih_152' => safe_post('putih_152') !== '' ? safe_post('putih_152') : null,
				'putih_153' => safe_post('putih_153') !== '' ? safe_post('putih_153') : null,
				'putih_154' => safe_post('putih_154') !== '' ? safe_post('putih_154') : null,
				'putih_155' => safe_post('putih_155') !== '' ? safe_post('putih_155') : null,
				'putih_156' => safe_post('putih_156') !== '' ? safe_post('putih_156') : null,
				'putih_157' => safe_post('putih_157') !== '' ? safe_post('putih_157') : null,
				'putih_158' => safe_post('putih_158') !== '' ? safe_post('putih_158') : null,
				'putih_159' => safe_post('putih_159') !== '' ? safe_post('putih_159') : null,
				'putih_160' => safe_post('putih_160') !== '' ? safe_post('putih_160') : null,
            ]),  

            'abu' => json_encode([
                'abu_1' => safe_post('abu_1') !== '' ? safe_post('abu_1') : null,
				'abu_2' => safe_post('abu_2') !== '' ? safe_post('abu_2') : null,
				'abu_3' => safe_post('abu_3') !== '' ? safe_post('abu_3') : null,
				'abu_4' => safe_post('abu_4') !== '' ? safe_post('abu_4') : null,
				'abu_5' => safe_post('abu_5') !== '' ? safe_post('abu_5') : null,
				'abu_6' => safe_post('abu_6') !== '' ? safe_post('abu_6') : null,
				'abu_7' => safe_post('abu_7') !== '' ? safe_post('abu_7') : null,
				'abu_8' => safe_post('abu_8') !== '' ? safe_post('abu_8') : null,
				'abu_9' => safe_post('abu_9') !== '' ? safe_post('abu_9') : null,
				'abu_10' => safe_post('abu_10') !== '' ? safe_post('abu_10') : null,
				'abu_11' => safe_post('abu_11') !== '' ? safe_post('abu_11') : null,
				'abu_12' => safe_post('abu_12') !== '' ? safe_post('abu_12') : null,
				'abu_13' => safe_post('abu_13') !== '' ? safe_post('abu_13') : null,
				'abu_14' => safe_post('abu_14') !== '' ? safe_post('abu_14') : null,
				'abu_15' => safe_post('abu_15') !== '' ? safe_post('abu_15') : null,
				'abu_16' => safe_post('abu_16') !== '' ? safe_post('abu_16') : null,
				'abu_17' => safe_post('abu_17') !== '' ? safe_post('abu_17') : null,
				'abu_18' => safe_post('abu_18') !== '' ? safe_post('abu_18') : null,
				'abu_19' => safe_post('abu_19') !== '' ? safe_post('abu_19') : null,
				'abu_20' => safe_post('abu_20') !== '' ? safe_post('abu_20') : null,
				'abu_21' => safe_post('abu_21') !== '' ? safe_post('abu_21') : null,
				'abu_22' => safe_post('abu_22') !== '' ? safe_post('abu_22') : null,
				'abu_23' => safe_post('abu_23') !== '' ? safe_post('abu_23') : null,
				'abu_24' => safe_post('abu_24') !== '' ? safe_post('abu_24') : null,
				'abu_25' => safe_post('abu_25') !== '' ? safe_post('abu_25') : null,
				'abu_26' => safe_post('abu_26') !== '' ? safe_post('abu_26') : null,
				'abu_27' => safe_post('abu_27') !== '' ? safe_post('abu_27') : null,
				'abu_28' => safe_post('abu_28') !== '' ? safe_post('abu_28') : null,
				'abu_29' => safe_post('abu_29') !== '' ? safe_post('abu_29') : null,
				'abu_30' => safe_post('abu_30') !== '' ? safe_post('abu_30') : null,
				'abu_31' => safe_post('abu_31') !== '' ? safe_post('abu_31') : null,
				'abu_32' => safe_post('abu_32') !== '' ? safe_post('abu_32') : null,
				'abu_33' => safe_post('abu_33') !== '' ? safe_post('abu_33') : null,
				'abu_34' => safe_post('abu_34') !== '' ? safe_post('abu_34') : null,
				'abu_35' => safe_post('abu_35') !== '' ? safe_post('abu_35') : null,
				'abu_36' => safe_post('abu_36') !== '' ? safe_post('abu_36') : null,
				'abu_37' => safe_post('abu_37') !== '' ? safe_post('abu_37') : null,
				'abu_38' => safe_post('abu_38') !== '' ? safe_post('abu_38') : null,
				'abu_39' => safe_post('abu_39') !== '' ? safe_post('abu_39') : null,
				'abu_40' => safe_post('abu_40') !== '' ? safe_post('abu_40') : null,
				'abu_41' => safe_post('abu_41') !== '' ? safe_post('abu_41') : null,
				'abu_42' => safe_post('abu_42') !== '' ? safe_post('abu_42') : null,
				'abu_43' => safe_post('abu_43') !== '' ? safe_post('abu_43') : null,
				'abu_44' => safe_post('abu_44') !== '' ? safe_post('abu_44') : null,
				'abu_45' => safe_post('abu_45') !== '' ? safe_post('abu_45') : null,
				'abu_46' => safe_post('abu_46') !== '' ? safe_post('abu_46') : null,
				'abu_47' => safe_post('abu_47') !== '' ? safe_post('abu_47') : null,
				'abu_48' => safe_post('abu_48') !== '' ? safe_post('abu_48') : null,
				'abu_49' => safe_post('abu_49') !== '' ? safe_post('abu_49') : null,
				'abu_50' => safe_post('abu_50') !== '' ? safe_post('abu_50') : null,
				'abu_51' => safe_post('abu_51') !== '' ? safe_post('abu_51') : null,
				'abu_52' => safe_post('abu_52') !== '' ? safe_post('abu_52') : null,
				'abu_53' => safe_post('abu_53') !== '' ? safe_post('abu_53') : null,
				'abu_54' => safe_post('abu_54') !== '' ? safe_post('abu_54') : null,
				'abu_55' => safe_post('abu_55') !== '' ? safe_post('abu_55') : null,
				'abu_56' => safe_post('abu_56') !== '' ? safe_post('abu_56') : null,
				'abu_57' => safe_post('abu_57') !== '' ? safe_post('abu_57') : null,
				'abu_58' => safe_post('abu_58') !== '' ? safe_post('abu_58') : null,
				'abu_59' => safe_post('abu_59') !== '' ? safe_post('abu_59') : null,
				'abu_60' => safe_post('abu_60') !== '' ? safe_post('abu_60') : null,
                'abu_61' => safe_post('abu_61') !== '' ? safe_post('abu_61') : null,
				'abu_62' => safe_post('abu_62') !== '' ? safe_post('abu_62') : null,
				'abu_63' => safe_post('abu_63') !== '' ? safe_post('abu_63') : null,
				'abu_64' => safe_post('abu_64') !== '' ? safe_post('abu_64') : null,
				'abu_65' => safe_post('abu_65') !== '' ? safe_post('abu_65') : null,
				'abu_66' => safe_post('abu_66') !== '' ? safe_post('abu_66') : null,
				'abu_67' => safe_post('abu_67') !== '' ? safe_post('abu_67') : null,
				'abu_68' => safe_post('abu_68') !== '' ? safe_post('abu_68') : null,
				'abu_69' => safe_post('abu_69') !== '' ? safe_post('abu_69') : null,
				'abu_70' => safe_post('abu_70') !== '' ? safe_post('abu_70') : null,
				'abu_71' => safe_post('abu_71') !== '' ? safe_post('abu_71') : null,
				'abu_72' => safe_post('abu_72') !== '' ? safe_post('abu_72') : null,
				'abu_73' => safe_post('abu_73') !== '' ? safe_post('abu_73') : null,
				'abu_74' => safe_post('abu_74') !== '' ? safe_post('abu_74') : null,
				'abu_75' => safe_post('abu_75') !== '' ? safe_post('abu_75') : null,
				'abu_76' => safe_post('abu_76') !== '' ? safe_post('abu_76') : null,
				'abu_77' => safe_post('abu_77') !== '' ? safe_post('abu_77') : null,
				'abu_78' => safe_post('abu_78') !== '' ? safe_post('abu_78') : null,
				'abu_79' => safe_post('abu_79') !== '' ? safe_post('abu_79') : null,
				'abu_80' => safe_post('abu_80') !== '' ? safe_post('abu_80') : null,
				'abu_81' => safe_post('abu_81') !== '' ? safe_post('abu_81') : null,
				'abu_82' => safe_post('abu_82') !== '' ? safe_post('abu_82') : null,
				'abu_83' => safe_post('abu_83') !== '' ? safe_post('abu_83') : null,
				'abu_84' => safe_post('abu_84') !== '' ? safe_post('abu_84') : null,
				'abu_85' => safe_post('abu_85') !== '' ? safe_post('abu_85') : null,

                'abu_86' => safe_post('abu_86') !== '' ? safe_post('abu_86') : null,
				'abu_87' => safe_post('abu_87') !== '' ? safe_post('abu_87') : null,
				'abu_88' => safe_post('abu_88') !== '' ? safe_post('abu_88') : null,
				'abu_89' => safe_post('abu_89') !== '' ? safe_post('abu_89') : null,
				'abu_90' => safe_post('abu_90') !== '' ? safe_post('abu_90') : null,
				'abu_91' => safe_post('abu_91') !== '' ? safe_post('abu_91') : null,
				'abu_92' => safe_post('abu_92') !== '' ? safe_post('abu_92') : null,
				'abu_93' => safe_post('abu_93') !== '' ? safe_post('abu_93') : null,
				'abu_94' => safe_post('abu_94') !== '' ? safe_post('abu_94') : null,
				'abu_95' => safe_post('abu_95') !== '' ? safe_post('abu_95') : null,
				'abu_96' => safe_post('abu_96') !== '' ? safe_post('abu_96') : null,
				'abu_97' => safe_post('abu_97') !== '' ? safe_post('abu_97') : null,
				'abu_98' => safe_post('abu_98') !== '' ? safe_post('abu_98') : null,
				'abu_99' => safe_post('abu_99') !== '' ? safe_post('abu_99') : null,
				'abu_100' => safe_post('abu_100') !== '' ? safe_post('abu_100') : null,
				'abu_101' => safe_post('abu_101') !== '' ? safe_post('abu_101') : null,
				'abu_102' => safe_post('abu_102') !== '' ? safe_post('abu_102') : null,
				'abu_103' => safe_post('abu_103') !== '' ? safe_post('abu_103') : null,
				'abu_104' => safe_post('abu_104') !== '' ? safe_post('abu_104') : null,
				'abu_105' => safe_post('abu_105') !== '' ? safe_post('abu_105') : null,
				'abu_106' => safe_post('abu_106') !== '' ? safe_post('abu_106') : null,
				'abu_107' => safe_post('abu_107') !== '' ? safe_post('abu_107') : null,
				'abu_108' => safe_post('abu_108') !== '' ? safe_post('abu_108') : null,
				'abu_109' => safe_post('abu_109') !== '' ? safe_post('abu_109') : null,
				'abu_110' => safe_post('abu_110') !== '' ? safe_post('abu_110') : null,
				'abu_111' => safe_post('abu_111') !== '' ? safe_post('abu_111') : null,
				'abu_112' => safe_post('abu_112') !== '' ? safe_post('abu_112') : null,
				'abu_113' => safe_post('abu_113') !== '' ? safe_post('abu_113') : null,
				'abu_114' => safe_post('abu_114') !== '' ? safe_post('abu_114') : null,
				'abu_115' => safe_post('abu_115') !== '' ? safe_post('abu_115') : null,
				'abu_116' => safe_post('abu_116') !== '' ? safe_post('abu_116') : null,
				'abu_117' => safe_post('abu_117') !== '' ? safe_post('abu_117') : null,
				'abu_118' => safe_post('abu_118') !== '' ? safe_post('abu_118') : null,
				'abu_119' => safe_post('abu_119') !== '' ? safe_post('abu_119') : null,
				'abu_120' => safe_post('abu_120') !== '' ? safe_post('abu_120') : null,
				'abu_121' => safe_post('abu_121') !== '' ? safe_post('abu_121') : null,
				'abu_122' => safe_post('abu_122') !== '' ? safe_post('abu_122') : null,
				'abu_123' => safe_post('abu_123') !== '' ? safe_post('abu_123') : null,
				'abu_124' => safe_post('abu_124') !== '' ? safe_post('abu_124') : null,
				'abu_125' => safe_post('abu_125') !== '' ? safe_post('abu_125') : null,
				'abu_126' => safe_post('abu_126') !== '' ? safe_post('abu_126') : null,
				'abu_127' => safe_post('abu_127') !== '' ? safe_post('abu_127') : null,
				'abu_128' => safe_post('abu_128') !== '' ? safe_post('abu_128') : null,
				'abu_129' => safe_post('abu_129') !== '' ? safe_post('abu_129') : null,
				'abu_130' => safe_post('abu_130') !== '' ? safe_post('abu_130') : null,
				'abu_131' => safe_post('abu_131') !== '' ? safe_post('abu_131') : null,
				'abu_132' => safe_post('abu_132') !== '' ? safe_post('abu_132') : null,
				'abu_133' => safe_post('abu_133') !== '' ? safe_post('abu_133') : null,
				'abu_134' => safe_post('abu_134') !== '' ? safe_post('abu_134') : null,
				'abu_135' => safe_post('abu_135') !== '' ? safe_post('abu_135') : null,
				'abu_136' => safe_post('abu_136') !== '' ? safe_post('abu_136') : null,
				'abu_137' => safe_post('abu_137') !== '' ? safe_post('abu_137') : null,
				'abu_138' => safe_post('abu_138') !== '' ? safe_post('abu_138') : null,
				'abu_139' => safe_post('abu_139') !== '' ? safe_post('abu_139') : null,
				'abu_140' => safe_post('abu_140') !== '' ? safe_post('abu_140') : null,
				'abu_141' => safe_post('abu_141') !== '' ? safe_post('abu_141') : null,
				'abu_142' => safe_post('abu_142') !== '' ? safe_post('abu_142') : null,
				'abu_143' => safe_post('abu_143') !== '' ? safe_post('abu_143') : null,
				'abu_144' => safe_post('abu_144') !== '' ? safe_post('abu_144') : null,
				'abu_145' => safe_post('abu_145') !== '' ? safe_post('abu_145') : null,
				'abu_146' => safe_post('abu_146') !== '' ? safe_post('abu_146') : null,
				'abu_147' => safe_post('abu_147') !== '' ? safe_post('abu_147') : null,
				'abu_148' => safe_post('abu_148') !== '' ? safe_post('abu_148') : null,
				'abu_149' => safe_post('abu_149') !== '' ? safe_post('abu_149') : null,
				'abu_150' => safe_post('abu_150') !== '' ? safe_post('abu_150') : null,
				'abu_151' => safe_post('abu_151') !== '' ? safe_post('abu_151') : null,
				'abu_152' => safe_post('abu_152') !== '' ? safe_post('abu_152') : null,
				'abu_153' => safe_post('abu_153') !== '' ? safe_post('abu_153') : null,
				'abu_154' => safe_post('abu_154') !== '' ? safe_post('abu_154') : null,
				'abu_155' => safe_post('abu_155') !== '' ? safe_post('abu_155') : null,
				'abu_156' => safe_post('abu_156') !== '' ? safe_post('abu_156') : null,
				'abu_157' => safe_post('abu_157') !== '' ? safe_post('abu_157') : null,
				'abu_158' => safe_post('abu_158') !== '' ? safe_post('abu_158') : null,
				'abu_159' => safe_post('abu_159') !== '' ? safe_post('abu_159') : null,
				'abu_160' => safe_post('abu_160') !== '' ? safe_post('abu_160') : null,
            ]),

            'hitam' => json_encode([
                'hitam_1' => safe_post('hitam_1') !== '' ? safe_post('hitam_1') : null,
				'hitam_2' => safe_post('hitam_2') !== '' ? safe_post('hitam_2') : null,
				'hitam_3' => safe_post('hitam_3') !== '' ? safe_post('hitam_3') : null,
				'hitam_4' => safe_post('hitam_4') !== '' ? safe_post('hitam_4') : null,
				'hitam_5' => safe_post('hitam_5') !== '' ? safe_post('hitam_5') : null,
				'hitam_6' => safe_post('hitam_6') !== '' ? safe_post('hitam_6') : null,
				'hitam_7' => safe_post('hitam_7') !== '' ? safe_post('hitam_7') : null,
				'hitam_8' => safe_post('hitam_8') !== '' ? safe_post('hitam_8') : null,
				'hitam_9' => safe_post('hitam_9') !== '' ? safe_post('hitam_9') : null,
				'hitam_10' => safe_post('hitam_10') !== '' ? safe_post('hitam_10') : null,
				'hitam_11' => safe_post('hitam_11') !== '' ? safe_post('hitam_11') : null,
				'hitam_12' => safe_post('hitam_12') !== '' ? safe_post('hitam_12') : null,
				'hitam_13' => safe_post('hitam_13') !== '' ? safe_post('hitam_13') : null,
				'hitam_14' => safe_post('hitam_14') !== '' ? safe_post('hitam_14') : null,
				'hitam_15' => safe_post('hitam_15') !== '' ? safe_post('hitam_15') : null,
				'hitam_16' => safe_post('hitam_16') !== '' ? safe_post('hitam_16') : null,
				'hitam_17' => safe_post('hitam_17') !== '' ? safe_post('hitam_17') : null,
				'hitam_18' => safe_post('hitam_18') !== '' ? safe_post('hitam_18') : null,
				'hitam_19' => safe_post('hitam_19') !== '' ? safe_post('hitam_19') : null,
				'hitam_20' => safe_post('hitam_20') !== '' ? safe_post('hitam_20') : null,
				'hitam_21' => safe_post('hitam_21') !== '' ? safe_post('hitam_21') : null,
				'hitam_22' => safe_post('hitam_22') !== '' ? safe_post('hitam_22') : null,
				'hitam_23' => safe_post('hitam_23') !== '' ? safe_post('hitam_23') : null,
				'hitam_24' => safe_post('hitam_24') !== '' ? safe_post('hitam_24') : null,
				'hitam_25' => safe_post('hitam_25') !== '' ? safe_post('hitam_25') : null,
				'hitam_26' => safe_post('hitam_26') !== '' ? safe_post('hitam_26') : null,
				'hitam_27' => safe_post('hitam_27') !== '' ? safe_post('hitam_27') : null,
				'hitam_28' => safe_post('hitam_28') !== '' ? safe_post('hitam_28') : null,
				'hitam_29' => safe_post('hitam_29') !== '' ? safe_post('hitam_29') : null,
				'hitam_30' => safe_post('hitam_30') !== '' ? safe_post('hitam_30') : null,
				'hitam_31' => safe_post('hitam_31') !== '' ? safe_post('hitam_31') : null,
				'hitam_32' => safe_post('hitam_32') !== '' ? safe_post('hitam_32') : null,
				'hitam_33' => safe_post('hitam_33') !== '' ? safe_post('hitam_33') : null,
				'hitam_34' => safe_post('hitam_34') !== '' ? safe_post('hitam_34') : null,
				'hitam_35' => safe_post('hitam_35') !== '' ? safe_post('hitam_35') : null,
				'hitam_36' => safe_post('hitam_36') !== '' ? safe_post('hitam_36') : null,
				'hitam_37' => safe_post('hitam_37') !== '' ? safe_post('hitam_37') : null,
				'hitam_38' => safe_post('hitam_38') !== '' ? safe_post('hitam_38') : null,
				'hitam_39' => safe_post('hitam_39') !== '' ? safe_post('hitam_39') : null,
				'hitam_40' => safe_post('hitam_40') !== '' ? safe_post('hitam_40') : null,
				'hitam_41' => safe_post('hitam_41') !== '' ? safe_post('hitam_41') : null,
				'hitam_42' => safe_post('hitam_42') !== '' ? safe_post('hitam_42') : null,
				'hitam_43' => safe_post('hitam_43') !== '' ? safe_post('hitam_43') : null,
				'hitam_44' => safe_post('hitam_44') !== '' ? safe_post('hitam_44') : null,
				'hitam_45' => safe_post('hitam_45') !== '' ? safe_post('hitam_45') : null,
				'hitam_46' => safe_post('hitam_46') !== '' ? safe_post('hitam_46') : null,
				'hitam_47' => safe_post('hitam_47') !== '' ? safe_post('hitam_47') : null,
				'hitam_48' => safe_post('hitam_48') !== '' ? safe_post('hitam_48') : null,
				'hitam_49' => safe_post('hitam_49') !== '' ? safe_post('hitam_49') : null,
				'hitam_50' => safe_post('hitam_50') !== '' ? safe_post('hitam_50') : null,
				'hitam_51' => safe_post('hitam_51') !== '' ? safe_post('hitam_51') : null,
				'hitam_52' => safe_post('hitam_52') !== '' ? safe_post('hitam_52') : null,
				'hitam_53' => safe_post('hitam_53') !== '' ? safe_post('hitam_53') : null,
				'hitam_54' => safe_post('hitam_54') !== '' ? safe_post('hitam_54') : null,
				'hitam_55' => safe_post('hitam_55') !== '' ? safe_post('hitam_55') : null,
				'hitam_56' => safe_post('hitam_56') !== '' ? safe_post('hitam_56') : null,
				'hitam_57' => safe_post('hitam_57') !== '' ? safe_post('hitam_57') : null,
				'hitam_58' => safe_post('hitam_58') !== '' ? safe_post('hitam_58') : null,
				'hitam_59' => safe_post('hitam_59') !== '' ? safe_post('hitam_59') : null,
				'hitam_60' => safe_post('hitam_60') !== '' ? safe_post('hitam_60') : null,
                'hitam_61' => safe_post('hitam_61') !== '' ? safe_post('hitam_61') : null,
				'hitam_62' => safe_post('hitam_62') !== '' ? safe_post('hitam_62') : null,
				'hitam_63' => safe_post('hitam_63') !== '' ? safe_post('hitam_63') : null,
				'hitam_64' => safe_post('hitam_64') !== '' ? safe_post('hitam_64') : null,
				'hitam_65' => safe_post('hitam_65') !== '' ? safe_post('hitam_65') : null,
				'hitam_66' => safe_post('hitam_66') !== '' ? safe_post('hitam_66') : null,
				'hitam_67' => safe_post('hitam_67') !== '' ? safe_post('hitam_67') : null,
				'hitam_68' => safe_post('hitam_68') !== '' ? safe_post('hitam_68') : null,
				'hitam_69' => safe_post('hitam_69') !== '' ? safe_post('hitam_69') : null,
				'hitam_70' => safe_post('hitam_70') !== '' ? safe_post('hitam_70') : null,
				'hitam_71' => safe_post('hitam_71') !== '' ? safe_post('hitam_71') : null,
				'hitam_72' => safe_post('hitam_72') !== '' ? safe_post('hitam_72') : null,
				'hitam_73' => safe_post('hitam_73') !== '' ? safe_post('hitam_73') : null,
				'hitam_74' => safe_post('hitam_74') !== '' ? safe_post('hitam_74') : null,
				'hitam_75' => safe_post('hitam_75') !== '' ? safe_post('hitam_75') : null,
				'hitam_76' => safe_post('hitam_76') !== '' ? safe_post('hitam_76') : null,
				'hitam_77' => safe_post('hitam_77') !== '' ? safe_post('hitam_77') : null,
				'hitam_78' => safe_post('hitam_78') !== '' ? safe_post('hitam_78') : null,
				'hitam_79' => safe_post('hitam_79') !== '' ? safe_post('hitam_79') : null,
				'hitam_80' => safe_post('hitam_80') !== '' ? safe_post('hitam_80') : null,
				'hitam_81' => safe_post('hitam_81') !== '' ? safe_post('hitam_81') : null,
				'hitam_82' => safe_post('hitam_82') !== '' ? safe_post('hitam_82') : null,
				'hitam_83' => safe_post('hitam_83') !== '' ? safe_post('hitam_83') : null,
				'hitam_84' => safe_post('hitam_84') !== '' ? safe_post('hitam_84') : null,
				'hitam_85' => safe_post('hitam_85') !== '' ? safe_post('hitam_85') : null,

                'hitam_86' => safe_post('hitam_86') !== '' ? safe_post('hitam_86') : null,
				'hitam_87' => safe_post('hitam_87') !== '' ? safe_post('hitam_87') : null,
				'hitam_88' => safe_post('hitam_88') !== '' ? safe_post('hitam_88') : null,
				'hitam_89' => safe_post('hitam_89') !== '' ? safe_post('hitam_89') : null,
				'hitam_90' => safe_post('hitam_90') !== '' ? safe_post('hitam_90') : null,
				'hitam_91' => safe_post('hitam_91') !== '' ? safe_post('hitam_91') : null,
				'hitam_92' => safe_post('hitam_92') !== '' ? safe_post('hitam_92') : null,
				'hitam_93' => safe_post('hitam_93') !== '' ? safe_post('hitam_93') : null,
				'hitam_94' => safe_post('hitam_94') !== '' ? safe_post('hitam_94') : null,
				'hitam_95' => safe_post('hitam_95') !== '' ? safe_post('hitam_95') : null,
				'hitam_96' => safe_post('hitam_96') !== '' ? safe_post('hitam_96') : null,
				'hitam_97' => safe_post('hitam_97') !== '' ? safe_post('hitam_97') : null,
				'hitam_98' => safe_post('hitam_98') !== '' ? safe_post('hitam_98') : null,
				'hitam_99' => safe_post('hitam_99') !== '' ? safe_post('hitam_99') : null,
				'hitam_100' => safe_post('hitam_100') !== '' ? safe_post('hitam_100') : null,
				'hitam_101' => safe_post('hitam_101') !== '' ? safe_post('hitam_101') : null,
				'hitam_102' => safe_post('hitam_102') !== '' ? safe_post('hitam_102') : null,
				'hitam_103' => safe_post('hitam_103') !== '' ? safe_post('hitam_103') : null,
				'hitam_104' => safe_post('hitam_104') !== '' ? safe_post('hitam_104') : null,
				'hitam_105' => safe_post('hitam_105') !== '' ? safe_post('hitam_105') : null,
				'hitam_106' => safe_post('hitam_106') !== '' ? safe_post('hitam_106') : null,
				'hitam_107' => safe_post('hitam_107') !== '' ? safe_post('hitam_107') : null,
				'hitam_108' => safe_post('hitam_108') !== '' ? safe_post('hitam_108') : null,
				'hitam_109' => safe_post('hitam_109') !== '' ? safe_post('hitam_109') : null,
				'hitam_110' => safe_post('hitam_110') !== '' ? safe_post('hitam_110') : null,
				'hitam_111' => safe_post('hitam_111') !== '' ? safe_post('hitam_111') : null,
				'hitam_112' => safe_post('hitam_112') !== '' ? safe_post('hitam_112') : null,
				'hitam_113' => safe_post('hitam_113') !== '' ? safe_post('hitam_113') : null,
				'hitam_114' => safe_post('hitam_114') !== '' ? safe_post('hitam_114') : null,
				'hitam_115' => safe_post('hitam_115') !== '' ? safe_post('hitam_115') : null,
				'hitam_116' => safe_post('hitam_116') !== '' ? safe_post('hitam_116') : null,
				'hitam_117' => safe_post('hitam_117') !== '' ? safe_post('hitam_117') : null,
				'hitam_118' => safe_post('hitam_118') !== '' ? safe_post('hitam_118') : null,
				'hitam_119' => safe_post('hitam_119') !== '' ? safe_post('hitam_119') : null,
				'hitam_120' => safe_post('hitam_120') !== '' ? safe_post('hitam_120') : null,
				'hitam_121' => safe_post('hitam_121') !== '' ? safe_post('hitam_121') : null,
				'hitam_122' => safe_post('hitam_122') !== '' ? safe_post('hitam_122') : null,
				'hitam_123' => safe_post('hitam_123') !== '' ? safe_post('hitam_123') : null,
				'hitam_124' => safe_post('hitam_124') !== '' ? safe_post('hitam_124') : null,
				'hitam_125' => safe_post('hitam_125') !== '' ? safe_post('hitam_125') : null,
				'hitam_126' => safe_post('hitam_126') !== '' ? safe_post('hitam_126') : null,
				'hitam_127' => safe_post('hitam_127') !== '' ? safe_post('hitam_127') : null,
				'hitam_128' => safe_post('hitam_128') !== '' ? safe_post('hitam_128') : null,
				'hitam_129' => safe_post('hitam_129') !== '' ? safe_post('hitam_129') : null,
				'hitam_130' => safe_post('hitam_130') !== '' ? safe_post('hitam_130') : null,
				'hitam_131' => safe_post('hitam_131') !== '' ? safe_post('hitam_131') : null,
				'hitam_132' => safe_post('hitam_132') !== '' ? safe_post('hitam_132') : null,
				'hitam_133' => safe_post('hitam_133') !== '' ? safe_post('hitam_133') : null,
				'hitam_134' => safe_post('hitam_134') !== '' ? safe_post('hitam_134') : null,
				'hitam_135' => safe_post('hitam_135') !== '' ? safe_post('hitam_135') : null,
				'hitam_136' => safe_post('hitam_136') !== '' ? safe_post('hitam_136') : null,
				'hitam_137' => safe_post('hitam_137') !== '' ? safe_post('hitam_137') : null,
				'hitam_138' => safe_post('hitam_138') !== '' ? safe_post('hitam_138') : null,
				'hitam_139' => safe_post('hitam_139') !== '' ? safe_post('hitam_139') : null,
				'hitam_140' => safe_post('hitam_140') !== '' ? safe_post('hitam_140') : null,
				'hitam_141' => safe_post('hitam_141') !== '' ? safe_post('hitam_141') : null,
				'hitam_142' => safe_post('hitam_142') !== '' ? safe_post('hitam_142') : null,
				'hitam_143' => safe_post('hitam_143') !== '' ? safe_post('hitam_143') : null,
				'hitam_144' => safe_post('hitam_144') !== '' ? safe_post('hitam_144') : null,
				'hitam_145' => safe_post('hitam_145') !== '' ? safe_post('hitam_145') : null,
				'hitam_146' => safe_post('hitam_146') !== '' ? safe_post('hitam_146') : null,
				'hitam_147' => safe_post('hitam_147') !== '' ? safe_post('hitam_147') : null,
				'hitam_148' => safe_post('hitam_148') !== '' ? safe_post('hitam_148') : null,
				'hitam_149' => safe_post('hitam_149') !== '' ? safe_post('hitam_149') : null,
				'hitam_150' => safe_post('hitam_150') !== '' ? safe_post('hitam_150') : null,
				'hitam_151' => safe_post('hitam_151') !== '' ? safe_post('hitam_151') : null,
				'hitam_152' => safe_post('hitam_152') !== '' ? safe_post('hitam_152') : null,
				'hitam_153' => safe_post('hitam_153') !== '' ? safe_post('hitam_153') : null,
				'hitam_154' => safe_post('hitam_154') !== '' ? safe_post('hitam_154') : null,
				'hitam_155' => safe_post('hitam_155') !== '' ? safe_post('hitam_155') : null,
				'hitam_156' => safe_post('hitam_156') !== '' ? safe_post('hitam_156') : null,
				'hitam_157' => safe_post('hitam_157') !== '' ? safe_post('hitam_157') : null,
				'hitam_158' => safe_post('hitam_158') !== '' ? safe_post('hitam_158') : null,
				'hitam_159' => safe_post('hitam_159') !== '' ? safe_post('hitam_159') : null,
				'hitam_160' => safe_post('hitam_160') !== '' ? safe_post('hitam_160') : null,
            ]),

            // 'oksitosin' => json_encode([
			// 	'oksitosin_1' => safe_post('oksitosin_1') !== '' ? safe_post('oksitosin_1') : null,
			// 	'oksitosin_2' => safe_post('oksitosin_2') !== '' ? safe_post('oksitosin_2') : null,
			// 	'oksitosin_3' => safe_post('oksitosin_3') !== '' ? safe_post('oksitosin_3') : null,
			// 	'oksitosin_4' => safe_post('oksitosin_4') !== '' ? safe_post('oksitosin_4') : null,
			// 	'oksitosin_5' => safe_post('oksitosin_5') !== '' ? safe_post('oksitosin_5') : null,
			// 	'oksitosin_6' => safe_post('oksitosin_6') !== '' ? safe_post('oksitosin_6') : null,
			// 	'oksitosin_7' => safe_post('oksitosin_7') !== '' ? safe_post('oksitosin_7') : null,
			// 	'oksitosin_8' => safe_post('oksitosin_8') !== '' ? safe_post('oksitosin_8') : null,
			// 	'oksitosin_9' => safe_post('oksitosin_9') !== '' ? safe_post('oksitosin_9') : null,
			// 	'oksitosin_10' => safe_post('oksitosin_10') !== '' ? safe_post('oksitosin_10') : null,
			// 	'oksitosin_11' => safe_post('oksitosin_11') !== '' ? safe_post('oksitosin_11') : null,
			// 	'oksitosin_12' => safe_post('oksitosin_12') !== '' ? safe_post('oksitosin_12') : null,
			// 	'oksitosin_13' => safe_post('oksitosin_13') !== '' ? safe_post('oksitosin_13') : null,
			// 	'oksitosin_14' => safe_post('oksitosin_14') !== '' ? safe_post('oksitosin_14') : null,
			// 	'oksitosin_15' => safe_post('oksitosin_15') !== '' ? safe_post('oksitosin_15') : null,
			// 	'oksitosin_16' => safe_post('oksitosin_16') !== '' ? safe_post('oksitosin_16') : null,
			// 	'oksitosin_17' => safe_post('oksitosin_17') !== '' ? safe_post('oksitosin_17') : null,
			// 	'oksitosin_18' => safe_post('oksitosin_18') !== '' ? safe_post('oksitosin_18') : null,
			// 	'oksitosin_19' => safe_post('oksitosin_19') !== '' ? safe_post('oksitosin_19') : null,
			// 	'oksitosin_20' => safe_post('oksitosin_20') !== '' ? safe_post('oksitosin_20') : null,
			// 	'oksitosin_21' => safe_post('oksitosin_21') !== '' ? safe_post('oksitosin_21') : null,
			// 	'oksitosin_22' => safe_post('oksitosin_22') !== '' ? safe_post('oksitosin_22') : null,
			// 	'oksitosin_23' => safe_post('oksitosin_23') !== '' ? safe_post('oksitosin_23') : null,
			// 	'oksitosin_24' => safe_post('oksitosin_24') !== '' ? safe_post('oksitosin_24') : null,
            // ]),

            // 'tetes' => json_encode([
			// 	'tetes_1' => safe_post('tetes_1') !== '' ? safe_post('tetes_1') : null,
			// 	'tetes_2' => safe_post('tetes_2') !== '' ? safe_post('tetes_2') : null,
			// 	'tetes_3' => safe_post('tetes_3') !== '' ? safe_post('tetes_3') : null,
			// 	'tetes_4' => safe_post('tetes_4') !== '' ? safe_post('tetes_4') : null,
			// 	'tetes_5' => safe_post('tetes_5') !== '' ? safe_post('tetes_5') : null,
			// 	'tetes_6' => safe_post('tetes_6') !== '' ? safe_post('tetes_6') : null,
			// 	'tetes_7' => safe_post('tetes_7') !== '' ? safe_post('tetes_7') : null,
			// 	'tetes_8' => safe_post('tetes_8') !== '' ? safe_post('tetes_8') : null,
			// 	'tetes_9' => safe_post('tetes_9') !== '' ? safe_post('tetes_9') : null,
			// 	'tetes_10' => safe_post('tetes_10') !== '' ? safe_post('tetes_10') : null,
			// 	'tetes_11' => safe_post('tetes_11') !== '' ? safe_post('tetes_11') : null,
			// 	'tetes_12' => safe_post('tetes_12') !== '' ? safe_post('tetes_12') : null,
			// 	'tetes_13' => safe_post('tetes_13') !== '' ? safe_post('tetes_13') : null,
			// 	'tetes_14' => safe_post('tetes_14') !== '' ? safe_post('tetes_14') : null,
			// 	'tetes_15' => safe_post('tetes_15') !== '' ? safe_post('tetes_15') : null,
			// 	'tetes_16' => safe_post('tetes_16') !== '' ? safe_post('tetes_16') : null,
			// 	'tetes_17' => safe_post('tetes_17') !== '' ? safe_post('tetes_17') : null,
			// 	'tetes_18' => safe_post('tetes_18') !== '' ? safe_post('tetes_18') : null,
			// 	'tetes_19' => safe_post('tetes_19') !== '' ? safe_post('tetes_19') : null,
			// 	'tetes_20' => safe_post('tetes_20') !== '' ? safe_post('tetes_20') : null,
			// 	'tetes_21' => safe_post('tetes_21') !== '' ? safe_post('tetes_21') : null,
			// 	'tetes_22' => safe_post('tetes_22') !== '' ? safe_post('tetes_22') : null,
			// 	'tetes_23' => safe_post('tetes_23') !== '' ? safe_post('tetes_23') : null,
			// 	'tetes_24' => safe_post('tetes_24') !== '' ? safe_post('tetes_24') : null,
            // ]),

            'oksitosin' => json_encode(array_reduce(range(1, 32), function ($carry, $i) {
                $key = "oksitosin_$i";
                $value = safe_post($key);
                $carry[$key] = $value !== '' ? $value : null;
                return $carry;
            }, [])),

            'tetes' => json_encode(array_reduce(range(1, 32), function ($carry, $i) {
                $key = "tetes_$i";
                $value = safe_post($key);
                $carry[$key] = $value !== '' ? $value : null;
                return $carry;
            }, [])),

            'obat_cairan' => json_encode(array_reduce(range(1, 16), function ($carry, $i) {
                $key = "obat_cairan_$i";
                $value = safe_post($key);
                $carry[$key] = $value !== '' ? $value : null;
                return $carry;
            }, [])),

            'suhu' => json_encode([
                'suhu_1' => safe_post('suhu_1') !== '' ? safe_post('suhu_1') : null,
				'suhu_2' => safe_post('suhu_2') !== '' ? safe_post('suhu_2') : null,
				'suhu_3' => safe_post('suhu_3') !== '' ? safe_post('suhu_3') : null,
				'suhu_4' => safe_post('suhu_4') !== '' ? safe_post('suhu_4') : null,
				'suhu_5' => safe_post('suhu_5') !== '' ? safe_post('suhu_5') : null,
				'suhu_6' => safe_post('suhu_6') !== '' ? safe_post('suhu_6') : null,
				'suhu_7' => safe_post('suhu_7') !== '' ? safe_post('suhu_7') : null,
				'suhu_8' => safe_post('suhu_8') !== '' ? safe_post('suhu_8') : null,
				'suhu_9' => safe_post('suhu_9') !== '' ? safe_post('suhu_9') : null,
				'suhu_10' => safe_post('suhu_10') !== '' ? safe_post('suhu_10') : null,
				'suhu_11' => safe_post('suhu_11') !== '' ? safe_post('suhu_11') : null,
				'suhu_12' => safe_post('suhu_12') !== '' ? safe_post('suhu_12') : null,
				'suhu_13' => safe_post('suhu_13') !== '' ? safe_post('suhu_13') : null,
				'suhu_14' => safe_post('suhu_14') !== '' ? safe_post('suhu_14') : null,
				'suhu_15' => safe_post('suhu_15') !== '' ? safe_post('suhu_15') : null,
				'suhu_16' => safe_post('suhu_16') !== '' ? safe_post('suhu_16') : null,
            ]),

            'protein' => json_encode([
				'protein_1' => safe_post('protein_1') !== '' ? safe_post('protein_1') : null,
				'protein_2' => safe_post('protein_2') !== '' ? safe_post('protein_2') : null,
				'protein_3' => safe_post('protein_3') !== '' ? safe_post('protein_3') : null,
				'protein_4' => safe_post('protein_4') !== '' ? safe_post('protein_4') : null,
				'protein_5' => safe_post('protein_5') !== '' ? safe_post('protein_5') : null,
				'protein_6' => safe_post('protein_6') !== '' ? safe_post('protein_6') : null,
				'protein_7' => safe_post('protein_7') !== '' ? safe_post('protein_7') : null,
				'protein_8' => safe_post('protein_8') !== '' ? safe_post('protein_8') : null,
				'protein_9' => safe_post('protein_9') !== '' ? safe_post('protein_9') : null,
				'protein_10' => safe_post('protein_10') !== '' ? safe_post('protein_10') : null,
				'protein_11' => safe_post('protein_11') !== '' ? safe_post('protein_11') : null,
				'protein_12' => safe_post('protein_12') !== '' ? safe_post('protein_12') : null,
				'protein_13' => safe_post('protein_13') !== '' ? safe_post('protein_13') : null,
				'protein_14' => safe_post('protein_14') !== '' ? safe_post('protein_14') : null,
				'protein_15' => safe_post('protein_15') !== '' ? safe_post('protein_15') : null,
				'protein_16' => safe_post('protein_16') !== '' ? safe_post('protein_16') : null,
            ]),

            'aseton' => json_encode([
				'aseton_1' => safe_post('aseton_1') !== '' ? safe_post('aseton_1') : null,
				'aseton_2' => safe_post('aseton_2') !== '' ? safe_post('aseton_2') : null,
				'aseton_3' => safe_post('aseton_3') !== '' ? safe_post('aseton_3') : null,
				'aseton_4' => safe_post('aseton_4') !== '' ? safe_post('aseton_4') : null,
				'aseton_5' => safe_post('aseton_5') !== '' ? safe_post('aseton_5') : null,
				'aseton_6' => safe_post('aseton_6') !== '' ? safe_post('aseton_6') : null,
				'aseton_7' => safe_post('aseton_7') !== '' ? safe_post('aseton_7') : null,
				'aseton_8' => safe_post('aseton_8') !== '' ? safe_post('aseton_8') : null,
				'aseton_9' => safe_post('aseton_9') !== '' ? safe_post('aseton_9') : null,
				'aseton_10' => safe_post('aseton_10') !== '' ? safe_post('aseton_10') : null,
				'aseton_11' => safe_post('aseton_11') !== '' ? safe_post('aseton_11') : null,
				'aseton_12' => safe_post('aseton_12') !== '' ? safe_post('aseton_12') : null,
				'aseton_13' => safe_post('aseton_13') !== '' ? safe_post('aseton_13') : null,
				'aseton_14' => safe_post('aseton_14') !== '' ? safe_post('aseton_14') : null,
				'aseton_15' => safe_post('aseton_15') !== '' ? safe_post('aseton_15') : null,
				'aseton_16' => safe_post('aseton_16') !== '' ? safe_post('aseton_16') : null,
            ]),

            'volume' => json_encode([
				'volume_1' => safe_post('volume_1') !== '' ? safe_post('volume_1') : null,
				'volume_2' => safe_post('volume_2') !== '' ? safe_post('volume_2') : null,
				'volume_3' => safe_post('volume_3') !== '' ? safe_post('volume_3') : null,
				'volume_4' => safe_post('volume_4') !== '' ? safe_post('volume_4') : null,
				'volume_5' => safe_post('volume_5') !== '' ? safe_post('volume_5') : null,
				'volume_6' => safe_post('volume_6') !== '' ? safe_post('volume_6') : null,
				'volume_7' => safe_post('volume_7') !== '' ? safe_post('volume_7') : null,
				'volume_8' => safe_post('volume_8') !== '' ? safe_post('volume_8') : null,
				'volume_9' => safe_post('volume_9') !== '' ? safe_post('volume_9') : null,
				'volume_10' => safe_post('volume_10') !== '' ? safe_post('volume_10') : null,
				'volume_11' => safe_post('volume_11') !== '' ? safe_post('volume_11') : null,
				'volume_12' => safe_post('volume_12') !== '' ? safe_post('volume_12') : null,
				'volume_13' => safe_post('volume_13') !== '' ? safe_post('volume_13') : null,
				'volume_14' => safe_post('volume_14') !== '' ? safe_post('volume_14') : null,
				'volume_15' => safe_post('volume_15') !== '' ? safe_post('volume_15') : null,
				'volume_16' => safe_post('volume_16') !== '' ? safe_post('volume_16') : null,
            ]),

            // TABEL
            'waktu_iv' => json_encode([
                'waktu_iv_1' => safe_post('waktu_iv_1') !== '' ? safe_post('waktu_iv_1') : null,
				'waktu_iv_2' => safe_post('waktu_iv_2') !== '' ? safe_post('waktu_iv_2') : null,
				'waktu_iv_3' => safe_post('waktu_iv_3') !== '' ? safe_post('waktu_iv_3') : null,
				'waktu_iv_4' => safe_post('waktu_iv_4') !== '' ? safe_post('waktu_iv_4') : null,
				'waktu_iv_5' => safe_post('waktu_iv_5') !== '' ? safe_post('waktu_iv_5') : null,
				'waktu_iv_6' => safe_post('waktu_iv_6') !== '' ? safe_post('waktu_iv_6') : null,
				'waktu_iv_7' => safe_post('waktu_iv_7') !== '' ? safe_post('waktu_iv_7') : null,
				// 'waktu_iv_8' => safe_post('waktu_iv_8') !== '' ? safe_post('waktu_iv_8') : null,
				// 'waktu_iv_9' => safe_post('waktu_iv_9') !== '' ? safe_post('waktu_iv_9') : null,
				// 'waktu_iv_10' => safe_post('waktu_iv_10') !== '' ? safe_post('waktu_iv_10') : null,
            ]),
            'tekanan_darah_iv' => json_encode([
                'tekanan_darah_iv_1' => safe_post('tekanan_darah_iv_1') !== '' ? safe_post('tekanan_darah_iv_1') : null,
				'tekanan_darah_iv_2' => safe_post('tekanan_darah_iv_2') !== '' ? safe_post('tekanan_darah_iv_2') : null,
				'tekanan_darah_iv_3' => safe_post('tekanan_darah_iv_3') !== '' ? safe_post('tekanan_darah_iv_3') : null,
				'tekanan_darah_iv_4' => safe_post('tekanan_darah_iv_4') !== '' ? safe_post('tekanan_darah_iv_4') : null,
				'tekanan_darah_iv_5' => safe_post('tekanan_darah_iv_5') !== '' ? safe_post('tekanan_darah_iv_5') : null,
				'tekanan_darah_iv_6' => safe_post('tekanan_darah_iv_6') !== '' ? safe_post('tekanan_darah_iv_6') : null,
				'tekanan_darah_iv_7' => safe_post('tekanan_darah_iv_7') !== '' ? safe_post('tekanan_darah_iv_7') : null,
				// 'tekanan_darah_iv_8' => safe_post('tekanan_darah_iv_8') !== '' ? safe_post('tekanan_darah_iv_8') : null,
				// 'tekanan_darah_iv_9' => safe_post('tekanan_darah_iv_9') !== '' ? safe_post('tekanan_darah_iv_9') : null,
				// 'tekanan_darah_iv_10' => safe_post('tekanan_darah_iv_10') !== '' ? safe_post('tekanan_darah_iv_10') : null,
            ]),
            'nadi_iv' => json_encode([
                'nadi_iv_1' => safe_post('nadi_iv_1') !== '' ? safe_post('nadi_iv_1') : null,
				'nadi_iv_2' => safe_post('nadi_iv_2') !== '' ? safe_post('nadi_iv_2') : null,
				'nadi_iv_3' => safe_post('nadi_iv_3') !== '' ? safe_post('nadi_iv_3') : null,
				'nadi_iv_4' => safe_post('nadi_iv_4') !== '' ? safe_post('nadi_iv_4') : null,
				'nadi_iv_5' => safe_post('nadi_iv_5') !== '' ? safe_post('nadi_iv_5') : null,
				'nadi_iv_6' => safe_post('nadi_iv_6') !== '' ? safe_post('nadi_iv_6') : null,
				'nadi_iv_7' => safe_post('nadi_iv_7') !== '' ? safe_post('nadi_iv_7') : null,
				// 'nadi_iv_8' => safe_post('nadi_iv_8') !== '' ? safe_post('nadi_iv_8') : null,
				// 'nadi_iv_9' => safe_post('nadi_iv_9') !== '' ? safe_post('nadi_iv_9') : null,
				// 'nadi_iv_10' => safe_post('nadi_iv_10') !== '' ? safe_post('nadi_iv_10') : null,
            ]),
            'suhu_iv' => json_encode([
                'suhu_iv_1' => safe_post('suhu_iv_1') !== '' ? safe_post('suhu_iv_1') : null,
				'suhu_iv_2' => safe_post('suhu_iv_2') !== '' ? safe_post('suhu_iv_2') : null,
				'suhu_iv_3' => safe_post('suhu_iv_3') !== '' ? safe_post('suhu_iv_3') : null,
				'suhu_iv_4' => safe_post('suhu_iv_4') !== '' ? safe_post('suhu_iv_4') : null,
				'suhu_iv_5' => safe_post('suhu_iv_5') !== '' ? safe_post('suhu_iv_5') : null,
				'suhu_iv_6' => safe_post('suhu_iv_6') !== '' ? safe_post('suhu_iv_6') : null,
				'suhu_iv_7' => safe_post('suhu_iv_7') !== '' ? safe_post('suhu_iv_7') : null,
				// 'suhu_iv_8' => safe_post('suhu_iv_8') !== '' ? safe_post('suhu_iv_8') : null,
				// 'suhu_iv_9' => safe_post('suhu_iv_9') !== '' ? safe_post('suhu_iv_9') : null,
				// 'suhu_iv_10' => safe_post('suhu_iv_10') !== '' ? safe_post('suhu_iv_10') : null,
            ]),
            'tfu_iv' => json_encode([
                'tfu_iv_1' => safe_post('tfu_iv_1') !== '' ? safe_post('tfu_iv_1') : null,
				'tfu_iv_2' => safe_post('tfu_iv_2') !== '' ? safe_post('tfu_iv_2') : null,
				'tfu_iv_3' => safe_post('tfu_iv_3') !== '' ? safe_post('tfu_iv_3') : null,
				'tfu_iv_4' => safe_post('tfu_iv_4') !== '' ? safe_post('tfu_iv_4') : null,
				'tfu_iv_5' => safe_post('tfu_iv_5') !== '' ? safe_post('tfu_iv_5') : null,
				'tfu_iv_6' => safe_post('tfu_iv_6') !== '' ? safe_post('tfu_iv_6') : null,
				'tfu_iv_7' => safe_post('tfu_iv_7') !== '' ? safe_post('tfu_iv_7') : null,
				// 'tfu_iv_8' => safe_post('tfu_iv_8') !== '' ? safe_post('tfu_iv_8') : null,
				// 'tfu_iv_9' => safe_post('tfu_iv_9') !== '' ? safe_post('tfu_iv_9') : null,
				// 'tfu_iv_10' => safe_post('tfu_iv_10') !== '' ? safe_post('tfu_iv_10') : null,
            ]),
            'kontraksi_uterus_iv' => json_encode([
                'kontraksi_uterus_iv_1' => safe_post('kontraksi_uterus_iv_1') !== '' ? safe_post('kontraksi_uterus_iv_1') : null,
				'kontraksi_uterus_iv_2' => safe_post('kontraksi_uterus_iv_2') !== '' ? safe_post('kontraksi_uterus_iv_2') : null,
				'kontraksi_uterus_iv_3' => safe_post('kontraksi_uterus_iv_3') !== '' ? safe_post('kontraksi_uterus_iv_3') : null,
				'kontraksi_uterus_iv_4' => safe_post('kontraksi_uterus_iv_4') !== '' ? safe_post('kontraksi_uterus_iv_4') : null,
				'kontraksi_uterus_iv_5' => safe_post('kontraksi_uterus_iv_5') !== '' ? safe_post('kontraksi_uterus_iv_5') : null,
				'kontraksi_uterus_iv_6' => safe_post('kontraksi_uterus_iv_6') !== '' ? safe_post('kontraksi_uterus_iv_6') : null,
				'kontraksi_uterus_iv_7' => safe_post('kontraksi_uterus_iv_7') !== '' ? safe_post('kontraksi_uterus_iv_7') : null,
				// 'kontraksi_uterus_iv_8' => safe_post('kontraksi_uterus_iv_8') !== '' ? safe_post('kontraksi_uterus_iv_8') : null,
				// 'kontraksi_uterus_iv_9' => safe_post('kontraksi_uterus_iv_9') !== '' ? safe_post('kontraksi_uterus_iv_9') : null,
				// 'kontraksi_uterus_iv_10' => safe_post('kontraksi_uterus_iv_10') !== '' ? safe_post('kontraksi_uterus_iv_10') : null,
            ]),
            'kandung_kemih_iv' => json_encode([
                'kandung_kemih_iv_1' => safe_post('kandung_kemih_iv_1') !== '' ? safe_post('kandung_kemih_iv_1') : null,
				'kandung_kemih_iv_2' => safe_post('kandung_kemih_iv_2') !== '' ? safe_post('kandung_kemih_iv_2') : null,
				'kandung_kemih_iv_3' => safe_post('kandung_kemih_iv_3') !== '' ? safe_post('kandung_kemih_iv_3') : null,
				'kandung_kemih_iv_4' => safe_post('kandung_kemih_iv_4') !== '' ? safe_post('kandung_kemih_iv_4') : null,
				'kandung_kemih_iv_5' => safe_post('kandung_kemih_iv_5') !== '' ? safe_post('kandung_kemih_iv_5') : null,
				'kandung_kemih_iv_6' => safe_post('kandung_kemih_iv_6') !== '' ? safe_post('kandung_kemih_iv_6') : null,
				'kandung_kemih_iv_7' => safe_post('kandung_kemih_iv_7') !== '' ? safe_post('kandung_kemih_iv_7') : null,
				// 'kandung_kemih_iv_8' => safe_post('kandung_kemih_iv_8') !== '' ? safe_post('kandung_kemih_iv_8') : null,
				// 'kandung_kemih_iv_9' => safe_post('kandung_kemih_iv_9') !== '' ? safe_post('kandung_kemih_iv_9') : null,
				// 'kandung_kemih_iv_10' => safe_post('kandung_kemih_iv_10') !== '' ? safe_post('kandung_kemih_iv_10') : null,
            ]),
            'darah_yg_keluar_iv' => json_encode([
                'darah_yg_keluar_iv_1' => safe_post('darah_yg_keluar_iv_1') !== '' ? safe_post('darah_yg_keluar_iv_1') : null,
				'darah_yg_keluar_iv_2' => safe_post('darah_yg_keluar_iv_2') !== '' ? safe_post('darah_yg_keluar_iv_2') : null,
				'darah_yg_keluar_iv_3' => safe_post('darah_yg_keluar_iv_3') !== '' ? safe_post('darah_yg_keluar_iv_3') : null,
				'darah_yg_keluar_iv_4' => safe_post('darah_yg_keluar_iv_4') !== '' ? safe_post('darah_yg_keluar_iv_4') : null,
				'darah_yg_keluar_iv_5' => safe_post('darah_yg_keluar_iv_5') !== '' ? safe_post('darah_yg_keluar_iv_5') : null,
				'darah_yg_keluar_iv_6' => safe_post('darah_yg_keluar_iv_6') !== '' ? safe_post('darah_yg_keluar_iv_6') : null,
				'darah_yg_keluar_iv_7' => safe_post('darah_yg_keluar_iv_7') !== '' ? safe_post('darah_yg_keluar_iv_7') : null,
				// 'darah_yg_keluar_iv_8' => safe_post('darah_yg_keluar_iv_8') !== '' ? safe_post('darah_yg_keluar_iv_8') : null,
				// 'darah_yg_keluar_iv_9' => safe_post('darah_yg_keluar_iv_9') !== '' ? safe_post('darah_yg_keluar_iv_9') : null,
				// 'darah_yg_keluar_iv_10' => safe_post('darah_yg_keluar_iv_10') !== '' ? safe_post('darah_yg_keluar_iv_10') : null,
            ]),

            'tgl_grafik_sk'        	        => safe_post('tgl_grafik_sk') !== '' ? safe_post('tgl_grafik_sk') : null,
            'jam_grafik_sk'        	        => safe_post('jam_grafik_sk') !== '' ? safe_post('jam_grafik_sk') : null,
            'keterangan_grafik_sk'        	=> safe_post('keterangan_grafik_sk') !== '' ? safe_post('keterangan_grafik_sk') : null,

            'waktujam' => json_encode([
				'waktujam_1' => safe_post('waktujam_1') !== '' ? safe_post('waktujam_1') : null,
				'waktujam_2' => safe_post('waktujam_2') !== '' ? safe_post('waktujam_2') : null,
				'waktujam_3' => safe_post('waktujam_3') !== '' ? safe_post('waktujam_3') : null,
				'waktujam_4' => safe_post('waktujam_4') !== '' ? safe_post('waktujam_4') : null,
				'waktujam_5' => safe_post('waktujam_5') !== '' ? safe_post('waktujam_5') : null,
				'waktujam_6' => safe_post('waktujam_6') !== '' ? safe_post('waktujam_6') : null,
				'waktujam_7' => safe_post('waktujam_7') !== '' ? safe_post('waktujam_7') : null,
				'waktujam_8' => safe_post('waktujam_8') !== '' ? safe_post('waktujam_8') : null,
				'waktujam_9' => safe_post('waktujam_9') !== '' ? safe_post('waktujam_9') : null,
				'waktujam_10' => safe_post('waktujam_10') !== '' ? safe_post('waktujam_10') : null,
				'waktujam_11' => safe_post('waktujam_11') !== '' ? safe_post('waktujam_11') : null,
				'waktujam_12' => safe_post('waktujam_12') !== '' ? safe_post('waktujam_12') : null,
				'waktujam_13' => safe_post('waktujam_13') !== '' ? safe_post('waktujam_13') : null,
				'waktujam_14' => safe_post('waktujam_14') !== '' ? safe_post('waktujam_14') : null,
				'waktujam_15' => safe_post('waktujam_15') !== '' ? safe_post('waktujam_15') : null,
				'waktujam_16' => safe_post('waktujam_16') !== '' ? safe_post('waktujam_16') : null,
            ]),
        );	

        $this->m_pelayanan->updateCatatanPersalinan($data_cp, $id_partograf);

		if (!empty($respon)) {
			$response = $respon;
		} else {
			$response = null;
		}
		if ($this->db->trans_status() === false) :
			$this->db->trans_rollback();
			$status = false;
		else :
			$this->db->trans_commit();
			$status = true;
		endif;
		$message = array(
			'status' => $status,
			'token'  => $this->security->get_csrf_hash(),
            'id_pendaftaran' => ('id_pendaftaran'),
            'id_layanan_pendaftaran' => ('id_layanan_pendaftaran'),
			'respon' => $response,
		);
		$this->response($message, REST_Controller::HTTP_OK);
	}



























    public function check_order_tarif_lab_get()
    {
        $id_layanan_pendaftaran = safe_get('id_layanan');

        $data = $this->db
            ->where('id_layanan_pendaftaran', $id_layanan_pendaftaran)
            ->where('status !=', 'batal')
            ->get('sm_order_laboratorium')
            ->result();

        $detail = [];
        foreach ($data as $order) {
            $item = json_decode($order->item);
            foreach ($item as $value) {
                $sql = "select kt.total
                        from sm_tarif_pelayanan kt
                        where kt.id = '" . $value->item . "'";
                $detail[] = $this->db->query($sql)->row();
            }
        }

        $layanan = $this->db->select('id_penjamin')->from('sm_layanan_pendaftaran')->where('id', $id_layanan_pendaftaran)->get()->row();

        $this->response([
            'tarif' => array_sum(array_column($detail, 'total')),
            'penjamin' => $layanan->id_penjamin
        ], REST_Controller::HTTP_OK);
    }

    function cek_checkout_get($id_layanan_pendaftaran)
    {
        $cek_OK1 = $this->db->select('COUNT(ko.id) as count')->from('sm_layanan_pendaftaran lp')->join('sm_jadwal_kamar_operasi ko', 'lp.id = ko.id_layanan_pendaftaran')
            ->where('lp.id', $id_layanan_pendaftaran)->where('ko.status', 'Request')->where('ko.status <>', 'Canceled')->get()->row()->count;

        $cek_OK2 = $this->db->select('COUNT(ko.id) as count')->from('sm_layanan_pendaftaran lp')->join('sm_jadwal_kamar_operasi ko', 'lp.id = ko.id_layanan_pendaftaran')
            ->where('lp.id', $id_layanan_pendaftaran)->where('ko.diperiksa', 'Belum')->where('ko.status <>', 'Canceled')->get()->row()->count;

        $response = array('status' => true, 'message' => 'Berhasil');
        if ($cek_OK1 >= 1) {
            $response = array('status' => false, 'message' => 'Tidak bisa menginput Status Keluar.<br>Masih ada <b>Order Operasi belum di konfirmasi</b>. Silahkan menghubungi Admin OK.');
        } else if ($cek_OK2 >= 1) {
            $response = array('status' => false, 'message' => 'Tidak bisa menginput Status Keluar.<br>Masih ada <b>Order Operasi belum dilayani</b>. Silahkan menghubungi Admin OK.');
        }

        $this->response($response, REST_Controller::HTTP_OK);
    }

    function simpan_edit_diagnosa_post()
    {
        $this->db->trans_begin();

        $id_sub_spesialis = NULL;
        if (isset($_POST['subspesialis'])) :
            $id_sub_spesialis = safe_post('subspesialis') !== '' ? safe_post('subspesialis') : NULL;
        endif;

        $dokter = safe_post('dokter') !== '' ? safe_post('dokter') : NULL;
        $layanan = array('id' => safe_post('id_layanan'), 'id_dokter' => $dokter, 'status_terlayani' => 'Sudah', 'id_sub_spesialis' => $id_sub_spesialis);
        // insert data anamnesa
        if (safe_post('jenis_layanan') === 'Rawat Inap') :
            $jenis = 'Rawat Inap';
        else :
            if (safe_post('jenis_layanan') === 'IGD') :
                $jenis = 'IGD';
            else :
                if (safe_post('jenis_layanan') === 'Pemulasaran Jenazah') :
                    $jenis = 'Pemulasaran Jenazah';
                else :
                    if (safe_post('jenis_layanan') === 'Hemodialisa') :
                        $jenis = 'Hemodialisa';
                    else :
                        $jenis = 'Rawat Jalan';
                    endif;
                endif;
            endif;
        endif;

        // data diagnosa
        $diagnosa = array(
            'id_diag'                   => $this->post('id_diag'),
            'id_dokter'                 => $this->post('dokter_diag'),
            'id_golongan_sebab_sakit'   => $this->post('id_golongan_sebab_sakit') !== '' ? $this->post('id_golongan_sebab_sakit') : NULL,
            'kode_diagnosa'             => $this->post('kode_diag') !== '' ? $this->post('kode_diag') : NULL,
            'diagnosa_manual'           => $this->post('diag_manual') === "on" ? NULL : $this->post('diag_manual'),
            'golongan_sebab_sakit_lain' => $this->post('gol_sebab_sakit_lain') !== '' ? $this->post('gol_sebab_sakit_lain') : NULL,
            'diagnosa_klinis'           => $this->post('diag_klinis') === "on" ? NULL : $this->post('diag_klinis'),
            'prioritas'                 => $this->post('prioritas') !== '' ? $this->post('prioritas') : NULL,
            'diagnosa_banding'          => $this->post('diag_banding') !== '' ? $this->post('diag_banding') : NULL,
            'diagnosa_akhir'            => $this->post('diag_akhir') === "on" ? 0 : $this->post('diag_akhir'),
            'penyebab_kematian'         => $this->post('sebab_kematian') === "on" ? 0 : $this->post('sebab_kematian'),
            'jenis_kasus'               => $this->post('jenis_kasus') !== '' ? $this->post('jenis_kasus') : NULL,
            'is_resume'                 => $this->post('is_resume') ?? 1,
        );

        if ($jenis !== "Rawat Inap") :
            $diagnosa['post'] = array(1);
        endif;

        // insert data diagnosa
        $this->m_pelayanan->simpanDiagnosaPemeriksaan($layanan['id'], $diagnosa, safe_post('id_pasien'));

        // update tanggal periksa
        $waktu_periksa = array('id_layanan_pendaftaran' => $layanan['id'], 'waktu' => $this->datetime);
        $this->m_pelayanan->updateWaktuPeriksa($waktu_periksa);

        // update tracer
        $this->load->model('Tracer_model', 'tracer');
        $this->tracer->updateStatusBerkas($layanan['id']);

        if ($this->db->trans_status() === false) :
            $this->db->trans_rollback();
            $status = false;
        else :
            $this->db->trans_commit();
            $status = true;
        endif;

        $message = array(
            'status' => $status,
            'token'  => $this->security->get_csrf_hash(),
            'id'     => $layanan['id'],
        );

        $this->response($message, REST_Controller::HTTP_OK);
    }

    function simpan_edit_diagnosa_icare_post()
    {
        $this->db->trans_begin();

        $id_sub_spesialis = NULL;
        if (isset($_POST['subspesialis'])) :
            $id_sub_spesialis = safe_post('subspesialis') !== '' ? safe_post('subspesialis') : NULL;
        endif;

        $dokter = safe_post('dokter') !== '' ? safe_post('dokter') : NULL;
        $layanan = array('id' => safe_post('id_layanan'), 'id_dokter' => $dokter, 'status_terlayani' => 'Sudah', 'id_sub_spesialis' => $id_sub_spesialis);

        if (safe_post('jenis_layanan') === 'Intensive Care') :
            $jenis = 'Intensive Care';
        else :
            if (safe_post('jenis_layanan') === 'IGD') :
                $jenis = 'IGD';
            else :
                if (safe_post('jenis_layanan') === 'Pemulasaran Jenazah') :
                    $jenis = 'Pemulasaran Jenazah';
                else :
                    if (safe_post('jenis_layanan') === 'Hemodialisa') :
                        $jenis = 'Hemodialisa';
                    else :
                        $jenis = 'Rawat Jalan';
                    endif;
                endif;
            endif;
        endif;

        // data diagnosa
        $diagnosa = array(
            'id_diag'                   => $this->post('id_diag'),
            'id_dokter'                 => $this->post('dokter_diag'),
            'id_golongan_sebab_sakit'   => $this->post('id_golongan_sebab_sakit') !== '' ? $this->post('id_golongan_sebab_sakit') : NULL,
            'kode_diagnosa'             => $this->post('kode_diag') !== '' ? $this->post('kode_diag') : NULL,
            'diagnosa_manual'           => $this->post('diag_manual'),
            'golongan_sebab_sakit_lain' => $this->post('gol_sebab_sakit_lain') !== '' ? $this->post('gol_sebab_sakit_lain') : NULL,
            'diagnosa_klinis'           => $this->post('diag_klinis') === "on" ? NULL : $this->post('diag_klinis'),
            'prioritas'                 => $this->post('prioritas') !== '' ? $this->post('prioritas') : NULL,
            'diagnosa_banding'          => $this->post('diag_banding') !== '' ? $this->post('diag_banding') : NULL,
            'diagnosa_akhir'            => $this->post('diag_akhir') === "on" ? 0 : $this->post('diag_akhir'),
            'penyebab_kematian'         => $this->post('sebab_kematian') === "on" ? 0 : $this->post('sebab_kematian'),
            'is_resume'                 => $this->post('is_resume') ?? 1,
        );

        if ($jenis !== "Intensive Care") :
            $diagnosa['post'] = array(1);
        endif;

        // insert data diagnosa
        $this->m_pelayanan->simpanDiagnosaPemeriksaan($layanan['id'], $diagnosa, safe_post('id_pasien'));

        // update tanggal periksa
        $waktu_periksa = array('id_layanan_pendaftaran' => $layanan['id'], 'waktu' => $this->datetime);
        $this->m_pelayanan->updateWaktuPeriksa($waktu_periksa);

        // update tracer
        $this->load->model('Tracer_model', 'tracer');
        $this->tracer->updateStatusBerkas($layanan['id']);

        if ($this->db->trans_status() === false) :
            $this->db->trans_rollback();
            $status = false;
        else :
            $this->db->trans_commit();
            $status = true;
        endif;

        $message = array(
            'status' => $status,
            'token'  => $this->security->get_csrf_hash(),
            'id'     => $layanan['id'],
        );

        $this->response($message, REST_Controller::HTTP_OK);
    }



    // PENGKAJIAN UPAYA LANSIA
    function get_data_entri_lansia_get(){
        if (!$this->get('id')) :
            $this->response(NULL, REST_Controller::HTTP_BAD_REQUEST); // (400)
        endif;

        $this->load->model('pendaftaran/Pendaftaran_model', 'm_pendaftaran');
        $data = $this->m_pendaftaran->getPendaftaranDetail($this->get('id', true), $this->get('id_layanan', true));
        $data['profil'] = $this->m_pelayanan->getProfilPasien($data['pasien']->id_pasien);

        $data['pengkajian_ulang_resiko_jatuh_pasien_lansia'] = $this->m_pelayanan->getPengkajianUlangResikoJatuhPasienLansia($this->get('id', true));

        $data['upaya_pencegahan_risiko_jatuh_pasien_lansia'] = $this->m_pelayanan->getUpayaPencegahanPasienLansia($this->get('id', true));

        if ($data) :
            $this->response($data, REST_Controller::HTTP_OK); // (200)
        endif;
    }

    // PENGKAJIAN UPAYA LANSIA
    function simpan_resiko_jatuh_pasien_lansia_post(){
        $layanan = array('id' => safe_post('id_layanan_pendaftaran'));
        $purjl_tanggal_pengkajian = safe_post('purjpl_tanggal_pengkajian');
        $id_pendaftaran           = safe_post('id_pendaftaran');

        if (!empty($purjl_tanggal_pengkajian)) {
            $pengkajian_date_lansia = safe_post('pengkajian_date_lansia') ?? null;

            $pengkajian_ulang = array(
                'id_pendaftaran'             => $id_pendaftaran,
                'id_layanan_pendaftaran'     => $layanan['id'],
                'id_perawat'                 => safe_post('purjpl_perawat') !== '' ? safe_post('purjpl_perawat') : null,
                'id_user'                    => safe_post('user_pengkajian') !== '' ? safe_post('user_pengkajian') : null,
                'tanggal_pengkajian'         => safe_post('purjpl_tanggal_pengkajian'),
                'jumlah_skor'                => safe_post('jumlah_skor') !== '' ? safe_post('jumlah_skor') : null,
                'paraf'                      => safe_post('purjpl_paraf') !== '' ? safe_post('purjpl_paraf') : null,
                'pasien_datang_karena_jatuh' => safe_post('purjpl_pasien_datang_karena_jatuh') !== '' ? safe_post('purjpl_pasien_datang_karena_jatuh') : null,
                'jatuh_dua_bulan_terakhir'   => safe_post('purjpl_jatuh_2_bulan_terakhir') !== '' ? safe_post('purjpl_jatuh_2_bulan_terakhir') : null,
                'delirium'                   => safe_post('purjpl_pasien_delirium') !== '' ? safe_post('purjpl_pasien_delirium') : null,
                'disorientasi'               => safe_post('purjpl_pasien_disorientasi') !== '' ? safe_post('purjpl_pasien_disorientasi') : null,
                'agitasi'                    => safe_post('purjpl_pasien_agitasi') !== '' ? safe_post('purjpl_pasien_agitasi') : null,
                'kacamata'                   => safe_post('purjpl_pasien_kacamata') !== '' ? safe_post('purjpl_pasien_kacamata') : null,
                'buram'                      => safe_post('purjpl_pasien_buram') !== '' ? safe_post('purjpl_pasien_buram') : null,
                'galukoma'                   => safe_post('purjpl_pasien_galukoma') !== '' ? safe_post('purjpl_pasien_galukoma') : null,
                'berkemih'                   => safe_post('purjpl_berkemih') !== '' ? safe_post('purjpl_berkemih') : null,
                'purjpl_pasien_mandirit'     => safe_post('purjpl_pasien_mandirit') !== '' ? safe_post('purjpl_pasien_mandirit') : null,
                'purjpl_pasien_m_mandiri'    => safe_post('purjpl_pasien_m_mandiri') !== '' ? safe_post('purjpl_pasien_m_mandiri') : null,
                'mandiri'                    => safe_post('purjpl_pasien_mandiri') !== '' ? safe_post('purjpl_pasien_mandiri') : null,
                'sedikit_bantuan'            => safe_post('purjpl_pasien_sedikit_bantuan') !== '' ? safe_post('purjpl_pasien_sedikit_bantuan') : null,
                'bantuan_nyata'              => safe_post('purjpl_pasien_bantuan_nyata') !== '' ? safe_post('purjpl_pasien_bantuan_nyata') : null,
                'bantuan_total'              => safe_post('purjpl_pasien_bantuan_total') !== '' ? safe_post('purjpl_pasien_bantuan_total') : null,
                'm_mandiri'                  => safe_post('purjpl_pasien_m_mandiri') !== '' ? safe_post('purjpl_pasien_m_mandiri') : null,
                'm_sedikit_bantuan'          => safe_post('purjpl_pasien_m_sedikit_bantuan') !== '' ? safe_post('purjpl_pasien_m_sedikit_bantuan') : null,
                'kursi_roda'                 => safe_post('purjpl_pasien_kursi_roda') !== '' ? safe_post('purjpl_pasien_kursi_roda') : null,
                'imobilisasi'                => safe_post('purjpl_pasien_imobilisasi') !== '' ? safe_post('purjpl_pasien_imobilisasi') : null,
                'date_created'               => $pengkajian_date_lansia,
            );
            // var_dump($pengkajian_ulang);die;
            $this->m_pelayanan->insertPengkajianUlangLansia($pengkajian_ulang);
        }

        $uprjpl_tanggal_pengkajian = safe_post('uprjpl_tanggal_pengkajian');
        $id_pendaftaran           = safe_post('id_pendaftaran');

        if (!empty($uprjpl_tanggal_pengkajian)) {
            $pengkajian_ulang = array(
                'id_pendaftaran'         => $id_pendaftaran,
                'id_layanan_pendaftaran' => $layanan['id'],
                'id_perawat_p'           => safe_post('uprjpl_perawat_p') !== '' ? safe_post('uprjpl_perawat_p') : null,
                'id_perawat_s'           => safe_post('uprjpl_perawat_s') !== '' ? safe_post('uprjpl_perawat_s') : null,
                'id_perawat_m'           => safe_post('uprjpl_perawat_m') !== '' ? safe_post('uprjpl_perawat_m') : null,
                'id_user'                => safe_post('user_pengkajian') !== '' ? safe_post('user_pengkajian') : null,
                'tanggal_pengkajian'     => safe_post('uprjpl_tanggal_pengkajian'),

                // Bel berfungsi dan mudah dijangkau
                'bel_p_ho'               => safe_post('uprjpl_bel_p_ho') !== '' ? safe_post('uprjpl_bel_p_ho') : null,
                'bel_p_10'               => safe_post('uprjpl_bel_p_10') !== '' ? safe_post('uprjpl_bel_p_10') : null,
                'bel_s_ho'               => safe_post('uprjpl_bel_s_ho') !== '' ? safe_post('uprjpl_bel_s_ho') : null,
                'bel_s_18'               => safe_post('uprjpl_bel_s_18') !== '' ? safe_post('uprjpl_bel_s_18') : null,
                'bel_m_ho'               => safe_post('uprjpl_bel_m_ho') !== '' ? safe_post('uprjpl_bel_m_ho') : null,
                'bel_m_23'               => safe_post('uprjpl_bel_m_23') !== '' ? safe_post('uprjpl_bel_m_23') : null,
                'bel_m_4'                => safe_post('uprjpl_bel_m_4') !== '' ? safe_post('uprjpl_bel_m_4') : null,

                // Roda tempat tidur terkunci
                'roda_p_ho'              => safe_post('uprjpl_roda_p_ho') !== '' ? safe_post('uprjpl_roda_p_ho') : null,
                'roda_p_10'              => safe_post('uprjpl_roda_p_10') !== '' ? safe_post('uprjpl_roda_p_10') : null,
                'roda_s_ho'              => safe_post('uprjpl_roda_s_ho') !== '' ? safe_post('uprjpl_roda_s_ho') : null,
                'roda_s_18'              => safe_post('uprjpl_roda_s_18') !== '' ? safe_post('uprjpl_roda_s_18') : null,
                'roda_m_ho'              => safe_post('uprjpl_roda_m_ho') !== '' ? safe_post('uprjpl_roda_m_ho') : null,
                'roda_m_23'              => safe_post('uprjpl_roda_m_23') !== '' ? safe_post('uprjpl_roda_m_23') : null,
                'roda_m_4'               => safe_post('uprjpl_roda_m_4') !== '' ? safe_post('uprjpl_roda_m_4') : null,

                // Posisikan tempat tidur pada posisi terendah
                'ptt_p_ho'               => safe_post('uprjpl_ptt_p_ho') !== '' ? safe_post('uprjpl_ptt_p_ho') : null,
                'ptt_p_10'               => safe_post('uprjpl_ptt_p_10') !== '' ? safe_post('uprjpl_ptt_p_10') : null,
                'ptt_s_ho'               => safe_post('uprjpl_ptt_s_ho') !== '' ? safe_post('uprjpl_ptt_s_ho') : null,
                'ptt_s_18'               => safe_post('uprjpl_ptt_s_18') !== '' ? safe_post('uprjpl_ptt_s_18') : null,
                'ptt_m_ho'               => safe_post('uprjpl_ptt_m_ho') !== '' ? safe_post('uprjpl_ptt_m_ho') : null,
                'ptt_m_23'               => safe_post('uprjpl_ptt_m_23') !== '' ? safe_post('uprjpl_ptt_m_23') : null,
                'ptt_m_4'                => safe_post('uprjpl_ptt_m_4') !== '' ? safe_post('uprjpl_ptt_m_4') : null,

                // Pagar pengaman tempat tidur dinaikan
                'ppt_p_ho'               => safe_post('uprjpl_ppt_p_ho') !== '' ? safe_post('uprjpl_ppt_p_ho') : null,
                'ppt_p_10'               => safe_post('uprjpl_ppt_p_10') !== '' ? safe_post('uprjpl_ppt_p_10') : null,
                'ppt_s_ho'               => safe_post('uprjpl_ppt_s_ho') !== '' ? safe_post('uprjpl_ppt_s_ho') : null,
                'ppt_s_18'               => safe_post('uprjpl_ppt_s_18') !== '' ? safe_post('uprjpl_ppt_s_18') : null,
                'ppt_m_ho'               => safe_post('uprjpl_ppt_m_ho') !== '' ? safe_post('uprjpl_ppt_m_ho') : null,
                'ppt_m_23'               => safe_post('uprjpl_ppt_m_23') !== '' ? safe_post('uprjpl_ppt_m_23') : null,
                'ppt_m_4'                => safe_post('uprjpl_ppt_m_4') !== '' ? safe_post('uprjpl_ppt_m_4') : null,

                // Penerang cukup
                'penerangan_p_ho'        => safe_post('uprjpl_penerangan_p_ho') !== '' ? safe_post('uprjpl_penerangan_p_ho') : null,
                'penerangan_p_10'        => safe_post('uprjpl_penerangan_p_10') !== '' ? safe_post('uprjpl_penerangan_p_10') : null,
                'penerangan_s_ho'        => safe_post('uprjpl_penerangan_s_ho') !== '' ? safe_post('uprjpl_penerangan_s_ho') : null,
                'penerangan_s_18'        => safe_post('uprjpl_penerangan_s_18') !== '' ? safe_post('uprjpl_penerangan_s_18') : null,
                'penerangan_m_ho'        => safe_post('uprjpl_penerangan_m_ho') !== '' ? safe_post('uprjpl_penerangan_m_ho') : null,
                'penerangan_m_23'        => safe_post('uprjpl_penerangan_m_23') !== '' ? safe_post('uprjpl_penerangan_m_23') : null,
                'penerangan_m_4'         => safe_post('uprjpl_penerangan_m_4') !== '' ? safe_post('uprjpl_penerangan_m_4') : null,

                // Pastikan alas kaki yang tidak licin untuk pasien yang dapat berjalan
                'alas_p_ho'              => safe_post('uprjpl_alas_p_ho') !== '' ? safe_post('uprjpl_alas_p_ho') : null,
                'alas_p_10'              => safe_post('uprjpl_alas_p_10') !== '' ? safe_post('uprjpl_alas_p_10') : null,
                'alas_s_ho'              => safe_post('uprjpl_alas_s_ho') !== '' ? safe_post('uprjpl_alas_s_ho') : null,
                'alas_s_18'              => safe_post('uprjpl_alas_s_18') !== '' ? safe_post('uprjpl_alas_s_18') : null,
                'alas_m_ho'              => safe_post('uprjpl_alas_m_ho') !== '' ? safe_post('uprjpl_alas_m_ho') : null,
                'alas_m_23'              => safe_post('uprjpl_alas_m_23') !== '' ? safe_post('uprjpl_alas_m_23') : null,
                'alas_m_4'               => safe_post('uprjpl_alas_m_4') !== '' ? safe_post('uprjpl_alas_m_4') : null,

                // Lantai kering dan tidak licin
                'lantai_p_ho'            => safe_post('uprjpl_lantai_p_ho') !== '' ? safe_post('uprjpl_lantai_p_ho') : null,
                'lantai_p_10'            => safe_post('uprjpl_lantai_p_10') !== '' ? safe_post('uprjpl_lantai_p_10') : null,
                'lantai_s_ho'            => safe_post('uprjpl_lantai_s_ho') !== '' ? safe_post('uprjpl_lantai_s_ho') : null,
                'lantai_s_18'            => safe_post('uprjpl_lantai_s_18') !== '' ? safe_post('uprjpl_lantai_s_18') : null,
                'lantai_m_ho'            => safe_post('uprjpl_lantai_m_ho') !== '' ? safe_post('uprjpl_lantai_m_ho') : null,
                'lantai_m_23'            => safe_post('uprjpl_lantai_m_23') !== '' ? safe_post('uprjpl_lantai_m_23') : null,
                'lantai_m_4'             => safe_post('uprjpl_lantai_m_4') !== '' ? safe_post('uprjpl_lantai_m_4') : null,

                // Dekatkan alat-alat pasien
                'alat_p_ho'              => safe_post('uprjpl_alat_p_ho') !== '' ? safe_post('uprjpl_alat_p_ho') : null,
                'alat_p_10'              => safe_post('uprjpl_alat_p_10') !== '' ? safe_post('uprjpl_alat_p_10') : null,
                'alat_s_ho'              => safe_post('uprjpl_alat_s_ho') !== '' ? safe_post('uprjpl_alat_s_ho') : null,
                'alat_s_18'              => safe_post('uprjpl_alat_s_18') !== '' ? safe_post('uprjpl_alat_s_18') : null,
                'alat_m_ho'              => safe_post('uprjpl_alat_m_ho') !== '' ? safe_post('uprjpl_alat_m_ho') : null,
                'alat_m_23'              => safe_post('uprjpl_alat_m_23') !== '' ? safe_post('uprjpl_alat_m_23') : null,
                'alat_m_4'               => safe_post('uprjpl_alat_m_4') !== '' ? safe_post('uprjpl_alat_m_4') : null,

                // Edukasi pasien tentang efek samping obat yang diberikan
                'edukasi_p_ho'           => safe_post('uprjpl_edukasi_p_ho') !== '' ? safe_post('uprjpl_edukasi_p_ho') : null,
                'edukasi_p_10'           => safe_post('uprjpl_edukasi_p_10') !== '' ? safe_post('uprjpl_edukasi_p_10') : null,
                'edukasi_s_ho'           => safe_post('uprjpl_edukasi_s_ho') !== '' ? safe_post('uprjpl_edukasi_s_ho') : null,
                'edukasi_s_18'           => safe_post('uprjpl_edukasi_s_18') !== '' ? safe_post('uprjpl_edukasi_s_18') : null,
                'edukasi_m_ho'           => safe_post('uprjpl_edukasi_m_ho') !== '' ? safe_post('uprjpl_edukasi_m_ho') : null,
                'edukasi_m_23'           => safe_post('uprjpl_edukasi_m_23') !== '' ? safe_post('uprjpl_edukasi_m_23') : null,
                'edukasi_m_4'            => safe_post('uprjpl_edukasi_m_4') !== '' ? safe_post('uprjpl_edukasi_m_4') : null,

                // Tidak meninggalkan pasien di kamar mandi saat menggunakan commode
                'commode_p_ho'           => safe_post('uprjpl_commode_p_ho') !== '' ? safe_post('uprjpl_commode_p_ho') : null,
                'commode_p_10'           => safe_post('uprjpl_commode_p_10') !== '' ? safe_post('uprjpl_commode_p_10') : null,
                'commode_s_ho'           => safe_post('uprjpl_commode_s_ho') !== '' ? safe_post('uprjpl_commode_s_ho') : null,
                'commode_s_18'           => safe_post('uprjpl_commode_s_18') !== '' ? safe_post('uprjpl_commode_s_18') : null,
                'commode_m_ho'           => safe_post('uprjpl_commode_m_ho') !== '' ? safe_post('uprjpl_commode_m_ho') : null,
                'commode_m_23'           => safe_post('uprjpl_commode_m_23') !== '' ? safe_post('uprjpl_commode_m_23') : null,
                'commode_m_4'            => safe_post('uprjpl_commode_m_4') !== '' ? safe_post('uprjpl_commode_m_4') : null,

                // Pasang gelang khusus
                'gelang_p_ho'            => safe_post('uprjpl_gelang_p_ho') !== '' ? safe_post('uprjpl_gelang_p_ho') : null,
                'gelang_p_10'            => safe_post('uprjpl_gelang_p_10') !== '' ? safe_post('uprjpl_gelang_p_10') : null,
                'gelang_s_ho'            => safe_post('uprjpl_gelang_s_ho') !== '' ? safe_post('uprjpl_gelang_s_ho') : null,
                'gelang_s_18'            => safe_post('uprjpl_gelang_s_18') !== '' ? safe_post('uprjpl_gelang_s_18') : null,
                'gelang_m_ho'            => safe_post('uprjpl_gelang_m_ho') !== '' ? safe_post('uprjpl_gelang_m_ho') : null,
                'gelang_m_23'            => safe_post('uprjpl_gelang_m_23') !== '' ? safe_post('uprjpl_gelang_m_23') : null,
                'gelang_m_4'             => safe_post('uprjpl_gelang_m_4') !== '' ? safe_post('uprjpl_gelang_m_4') : null,

                // Tempatkan pasien di kamar yang paling dekat dengan Nurse Station
                'station_p_ho'           => safe_post('uprjpl_station_p_ho') !== '' ? safe_post('uprjpl_station_p_ho') : null,
                'station_p_10'           => safe_post('uprjpl_station_p_10') !== '' ? safe_post('uprjpl_station_p_10') : null,
                'station_s_ho'           => safe_post('uprjpl_station_s_ho') !== '' ? safe_post('uprjpl_station_s_ho') : null,
                'station_s_18'           => safe_post('uprjpl_station_s_18') !== '' ? safe_post('uprjpl_station_s_18') : null,
                'station_m_ho'           => safe_post('uprjpl_station_m_ho') !== '' ? safe_post('uprjpl_station_m_ho') : null,
                'station_m_23'           => safe_post('uprjpl_station_m_23') !== '' ? safe_post('uprjpl_station_m_23') : null,
                'station_m_4'            => safe_post('uprjpl_station_m_4') !== '' ? safe_post('uprjpl_station_m_4') : null,

                // Paraf
                'paraf_p_ho'             => safe_post('uprjpl_paraf_p_ho') !== '' ? safe_post('uprjpl_paraf_p_ho') : null,
                'paraf_p_10'             => safe_post('uprjpl_paraf_p_10') !== '' ? safe_post('uprjpl_paraf_p_10') : null,
                'paraf_s_ho'             => safe_post('uprjpl_paraf_s_ho') !== '' ? safe_post('uprjpl_paraf_s_ho') : null,
                'paraf_s_18'             => safe_post('uprjpl_paraf_s_18') !== '' ? safe_post('uprjpl_paraf_s_18') : null,
                'paraf_m_ho'             => safe_post('uprjpl_paraf_m_ho') !== '' ? safe_post('uprjpl_paraf_m_ho') : null,
                'paraf_m_23'             => safe_post('uprjpl_paraf_m_23') !== '' ? safe_post('uprjpl_paraf_m_23') : null,
                'paraf_m_4'              => safe_post('uprjpl_paraf_m_4') !== '' ? safe_post('uprjpl_paraf_m_4') : null,

                'date_created' => safe_post('pencegahan_date_lansia') !== '' ? safe_post('pencegahan_date_lansia') : null,
            );

            $this->m_pelayanan->insertUpayaPencegahanLansia($pengkajian_ulang);
        }

        if (!empty($respon)) {

            $response = $respon;
        } else {

            $response = null;
        }

        if ($this->db->trans_status() === false) :
            $this->db->trans_rollback();
            $status = false;
        else :
            $this->db->trans_commit();
            $status = true;
        endif;

        $message = array(
            'status' => $status,
            'token'  => $this->security->get_csrf_hash(),
            'id'     => $layanan['id'],
            'respon' => $response,
        );
        $this->response($message, REST_Controller::HTTP_OK);
    }

    // PENGKAJIAN LANSIA
    function update_pengkajian_ulang_risiko_jatuh_pasien_lansia_put(){
        if (!$this->put('id', true)) :
            $this->response(array('status' => false), REST_Controller::HTTP_OK);
        endif;

        $tanggal_pengkajian = $this->put('purjpl_tanggal_pengkajian', true);
        $tanggal_pengkajian = str_replace('/', '-', $tanggal_pengkajian);

        $tanggal_pengkajian         = date('Y-m-d', strtotime($tanggal_pengkajian));
        $jumlah_skor                = $this->put('purjpl_jumlah_skor', true);
        $paraf                      = $this->put('purjpl_paraf', true) ? 1 : 0;
        $id_perawat                 = $this->put('purjpl_perawat', true);
        $pasien_datang_karena_jatuh = $this->put('purjpl_pasien_datang_karena_jatuh', true);
        $jatuh_dua_bulan_terakhir   = $this->put('purjpl_jatuh_2_bulan_terakhir', true);
        $delirium                   = $this->put('purjpl_pasien_delirium', true);
        $disorientasi               = $this->put('purjpl_pasien_disorientasi', true);
        $agitasi                    = $this->put('purjpl_pasien_agitasi', true);
        $kacamata                   = $this->put('purjpl_pasien_kacamata', true);
        $buram                      = $this->put('purjpl_pasien_buram', true);
        $galukoma                   = $this->put('purjpl_pasien_galukoma', true);
        $berkemih                   = $this->put('purjpl_berkemih', true);

        $purjpl_pasien_mandirit     = $this->put('purjpl_pasien_mandirit', true);
        $purjpl_pasien_m_mandiri    = $this->put('purjpl_pasien_m_mandiri', true);

        $mandiri                    = $this->put('purjpl_pasien_mandiri', true);
        $sedikit_bantuan            = $this->put('purjpl_pasien_sedikit_bantuan', true);
        $bantuan_nyata              = $this->put('purjpl_pasien_bantuan_nyata', true);
        $bantuan_total              = $this->put('purjpl_pasien_bantuan_total', true);
        $m_mandiri                  = $this->put('purjpl_pasien_m_mandiri', true);
        $m_sedikit_bantuan          = $this->put('purjpl_pasien_m_sedikit_bantuan', true);
        $kursi_roda                 = $this->put('purjpl_pasien_kursi_roda', true);
        $imobilisasi                = $this->put('purjpl_pasien_imobilisasi', true);
        $data = array(
            'id'                         => $this->put('id', true),
            'tanggal_pengkajian'         => $tanggal_pengkajian,
            'jumlah_skor'                => $jumlah_skor,
            'paraf'                      => $paraf,
            'id_perawat'                 => $id_perawat,
            'pasien_datang_karena_jatuh' => $pasien_datang_karena_jatuh,
            'jatuh_dua_bulan_terakhir'   => $jatuh_dua_bulan_terakhir,
            'delirium'                   => $delirium,
            'disorientasi'               => $disorientasi,
            'agitasi'                    => $agitasi,
            'kacamata'                   => $kacamata,
            'buram'                      => $buram,
            'galukoma'                   => $galukoma,
            'berkemih'                   => $berkemih,

            'purjpl_pasien_mandirit'                   => $purjpl_pasien_mandirit,
            'purjpl_pasien_m_mandiri'                   => $purjpl_pasien_m_mandiri,

            'mandiri'                    => $mandiri,
            'sedikit_bantuan'            => $sedikit_bantuan,
            'bantuan_nyata'              => $bantuan_nyata,
            'bantuan_total'              => $bantuan_total,
            'm_mandiri'                  => $m_mandiri,
            'm_sedikit_bantuan'          => $m_sedikit_bantuan,
            'kursi_roda'                 => $kursi_roda,
            'imobilisasi'                => $imobilisasi,
            'updated_at'                 => date('Y-m-d H:i:s', time()),
        );

        $status = $this->m_pelayanan->editPengkajianRisikoJatuhPasienLansia($data);
        $this->response(array('status' => $status), REST_Controller::HTTP_OK);
    }

    // PENGKAJIAN LANSIA
    function get_pengkajian_ulang_resiko_jatuh_pasien_lansia_get(){
        if (!$this->get('id', true)) :
            $this->response(null, REST_Controller::HTTP_BAD_REQUEST);
        endif;

        $data = $this->m_pelayanan->getPengkajianUlangResikoJatuhPasienLansiaByID($this->get('id', true));
        $this->response($data, REST_Controller::HTTP_OK);
    }

    // PENGKAJIAN LANSIA
    function hapus_pengkajian_ulang_resiko_jatuh_pasien_lansia_delete($id){
        $status = $this->m_pelayanan->deletePengkajianUlangRisikoJatuhPasienLansia($id);
        if ($status) :
            $response = array('status' => $status, 'message' => 'Berhasil menghapus Pengkajian Ulang Risiko Jatuh Pasien Lansia!');
        else :
            $response = array('status' => $status, 'message' => 'Gagal menghapus Pengkajian Ulang Risiko Jatuh Pasien Lansia!');
        endif;
        $this->response($response, REST_Controller::HTTP_OK);
    }

    // UPAYA LANSIA
    function update_upaya_pencegahan_risiko_jatuh_pasien_lansia_put(){
        if (!$this->put('id', true)) :
            $this->response(array('status' => false), REST_Controller::HTTP_OK);
        endif;

        $tanggal_pengkajian = $this->put('uprjpl_tanggal_pengkajian', true);
        $tanggal_pengkajian = str_replace('/', '-', $tanggal_pengkajian);

        $tanggal_pengkajian = date('Y-m-d', strtotime($tanggal_pengkajian));
        $id_perawat_p       = $this->put('uprjpl_perawat_p', true);
        $id_perawat_s       = $this->put('uprjpl_perawat_s', true);
        $id_perawat_m       = $this->put('uprjpl_perawat_m', true);

        // Bel berfungsi dan mudah dijangkau
        $bel_p_ho = $this->put('uprjpl_bel_p_ho', true);
        $bel_p_10 = $this->put('uprjpl_bel_p_10', true);
        $bel_s_ho = $this->put('uprjpl_bel_s_ho', true);
        $bel_s_18 = $this->put('uprjpl_bel_s_18', true);
        $bel_m_ho = $this->put('uprjpl_bel_m_ho', true);
        $bel_m_23 = $this->put('uprjpl_bel_m_23', true);
        $bel_m_4  = $this->put('uprjpl_bel_m_4', true);

        // Roda tempat tidur terkunci
        $roda_p_ho = $this->put('uprjpl_roda_p_ho', true);
        $roda_p_10 = $this->put('uprjpl_roda_p_10', true);
        $roda_s_ho = $this->put('uprjpl_roda_s_ho', true);
        $roda_s_18 = $this->put('uprjpl_roda_s_18', true);
        $roda_m_ho = $this->put('uprjpl_roda_m_ho', true);
        $roda_m_23 = $this->put('uprjpl_roda_m_23', true);
        $roda_m_4  = $this->put('uprjpl_roda_m_4', true);

        // Posisikan tempat tidur pada posisi terendah
        $ptt_p_ho = $this->put('uprjpl_ptt_p_ho', true);
        $ptt_p_10 = $this->put('uprjpl_ptt_p_10', true);
        $ptt_s_ho = $this->put('uprjpl_ptt_s_ho', true);
        $ptt_s_18 = $this->put('uprjpl_ptt_s_18', true);
        $ptt_m_ho = $this->put('uprjpl_ptt_m_ho', true);
        $ptt_m_23 = $this->put('uprjpl_ptt_m_23', true);
        $ptt_m_4  = $this->put('uprjpl_ptt_m_4', true);

        // Pagar pengaman tempat tidur dinaikan
        $ppt_p_ho = $this->put('uprjpl_ppt_p_ho', true);
        $ppt_p_10 = $this->put('uprjpl_ppt_p_10', true);
        $ppt_s_ho = $this->put('uprjpl_ppt_s_ho', true);
        $ppt_s_18 = $this->put('uprjpl_ppt_s_18', true);
        $ppt_m_ho = $this->put('uprjpl_ppt_m_ho', true);
        $ppt_m_23 = $this->put('uprjpl_ppt_m_23', true);
        $ppt_m_4  = $this->put('uprjpl_ppt_m_4', true);

        // Penerang cukup
        $penerangan_p_ho = $this->put('uprjpl_penerangan_p_ho', true);
        $penerangan_p_10 = $this->put('uprjpl_penerangan_p_10', true);
        $penerangan_s_ho = $this->put('uprjpl_penerangan_s_ho', true);
        $penerangan_s_18 = $this->put('uprjpl_penerangan_s_18', true);
        $penerangan_m_ho = $this->put('uprjpl_penerangan_m_ho', true);
        $penerangan_m_23 = $this->put('uprjpl_penerangan_m_23', true);
        $penerangan_m_4  = $this->put('uprjpl_penerangan_m_4', true);

        // Pastikan alas kaki yang tidak licin untuk pasien yang dapat berjalan
        $alas_p_ho = $this->put('uprjpl_alas_p_ho', true);
        $alas_p_10 = $this->put('uprjpl_alas_p_10', true);
        $alas_s_ho = $this->put('uprjpl_alas_s_ho', true);
        $alas_s_18 = $this->put('uprjpl_alas_s_18', true);
        $alas_m_ho = $this->put('uprjpl_alas_m_ho', true);
        $alas_m_23 = $this->put('uprjpl_alas_m_23', true);
        $alas_m_4  = $this->put('uprjpl_alas_m_4', true);

        // Lantai kering dan tidak licin
        $lantai_p_ho = $this->put('uprjpl_lantai_p_ho', true);
        $lantai_p_10 = $this->put('uprjpl_lantai_p_10', true);
        $lantai_s_ho = $this->put('uprjpl_lantai_s_ho', true);
        $lantai_s_18 = $this->put('uprjpl_lantai_s_18', true);
        $lantai_m_ho = $this->put('uprjpl_lantai_m_ho', true);
        $lantai_m_23 = $this->put('uprjpl_lantai_m_23', true);
        $lantai_m_4  = $this->put('uprjpl_lantai_m_4', true);

        // Dekatkan alat-alat pasien
        $alat_p_ho = $this->put('uprjpl_alat_p_ho', true);
        $alat_p_10 = $this->put('uprjpl_alat_p_10', true);
        $alat_s_ho = $this->put('uprjpl_alat_s_ho', true);
        $alat_s_18 = $this->put('uprjpl_alat_s_18', true);
        $alat_m_ho = $this->put('uprjpl_alat_m_ho', true);
        $alat_m_23 = $this->put('uprjpl_alat_m_23', true);
        $alat_m_4  = $this->put('uprjpl_alat_m_4', true);

        // Edukasi pasien tentang efek samping obat yang diberikan
        $edukasi_p_ho = $this->put('uprjpl_edukasi_p_ho', true);
        $edukasi_p_10 = $this->put('uprjpl_edukasi_p_10', true);
        $edukasi_s_ho = $this->put('uprjpl_edukasi_s_ho', true);
        $edukasi_s_18 = $this->put('uprjpl_edukasi_s_18', true);
        $edukasi_m_ho = $this->put('uprjpl_edukasi_m_ho', true);
        $edukasi_m_23 = $this->put('uprjpl_edukasi_m_23', true);
        $edukasi_m_4  = $this->put('uprjpl_edukasi_m_4', true);

        // Tidak meninggalkan pasien di kamar mandi saat menggunakan commode
        $commode_p_ho = $this->put('uprjpl_commode_p_ho', true);
        $commode_p_10 = $this->put('uprjpl_commode_p_10', true);
        $commode_s_ho = $this->put('uprjpl_commode_s_ho', true);
        $commode_s_18 = $this->put('uprjpl_commode_s_18', true);
        $commode_m_ho = $this->put('uprjpl_commode_m_ho', true);
        $commode_m_23 = $this->put('uprjpl_commode_m_23', true);
        $commode_m_4  = $this->put('uprjpl_commode_m_4', true);

        // Pasang gelang khusus
        $gelang_p_ho = $this->put('uprjpl_gelang_p_ho', true);
        $gelang_p_10 = $this->put('uprjpl_gelang_p_10', true);
        $gelang_s_ho = $this->put('uprjpl_gelang_s_ho', true);
        $gelang_s_18 = $this->put('uprjpl_gelang_s_18', true);
        $gelang_m_ho = $this->put('uprjpl_gelang_m_ho', true);
        $gelang_m_23 = $this->put('uprjpl_gelang_m_23', true);
        $gelang_m_4  = $this->put('uprjpl_gelang_m_4', true);

        // Tempatkan pasien di kamar yang paling dekat dengan Nurse Station
        $station_p_ho = $this->put('uprjpl_station_p_ho', true);
        $station_p_10 = $this->put('uprjpl_station_p_10', true);
        $station_s_ho = $this->put('uprjpl_station_s_ho', true);
        $station_s_18 = $this->put('uprjpl_station_s_18', true);
        $station_m_ho = $this->put('uprjpl_station_m_ho', true);
        $station_m_23 = $this->put('uprjpl_station_m_23', true);
        $station_m_4  = $this->put('uprjpl_station_m_4', true);

        // Paraf
        $paraf_p_ho = $this->put('uprjpl_paraf_p_ho', true);
        $paraf_p_10 = $this->put('uprjpl_paraf_p_10', true);
        $paraf_s_ho = $this->put('uprjpl_paraf_s_ho', true);
        $paraf_s_18 = $this->put('uprjpl_paraf_s_18', true);
        $paraf_m_ho = $this->put('uprjpl_paraf_m_ho', true);
        $paraf_m_23 = $this->put('uprjpl_paraf_m_23', true);
        $paraf_m_4  = $this->put('uprjpl_paraf_m_4', true);

        $data = array(
            'id'                 => $this->put('id', true),
            'tanggal_pengkajian' => $tanggal_pengkajian,
            'id_perawat_p'       => $id_perawat_p !== '' ? $id_perawat_p : null,
            'id_perawat_s'       => $id_perawat_s !== '' ? $id_perawat_s : null,
            'id_perawat_m'       => $id_perawat_m !== '' ? $id_perawat_m : null,

            'bel_p_ho' => $bel_p_ho === 'on' ? 1 : 0,
            'bel_p_10' => $bel_p_10 === 'on' ? 1 : 0,
            'bel_s_ho' => $bel_s_ho === 'on' ? 1 : 0,
            'bel_s_18' => $bel_s_18 === 'on' ? 1 : 0,
            'bel_m_ho' => $bel_m_ho === 'on' ? 1 : 0,
            'bel_m_23' => $bel_m_23 === 'on' ? 1 : 0,
            'bel_m_4'  => $bel_m_4 === 'on' ? 1 : 0,

            'roda_p_ho' => $roda_p_ho === 'on' ? 1 : 0,
            'roda_p_10' => $roda_p_10 === 'on' ? 1 : 0,
            'roda_s_ho' => $roda_s_ho === 'on' ? 1 : 0,
            'roda_s_18' => $roda_s_18 === 'on' ? 1 : 0,
            'roda_m_ho' => $roda_m_ho === 'on' ? 1 : 0,
            'roda_m_23' => $roda_m_23 === 'on' ? 1 : 0,
            'roda_m_4'  => $roda_m_4 === 'on' ? 1 : 0,

            'ptt_p_ho' => $ptt_p_ho === 'on' ? 1 : 0,
            'ptt_p_10' => $ptt_p_10 === 'on' ? 1 : 0,
            'ptt_s_ho' => $ptt_s_ho === 'on' ? 1 : 0,
            'ptt_s_18' => $ptt_s_18 === 'on' ? 1 : 0,
            'ptt_m_ho' => $ptt_m_ho === 'on' ? 1 : 0,
            'ptt_m_23' => $ptt_m_23 === 'on' ? 1 : 0,
            'ptt_m_4'  => $ptt_m_4 === 'on' ? 1 : 0,

            'ppt_p_ho' => $ppt_p_ho === 'on' ? 1 : 0,
            'ppt_p_10' => $ppt_p_10 === 'on' ? 1 : 0,
            'ppt_s_ho' => $ppt_s_ho === 'on' ? 1 : 0,
            'ppt_s_18' => $ppt_s_18 === 'on' ? 1 : 0,
            'ppt_m_ho' => $ppt_m_ho === 'on' ? 1 : 0,
            'ppt_m_23' => $ppt_m_23 === 'on' ? 1 : 0,
            'ppt_m_4'  => $ppt_m_4 === 'on' ? 1 : 0,

            'penerangan_p_ho' => $penerangan_p_ho === 'on' ? 1 : 0,
            'penerangan_p_10' => $penerangan_p_10 === 'on' ? 1 : 0,
            'penerangan_s_ho' => $penerangan_s_ho === 'on' ? 1 : 0,
            'penerangan_s_18' => $penerangan_s_18 === 'on' ? 1 : 0,
            'penerangan_m_ho' => $penerangan_m_ho === 'on' ? 1 : 0,
            'penerangan_m_23' => $penerangan_m_23 === 'on' ? 1 : 0,
            'penerangan_m_4'  => $penerangan_m_4 === 'on' ? 1 : 0,

            'alas_p_ho' => $alas_p_ho === 'on' ? 1 : 0,
            'alas_p_10' => $alas_p_10 === 'on' ? 1 : 0,
            'alas_s_ho' => $alas_s_ho === 'on' ? 1 : 0,
            'alas_s_18' => $alas_s_18 === 'on' ? 1 : 0,
            'alas_m_ho' => $alas_m_ho === 'on' ? 1 : 0,
            'alas_m_23' => $alas_m_23 === 'on' ? 1 : 0,
            'alas_m_4'  => $alas_m_4 === 'on' ? 1 : 0,

            'lantai_p_ho' => $lantai_p_ho === 'on' ? 1 : 0,
            'lantai_p_10' => $lantai_p_10 === 'on' ? 1 : 0,
            'lantai_s_ho' => $lantai_s_ho === 'on' ? 1 : 0,
            'lantai_s_18' => $lantai_s_18 === 'on' ? 1 : 0,
            'lantai_m_ho' => $lantai_m_ho === 'on' ? 1 : 0,
            'lantai_m_23' => $lantai_m_23 === 'on' ? 1 : 0,
            'lantai_m_4'  => $lantai_m_4 === 'on' ? 1 : 0,

            'alat_p_ho' => $alat_p_ho === 'on' ? 1 : 0,
            'alat_p_10' => $alat_p_10 === 'on' ? 1 : 0,
            'alat_s_ho' => $alat_s_ho === 'on' ? 1 : 0,
            'alat_s_18' => $alat_s_18 === 'on' ? 1 : 0,
            'alat_m_ho' => $alat_m_ho === 'on' ? 1 : 0,
            'alat_m_23' => $alat_m_23 === 'on' ? 1 : 0,
            'alat_m_4'  => $alat_m_4 === 'on' ? 1 : 0,

            'edukasi_p_ho' => $edukasi_p_ho === 'on' ? 1 : 0,
            'edukasi_p_10' => $edukasi_p_10 === 'on' ? 1 : 0,
            'edukasi_s_ho' => $edukasi_s_ho === 'on' ? 1 : 0,
            'edukasi_s_18' => $edukasi_s_18 === 'on' ? 1 : 0,
            'edukasi_m_ho' => $edukasi_m_ho === 'on' ? 1 : 0,
            'edukasi_m_23' => $edukasi_m_23 === 'on' ? 1 : 0,
            'edukasi_m_4'  => $edukasi_m_4 === 'on' ? 1 : 0,

            'commode_p_ho' => $commode_p_ho === 'on' ? 1 : 0,
            'commode_p_10' => $commode_p_10 === 'on' ? 1 : 0,
            'commode_s_ho' => $commode_s_ho === 'on' ? 1 : 0,
            'commode_s_18' => $commode_s_18 === 'on' ? 1 : 0,
            'commode_m_ho' => $commode_m_ho === 'on' ? 1 : 0,
            'commode_m_23' => $commode_m_23 === 'on' ? 1 : 0,
            'commode_m_4'  => $commode_m_4 === 'on' ? 1 : 0,

            'gelang_p_ho' => $gelang_p_ho === 'on' ? 1 : 0,
            'gelang_p_10' => $gelang_p_10 === 'on' ? 1 : 0,
            'gelang_s_ho' => $gelang_s_ho === 'on' ? 1 : 0,
            'gelang_s_18' => $gelang_s_18 === 'on' ? 1 : 0,
            'gelang_m_ho' => $gelang_m_ho === 'on' ? 1 : 0,
            'gelang_m_23' => $gelang_m_23 === 'on' ? 1 : 0,
            'gelang_m_4'  => $gelang_m_4 === 'on' ? 1 : 0,

            'station_p_ho' => $station_p_ho === 'on' ? 1 : 0,
            'station_p_10' => $station_p_10 === 'on' ? 1 : 0,
            'station_s_ho' => $station_s_ho === 'on' ? 1 : 0,
            'station_s_18' => $station_s_18 === 'on' ? 1 : 0,
            'station_m_ho' => $station_m_ho === 'on' ? 1 : 0,
            'station_m_23' => $station_m_23 === 'on' ? 1 : 0,
            'station_m_4'  => $station_m_4 === 'on' ? 1 : 0,

            'paraf_p_ho' => $paraf_p_ho === 'on' ? 1 : 0,
            'paraf_p_10' => $paraf_p_10 === 'on' ? 1 : 0,
            'paraf_s_ho' => $paraf_s_ho === 'on' ? 1 : 0,
            'paraf_s_18' => $paraf_s_18 === 'on' ? 1 : 0,
            'paraf_m_ho' => $paraf_m_ho === 'on' ? 1 : 0,
            'paraf_m_23' => $paraf_m_23 === 'on' ? 1 : 0,
            'paraf_m_4'  => $paraf_m_4 === 'on' ? 1 : 0,

            'updated_at' => date('Y-m-d H:i:s', time()),
        );

        $status = $this->m_pelayanan->editUpayaPencegahanRisikoJatuhPasienLansia($data);
        $this->response(array('status' => $status), REST_Controller::HTTP_OK);
    }

    // UPAYA LANSIA
    function get_upaya_pencegahan_risiko_jatuh_pasien_lansia_get(){
        if (!$this->get('id', true)) :
            $this->response(null, REST_Controller::HTTP_BAD_REQUEST);
        endif;

        $data = $this->m_pelayanan->getUpayaPencegahanResikoJatuhPasienLansiaByID($this->get('id', true));
        $this->response($data, REST_Controller::HTTP_OK);
    }

    // UPAYA LANSIA
    function hapus_upaya_pencegahan_risiko_jatuh_pasien_lansia_delete($id){
        $status = $this->m_pelayanan->deleteUpayaPencegahanRisikoJatuhPasienLansia($id);
        if ($status) :
            $response = array('status' => $status, 'message' => 'Berhasil menghapus Upaya Pencegahan Risiko Jatuh Pasien Lansia!');
        else :
            $response = array('status' => $status, 'message' => 'Gagal menghapus Upaya Pencegahan Risiko Jatuh Pasien Lansia!');
        endif;
        $this->response($response, REST_Controller::HTTP_OK);
    }
            
    // MCOP PAGI SORE MALAM
    function get_data_entri_catatan_operan_perawat_get(){
        if (!$this->get('id')) :
            $this->response(NULL, REST_Controller::HTTP_BAD_REQUEST); // (400)
        endif;  
        $this->load->model('pendaftaran/Pendaftaran_model', 'm_pendaftaran'); 
        $this->load->model('pelayanan/Pelayanan_model', 'm_pelayanan');
        $data                   = $this->m_pendaftaran->getPendaftaranDetail($this->get('id', true), $this->get('id_layanan', true));
        $data['profil']         = $this->m_pelayanan->getProfilPasien($data['pasien']->id_pasien);
        $data['catatan_operan_perawat_pagi']  = $this->m_pelayanan->getCatatanOperanPerawatPagi($this->get('id', true));
        $data['catatan_operan_perawat_sore']  = $this->m_pelayanan->getCatatanOperanPerawatSore($this->get('id', true));
        $data['catatan_operan_perawat_malam']  = $this->m_pelayanan->getCatatanOperanPerawatMalam($this->get('id', true));
        if ($data) :
            $this->response($data, REST_Controller::HTTP_OK); // (200)
        endif;
    }

    // MCOP PAGI SORE MALAM
    function simpan_entri_catatan_operan_perawat_post(){
        $layanan = array('id' => safe_post('id_layanan_pendaftaran'));
        $id_layanan = $layanan['id'];
        $id_pendaftaran = null;

        //  Ambil id_pendaftaran dari layanan
        $layanan_row = $this->db->select('id_pendaftaran')->from('sm_layanan_pendaftaran')->where('id', $id_layanan)->get()->row();
        if ($layanan_row) {
            $id_pendaftaran = $layanan_row->id_pendaftaran;
        }

        //  Fungsi bantu untuk format array tanggal
        function formatArrayTanggal($input){
            if (empty($input) || !is_array($input)) return null;
            $hasil = [];
            foreach ($input as $key => $value) {
                if (!empty($value)) {
                    try {
                        $date = new DateTime($value);
                        $hasil[$key] = $date->format('Y-m-d H:i:s');
                    } catch (Exception $e) {
                        $hasil[$key] = null;
                    }
                } else {
                    $hasil[$key] = null;
                }
            }
            return $hasil;
        }

        //  PAGI
        $id_dpjp_utama_pagi = safe_post('dpjp_utama_pagi');
        if (!empty($id_dpjp_utama_pagi)) {
            $catatan_operan_perawat_pagi = array(
                'id_pendaftaran'                => $id_pendaftaran,
                'id_layanan_pendaftaran'        => $layanan['id'],
                'operan_diagnosa_keperawatan'   => safe_post('operan_diagnosa_keperawatan') ?: NULL,
                'dpjp_utama_pagi'               => $id_dpjp_utama_pagi,
                'konsulen_pagi'                 => safe_post('konsulen_pagi') ?: NULL,
                'tanggal_waktu_pagi'            => formatArrayTanggal(safe_post('tanggal_waktu_pagi')),
                'diagnosa_keperawatan_pagi'     => safe_post('diagnosa_keperawatan_pagi') ?: NULL,
                'infus_pagi'                    => safe_post('infus_pagi') ?: NULL,
                'rencana_tindakan_pagi'         => safe_post('rencana_tindakan_pagi') ?: NULL,
                'perawat_mengover_pagi'         => safe_post('perawat_mengover_pagi') ?: NULL,
                'perawat_menerima_pagi'         => safe_post('perawat_menerima_pagi') ?: NULL,
                'id_users'                      => safe_post('user_input_catatan') ?: NULL,
            );
            $this->m_pelayanan->updateCatatanPagi($catatan_operan_perawat_pagi);
        }

        //  SORE
        $id_dokter_dpjp_sore = safe_post('id_dokter_dpjp_sore');
        if (!empty($id_dokter_dpjp_sore)) {
            $catatan_operan_perawat_sore = array(
                'id_pendaftaran'                => $id_pendaftaran,
                'id_layanan_pendaftaran'        => $layanan['id'],
                'dokter_dpjp_sore'              => $id_dokter_dpjp_sore,
                'konsulen_sore'                 => safe_post('konsulen_sore') ?: NULL,
                'tanggal_waktu_sore'            => formatArrayTanggal(safe_post('tanggal_waktu_sore')),
                'diagnosa_keperawatan_sore'     => safe_post('diagnosa_keperawatan_sore') ?: NULL,
                'infus_sore'                    => safe_post('infus_sore') ?: NULL,
                'rencana_tindakan_sore'         => safe_post('rencana_tindakan_sore') ?: NULL,
                'perawat_mengover_sore'         => safe_post('perawat_mengover_sore') ?: NULL,
                'perawat_menerima_sore'         => safe_post('perawat_menerima_sore') ?: NULL,
                'id_users'                      => safe_post('user_input_catatan') ?: NULL,
            );
            $this->m_pelayanan->updateCatatanSore($catatan_operan_perawat_sore);
        }

        //  MALAM
        $dokter_dpjp_malam = safe_post('id_dokter_dpjp_malam');
        if (!empty($dokter_dpjp_malam)) {
            $catatan_operan_perawat_malam = array(
                // 'id_pendaftaran'                => $id_pendaftaran,
                'id_layanan_pendaftaran'        => $layanan['id'],
                'dokter_dpjp_malam'             => $dokter_dpjp_malam,
                'konsulen_malam'                => safe_post('konsulen_malam') ?: NULL,
                'tanggal_waktu_malam'           => formatArrayTanggal(safe_post('tanggal_waktu_malam')),
                'diagnosa_keperawatan_malam'    => safe_post('diagnosa_keperawatan_malam') ?: NULL,
                'infus_malam'                   => safe_post('infus_malam') ?: NULL,
                'rencana_tindakan_malam'        => safe_post('rencana_tindakan_malam') ?: NULL,
                'perawat_mengover_malam'        => safe_post('perawat_mengover_malam') ?: NULL,
                'perawat_menerima_malam'        => safe_post('perawat_menerima_malam') ?: NULL,
                'id_users'                      => safe_post('user_input_catatan') ?: NULL,
            );
            $this->m_pelayanan->updateCatatanMalam($catatan_operan_perawat_malam);
        }

        //  Final Response
        $response = !empty($respon) ? $respon : null;

        if ($this->db->trans_status() === false) {
            $this->db->trans_rollback();
            $status = false;
        } else {
            $this->db->trans_commit();
            $status = true;
        }

        $message = array(
            'status' => $status,
            'token'  => $this->security->get_csrf_hash(),
            'id'     => $layanan['id'],
            'respon' => $response,
        );

        $this->response($message, REST_Controller::HTTP_OK);
    }

    // MCOP PAGI
    function get_catatan_operan_pagi_get(){
        if (!$this->get('id', true)) :
            $this->response(null, REST_Controller::HTTP_BAD_REQUEST);
        endif;
        $data = $this->m_pelayanan->getCatatanOperanPerawatPagiByID($this->get('id', true));
        $this->response($data, REST_Controller::HTTP_OK);
    }

    // MCOP PAGI
    function update_catatan_operan_pagi_post() {
        $id = $this->post('id', true);
        if (!$id) {
            $this->response(['status' => false], REST_Controller::HTTP_OK);
            return;
        }

        $log = $this->m_pelayanan->getCatatanOperanPerawatPagiByID($id); // ambil data lama untuk log

        $data = [
            'id'                            => $id,
            'tanggal_waktu_pagi'            => date('Y-m-d H:i', strtotime(str_replace('/', '-', $this->post('tanggal_waktu_pagi', true)))),
            'operan_diagnosa_keperawatan'   => $this->post('operan_diagnosa_keperawatan', true) ?: null,
            'dpjp_utama_pagi'               => $this->post('dpjp_utama_pagi', true) ?: null,
            'konsulen_pagi'                 => $this->post('konsulen_pagi', true) ?: null,
            'diagnosa_keperawatan_pagi'     => $this->post('diagnosa_keperawatan_pagi', true) ?: null,
            'infus_pagi'                    => $this->post('infus_pagi', true) ?: null,
            'rencana_tindakan_pagi'         => $this->post('rencana_tindakan_pagi', true) ?: null,
            'perawat_mengover_pagi'         => $this->post('perawat_mengover_pagi', true) ?: null,
            'perawat_menerima_pagi'         => $this->post('perawat_menerima_pagi', true) ?: null,
            'updated_at'                    => date('Y-m-d H:i:s'),
        ];

        // Siapkan log data
        $log_data = $log ? (array) $log : [];
        $log_data['aksi'] = 'update';
        $log_data['updated_by'] = $this->post('updated_by', true) ?: 'SYSTEM';
        $log_data['id_upaya'] = $id;
        $log_data['updated_at'] = $data['updated_at'];

        //  Hapus kolom yang tidak ada di tabel logs
        unset(
            $log_data['id'], //  supaya tidak bentrok dengan primary key
            $log_data['akun_user'],
            $log_data['dokter_dpjp_pagi'],
            $log_data['petugas_mengover_pagi'],
            $log_data['petugas_menerima_pagi'],
            $log_data['konsulen_pagi_g']
        );

        $this->db->insert('sm_catatan_operan_perawat_pagi_logs', $log_data);

        $status = $this->m_pelayanan->editCatatanOperanRencanaPagi($data);
        $this->response(['status' => $status], REST_Controller::HTTP_OK);
    }

    // MCOP PAGI
    function hapus_catatan_operan_pagi_delete($id){
        $deleted_by = $this->input->post('deleted_by', true) ?: 'SYSTEM';

        // Ambil data lama sebelum dihapus
        $lama = $this->m_pelayanan->getCatatanOperanPerawatPagiByID($id);

        if ($lama) {
            $log = (array) $lama;
            $log['aksi'] = 'delete';
            $log['deleted_by'] = $deleted_by;
            $log['deleted_at'] = date('Y-m-d H:i:s');
            $log['id_upaya'] = $lama->id;

            //  Hapus kolom yang tidak ada di tabel log
            unset(
                $log['id'],
                $log['akun_user'],
                $log['dokter_dpjp_pagi'],
                $log['petugas_mengover_pagi'],
                $log['petugas_menerima_pagi'],
                $log['konsulen_pagi_g']
            );

            $this->db->insert('sm_catatan_operan_perawat_pagi_logs', $log);
        }

        // Lanjut hapus
        $status = $this->m_pelayanan->deleteCatatanOperanPagi($id);

        $message = $status
            ? ['status' => true, 'message' => 'Berhasil menghapus data!']
            : ['status' => false, 'message' => 'Gagal menghapus data!'];

        $this->response($message, REST_Controller::HTTP_OK);
    }

    // MCOP SORE
    function get_catatan_operan_sore_get(){
        if (!$this->get('id', true)) :
            $this->response(null, REST_Controller::HTTP_BAD_REQUEST);
        endif;
        $data = $this->m_pelayanan->getCatatanOperanPerawatSoreByID($this->get('id', true));
        $this->response($data, REST_Controller::HTTP_OK);
    }

    // MCOP SORE
    function update_catatan_operan_sore_post() {
        $id = $this->post('id', true);
        if (!$id) {
            $this->response(['status' => false], REST_Controller::HTTP_OK);
            return;
        }

        $log = $this->m_pelayanan->getCatatanOperanPerawatSoreByID($id); // ambil data lama untuk log

        $data = [
            'id'                            => $id,
            'tanggal_waktu_sore'            => date('Y-m-d H:i', strtotime(str_replace('/', '-', $this->post('tanggal_waktu_sore', true)))),
            'dokter_dpjp_sore'               => $this->post('dokter_dpjp_sore', true) ?: null,
            'konsulen_sore'                 => $this->post('konsulen_sore', true) ?: null,
            'diagnosa_keperawatan_sore'     => $this->post('diagnosa_keperawatan_sore', true) ?: null,
            'infus_sore'                    => $this->post('infus_sore', true) ?: null,
            'rencana_tindakan_sore'         => $this->post('rencana_tindakan_sore', true) ?: null,
            'perawat_mengover_sore'         => $this->post('perawat_mengover_sore', true) ?: null,
            'perawat_menerima_sore'         => $this->post('perawat_menerima_sore', true) ?: null,
            'updated_at'                    => date('Y-m-d H:i:s'),
        ];

        // Siapkan log data
        $log_data = $log ? (array) $log : [];
        $log_data['aksi'] = 'update';
        $log_data['updated_by'] = $this->post('updated_by', true) ?: 'SYSTEM';
        $log_data['id_upaya'] = $id;
        $log_data['updated_at'] = $data['updated_at'];

        //  Hapus kolom yang tidak ada di tabel logs
        unset(
            $log_data['id'], //  supaya tidak bentrok dengan primary key
            $log_data['akun_user'],
            $log_data['dpjp_utama_sore'],
            $log_data['petugas_mengover_sore'],
            $log_data['petugas_menerima_sore'],
            $log_data['konsulen_sore_g']
        );

        $this->db->insert('sm_catatan_operan_perawat_sore_logs', $log_data);

        $status = $this->m_pelayanan->editCatatanOperanRencanaSore($data);
        $this->response(['status' => $status], REST_Controller::HTTP_OK);
    }

    // MCOP SORE
    function hapus_catatan_operan_sore_delete($id){
        $deleted_by = $this->input->post('deleted_by', true) ?: 'SYSTEM';

        // Ambil data lama sebelum dihapus
        $lama = $this->m_pelayanan->getCatatanOperanPerawatSoreByID($id);

        if ($lama) {
            $log = (array) $lama;
            $log['aksi'] = 'delete';
            $log['deleted_by'] = $deleted_by;
            $log['deleted_at'] = date('Y-m-d H:i:s');
            $log['id_upaya'] = $lama->id;

            //  Hapus kolom yang tidak ada di tabel log
            unset(
                $log['id'],
                $log['akun_user'],
                $log['dpjp_utama_sore'],
                $log['petugas_mengover_sore'],
                $log['petugas_menerima_sore'],
                $log['konsulen_sore_g']
            );

            $this->db->insert('sm_catatan_operan_perawat_sore_logs', $log);
        }

        // Lanjut hapus
        $status = $this->m_pelayanan->deleteCatatanOperanSore($id);

        $message = $status
            ? ['status' => true, 'message' => 'Berhasil menghapus data!']
            : ['status' => false, 'message' => 'Gagal menghapus data!'];

        $this->response($message, REST_Controller::HTTP_OK);
    }

    // MCOP MALAM
    function get_catatan_operan_malam_get(){
        if (!$this->get('id', true)) :
            $this->response(null, REST_Controller::HTTP_BAD_REQUEST);
        endif;
        $data = $this->m_pelayanan->getCatatanOperanPerawatMalamByID($this->get('id', true));
        $this->response($data, REST_Controller::HTTP_OK);
    }

    // MCOP MALAM
    function update_catatan_operan_malam_post() {
        $id = $this->post('id', true);
        if (!$id) {
            $this->response(['status' => false], REST_Controller::HTTP_OK);
            return;
        }

        $log = $this->m_pelayanan->getCatatanOperanPerawatMalamByID($id); // ambil data lama untuk log

        $data = [
            'id'                            => $id,
            'tanggal_waktu_malam'            => date('Y-m-d H:i', strtotime(str_replace('/', '-', $this->post('tanggal_waktu_malam', true)))),
            'dokter_dpjp_malam'               => $this->post('dokter_dpjp_malam', true) ?: null,
            'konsulen_malam'                 => $this->post('konsulen_malam', true) ?: null,
            'diagnosa_keperawatan_malam'     => $this->post('diagnosa_keperawatan_malam', true) ?: null,
            'infus_malam'                    => $this->post('infus_malam', true) ?: null,
            'rencana_tindakan_malam'         => $this->post('rencana_tindakan_malam', true) ?: null,
            'perawat_mengover_malam'         => $this->post('perawat_mengover_malam', true) ?: null,
            'perawat_menerima_malam'         => $this->post('perawat_menerima_malam', true) ?: null,
            'updated_at'                    => date('Y-m-d H:i:s'),
        ];

        // Siapkan log data
        $log_data = $log ? (array) $log : [];
        $log_data['aksi'] = 'update';
        $log_data['updated_by'] = $this->post('updated_by', true) ?: 'SYSTEM';
        $log_data['id_upaya'] = $id;
        $log_data['updated_at'] = $data['updated_at'];

        //  Hapus kolom yang tidak ada di tabel logs
        unset(
            $log_data['id'], //  supaya tidak bentrok dengan primary key
            $log_data['akun_user'],
            $log_data['dpjp_utama_malam'],
            $log_data['petugas_mengover_malam'],
            $log_data['petugas_menerima_malam'],
            $log_data['konsulen_malam_g']
        );

        $this->db->insert('sm_catatan_operan_perawat_malam_logs', $log_data);

        $status = $this->m_pelayanan->editCatatanOperanRencanaMalam($data);
        $this->response(['status' => $status], REST_Controller::HTTP_OK);
    }

    // MCOP MALAM
    function hapus_catatan_operan_malam_delete($id){
        $deleted_by = $this->input->post('deleted_by', true) ?: 'SYSTEM';

        // Ambil data lama sebelum dihapus
        $lama = $this->m_pelayanan->getCatatanOperanPerawatMalamByID($id);

        if ($lama) {
            $log = (array) $lama;
            $log['aksi'] = 'delete';
            $log['deleted_by'] = $deleted_by;
            $log['deleted_at'] = date('Y-m-d H:i:s');
            $log['id_upaya'] = $lama->id;

            //  Hapus kolom yang tidak ada di tabel log
            unset(
                $log['id'],
                $log['akun_user'],
                $log['dpjp_utama_malam'],
                $log['petugas_mengover_malam'],
                $log['petugas_menerima_malam'],
                $log['konsulen_malam_g']
            );

            $this->db->insert('sm_catatan_operan_perawat_malam_logs', $log);
        }

        // Lanjut hapus
        $status = $this->m_pelayanan->deleteCatatanOperanMalam($id);

        $message = $status
            ? ['status' => true, 'message' => 'Berhasil menghapus data!']
            : ['status' => false, 'message' => 'Gagal menghapus data!'];

        $this->response($message, REST_Controller::HTTP_OK);
    }





    // DOKTER ICC
    function get_tim_dokter_get(){
        if (!$this->get('id_layanan_pendaftaran')) :
            $this->response(NULL, REST_Controller::HTTP_BAD_REQUEST); // (400)
        endif;
        $this->load->model('pendaftaran/Pendaftaran_model', 'm_pendaftaran'); 
        $this->load->model('pelayanan/Pelayanan_model', 'm_pelayanan');
        $data                              = $this->m_pendaftaran->getPendaftaranDetail($this->get('id', true), $this->get('id_layanan', true));
        $data['profil']                    = $this->m_pelayanan->getProfilPasien($data['pasien']->id_pasien);
        $data['dokter_pdjp']               = $this->m_pelayanan->getIDokter($this->get('id', true));
        if ($data) :
            $this->response($data, REST_Controller::HTTP_OK); // (200)
        endif;
    }

    // DOKTER ICC
    function simpan_tim_dokter_bedah_satuan_post() {
        $id_layanan_pendaftaran = safe_post('id_layanan_pendaftaran');
        $id_pendaftaran         = safe_post('id_pendaftaran');
        $dokter_bedah           = safe_post('dokter_bedah'); // bisa array

        if (empty($id_layanan_pendaftaran) || empty($id_pendaftaran)) {
            $this->response(NULL, REST_Controller::HTTP_BAD_REQUEST);
            return;
        }

        $this->load->model('pelayanan/Pelayanan_model', 'm_pelayanan');
        $this->db->trans_begin();

        if (is_array($dokter_bedah)) {
            foreach ($dokter_bedah as $id_dokter) {
                //  Cek apakah dokter ini sudah ada di DB
                $cek = $this->db->get_where('sm_dokter_icc', [
                    'id_layanan_pendaftaran' => $id_layanan_pendaftaran,
                    'id_pendaftaran'         => $id_pendaftaran,
                    'dokterdpjpicc'          => $id_dokter,
                ])->row();

                 if (!$cek) {
                    $this->db->insert('sm_dokter_icc', [
                        'id_layanan_pendaftaran' => $id_layanan_pendaftaran,
                        'id_pendaftaran'         => $id_pendaftaran,
                        'dokterdpjpicc'          => $id_dokter,
                        'id_user'                => $this->session->userdata('id_translucent'), //  ini yang ditambah
                    ]);
                }

            }
        }
        if ($this->db->trans_status() === false) {
            $this->db->trans_rollback();
            $status = false;
        } else {
            $this->db->trans_commit();
            $status = true;
        }

        $this->response([
            'status' => $status,
            'token'  => $this->security->get_csrf_hash(),
            'id_pendaftaran' => $id_pendaftaran,
            'id_layanan_pendaftaran' => $id_layanan_pendaftaran
        ], REST_Controller::HTTP_OK);
    }

    // DOKTER ICC
    function hapus_tim_dokter_bedah_post(){
        $id_dokter_icc = safe_post('id_dokter_icc');

        if (!$id_dokter_icc) {
            $this->response([
                'status' => false,
                'message' => 'ID dokter ICC tidak ditemukan.'
            ], REST_Controller::HTTP_BAD_REQUEST);
            return;
        }

        $this->load->model('pelayanan/Pelayanan_model', 'm_pelayanan');

        // Ambil data sebelum dihapus untuk kebutuhan log
        $data_dokter = $this->db->get_where('sm_dokter_icc', ['id' => $id_dokter_icc])->row();

        if (!$data_dokter) {
            $this->response([
                'status' => false,
                'message' => 'Data dokter tidak ditemukan.'
            ], REST_Controller::HTTP_OK);
            return;
        }

        $this->db->trans_begin();

        $status = $this->m_pelayanan->hapus_dokter_bedah_by_id($id_dokter_icc);

        if ($this->db->trans_status() === FALSE || !$status) {
            $this->db->trans_rollback();
            $this->response([
                'status' => false,
                'message' => 'Gagal menghapus data dokter.',
                'token'  => $this->security->get_csrf_hash()
            ], REST_Controller::HTTP_OK);
            return;
        }

        $this->db->insert('sm_dokter_icc_logs', [
            'id_dokter_icc'          => $id_dokter_icc,
            'id_pendaftaran'         => $data_dokter->id_pendaftaran,
            'id_layanan_pendaftaran' => $data_dokter->id_layanan_pendaftaran,
            'dokterdpjpicc'          => $data_dokter->dokterdpjpicc,
            'deleted_at'             => date('Y-m-d H:i:s'),
            'log_action'             => 'delete',
            'id_user'                => $this->session->userdata('id_translucent'), // ini aja cukup
        ]);

        $this->db->trans_commit();

        $this->response([
            'status' => true,
            'message' => 'Data dokter berhasil dihapus.',
            'token'  => $this->security->get_csrf_hash()
        ], REST_Controller::HTTP_OK);
    }

    // ICC // CATATANPERAWAT
    function get_data_intensive_care_chart_get(){
        if (!$this->get('id_layanan_pendaftaran')) :
            $this->response(NULL, REST_Controller::HTTP_BAD_REQUEST); // (400)
        endif;
        $this->load->model('pendaftaran/Pendaftaran_model', 'm_pendaftaran'); 
        $this->load->model('pelayanan/Pelayanan_model', 'm_pelayanan');
        $data                                       = $this->m_pendaftaran->getPendaftaranDetail($this->get('id', true), $this->get('id_layanan', true));
        $data['profil']                             = $this->m_pelayanan->getProfilPasien($data['pasien']->id_pasien);
        $data['intensive_care_chart']               = $this->m_pelayanan->getItensiveCareChart($this->get('id', true));
        $data['intensive_care_chart_logs']          = $this->m_pelayanan->getItensiveCareChartLogs($this->get('id', true));
        $data['catatan_perawat_icc']                = $this->m_pelayanan->getCatatanPerawatIcc($this->get('id', true));
        if ($data) :
            $this->response($data, REST_Controller::HTTP_OK); // (200)
        endif;
    }

    // ICC
    function get_history_logs_intensive_care_chart_get(){
        if (!$this->get('id_layanan_pendaftaran', true)) :
            $this->response(NULL, REST_Controller::HTTP_BAD_REQUEST); // (400)
        endif;
        $id_layanan_pendaftaran = $this->get('id_layanan_pendaftaran', true);
        $data['intensive_care_chart_logs']       = $this->m_pelayanan->getItensiveCareChartLogs($id_layanan_pendaftaran);
        if ($data) :
            $this->response($data, REST_Controller::HTTP_OK); // (200)
        endif;
    }
    
    // ICC
    function simpan_data_intensive_care_chart_post(){      
        if (safe_post('id_layanan_pendaftaran') === '') :
            $this->response(NULL, REST_Controller::HTTP_BAD_REQUEST);
        endif;
        $id_layanan_pendaftaran = safe_post('id_layanan_pendaftaran');
        $id_pendaftaran = safe_post('id_pendaftaran');;
        $id_icc = safe_post('id_icc');
        $id_users = safe_post('id_user');
        $data_icc = array(		
            'id_layanan_pendaftaran'=> $id_layanan_pendaftaran,
            'id_pendaftaran'        => $id_pendaftaran,
            'id_users'              => $id_users,    
            'dokterdpjpicc'         => (safe_post('dokterdpjpicc') !== '' ? safe_post('dokterdpjpicc') : NULL),
            'dokterdpjptambahicc'   => (safe_post('dokterdpjptambahicc') !== '' ? safe_post('dokterdpjptambahicc') : NULL),
            'dokterdpjptambahiccq'  => (safe_post('dokterdpjptambahiccq') !== '' ? safe_post('dokterdpjptambahiccq') : NULL),
            'dokterdpjptambahiccw'  => (safe_post('dokterdpjptambahiccw') !== '' ? safe_post('dokterdpjptambahiccw') : NULL),
            'tglmasukicc'           => (safe_post('tglmasukicc') !== '' ? safe_post('tglmasukicc') : NULL),
            'tglicc'                => (safe_post('tglicc') !== '' ? safe_post('tglicc') : NULL),
            'perawatanharike'       => (safe_post('perawatanharike') !== '' ? safe_post('perawatanharike') : NULL),
            'bbicc'                 => (safe_post('bbicc') !== '' ? safe_post('bbicc') : NULL),
            'tbicc'                 => (safe_post('tbicc') !== '' ? safe_post('tbicc') : NULL),
            'goldarahrh'            => (safe_post('goldarahrh') !== '' ? safe_post('goldarahrh') : NULL),
            'unitruangansebelumnya' => (safe_post('unitruangansebelumnya') !== '' ? safe_post('unitruangansebelumnya') : NULL),
            'sofascore'             => (safe_post('sofascore') !== '' ? safe_post('sofascore') : NULL),
            'bradenscore'           => (safe_post('bradenscore') !== '' ? safe_post('bradenscore') : NULL),
            'downscore'             => (safe_post('downscore') !== '' ? safe_post('downscore') : NULL),

            'pesaniic' => json_encode([
                'pesaniic_1' => safe_post('pesaniic_1') !== '' ? safe_post('pesaniic_1') : null,
                'pesaniic_2' => safe_post('pesaniic_2') !== '' ? safe_post('pesaniic_2') : null,
                'pesaniic_3' => safe_post('pesaniic_3') !== '' ? safe_post('pesaniic_3') : null,
            ]),

            'diagnosisicc'        => (safe_post('diagnosisicc') !== '' ? safe_post('diagnosisicc') : NULL),
            'tanggaljoicc'        => (safe_post('tanggaljoicc') !== '' ? safe_post('tanggaljoicc') : NULL),
            'jenisoperasiicc'     => (safe_post('jenisoperasiicc') !== '' ? safe_post('jenisoperasiicc') : NULL),

            'infusIicc'           => (safe_post('infusIicc') !== '' ? safe_post('infusIicc') : NULL),
            'tanggalpemasangan1'  => (safe_post('tanggalpemasangan1') !== '' ? safe_post('tanggalpemasangan1') : NULL),
            'posisi1'             => (safe_post('posisi1') !== '' ? safe_post('posisi1') : NULL),
            'ukuran1'             => (safe_post('ukuran1') !== '' ? safe_post('ukuran1') : NULL),
            'tanggalpencabutan1'  => (safe_post('tanggalpencabutan1') !== '' ? safe_post('tanggalpencabutan1') : NULL),

            'infusIIicc'          => (safe_post('infusIIicc') !== '' ? safe_post('infusIIicc') : NULL),
            'tanggalpemasangan2'  => (safe_post('tanggalpemasangan2') !== '' ? safe_post('tanggalpemasangan2') : NULL),
            'posisi2'             => (safe_post('posisi2') !== '' ? safe_post('posisi2') : NULL),
            'ukuran2'             => (safe_post('ukuran2') !== '' ? safe_post('ukuran2') : NULL),
            'tanggalpencabutan2'  => (safe_post('tanggalpencabutan2') !== '' ? safe_post('tanggalpencabutan2') : NULL),

            'cvc'                   => (safe_post('cvc') !== '' ? safe_post('cvc') : NULL),
            'cdl'                   => (safe_post('cdl') !== '' ? safe_post('cdl') : NULL),
            'picc'                  => (safe_post('picc') !== '' ? safe_post('picc') : NULL),
            'tanggalpemasangan3'    => (safe_post('tanggalpemasangan3') !== '' ? safe_post('tanggalpemasangan3') : NULL),
            'posisi3'               => (safe_post('posisi3') !== '' ? safe_post('posisi3') : NULL),
            'ukuran3'               => (safe_post('ukuran3') !== '' ? safe_post('ukuran3') : NULL),
            'tanggalpencabutan3'    => (safe_post('tanggalpencabutan3') !== '' ? safe_post('tanggalpencabutan3') : NULL),

            'ett'                   => (safe_post('ett') !== '' ? safe_post('ett') : NULL),
            'tracheostomy'          => (safe_post('tracheostomy') !== '' ? safe_post('tracheostomy') : NULL),
            'tanggalpemasangan4'    => (safe_post('tanggalpemasangan4') !== '' ? safe_post('tanggalpemasangan4') : NULL),
            'posisi4'               => (safe_post('posisi4') !== '' ? safe_post('posisi4') : NULL),
            'ukuran4'               => (safe_post('ukuran4') !== '' ? safe_post('ukuran4') : NULL),
            'tanggalpencabutan4'    => (safe_post('tanggalpencabutan4') !== '' ? safe_post('tanggalpencabutan4') : NULL),

            'icp'                   => (safe_post('icp') !== '' ? safe_post('icp') : NULL),
            'ext'                   => (safe_post('ext') !== '' ? safe_post('ext') : NULL),
            'epi'                   => (safe_post('epi') !== '' ? safe_post('epi') : NULL),
            // 'drainage'              => (safe_post('drainage') !== '' ? safe_post('drainage') : NULL),
            'tanggalpemasangan5'    => (safe_post('tanggalpemasangan5') !== '' ? safe_post('tanggalpemasangan5') : NULL),
            'posisi5'               => (safe_post('posisi5') !== '' ? safe_post('posisi5') : NULL),
            'ukuran5'               => (safe_post('ukuran5') !== '' ? safe_post('ukuran5') : NULL),
            'tanggalpencabutan5'    => (safe_post('tanggalpencabutan5') !== '' ? safe_post('tanggalpencabutan5') : NULL),

            'cimino'                => (safe_post('cimino') !== '' ? safe_post('cimino') : NULL),
            'avgraft'               => (safe_post('avgraft') !== '' ? safe_post('avgraft') : NULL),
            'tanggalpemasangan6'    => (safe_post('tanggalpemasangan6') !== '' ? safe_post('tanggalpemasangan6') : NULL),
            'posisi6'               => (safe_post('posisi6') !== '' ? safe_post('posisi6') : NULL),
            'ukuran6'               => (safe_post('ukuran6') !== '' ? safe_post('ukuran6') : NULL),
            'tanggalpencabutan6'    => (safe_post('tanggalpencabutan6') !== '' ? safe_post('tanggalpencabutan6') : NULL),

            'ngticc'                => (safe_post('ngticc') !== '' ? safe_post('ngticc') : NULL),
            'ogticc'                => (safe_post('ogticc') !== '' ? safe_post('ogticc') : NULL),
            'tanggalpemasangan7'    => (safe_post('tanggalpemasangan7') !== '' ? safe_post('tanggalpemasangan7') : NULL),
            'posisi7'               => (safe_post('posisi7') !== '' ? safe_post('posisi7') : NULL),
            'ukuran7'               => (safe_post('ukuran7') !== '' ? safe_post('ukuran7') : NULL),
            'tanggalpencabutan7'    => (safe_post('tanggalpencabutan7') !== '' ? safe_post('tanggalpencabutan7') : NULL),

            'urineekttr'            => (safe_post('urineekttr') !== '' ? safe_post('urineekttr') : NULL),
            'tanggalpemasangan8'    => (safe_post('tanggalpemasangan8') !== '' ? safe_post('tanggalpemasangan8') : NULL),
            'posisi8'               => (safe_post('posisi8') !== '' ? safe_post('posisi8') : NULL),
            'ukuran8'               => (safe_post('ukuran8') !== '' ? safe_post('ukuran8') : NULL),
            'tanggalpencabutan8'    => (safe_post('tanggalpencabutan8') !== '' ? safe_post('tanggalpencabutan8') : NULL),

            'textkosong' => json_encode([
                'textkosong_1' => safe_post('textkosong_1') !== '' ? safe_post('textkosong_1') : null,
                'textkosong_2' => safe_post('textkosong_2') !== '' ? safe_post('textkosong_2') : null,
                'textkosong_3' => safe_post('textkosong_3') !== '' ? safe_post('textkosong_3') : null,
            ]),

            'alergiicct'    => (safe_post('alergiicct') !== '' ? safe_post('alergiicct') : NULL),
            'antibiotikicc' => (safe_post('antibiotikicc') !== '' ? safe_post('antibiotikicc') : NULL),
            'kulturicc'     => (safe_post('kulturicc') !== '' ? safe_post('kulturicc') : NULL),

            // 'terapioralicc' => json_encode([
            //     'terapioralicc1' => safe_post('terapioralicc1') !== '' ? safe_post('terapioralicc1') : null,
            //     'terapioralicc2' => safe_post('terapioralicc2') !== '' ? safe_post('terapioralicc2') : null,
            //     'terapioralicc3' => safe_post('terapioralicc3') !== '' ? safe_post('terapioralicc3') : null,
            //     'terapioralicc4' => safe_post('terapioralicc4') !== '' ? safe_post('terapioralicc4') : null,
            //     'terapioralicc5' => safe_post('terapioralicc5') !== '' ? safe_post('terapioralicc5') : null,
            //     'terapioralicc6' => safe_post('terapioralicc6') !== '' ? safe_post('terapioralicc6') : null,
            //     'terapioralicc7' => safe_post('terapioralicc7') !== '' ? safe_post('terapioralicc7') : null,
            //     'terapioralicc8' => safe_post('terapioralicc8') !== '' ? safe_post('terapioralicc8') : null,
            //     'terapioralicc9' => safe_post('terapioralicc9') !== '' ? safe_post('terapioralicc9') : null,
            //     'terapioralicc10' => safe_post('terapioralicc10') !== '' ? safe_post('terapioralicc10') : null,
            //     'terapioralicc11' => safe_post('terapioralicc11') !== '' ? safe_post('terapioralicc11') : null,
            //     'terapioralicc12' => safe_post('terapioralicc12') !== '' ? safe_post('terapioralicc12') : null,
            //     'terapioralicc13' => safe_post('terapioralicc13') !== '' ? safe_post('terapioralicc13') : null,
            //     'terapioralicc14' => safe_post('terapioralicc14') !== '' ? safe_post('terapioralicc14') : null,
            //     'terapioralicc15' => safe_post('terapioralicc15') !== '' ? safe_post('terapioralicc15') : null,
            //     'terapioralicc16' => safe_post('terapioralicc16') !== '' ? safe_post('terapioralicc16') : null,
            //     'terapioralicc17' => safe_post('terapioralicc17') !== '' ? safe_post('terapioralicc17') : null,
            //     'terapioralicc18' => safe_post('terapioralicc18') !== '' ? safe_post('terapioralicc18') : null,
            //     'terapioralicc19' => safe_post('terapioralicc19') !== '' ? safe_post('terapioralicc19') : null,
            //     'terapioralicc20' => safe_post('terapioralicc20') !== '' ? safe_post('terapioralicc20') : null,
            //     'terapioralicc21' => safe_post('terapioralicc21') !== '' ? safe_post('terapioralicc21') : null,
            //     'terapioralicc22' => safe_post('terapioralicc22') !== '' ? safe_post('terapioralicc22') : null,
            //     'terapioralicc23' => safe_post('terapioralicc23') !== '' ? safe_post('terapioralicc23') : null,
            //     'terapioralicc24' => safe_post('terapioralicc24') !== '' ? safe_post('terapioralicc24') : null,
            //     'terapioralicc25' => safe_post('terapioralicc25') !== '' ? safe_post('terapioralicc25') : null,
            //     'terapioralicc26' => safe_post('terapioralicc26') !== '' ? safe_post('terapioralicc26') : null,
            //     'terapioralicc27' => safe_post('terapioralicc27') !== '' ? safe_post('terapioralicc27') : null,
            //     'terapioralicc28' => safe_post('terapioralicc28') !== '' ? safe_post('terapioralicc28') : null,
            //     'terapioralicc29' => safe_post('terapioralicc29') !== '' ? safe_post('terapioralicc29') : null,
            //     'terapioralicc30' => safe_post('terapioralicc30') !== '' ? safe_post('terapioralicc30') : null,
            //     'terapioralicc31' => safe_post('terapioralicc31') !== '' ? safe_post('terapioralicc31') : null,
            //     'terapioralicc32' => safe_post('terapioralicc32') !== '' ? safe_post('terapioralicc32') : null,
            //     'terapioralicc33' => safe_post('terapioralicc33') !== '' ? safe_post('terapioralicc33') : null,
            //     'terapioralicc34' => safe_post('terapioralicc34') !== '' ? safe_post('terapioralicc34') : null,
            //     'terapioralicc35' => safe_post('terapioralicc35') !== '' ? safe_post('terapioralicc35') : null,
            //     'terapioralicc36' => safe_post('terapioralicc36') !== '' ? safe_post('terapioralicc36') : null,
            //     'terapioralicc37' => safe_post('terapioralicc37') !== '' ? safe_post('terapioralicc37') : null,
            //     'terapioralicc38' => safe_post('terapioralicc38') !== '' ? safe_post('terapioralicc38') : null,
            //     'terapioralicc39' => safe_post('terapioralicc39') !== '' ? safe_post('terapioralicc39') : null,
            //     'terapioralicc40' => safe_post('terapioralicc40') !== '' ? safe_post('terapioralicc40') : null,
            //     'terapioralicc41' => safe_post('terapioralicc41') !== '' ? safe_post('terapioralicc41') : null,
            //     'terapioralicc42' => safe_post('terapioralicc42') !== '' ? safe_post('terapioralicc42') : null,
            //     'terapioralicc43' => safe_post('terapioralicc43') !== '' ? safe_post('terapioralicc43') : null,
            //     'terapioralicc44' => safe_post('terapioralicc44') !== '' ? safe_post('terapioralicc44') : null,
            //     'terapioralicc45' => safe_post('terapioralicc45') !== '' ? safe_post('terapioralicc45') : null,
            //     'terapioralicc46' => safe_post('terapioralicc46') !== '' ? safe_post('terapioralicc46') : null,
            //     'terapioralicc47' => safe_post('terapioralicc47') !== '' ? safe_post('terapioralicc47') : null,
            //     'terapioralicc48' => safe_post('terapioralicc48') !== '' ? safe_post('terapioralicc48') : null,
            //     'terapioralicc49' => safe_post('terapioralicc49') !== '' ? safe_post('terapioralicc49') : null,
            //     'terapioralicc50' => safe_post('terapioralicc50') !== '' ? safe_post('terapioralicc50') : null,
            // ]),


            'terapioralicc' => json_encode(array_reduce(range(1, 50), function($carry, $i) { // 'terapioralicc' akan diisi dengan hasil pengubahan array menjadi JSON dari hasil operasi array_reduce.
                $key = 'terapioralicc' . $i; // Membuat string dengan nama 'terapioralicc' yang diikuti oleh nilai 'i', misalnya 'terapioralicc1', 'terapioralicc2', dst.
                $carry[$key] = safe_post($key) !== '' ? safe_post($key) : null; // Jika hasil dari 'safe_post($key)' tidak kosong, simpan hasilnya dalam array $carry dengan key yang sesuai, jika kosong, simpan nilai null.
                return $carry; // Kembalikan array $carry ke dalam fungsi array_reduce untuk iterasi berikutnya.
            }, [])),

            'terapioralicca' => json_encode(array_reduce(range(1, 50), function($carry, $i) {
                $key = 'terapioralicca' . $i;
                $carry[$key] = safe_post($key) !== '' ? safe_post($key) : null;
                return $carry;
            }, [])),

            'terapioraliccb' => json_encode(array_reduce(range(1, 50), function($carry, $i) {
                $key = 'terapioraliccb' . $i;
                $carry[$key] = safe_post($key) !== '' ? safe_post($key) : null;
                return $carry;
            }, [])),

            'terapioraliccc' => json_encode(array_reduce(range(1, 50), function($carry, $i) {
                $key = 'terapioraliccc' . $i;
                $carry[$key] = safe_post($key) !== '' ? safe_post($key) : null;
                return $carry;
            }, [])),

            'terapioraliccd' => json_encode(array_reduce(range(1, 50), function($carry, $i) {
                $key = 'terapioraliccd' . $i;
                $carry[$key] = safe_post($key) !== '' ? safe_post($key) : null;
                return $carry;
            }, [])),

            'terapioralicce' => json_encode(array_reduce(range(1, 50), function($carry, $i) {
                $key = 'terapioralicce' . $i;
                $carry[$key] = safe_post($key) !== '' ? safe_post($key) : null;
                return $carry;
            }, [])),

            'terapioraliccf' => json_encode(array_reduce(range(1, 50), function($carry, $i) {
                $key = 'terapioraliccf' . $i;
                $carry[$key] = safe_post($key) !== '' ? safe_post($key) : null;
                return $carry;
            }, [])),

            'terapioraliccg' => json_encode(array_reduce(range(1, 50), function($carry, $i) {
                $key = 'terapioraliccg' . $i;
                $carry[$key] = safe_post($key) !== '' ? safe_post($key) : null;
                return $carry;
            }, [])),

            'terapioralicch' => json_encode(array_reduce(range(1, 50), function($carry, $i) {
                $key = 'terapioralicch' . $i;
                $carry[$key] = safe_post($key) !== '' ? safe_post($key) : null;
                return $carry;
            }, [])),

            'terapioralicci' => json_encode(array_reduce(range(1, 50), function($carry, $i) {
                $key = 'terapioralicci' . $i;
                $carry[$key] = safe_post($key) !== '' ? safe_post($key) : null;
                return $carry;
            }, [])),

            'terapioraliccj' => json_encode(array_reduce(range(1, 50), function($carry, $i) {
                $key = 'terapioraliccj' . $i;
                $carry[$key] = safe_post($key) !== '' ? safe_post($key) : null;
                return $carry;
            }, [])),

            'terapioralicck' => json_encode(array_reduce(range(1, 50), function($carry, $i) {
                $key = 'terapioralicck' . $i;
                $carry[$key] = safe_post($key) !== '' ? safe_post($key) : null;
                return $carry;
            }, [])),
            // batas

            'terapiinjeksiicc' => json_encode(array_reduce(range(1, 50), function($carry, $i) {
                $key = 'terapiinjeksiicc' . $i;
                $carry[$key] = safe_post($key) !== '' ? safe_post($key) : null;
                return $carry;
            }, [])),

            'terapiinjeksiicca' => json_encode(array_reduce(range(1, 50), function($carry, $i) {
                $key = 'terapiinjeksiicca' . $i;
                $carry[$key] = safe_post($key) !== '' ? safe_post($key) : null;
                return $carry;
            }, [])),

            'terapiinjeksiiccb' => json_encode(array_reduce(range(1, 50), function($carry, $i) {
                $key = 'terapiinjeksiiccb' . $i;
                $carry[$key] = safe_post($key) !== '' ? safe_post($key) : null;
                return $carry;
            }, [])),

            'terapiinjeksiiccc' => json_encode(array_reduce(range(1, 50), function($carry, $i) {
                $key = 'terapiinjeksiiccc' . $i;
                $carry[$key] = safe_post($key) !== '' ? safe_post($key) : null;
                return $carry;
            }, [])),

            'terapiinjeksiiccd' => json_encode(array_reduce(range(1, 50), function($carry, $i) {
                $key = 'terapiinjeksiiccd' . $i;
                $carry[$key] = safe_post($key) !== '' ? safe_post($key) : null;
                return $carry;
            }, [])),

            'terapiinjeksiicce' => json_encode(array_reduce(range(1, 50), function($carry, $i) {
                $key = 'terapiinjeksiicce' . $i;
                $carry[$key] = safe_post($key) !== '' ? safe_post($key) : null;
                return $carry;
            }, [])),

            'terapiinjeksiiccf' => json_encode(array_reduce(range(1, 50), function($carry, $i) {
                $key = 'terapiinjeksiiccf' . $i;
                $carry[$key] = safe_post($key) !== '' ? safe_post($key) : null;
                return $carry;
            }, [])),

            'terapiinjeksiiccg' => json_encode(array_reduce(range(1, 50), function($carry, $i) {
                $key = 'terapiinjeksiiccg' . $i;
                $carry[$key] = safe_post($key) !== '' ? safe_post($key) : null;
                return $carry;
            }, [])),

            'terapiinjeksiicch' => json_encode(array_reduce(range(1, 50), function($carry, $i) {
                $key = 'terapiinjeksiicch' . $i;
                $carry[$key] = safe_post($key) !== '' ? safe_post($key) : null;
                return $carry;
            }, [])),

            'terapiinjeksiicci' => json_encode(array_reduce(range(1, 50), function($carry, $i) {
                $key = 'terapiinjeksiicci' . $i;
                $carry[$key] = safe_post($key) !== '' ? safe_post($key) : null;
                return $carry;
            }, [])),

            'terapiinjeksiiccj' => json_encode(array_reduce(range(1, 50), function($carry, $i) {
                $key = 'terapiinjeksiiccj' . $i;
                $carry[$key] = safe_post($key) !== '' ? safe_post($key) : null;
                return $carry;
            }, [])),

            'terapiinjeksiicck' => json_encode(array_reduce(range(1, 50), function($carry, $i) {
                $key = 'terapiinjeksiicck' . $i;
                $carry[$key] = safe_post($key) !== '' ? safe_post($key) : null;
                return $carry;
            }, [])),

            // batas
            'terapilainicc' => json_encode(array_reduce(range(1, 50), function($carry, $i) {
                $key = 'terapilainicc' . $i;
                $carry[$key] = safe_post($key) !== '' ? safe_post($key) : null;
                return $carry;
            }, [])),

            'terapilainicca' => json_encode(array_reduce(range(1, 50), function($carry, $i) {
                $key = 'terapilainicca' . $i;
                $carry[$key] = safe_post($key) !== '' ? safe_post($key) : null;
                return $carry;
            }, [])),

            'terapilainiccb' => json_encode(array_reduce(range(1, 50), function($carry, $i) {
                $key = 'terapilainiccb' . $i;
                $carry[$key] = safe_post($key) !== '' ? safe_post($key) : null;
                return $carry;
            }, [])),


            // BATAS  
            'lapcwpA' => json_encode(array_reduce(range(1, 50), function($carry, $i) {
                $key = 'lapcwpA' . $i;
                $carry[$key] = safe_post($key) !== '' ? safe_post($key) : null;
                return $carry;
            }, [])),

            'lapcwpB' => json_encode(array_reduce(range(1, 50), function($carry, $i) {
                $key = 'lapcwpB' . $i;
                $carry[$key] = safe_post($key) !== '' ? safe_post($key) : null;
                return $carry;
            }, [])),

            'lapcwpC' => json_encode(array_reduce(range(1, 50), function($carry, $i) {
                $key = 'lapcwpC' . $i;
                $carry[$key] = safe_post($key) !== '' ? safe_post($key) : null;
                return $carry;
            }, [])),

            'lapcwpD' => json_encode(array_reduce(range(1, 50), function($carry, $i) {
                $key = 'lapcwpD' . $i;
                $carry[$key] = safe_post($key) !== '' ? safe_post($key) : null;
                return $carry;
            }, [])),

            'lapcwpE' => json_encode(array_reduce(range(1, 50), function($carry, $i) {
                $key = 'lapcwpE' . $i;
                $carry[$key] = safe_post($key) !== '' ? safe_post($key) : null;
                return $carry;
            }, [])),

            'lapcwpF' => json_encode(array_reduce(range(1, 50), function($carry, $i) {
                $key = 'lapcwpF' . $i;
                $carry[$key] = safe_post($key) !== '' ? safe_post($key) : null;
                return $carry;
            }, [])),

            'lapcwpG' => json_encode(array_reduce(range(1, 50), function($carry, $i) {
                $key = 'lapcwpG' . $i;
                $carry[$key] = safe_post($key) !== '' ? safe_post($key) : null;
                return $carry;
            }, [])),

            'lapcwpH' => json_encode(array_reduce(range(1, 50), function($carry, $i) {
                $key = 'lapcwpH' . $i;
                $carry[$key] = safe_post($key) !== '' ? safe_post($key) : null;
                return $carry;
            }, [])),

            'lapcwpI' => json_encode(array_reduce(range(1, 50), function($carry, $i) {
                $key = 'lapcwpI' . $i;
                $carry[$key] = safe_post($key) !== '' ? safe_post($key) : null;
                return $carry;
            }, [])),

            'lapcwpJ' => json_encode(array_reduce(range(1, 50), function($carry, $i) {
                $key = 'lapcwpJ' . $i;
                $carry[$key] = safe_post($key) !== '' ? safe_post($key) : null;
                return $carry;
            }, [])),

            'lapcwpK' => json_encode(array_reduce(range(1, 50), function($carry, $i) {
                $key = 'lapcwpK' . $i;
                $carry[$key] = safe_post($key) !== '' ? safe_post($key) : null;
                return $carry;
            }, [])),

            'lapcwpL' => json_encode(array_reduce(range(1, 50), function($carry, $i) {
                $key = 'lapcwpL' . $i;
                $carry[$key] = safe_post($key) !== '' ? safe_post($key) : null;
                return $carry;
            }, [])),

            'lapcwpM' => json_encode(array_reduce(range(1, 50), function($carry, $i) {
                $key = 'lapcwpM' . $i;
                $carry[$key] = safe_post($key) !== '' ? safe_post($key) : null;
                return $carry;
            }, [])),

            'lapcwpN' => json_encode(array_reduce(range(1, 50), function($carry, $i) {
                $key = 'lapcwpN' . $i;
                $carry[$key] = safe_post($key) !== '' ? safe_post($key) : null;
                return $carry;
            }, [])),

            'lapcwpO' => json_encode(array_reduce(range(1, 50), function($carry, $i) {
                $key = 'lapcwpO' . $i;
                $carry[$key] = safe_post($key) !== '' ? safe_post($key) : null;
                return $carry;
            }, [])),

            'lapcwpP' => json_encode(array_reduce(range(1, 50), function($carry, $i) {
                $key = 'lapcwpP' . $i;
                $carry[$key] = safe_post($key) !== '' ? safe_post($key) : null;
                return $carry;
            }, [])),

            'lapcwpQ' => json_encode(array_reduce(range(1, 50), function($carry, $i) {
                $key = 'lapcwpQ' . $i;
                $carry[$key] = safe_post($key) !== '' ? safe_post($key) : null;
                return $carry;
            }, [])),

            'lapcwpR' => json_encode(array_reduce(range(1, 50), function($carry, $i) {
                $key = 'lapcwpR' . $i;
                $carry[$key] = safe_post($key) !== '' ? safe_post($key) : null;
                return $carry;
            }, [])),

            'lapcwpS' => json_encode(array_reduce(range(1, 50), function($carry, $i) {
                $key = 'lapcwpS' . $i;
                $carry[$key] = safe_post($key) !== '' ? safe_post($key) : null;
                return $carry;
            }, [])),

            'lapcwpT' => json_encode(array_reduce(range(1, 50), function($carry, $i) {
                $key = 'lapcwpT' . $i;
                $carry[$key] = safe_post($key) !== '' ? safe_post($key) : null;
                return $carry;
            }, [])),

            'lapcwpU' => json_encode(array_reduce(range(1, 50), function($carry, $i) {
                $key = 'lapcwpU' . $i;
                $carry[$key] = safe_post($key) !== '' ? safe_post($key) : null;
                return $carry;
            }, [])),

            'lapcwpV' => json_encode(array_reduce(range(1, 50), function($carry, $i) {
                $key = 'lapcwpV' . $i;
                $carry[$key] = safe_post($key) !== '' ? safe_post($key) : null;
                return $carry;
            }, [])),

            'lapcwpW' => json_encode(array_reduce(range(1, 50), function($carry, $i) {
                $key = 'lapcwpW' . $i;
                $carry[$key] = safe_post($key) !== '' ? safe_post($key) : null;
                return $carry;
            }, [])),

            'lapcwpX' => json_encode(array_reduce(range(1, 50), function($carry, $i) {
                $key = 'lapcwpX' . $i;
                $carry[$key] = safe_post($key) !== '' ? safe_post($key) : null;
                return $carry;
            }, [])),

            'lapcwpY' => json_encode(array_reduce(range(1, 50), function($carry, $i) {
                $key = 'lapcwpY' . $i;
                $carry[$key] = safe_post($key) !== '' ? safe_post($key) : null;
                return $carry;
            }, [])),
            'lapcwpZ' => json_encode(array_reduce(range(1, 50), function($carry, $i) {
                $key = 'lapcwpZ' . $i;
                $carry[$key] = safe_post($key) !== '' ? safe_post($key) : null;
                return $carry;
            }, [])),
            'lapcwpAA' => json_encode(array_reduce(range(1, 50), function($carry, $i) {
                $key = 'lapcwpAA' . $i;
                $carry[$key] = safe_post($key) !== '' ? safe_post($key) : null;
                return $carry;
            }, [])),

            'lapcwpBB' => json_encode(array_reduce(range(1, 50), function($carry, $i) {
                $key = 'lapcwpBB' . $i;
                $carry[$key] = safe_post($key) !== '' ? safe_post($key) : null;
                return $carry;
            }, [])),
            'lapcwpCC' => json_encode(array_reduce(range(1, 50), function($carry, $i) {
                $key = 'lapcwpCC' . $i;
                $carry[$key] = safe_post($key) !== '' ? safe_post($key) : null;
                return $carry;
            }, [])),
            'lapcwpDD' => json_encode(array_reduce(range(1, 50), function($carry, $i) {
                $key = 'lapcwpDD' . $i;
                $carry[$key] = safe_post($key) !== '' ? safe_post($key) : null;
                return $carry;
            }, [])),

            'lapcwpEE' => json_encode(array_reduce(range(1, 50), function($carry, $i) {
                $key = 'lapcwpEE' . $i;
                $carry[$key] = safe_post($key) !== '' ? safe_post($key) : null;
                return $carry;
            }, [])),
            'lapcwpFF' => json_encode(array_reduce(range(1, 50), function($carry, $i) {
                $key = 'lapcwpFF' . $i;
                $carry[$key] = safe_post($key) !== '' ? safe_post($key) : null;
                return $carry;
            }, [])),
            'lapcwpGG' => json_encode(array_reduce(range(1, 50), function($carry, $i) {
                $key = 'lapcwpGG' . $i;
                $carry[$key] = safe_post($key) !== '' ? safe_post($key) : null;
                return $carry;
            }, [])),

            'lapcwptext'     => (safe_post('lapcwptext') !== '' ? safe_post('lapcwptext') : NULL),


            // BATAS
            'sirkulasiA' => json_encode(array_reduce(range(1, 50), function($carry, $i) {
                $key = 'sirkulasiA' . $i;
                $carry[$key] = safe_post($key) !== '' ? safe_post($key) : null;
                return $carry;
            }, [])),
            'sirkulasiB' => json_encode(array_reduce(range(1, 50), function($carry, $i) {
                $key = 'sirkulasiB' . $i;
                $carry[$key] = safe_post($key) !== '' ? safe_post($key) : null;
                return $carry;
            }, [])),
            'sirkulasiC' => json_encode(array_reduce(range(1, 50), function($carry, $i) {
                $key = 'sirkulasiC' . $i;
                $carry[$key] = safe_post($key) !== '' ? safe_post($key) : null;
                return $carry;
            }, [])),
            'sirkulasiD' => json_encode(array_reduce(range(1, 50), function($carry, $i) {
                $key = 'sirkulasiD' . $i;
                $carry[$key] = safe_post($key) !== '' ? safe_post($key) : null;
                return $carry;
            }, [])),
            'sirkulasiE' => json_encode(array_reduce(range(1, 50), function($carry, $i) {
                $key = 'sirkulasiE' . $i;
                $carry[$key] = safe_post($key) !== '' ? safe_post($key) : null;
                return $carry;
            }, [])),
            'sirkulasiF' => json_encode(array_reduce(range(1, 25), function($carry, $i) {
                $key = 'sirkulasiF' . $i;
                $carry[$key] = safe_post($key) !== '' ? safe_post($key) : null;
                return $carry;
            }, [])),

            'sirkulasitext'     => (safe_post('sirkulasitext') !== '' ? safe_post('sirkulasitext') : NULL),


            // BATAS
            'modeicc' => json_encode(array_reduce(range(1, 26), function($carry, $i) {
                $key = 'modeicc' . $i;
                $carry[$key] = safe_post($key) !== '' ? safe_post($key) : null;
                return $carry;
            }, [])),

            'mvemvicc' => json_encode(array_reduce(range(1, 26), function($carry, $i) {
                $key = 'mvemvicc' . $i;
                $carry[$key] = safe_post($key) !== '' ? safe_post($key) : null;
                return $carry;
            }, [])),

            'tvetvicc' => json_encode(array_reduce(range(1, 26), function($carry, $i) {
                $key = 'tvetvicc' . $i;
                $carry[$key] = safe_post($key) !== '' ? safe_post($key) : null;
                return $carry;
            }, [])),

            'totalrateicc' => json_encode(array_reduce(range(1, 26), function($carry, $i) {
                $key = 'totalrateicc' . $i;
                $carry[$key] = safe_post($key) !== '' ? safe_post($key) : null;
                return $carry;
            }, [])),

            'inspirasipressicc' => json_encode(array_reduce(range(1, 26), function($carry, $i) {
                $key = 'inspirasipressicc' . $i;
                $carry[$key] = safe_post($key) !== '' ? safe_post($key) : null;
                return $carry;
            }, [])),

            'modpeepicc' => json_encode(array_reduce(range(1, 26), function($carry, $i) {
                $key = 'modpeepicc' . $i;
                $carry[$key] = safe_post($key) !== '' ? safe_post($key) : null;
                return $carry;
            }, [])),

            'peakicc' => json_encode(array_reduce(range(1, 26), function($carry, $i) {
                $key = 'peakicc' . $i;
                $carry[$key] = safe_post($key) !== '' ? safe_post($key) : null;
                return $carry;
            }, [])),

            'fiicc' => json_encode(array_reduce(range(1, 26), function($carry, $i) {
                $key = 'fiicc' . $i;
                $carry[$key] = safe_post($key) !== '' ? safe_post($key) : null;
                return $carry;
            }, [])),

            'cufforessicc' => json_encode(array_reduce(range(1, 26), function($carry, $i) {
                $key = 'cufforessicc' . $i;
                $carry[$key] = safe_post($key) !== '' ? safe_post($key) : null;
                return $carry;
            }, [])),

            'suctionicc' => json_encode(array_reduce(range(1, 26), function($carry, $i) {
                $key = 'suctionicc' . $i;
                $carry[$key] = safe_post($key) !== '' ? safe_post($key) : null;
                return $carry;
            }, [])),

            'gdsicc' => json_encode(array_reduce(range(1, 26), function($carry, $i) {
                $key = 'gdsicc' . $i;
                $carry[$key] = safe_post($key) !== '' ? safe_post($key) : null;
                return $carry;
            }, [])),
            'respirasitext'     => (safe_post('respirasitext') !== '' ? safe_post('respirasitext') : NULL),

            // BATAS
            'ukuranpupilicc' => json_encode(array_reduce(range(1, 50), function($carry, $i) {
                $key = 'ukuranpupilicc' . $i;
                $carry[$key] = safe_post($key) !== '' ? safe_post($key) : null;
                return $carry;
            }, [])),

            'reaksipupilicc' => json_encode(array_reduce(range(1, 50), function($carry, $i) {
                $key = 'reaksipupilicc' . $i;
                $carry[$key] = safe_post($key) !== '' ? safe_post($key) : null;
                return $carry;
            }, [])),

            'gcsicc' => json_encode(array_reduce(range(1, 25), function($carry, $i) {
                $key = 'gcsicc' . $i;
                $carry[$key] = safe_post($key) !== '' ? safe_post($key) : null;
                return $carry;
            }, [])),
            
            'kesadaranicct' => json_encode(array_reduce(range(1, 25), function($carry, $i) {
                $key = 'kesadaranicct' . $i;
                $carry[$key] = safe_post($key) !== '' ? safe_post($key) : null;
                return $carry;
            }, [])),

            'plebitisicc' => json_encode(array_reduce(range(1, 25), function($carry, $i) {
                $key = 'plebitisicc' . $i;
                $carry[$key] = safe_post($key) !== '' ? safe_post($key) : null;
                return $carry;
            }, [])),

            'locationicc' => json_encode(array_reduce(range(1, 25), function($carry, $i) {
                $key = 'locationicc' . $i;
                $carry[$key] = safe_post($key) !== '' ? safe_post($key) : null;
                return $carry;
            }, [])),

            'intensity' => json_encode(array_reduce(range(1, 25), function($carry, $i) {
                $key = 'intensity' . $i;
                $carry[$key] = safe_post($key) !== '' ? safe_post($key) : null;
                return $carry;
            }, [])),

            'sedationicc' => json_encode(array_reduce(range(1, 25), function($carry, $i) {
                $key = 'sedationicc' . $i;
                $carry[$key] = safe_post($key) !== '' ? safe_post($key) : null;
                return $carry;
            }, [])),
            'neurotext'     => (safe_post('neurotext') !== '' ? safe_post('neurotext') : NULL),


            // BATAS 
            'phicc' => json_encode(array_reduce(range(1, 6), function($carry, $i) {
                $key = 'phicc' . $i;
                $carry[$key] = safe_post($key) !== '' ? safe_post($key) : null;
                return $carry;
            }, [])),

            'pcoicc' => json_encode(array_reduce(range(1, 6), function($carry, $i) {
                $key = 'pcoicc' . $i;
                $carry[$key] = safe_post($key) !== '' ? safe_post($key) : null;
                return $carry;
            }, [])),

            'poicc' => json_encode(array_reduce(range(1, 6), function($carry, $i) {
                $key = 'poicc' . $i;
                $carry[$key] = safe_post($key) !== '' ? safe_post($key) : null;
                return $carry;
            }, [])),

            'tcoicc' => json_encode(array_reduce(range(1, 6), function($carry, $i) {
                $key = 'tcoicc' . $i;
                $carry[$key] = safe_post($key) !== '' ? safe_post($key) : null;
                return $carry;
            }, [])),

            'belicc' => json_encode(array_reduce(range(1, 6), function($carry, $i) {
                $key = 'belicc' . $i;
                $carry[$key] = safe_post($key) !== '' ? safe_post($key) : null;
                return $carry;
            }, [])),

            'hcoicc' => json_encode(array_reduce(range(1, 6), function($carry, $i) {
                $key = 'hcoicc' . $i;
                $carry[$key] = safe_post($key) !== '' ? safe_post($key) : null;
                return $carry;
            }, [])),

            'ooduaicc' => json_encode(array_reduce(range(1, 6), function($carry, $i) {
                $key = 'ooduaicc' . $i;
                $carry[$key] = safe_post($key) !== '' ? safe_post($key) : null;
                return $carry;
            }, [])),

            'saturwasiicc' => json_encode(array_reduce(range(1, 6), function($carry, $i) {
                $key = 'saturwasiicc' . $i;
                $carry[$key] = safe_post($key) !== '' ? safe_post($key) : null;
                return $carry;
            }, [])),

            'nakclcaicc' => json_encode(array_reduce(range(1, 6), function($carry, $i) {
                $key = 'nakclcaicc' . $i;
                $carry[$key] = safe_post($key) !== '' ? safe_post($key) : null;
                return $carry;
            }, [])),

            'ureumcreatininicc' => json_encode(array_reduce(range(1, 6), function($carry, $i) {
                $key = 'ureumcreatininicc' . $i;
                $carry[$key] = safe_post($key) !== '' ? safe_post($key) : null;
                return $carry;
            }, [])),

            'albuminicc' => json_encode(array_reduce(range(1, 6), function($carry, $i) {
                $key = 'albuminicc' . $i;
                $carry[$key] = safe_post($key) !== '' ? safe_post($key) : null;
                return $carry;
            }, [])),

            'hbhtleuicc' => json_encode(array_reduce(range(1, 6), function($carry, $i) {
                $key = 'hbhtleuicc' . $i;
                $carry[$key] = safe_post($key) !== '' ? safe_post($key) : null;
                return $carry;
            }, [])),

            'otpticc' => json_encode(array_reduce(range(1, 6), function($carry, $i) {
                $key = 'otpticc' . $i;
                $carry[$key] = safe_post($key) !== '' ? safe_post($key) : null;
                return $carry;
            }, [])),

            'bildirectlicc' => json_encode(array_reduce(range(1, 6), function($carry, $i) {
                $key = 'bildirectlicc' . $i;
                $carry[$key] = safe_post($key) !== '' ? safe_post($key) : null;
                return $carry;
            }, [])),

            'ckckmbicc' => json_encode(array_reduce(range(1, 6), function($carry, $i) {
                $key = 'ckckmbicc' . $i;
                $carry[$key] = safe_post($key) !== '' ? safe_post($key) : null;
                return $carry;
            }, [])),

            'ptapttcc' => json_encode(array_reduce(range(1, 6), function($carry, $i) {
                $key = 'ptapttcc' . $i;
                $carry[$key] = safe_post($key) !== '' ? safe_post($key) : null;
                return $carry;
            }, [])),

            'fibrinogenicc' => json_encode(array_reduce(range(1, 6), function($carry, $i) {
                $key = 'fibrinogenicc' . $i;
                $carry[$key] = safe_post($key) !== '' ? safe_post($key) : null;
                return $carry;
            }, [])),

            'crppcticc' => json_encode(array_reduce(range(1, 6), function($carry, $i) {
                $key = 'crppcticc' . $i;
                $carry[$key] = safe_post($key) !== '' ? safe_post($key) : null;
                return $carry;
            }, [])),


            // BATAS 
            'intakeA' => json_encode(array_reduce(range(1, 51), function($carry, $i) {
                $key = 'intakeA' . $i;
                $carry[$key] = safe_post($key) !== '' ? safe_post($key) : null;
                return $carry;
            }, [])),
            'intakeB' => json_encode(array_reduce(range(1, 51), function($carry, $i) {
                $key = 'intakeB' . $i;
                $carry[$key] = safe_post($key) !== '' ? safe_post($key) : null;
                return $carry;
            }, [])),
            'intakeC' => json_encode(array_reduce(range(1, 51), function($carry, $i) {
                $key = 'intakeC' . $i;
                $carry[$key] = safe_post($key) !== '' ? safe_post($key) : null;
                return $carry;
            }, [])),
            'intakeD' => json_encode(array_reduce(range(1, 51), function($carry, $i) {
                $key = 'intakeD' . $i;
                $carry[$key] = safe_post($key) !== '' ? safe_post($key) : null;
                return $carry;
            }, [])),
            'intakeE' => json_encode(array_reduce(range(1, 51), function($carry, $i) {
                $key = 'intakeE' . $i;
                $carry[$key] = safe_post($key) !== '' ? safe_post($key) : null;
                return $carry;
            }, [])),
            'intakeF' => json_encode(array_reduce(range(1, 51), function($carry, $i) {
                $key = 'intakeF' . $i;
                $carry[$key] = safe_post($key) !== '' ? safe_post($key) : null;
                return $carry;
            }, [])),
            'intakeG' => json_encode(array_reduce(range(1, 51), function($carry, $i) {
                $key = 'intakeG' . $i;
                $carry[$key] = safe_post($key) !== '' ? safe_post($key) : null;
                return $carry;
            }, [])),
            'intakeH' => json_encode(array_reduce(range(1, 51), function($carry, $i) {
                $key = 'intakeH' . $i;
                $carry[$key] = safe_post($key) !== '' ? safe_post($key) : null;
                return $carry;
            }, [])),
            'intakeI' => json_encode(array_reduce(range(1, 51), function($carry, $i) {
                $key = 'intakeI' . $i;
                $carry[$key] = safe_post($key) !== '' ? safe_post($key) : null;
                return $carry;
            }, [])),
            'intakeJ' => json_encode(array_reduce(range(1, 51), function($carry, $i) {
                $key = 'intakeJ' . $i;
                $carry[$key] = safe_post($key) !== '' ? safe_post($key) : null;
                return $carry;
            }, [])),
            'intakeK' => json_encode(array_reduce(range(1, 25), function($carry, $i) {
                $key = 'intakeK' . $i;
                $carry[$key] = safe_post($key) !== '' ? safe_post($key) : null;
                return $carry;
            }, [])),
            'intakeL' => json_encode(array_reduce(range(1, 25), function($carry, $i) {
                $key = 'intakeL' . $i;
                $carry[$key] = safe_post($key) !== '' ? safe_post($key) : null;
                return $carry;
            }, [])),


            // BATASS 
            'drainA' => json_encode(array_reduce(range(1, 50), function($carry, $i) {
                $key = 'drainA' . $i;
                $carry[$key] = safe_post($key) !== '' ? safe_post($key) : null;
                return $carry;
            }, [])),
            'drainB' => json_encode(array_reduce(range(1, 50), function($carry, $i) {
                $key = 'drainB' . $i;
                $carry[$key] = safe_post($key) !== '' ? safe_post($key) : null;
                return $carry;
            }, [])),
            'drainC' => json_encode(array_reduce(range(1, 25), function($carry, $i) {
                $key = 'drainC' . $i;
                $carry[$key] = safe_post($key) !== '' ? safe_post($key) : null;
                return $carry;
            }, [])),
            'intakeD' => json_encode(array_reduce(range(1, 25), function($carry, $i) {
                $key = 'intakeD' . $i;
                $carry[$key] = safe_post($key) !== '' ? safe_post($key) : null;
                return $carry;
            }, [])),
            'ngtE' => json_encode(array_reduce(range(1, 25), function($carry, $i) {
                $key = 'ngtE' . $i;
                $carry[$key] = safe_post($key) !== '' ? safe_post($key) : null;
                return $carry;
            }, [])),
            'babF' => json_encode(array_reduce(range(1, 25), function($carry, $i) {
                $key = 'babF' . $i;
                $carry[$key] = safe_post($key) !== '' ? safe_post($key) : null;
                return $carry;
            }, [])),
            'bakG' => json_encode(array_reduce(range(1, 25), function($carry, $i) {
                $key = 'bakG' . $i;
                $carry[$key] = safe_post($key) !== '' ? safe_post($key) : null;
                return $carry;
            }, [])),
            'totalperjamH' => json_encode(array_reduce(range(1, 25), function($carry, $i) {
                $key = 'totalperjamH' . $i;
                $carry[$key] = safe_post($key) !== '' ? safe_post($key) : null;
                return $carry;
            }, [])),
            'runingtotalI' => json_encode(array_reduce(range(1, 25), function($carry, $i) {
                $key = 'runingtotalI' . $i;
                $carry[$key] = safe_post($key) !== '' ? safe_post($key) : null;
                return $carry;
            }, [])),

            'totaloutput'    => (safe_post('totaloutput') !== '' ? safe_post('totaloutput') : NULL),

            'balenceJ' => json_encode(array_reduce(range(1, 50), function($carry, $i) {
                $key = 'balenceJ' . $i;
                $carry[$key] = safe_post($key) !== '' ? safe_post($key) : null;
                return $carry;
            }, [])),

            'balenceK'    => (safe_post('balenceK') !== '' ? safe_post('balenceK') : NULL),

            'balanceL' => json_encode(array_reduce(range(1, 3), function($carry, $i) {
                $key = 'balanceL' . $i;
                $carry[$key] = safe_post($key) !== '' ? safe_post($key) : null;
                return $carry;
            }, [])),

            // DOWN SCORE/EVALUASI GAWAT NAFAS
            'frekuensinafasicc' => (safe_post('frekuensinafasicc') !== '' ? safe_post('frekuensinafasicc') : NULL),
            'retraksiicc'       => (safe_post('retraksiicc') !== '' ? safe_post('retraksiicc') : NULL),
            'sianosisicc'       => (safe_post('sianosisicc') !== '' ? safe_post('sianosisicc') : NULL),
            'airentriicc'       => (safe_post('airentriicc') !== '' ? safe_post('airentriicc') : NULL),
            'merintihicc'       => (safe_post('merintihicc') !== '' ? safe_post('merintihicc') : NULL),
            'total_nilai_dsegn' => (safe_post('total_nilai_dsegn') !== '' ? safe_post('total_nilai_dsegn') : NULL),

            // BRADEN RISK ASESSMENT SCALE
            'totalyicc_1'       => (safe_post('totalyicc_1') !== '' ? safe_post('totalyicc_1') : NULL),
            'totalyicc_2'       => (safe_post('totalyicc_2') !== '' ? safe_post('totalyicc_2') : NULL),
            'totalyicc_3'       => (safe_post('totalyicc_3') !== '' ? safe_post('totalyicc_3') : NULL),
            'totalyicc_4'       => (safe_post('totalyicc_4') !== '' ? safe_post('totalyicc_4') : NULL),
            'totalyicc_5'       => (safe_post('totalyicc_5') !== '' ? safe_post('totalyicc_5') : NULL),
            'totalyicc_6'       => (safe_post('totalyicc_6') !== '' ? safe_post('totalyicc_6') : NULL),
            'veryicc_1'         => (safe_post('veryicc_1') !== '' ? safe_post('veryicc_1') : NULL),
            'veryicc_2'         => (safe_post('veryicc_2') !== '' ? safe_post('veryicc_2') : NULL),
            'veryicc_3'         => (safe_post('veryicc_3') !== '' ? safe_post('veryicc_3') : NULL),
            'veryicc_4'         => (safe_post('veryicc_4') !== '' ? safe_post('veryicc_4') : NULL),
            'veryicc_5'         => (safe_post('veryicc_5') !== '' ? safe_post('veryicc_5') : NULL),
            'veryicc_6'         => (safe_post('veryicc_6') !== '' ? safe_post('veryicc_6') : NULL),
            'slightly_1'        => (safe_post('slightly_1') !== '' ? safe_post('slightly_1') : NULL),
            'slightly_2'        => (safe_post('slightly_2') !== '' ? safe_post('slightly_2') : NULL),
            'slightly_3'        => (safe_post('slightly_3') !== '' ? safe_post('slightly_3') : NULL),
            'slightly_4'        => (safe_post('slightly_4') !== '' ? safe_post('slightly_4') : NULL),
            'slightly_5'        => (safe_post('slightly_5') !== '' ? safe_post('slightly_5') : NULL),
            'slightly_6'        => (safe_post('slightly_6') !== '' ? safe_post('slightly_6') : NULL),
            'impairment_1'      => (safe_post('impairment_1') !== '' ? safe_post('impairment_1') : NULL),
            'impairment_2'      => (safe_post('impairment_2') !== '' ? safe_post('impairment_2') : NULL),
            'impairment_3'      => (safe_post('impairment_3') !== '' ? safe_post('impairment_3') : NULL),
            'impairment_4'      => (safe_post('impairment_4') !== '' ? safe_post('impairment_4') : NULL),
            'impairment_5'      => (safe_post('impairment_5') !== '' ? safe_post('impairment_5') : NULL),
            'total_nilai_bras'  => (safe_post('total_nilai_bras') !== '' ? safe_post('total_nilai_bras') : NULL),

            // SOFA SCORE
            'respirationa'      => (safe_post('respirationa') !== '' ? safe_post('respirationa') : NULL),
            'coagulation'       => (safe_post('coagulation') !== '' ? safe_post('coagulation') : NULL),
            'bilirubin'         => (safe_post('bilirubin') !== '' ? safe_post('bilirubin') : NULL),
            'cardiovascular'    => (safe_post('cardiovascular') !== '' ? safe_post('cardiovascular') : NULL),
            'cns'               => (safe_post('cns') !== '' ? safe_post('cns') : NULL),
            'renalicc'          => (safe_post('renalicc') !== '' ? safe_post('renalicc') : NULL),
            'total_nilai_ss'    => (safe_post('total_nilai_ss') !== '' ? safe_post('total_nilai_ss') : NULL),

            // TRS
            'mataicc'    => (safe_post('mataicc') !== '' ? safe_post('mataicc') : NULL),
            'motorikicc' => (safe_post('motorikicc') !== '' ? safe_post('motorikicc') : NULL),
            'verbalicc'  => (safe_post('verbalicc') !== '' ? safe_post('verbalicc') : NULL),
            'jmlhtrs'    => (safe_post('jmlhtrs') !== '' ? safe_post('jmlhtrs') : NULL),

            'plebitistkicc' => json_encode([
                'plebitistkicc_1' => safe_post('plebitistkicc_1') !== '' ? safe_post('plebitistkicc_1') : null,
                'plebitistkicc_2' => safe_post('plebitistkicc_2') !== '' ? safe_post('plebitistkicc_2') : null,
                'plebitistkicc_3' => safe_post('plebitistkicc_3') !== '' ? safe_post('plebitistkicc_3') : null,
                'plebitistkicc_4' => safe_post('plebitistkicc_4') !== '' ? safe_post('plebitistkicc_4') : null,
                'plebitistkicc_5' => safe_post('plebitistkicc_5') !== '' ? safe_post('plebitistkicc_5') : null,
            ]),

            // TRSP
            // 'spontanmicc' => (safe_post('spontanmicc') !== '' ? safe_post('spontanmicc') : NULL),
            // 'bercakapicc' => (safe_post('bercakapicc') !== '' ? safe_post('bercakapicc') : NULL),
            // 'terbaikicc'  => (safe_post('terbaikicc') !== '' ? safe_post('terbaikicc') : NULL),
            // 'jmlhtrsp'    => (safe_post('jmlhtrsp') !== '' ? safe_post('jmlhtrsp') : NULL),

            'sspm' => json_encode([
                'sspm_1' => safe_post('sspm_1') !== '' ? safe_post('sspm_1') : null,
                'sspm_2' => safe_post('sspm_2') !== '' ? safe_post('sspm_2') : null,
                'sspm_3' => safe_post('sspm_3') !== '' ? safe_post('sspm_3') : null,
                'sspm_4' => safe_post('sspm_4') !== '' ? safe_post('sspm_4') : null,
                'sspm_5' => safe_post('sspm_5') !== '' ? safe_post('sspm_5') : null,
                'sspm_6' => safe_post('sspm_6') !== '' ? safe_post('sspm_6') : null,
                'sspm_7' => safe_post('sspm_7') !== '' ? safe_post('sspm_7') : null,
                'sspm_8' => safe_post('sspm_8') !== '' ? safe_post('sspm_8') : null,
                'sspm_9' => safe_post('sspm_9') !== '' ? safe_post('sspm_9') : null,
                'sspm_10' => safe_post('sspm_10') !== '' ? safe_post('sspm_10') : null,
                'sspm_11' => safe_post('sspm_11') !== '' ? safe_post('sspm_11') : null,
                'sspm_12' => safe_post('sspm_12') !== '' ? safe_post('sspm_12') : null,
                'sspm_13' => safe_post('sspm_13') !== '' ? safe_post('sspm_13') : null,
                'sspm_14' => safe_post('sspm_14') !== '' ? safe_post('sspm_14') : null,
            ]),

            'ngcsk' => json_encode([
                'ngcsk_1' => safe_post('ngcsk_1') !== '' ? safe_post('ngcsk_1') : null,
                'ngcsk_2' => safe_post('ngcsk_2') !== '' ? safe_post('ngcsk_2') : null,
                'ngcsk_3' => safe_post('ngcsk_3') !== '' ? safe_post('ngcsk_3') : null,
                'ngcsk_4' => safe_post('ngcsk_4') !== '' ? safe_post('ngcsk_4') : null,
                'ngcsk_5' => safe_post('ngcsk_5') !== '' ? safe_post('ngcsk_5') : null,
                'ngcsk_6' => safe_post('ngcsk_6') !== '' ? safe_post('ngcsk_6') : null,
                'ngcsk_7' => safe_post('ngcsk_7') !== '' ? safe_post('ngcsk_7') : null,
                'ngcsk_8' => safe_post('ngcsk_8') !== '' ? safe_post('ngcsk_8') : null,
                'ngcsk_9' => safe_post('ngcsk_9') !== '' ? safe_post('ngcsk_9') : null,
                'ngcsk_10' => safe_post('ngcsk_10') !== '' ? safe_post('ngcsk_10') : null,
                'ngcsk_11' => safe_post('ngcsk_11') !== '' ? safe_post('ngcsk_11') : null,
                'ngcsk_12' => safe_post('ngcsk_12') !== '' ? safe_post('ngcsk_12') : null,
            ]),
        );	


        // var_dump($data_icc);die;
        $this->m_pelayanan->updateItensiveCareChart($data_icc, $id_icc);

        // CATATANPERAWAT
        $id_users             = safe_post('id_user');
        $layanan              = array('id'=> safe_post('id_layanan_pendaftaran')); 
        $id_pendaftaran       = safe_post('id_pendaftaran');  
        $pencegahan_date_icc  = safe_post('pencegahan_date_icc');  
        // KALAU GA ADA IINI PASTI EROR
        if (!empty($pencegahan_date_icc)) {
            $data_cticc = array(
                'id_pendaftaran'         => $id_pendaftaran,
                'id_layanan_pendaftaran' => $layanan['id'],
                'id_user'                => safe_post('user_pengkajian') !== '' ? safe_post('user_pengkajian') : null,
                'jampagiicc'             => safe_post('jampagiicc') !== '' ? safe_post('jampagiicc') : null,
                'dinaspagiicc'           => safe_post('dinaspagiicc') !== '' ? safe_post('dinaspagiicc') : null,
                'parafpagiicc'           => safe_post('parafpagiicc') !== '' ? safe_post('parafpagiicc') : null,
                'perawatpagiicc'         => safe_post('perawatpagiicc') !== '' ? safe_post('perawatpagiicc') : null,
                'jamsoreicc'             => safe_post('jamsoreicc') !== '' ? safe_post('jamsoreicc') : null,
                'dinassoreicc'           => safe_post('dinassoreicc') !== '' ? safe_post('dinassoreicc') : null,
                'parafsoreicc'           => safe_post('parafsoreicc') !== '' ? safe_post('parafsoreicc') : null,
                'perawatsoreicc'         => safe_post('perawatsoreicc') !== '' ? safe_post('perawatsoreicc') : null,
                'jammalamicc'            => safe_post('jammalamicc') !== '' ? safe_post('jammalamicc') : null,
                'dinasmalamicc'          => safe_post('dinasmalamicc') !== '' ? safe_post('dinasmalamicc') : null,
                'parafmalamicc'          => safe_post('parafmalamicc') !== '' ? safe_post('parafmalamicc') : null,
                'perawatmalamicc'        => safe_post('perawatmalamicc') !== '' ? safe_post('perawatmalamicc') : null,
                'date_created'           => safe_post('pencegahan_date_icc') !== '' ? safe_post('pencegahan_date_icc') : null,
            );
            $this->m_pelayanan->insertCatatanPerawatIcc($data_cticc);
        }

        if (!empty($respon)) {
            $response = $respon;
        } else {
            $response = null;
        }
        if ($this->db->trans_status() === false) :
            $this->db->trans_rollback();
            $status = false;
        else :
            $this->db->trans_commit();
            $status = true;
        endif;
        $message = array(
            'status' => $status,
            'token'  => $this->security->get_csrf_hash(),
            'id_pendaftaran' => ('id_pendaftaran'),
            'id_layanan_pendaftaran' => ('id_layanan_pendaftaran'),
            'respon' => $response,
        );
        $this->response($message, REST_Controller::HTTP_OK);
    }

    // // CATATANPERAWAT LOGS INI UDAH BISA JADI ID YANG NGEDIT KUTAUAN
    function update_catatanperawatIcc_put() {
        $this->db->trans_begin();

        $id = $this->put('id', true);
        if (!$id) {
            $this->response(['status' => false], REST_Controller::HTTP_OK);
            return;
        }

        // Ambil data lama untuk log
        $lama = $this->db->get_where('sm_catatan_perawat_icc', ['id' => $id])->row_array();
        if ($lama) {
            $log = $lama;
            unset($log['id']);
            $log['updated_at'] = date('Y-m-d H:i:s');
            $log['created_at'] = date('Y-m-d H:i:s');
            $log['id_user'] = $this->session->userdata('id_translucent') ?: $this->put('id_user'); // fallback
            $log['keterangan'] = 'Update';
            $this->m_pelayanan->insertLogcatatanperawatIcc($log);
        }

        $data = [
            'jampagiicc'        => $this->put('jampagiicc', true) ?: null,
            'dinaspagiicc'      => $this->put('dinaspagiicc', true) ?: null,
            'parafpagiicc'      => $this->put('parafpagiicc', true) ?: null,
            'perawatpagiicc'    => $this->put('perawatpagiicc', true) ?: null,
            'jamsoreicc'        => $this->put('jamsoreicc', true) ?: null,
            'dinassoreicc'      => $this->put('dinassoreicc', true) ?: null,
            'parafsoreicc'      => $this->put('parafsoreicc', true) ?: null,
            'perawatsoreicc'    => $this->put('perawatsoreicc', true) ?: null,
            'jammalamicc'       => $this->put('jammalamicc', true) ?: null,
            'dinasmalamicc'     => $this->put('dinasmalamicc', true) ?: null,
            'parafmalamicc'     => $this->put('parafmalamicc', true) ?: null,
            'perawatmalamicc'   => $this->put('perawatmalamicc', true) ?: null,
            'updated_at'        => date('Y-m-d H:i:s'),
            'id_user'           => $this->session->userdata('id_translucent') ?: $this->put('id_user'), // fallback
        ];

        $this->db->where('id', $id);
        $status = $this->db->update('sm_catatan_perawat_icc', $data);

        if ($this->db->trans_status() === false) {
            $this->db->trans_rollback();
            $this->response(['status' => false], REST_Controller::HTTP_OK);
        } else {
            $this->db->trans_commit();
            $this->response(['status' => true], REST_Controller::HTTP_OK);
        }
    }
    
    // CATATANPERAWAT
    function get_edit_catatanperawatIcc_get(){
         if (!$this->get('id', true)) :
             $this->response(null, REST_Controller::HTTP_BAD_REQUEST);
         endif;
         $data = $this->m_pelayanan->getCatatanPerawatIccByID($this->get('id', true));
         $this->response($data, REST_Controller::HTTP_OK);
    }

    // CATATANPERAWAT LOGS INI UDAH BISA JADI ID YANG NGEDIT KUTAUAN
    function hapus_catatanperawatIcc_delete($id){
        $this->db->trans_begin();

        $id_user = $this->input->get('id_user') ?: $this->session->userdata('id_translucent');

        // Ambil data lama
        $lama = $this->db->get_where('sm_catatan_perawat_icc', ['id' => $id])->row_array();
        if ($lama) {
            $log = $lama;
            unset($log['id']);
            $log['updated_at'] = date('Y-m-d H:i:s');
            $log['created_at'] = date('Y-m-d H:i:s');
            $log['id_user'] = $id_user;
            $log['keterangan'] = 'Delete';
            $this->m_pelayanan->insertLogcatatanperawatIcc($log);
        }

        $status = $this->m_pelayanan->deleteCatatanPerawatIc($id);

        if ($this->db->trans_status() === false || !$status) {
            $this->db->trans_rollback();
            $response = array('status' => false, 'message' => 'Gagal menghapus data!');
        } else {
            $this->db->trans_commit();
            $response = array('status' => true, 'message' => 'Berhasil menghapus data!');
        }

        $this->response($response, REST_Controller::HTTP_OK);
    }





    // CPDPO ILLIS  WPT IWPT
    function get_data_entri_catatan_pemberian_dan_pemantauan_obat_get(){
        if (!$this->get('id')) :
            $this->response(NULL, REST_Controller::HTTP_BAD_REQUEST); // (400)
        endif;
        $this->load->model('pendaftaran/Pendaftaran_model', 'm_pendaftaran');
        $data = $this->m_pendaftaran->getPendaftaranDetail($this->get('id', true), $this->get('id_layanan', true));
        $data['profil'] = $this->m_pelayanan->getProfilPasien($data['pasien']->id_pasien);

        // CPDPO
        $data['riwayat_pemakaian_obat'] = $this->m_pelayanan->getRiwayatPemakaianObat($this->get('id', true));
        // ILLIS
        $data['riwayat_pemakaian_obat_infus'] = $this->m_pelayanan->getRiwayatPemakaianObatInfus($this->get('id', true));
        // WPT
        $data['waktu_pemberian_tanggal'] = $this->m_pelayanan->getWaktuPemberianTanggal($this->get('id', true));
        // IWPT
        $data['waktu_pemberian_tanggal_infus'] = $this->m_pelayanan->getWaktuPemberianTanggalInfus($this->get('id', true));

        if ($data) :
            $this->response($data, REST_Controller::HTTP_OK); // (200)
        endif;
    }

    // CPDPO ILLIS  WPT IWPT
    function simpan_entri_catatan_pemberian_dan_pemantauan_obat_post(){

        $layanan = array('id' => safe_post('id_layanan_pendaftaran'));

        // CPDPO
        $tanggal_rpo    = safe_post('tanggal_rpo');
        $tangggal_rpo   = safe_post('tangggal_rpo');
        $pencegahan_date_rpo    = safe_post('pencegahan_date_rpo');
        $id_pendaftaran         = safe_post('id_pendaftaran');
        if (!empty($pencegahan_date_rpo)) {
            $riwayat_pemakaian_obat = array(
                'id_pendaftaran'         => $id_pendaftaran,
                'id_layanan_pendaftaran' => $layanan['id'],
                'id_user'                => safe_post('user_pengkajian') !== '' ? safe_post('user_pengkajian') : null,
                'tanggal_rpo'            => safe_post('tanggal_rpo') !== '' ? safe_post('tanggal_rpo') : null,
                'tangggal_rpo'           => safe_post('tangggal_rpo') !== '' ? safe_post('tangggal_rpo') : null,
                'nama_obat_rpo'          => safe_post('nama_obat_rpo') !== '' ? safe_post('nama_obat_rpo') : null,
                'dokter_1_rpo'           => safe_post('dokter_1_rpo') !== '' ? safe_post('dokter_1_rpo') : null,
                'dokter_2_rpo'           => safe_post('dokter_2_rpo') !== '' ? safe_post('dokter_2_rpo') : null,
                'rute_rpo'               => safe_post('rute_rpo') !== '' ? safe_post('rute_rpo') : null,
                'dosis_rpo'              => safe_post('dosis_rpo') !== '' ? safe_post('dosis_rpo') : null,
                'frekuensi_rpo'          => safe_post('frekuensi_rpo') !== '' ? safe_post('frekuensi_rpo') : null,
                'eso_rpo'                => safe_post('eso_rpo') !== '' ? safe_post('eso_rpo') : null,
                'r_farmasi_rpo'          => safe_post('r_farmasi_rpo') !== '' ? safe_post('r_farmasi_rpo') : null,
                'alergii_ob'             => safe_post('alergii_ob') !== '' ? safe_post('alergii_ob') : null,
                'alergii'                => safe_post('alergii') !== '' ? safe_post('alergii') : null,
                'date_created'           => safe_post('pencegahan_date_rpo') !== '' ? safe_post('pencegahan_date_rpo') : null,
            );
            //  var_dump($riwayat_pemakaian_obat);
            $this->m_pelayanan->insertRiwayatPemakaianObat($riwayat_pemakaian_obat);
        }


        // ILLIS
        $tanggal_rpoo   = safe_post('tanggal_rpoo');
        $tangggal_rpoo  = safe_post('tangggal_rpoo');
        $pencegahan_date_rpo_infus    = safe_post('pencegahan_date_rpo_infus');
        $id_pendaftaran         = safe_post('id_pendaftaran');
        if (!empty($pencegahan_date_rpo_infus)) {
            $riwayat_pemakaian_obat_infus = array(
                'id_pendaftaran'         => $id_pendaftaran,
                'id_layanan_pendaftaran' => $layanan['id'],
                'id_user'                => safe_post('user_pengkajian') !== '' ? safe_post('user_pengkajian') : null,
                'tanggal_rpoo'           => safe_post('tanggal_rpoo') !== '' ? safe_post('tanggal_rpoo') : null,
                'tangggal_rpoo'          => safe_post('tangggal_rpoo') !== '' ? safe_post('tangggal_rpoo') : null,
                'nama_obat_rpoo'         => safe_post('nama_obat_rpoo') !== '' ? safe_post('nama_obat_rpoo') : null,
                'dokter_1_rpoo'          => safe_post('dokter_1_rpoo') !== '' ? safe_post('dokter_1_rpoo') : null,
                'dokter_2_rpoo'          => safe_post('dokter_2_rpoo') !== '' ? safe_post('dokter_2_rpoo') : null,
                'rute_rpoo'              => safe_post('rute_rpoo') !== '' ? safe_post('rute_rpoo') : null,
                'dosis_rpoo'             => safe_post('dosis_rpoo') !== '' ? safe_post('dosis_rpoo') : null,
                'frekuensi_rpoo'         => safe_post('frekuensi_rpoo') !== '' ? safe_post('frekuensi_rpoo') : null,
                'eso_rpoo'               => safe_post('eso_rpoo') !== '' ? safe_post('eso_rpoo') : null,
                'r_farmasi_rpoo'         => safe_post('r_farmasi_rpoo') !== '' ? safe_post('r_farmasi_rpoo') : null,
                'alergiii'                => safe_post('alergiii') !== '' ? safe_post('alergiii') : null,
                'alergii_obb'                => safe_post('alergii_obb') !== '' ? safe_post('alergii_obb') : null,
                'date_created'           => safe_post('pencegahan_date_rpo_infus') !== '' ? safe_post('pencegahan_date_rpo_infus') : null,
            );
            //  var_dump($riwayat_pemakaian_obat);
            $this->m_pelayanan->insertRiwayatPemakaianObatInfus($riwayat_pemakaian_obat_infus);
        }


        // WPT
        $tanggal_wpt    = safe_post('tanggal_wpt');
        $pencegahan_date_wpt    = safe_post('pencegahan_date_wpt');
        $id_pendaftaran         = safe_post('id_pendaftaran');
        if (!empty($pencegahan_date_wpt)) {
            $waktu_pemberian_tanggal = array(
                'id_pendaftaran'         => $id_pendaftaran,
                'id_layanan_pendaftaran' => $layanan['id'],
                'id_user'                => safe_post('user_pengkajian') !== '' ? safe_post('user_pengkajian') : null,
                'tanggal_wpt'            => safe_post('tanggal_wpt') !== '' ? safe_post('tanggal_wpt') : null,
                'hari_wpt'               => safe_post('hari_wpt') !== '' ? safe_post('hari_wpt') : null,
                'jam_wpt'                => safe_post('jam_wpt') !== '' ? safe_post('jam_wpt') : null,
                'perawat_1_wpt'          => safe_post('perawat_1_wpt') !== '' ? safe_post('perawat_1_wpt') : null,
                'pasien_keluarga_wpt'    => safe_post('pasien_keluarga_wpt') !== '' ? safe_post('pasien_keluarga_wpt') : null,
                'pagi_wpt'               => safe_post('pagi_wpt') !== '' ? safe_post('pagi_wpt') : null,
                'siang_wpt'              => safe_post('siang_wpt')  !== '' ? safe_post('siang_wpt') : null,
                'sore_wpt'               => safe_post('sore_wpt')  !== '' ? safe_post('sore_wpt') : null,
                'malam_wpt'              => safe_post('malam_wpt')  !== '' ? safe_post('malam_wpt') : null,
                'date_created'           => safe_post('pencegahan_date_wpt') !== '' ? safe_post('pencegahan_date_wpt') : null,
            );
            //  var_dump($waktu_pemberian_tanggal);die;
            $this->m_pelayanan->insertWaktuPemberianTanggal($waktu_pemberian_tanggal);
        }

    
        // IWPT
        $tanggal_wptt   = safe_post('tanggal_wptt');
        $pencegahan_date_wptt_infus    = safe_post('pencegahan_date_wptt_infus');
        $id_pendaftaran                = safe_post('id_pendaftaran');
        if (!empty($pencegahan_date_wptt_infus)) {
            $waktu_pemberian_tanggal_infus = array(
                'id_pendaftaran'         => $id_pendaftaran,
                'id_layanan_pendaftaran' => $layanan['id'],
                'id_user'                => safe_post('user_pengkajian') !== '' ? safe_post('user_pengkajian') : null,
                'tanggal_wptt'           => safe_post('tanggal_wptt') !== '' ? safe_post('tanggal_wptt') : null,
                'hari_wptt'              => safe_post('hari_wptt') !== '' ? safe_post('hari_wptt') : null,
                'jam_wptt'               => safe_post('jam_wptt') !== '' ? safe_post('jam_wptt') : null,
                'perawat_2_wptt'         => safe_post('perawat_2_wptt') !== '' ? safe_post('perawat_2_wptt') : null,
                'pasien_keluarga_wptt'   => safe_post('pasien_keluarga_wptt') !== '' ? safe_post('pasien_keluarga_wptt') : null,
                'pagi_wptt'              => safe_post('pagi_wptt')  !== '' ? safe_post('pagi_wptt') : null,
                'siang_wptt'             => safe_post('siang_wptt')  !== '' ? safe_post('siang_wptt') : null,
                'sore_wptt'              => safe_post('sore_wptt')  !== '' ? safe_post('sore_wptt') : null,
                'malam_wptt'             => safe_post('malam_wptt')  !== '' ? safe_post('malam_wptt') : null,
                'date_created'           => safe_post('pencegahan_date_wptt_infus') !== '' ? safe_post('pencegahan_date_wptt_infus') : null,
            );
            $this->m_pelayanan->insertWaktuPemberianTanggalInfus($waktu_pemberian_tanggal_infus);
        }

        if (!empty($respon)) {

            $response = $respon;
        } else {

            $response = null;
        }

        if ($this->db->trans_status() === false) :
            $this->db->trans_rollback();
            $status = false;
        else :
            $this->db->trans_commit();
            $status = true;
        endif;

        $message = array(
            'status' => $status,
            'token'  => $this->security->get_csrf_hash(),
            'id'     => $layanan['id'],
            'respon' => $response,
        );
        $this->response($message, REST_Controller::HTTP_OK);
    }

    // CPDPO
    function get_riwayat_pemakaian_obat_get(){
        if (!$this->get('id', true)) :
            $this->response(null, REST_Controller::HTTP_BAD_REQUEST);
        endif;
        $data = $this->m_pelayanan->getRiwayatPemakaianObatByID($this->get('id', true));
        $this->response($data, REST_Controller::HTTP_OK);
    }

    // CPDPO
    function update_riwayat_pemakaian_obat_put(){
        if (!$this->put('id', true)) :
            $this->response(array('status' => false), REST_Controller::HTTP_OK);
        endif;
        $tanggal_rpo        = $this->put('tanggal_rpo', true);
        $tanggal_rpo        = str_replace('/', '-', $tanggal_rpo);
        $tanggal_rpo        = date('Y-m-d', strtotime($tanggal_rpo));
        $tangggal_rpo       = $this->put('tangggal_rpo', true);
        $tangggal_rpo       = str_replace('/', '-', $tangggal_rpo);
        $tangggal_rpo       = date('Y-m-d', strtotime($tangggal_rpo));
        $nama_obat_rpo      = $this->put('nama_obat_rpo', true);
        $dokter_1_rpo       = $this->put('dokter_1_rpo', true);
        $dokter_2_rpo       = $this->put('dokter_2_rpo', true);
        $rute_rpo           = $this->put('rute_rpo', true);
        $dosis_rpo          = $this->put('dosis_rpo', true);
        $frekuensi_rpo      = $this->put('frekuensi_rpo', true);
        $eso_rpo            = $this->put('eso_rpo', true);
        $r_farmasi_rpo      = $this->put('r_farmasi_rpo', true);
        $alergii            = $this->put('alergii', true);
        $alergii_ob         = $this->put('alergii_ob', true);
        $data = array(
            'id'                 => $this->put('id', true),
            'tanggal_rpo'        => $tanggal_rpo,
            'tangggal_rpo'       => $tangggal_rpo,
            'nama_obat_rpo'      => $nama_obat_rpo !== '' ? $nama_obat_rpo : null,
            'dokter_1_rpo'       => $dokter_1_rpo !== '' ? $dokter_1_rpo : null,
            'dokter_2_rpo'       => $dokter_2_rpo !== '' ? $dokter_2_rpo : null,
            'rute_rpo'           => $rute_rpo !== '' ? $rute_rpo : null,
            'dosis_rpo'          => $dosis_rpo !== '' ? $dosis_rpo : null,
            'frekuensi_rpo'      => $frekuensi_rpo !== '' ? $frekuensi_rpo : null,
            'eso_rpo'            => $eso_rpo !== '' ? $eso_rpo : null,
            'r_farmasi_rpo'      => $r_farmasi_rpo !== '' ? $r_farmasi_rpo : null,
            'alergii_ob'         => $alergii_ob !== '' ? $alergii_ob : null,
            'alergii'            => $alergii ? 1 : 0,
            'updated_at'         => date('Y-m-d H:i:s', time()),
        );
        $status = $this->m_pelayanan->editRiwayatPemakaianObat($data);
        $this->response(array('status' => $status), REST_Controller::HTTP_OK);
    }

    // CPDPO
    function hapus_riwayat_pemakaian_obat_delete($id){
        $status = $this->m_pelayanan->deleteRiwayatPemakaianObat($id);
        if ($status) :
            $response = array('status' => $status, 'message' => 'Berhasil menghapus Data!');
        else :
            $response = array('status' => $status, 'message' => 'Gagal menghapus Data!');
        endif;
        $this->response($response, REST_Controller::HTTP_OK);
    }

    // ILLIS
    function get_riwayat_pemakaian_obat_infus_get(){
        if (!$this->get('id', true)) :
            $this->response(null, REST_Controller::HTTP_BAD_REQUEST);
        endif;
        $data = $this->m_pelayanan->getRiwayatPemakaianObatInfusByID($this->get('id', true));
        $this->response($data, REST_Controller::HTTP_OK);
    }

    // ILLIS
    function update_riwayat_pemakaian_obat_infus_put(){
        if (!$this->put('id', true)) :
            $this->response(array('status' => false), REST_Controller::HTTP_OK);
        endif;
        $tanggal_rpoo       = $this->put('tanggal_rpoo', true);
        $tanggal_rpoo       = str_replace('/', '-', $tanggal_rpoo);
        $tanggal_rpoo       = date('Y-m-d', strtotime($tanggal_rpoo));
        $tangggal_rpoo      = $this->put('tangggal_rpoo', true);
        $tangggal_rpoo      = str_replace('/', '-', $tangggal_rpoo);
        $tangggal_rpoo      = date('Y-m-d', strtotime($tangggal_rpoo));
        $nama_obat_rpoo     = $this->put('nama_obat_rpoo', true);
        $dokter_1_rpoo      = $this->put('dokter_1_rpoo', true);
        $dokter_2_rpoo      = $this->put('dokter_2_rpoo', true);
        $rute_rpoo          = $this->put('rute_rpoo', true);
        $dosis_rpoo         = $this->put('dosis_rpoo', true);
        $frekuensi_rpoo     = $this->put('frekuensi_rpoo', true);
        $eso_rpoo           = $this->put('eso_rpoo', true);
        $r_farmasi_rpoo     = $this->put('r_farmasi_rpoo', true);
        $alergiii           = $this->put('alergiii', true);
        $alergii_obb        = $this->put('alergii_obb', true);
        $data = array(
            'id'                 => $this->put('id', true),
            'tanggal_rpoo'       => $tanggal_rpoo,
            'tangggal_rpoo'      => $tangggal_rpoo,  
            'nama_obat_rpoo'     => $nama_obat_rpoo !== '' ? $nama_obat_rpoo : null,
            'dokter_1_rpoo'      => $dokter_1_rpoo !== '' ? $dokter_1_rpoo : null,
            'dokter_2_rpoo'      => $dokter_2_rpoo !== '' ? $dokter_2_rpoo : null,
            'rute_rpoo'          => $rute_rpoo !== '' ? $rute_rpoo : null,
            'dosis_rpoo'         => $dosis_rpoo !== '' ? $dosis_rpoo : null,
            'frekuensi_rpoo'     => $frekuensi_rpoo !== '' ? $frekuensi_rpoo : null,
            'eso_rpoo'           => $eso_rpoo !== '' ? $eso_rpoo : null,
            'r_farmasi_rpoo'     => $r_farmasi_rpoo !== '' ? $r_farmasi_rpoo : null,
            'alergii_obb'        => $alergii_obb !== '' ? $alergii_obb : null,
            'alergiii'           => $alergiii ? 1 : 0,
            'updated_at'         => date('Y-m-d H:i:s', time()),
        );
        $status = $this->m_pelayanan->editRiwayatPemakaianObatInfus($data);
        $this->response(array('status' => $status), REST_Controller::HTTP_OK);
    }

    // ILLIS
    function hapus_riwayat_pemakaian_obat_infus_delete($id){
        $status = $this->m_pelayanan->deleteRiwayatPemakaianObatInfus($id);
        if ($status) :
            $response = array('status' => $status, 'message' => 'Berhasil menghapus Data!');
        else :
            $response = array('status' => $status, 'message' => 'Gagal menghapus Data!');
        endif;
        $this->response($response, REST_Controller::HTTP_OK);
    }

    // WPT
    function get_waktu_pemberian_tanggal_get(){
        if (!$this->get('id', true)) :
            $this->response(null, REST_Controller::HTTP_BAD_REQUEST);
        endif;
        $data = $this->m_pelayanan->getWaktuPemberianTanggalByID($this->get('id', true));
        $this->response($data, REST_Controller::HTTP_OK);
    }

    // WPT
    function update_waktu_pemberian_tanggal_put(){
        if (!$this->put('id', true)) :
            $this->response(array('status' => false), REST_Controller::HTTP_OK);
        endif;
        $tanggal_wpt            = $this->put('tanggal_wpt', true);
        $tanggal_wpt            = str_replace('/', '-', $tanggal_wpt);
        $tanggal_wpt            = date('Y-m-d', strtotime($tanggal_wpt));
        $perawat_1_wpt          = $this->put('perawat_1_wpt', true);
        $hari_wpt               = $this->put('hari_wpt', true);
        $jam_wpt                = $this->put('jam_wpt', true);
        $pasien_keluarga_wpt    = $this->put('pasien_keluarga_wpt', true);
        $pagi_wpt               = $this->put('pagi_wpt', true);
        $siang_wpt              = $this->put('siang_wpt', true);
        $sore_wpt               = $this->put('sore_wpt', true);
        $malam_wpt              = $this->put('malam_wpt', true);
        $data = array(
            'id'                      => $this->put('id', true),
            'tanggal_wpt'             => $tanggal_wpt,
            'perawat_1_wpt'           => $perawat_1_wpt !== '' ? $perawat_1_wpt : null,
            'hari_wpt'                => $hari_wpt !== '' ? $hari_wpt : null,
            'jam_wpt'                 => $jam_wpt !== '' ? $jam_wpt : null,
            'pasien_keluarga_wpt'     => $pasien_keluarga_wpt !== '' ? $pasien_keluarga_wpt : null,
            'pagi_wpt'                => $pagi_wpt === 'on' ? 1 : 0,
            'siang_wpt'               => $siang_wpt === 'on' ? 1 : 0,
            'sore_wpt'                => $sore_wpt === 'on' ? 1 : 0,
            'malam_wpt'               => $malam_wpt === 'on' ? 1 : 0,
            'updated_at'              => date('Y-m-d H:i:s', time()),
        );
        $status = $this->m_pelayanan->editWaktuPemberianTanggal($data);
        $this->response(array('status' => $status), REST_Controller::HTTP_OK);
    }

    // WPT
    function hapus_waktu_pemberian_tanggal_delete($id){
        $status = $this->m_pelayanan->deleteWaktuPemberianTanggal($id);
        if ($status) :
            $response = array('status' => $status, 'message' => 'Berhasil menghapus Data!');
        else :
            $response = array('status' => $status, 'message' => 'Gagal menghapus Data!');
        endif;
        $this->response($response, REST_Controller::HTTP_OK);
    }

    // IWPT
    function get_waktu_pemberian_tanggal_infus_get(){
        if (!$this->get('id', true)) :
            $this->response(null, REST_Controller::HTTP_BAD_REQUEST);
        endif;
        $data = $this->m_pelayanan->getWaktuPemberianTanggalInfusByID($this->get('id', true));
        $this->response($data, REST_Controller::HTTP_OK);
    }

    // IWPT
    function update_waktu_pemberian_tanggal_infus_put(){
        if (!$this->put('id', true)) :
            $this->response(array('status' => false), REST_Controller::HTTP_OK);
        endif;
        $tanggal_wptt           = $this->put('tanggal_wptt', true);
        $tanggal_wptt           = str_replace('/', '-', $tanggal_wptt);
        $tanggal_wptt           = date('Y-m-d', strtotime($tanggal_wptt));
        $perawat_2_wptt         = $this->put('perawat_2_wptt', true);;
        $hari_wptt              = $this->put('hari_wptt', true);
        $jam_wptt               = $this->put('jam_wptt', true);
        $pasien_keluarga_wptt   = $this->put('pasien_keluarga_wptt', true);
        $pagi_wptt              = $this->put('pagi_wptt', true);
        $siang_wptt             = $this->put('siang_wptt', true);
        $sore_wptt              = $this->put('sore_wptt', true);
        $malam_wptt             = $this->put('malam_wptt', true);
        $data = array(
            'id'                      => $this->put('id', true),
            'tanggal_wptt'            => $tanggal_wptt,
            'perawat_2_wptt'          => $perawat_2_wptt !== '' ? $perawat_2_wptt : null,
            'hari_wptt'               => $hari_wptt !== '' ? $hari_wptt : null,
            'jam_wptt'                => $jam_wptt !== '' ? $jam_wptt : null,
            'pasien_keluarga_wptt'    => $pasien_keluarga_wptt !== '' ? $pasien_keluarga_wptt : null,
            'pagi_wptt'               => $pagi_wptt === 'on' ? 1 : 0,
            'siang_wptt'              => $siang_wptt === 'on' ? 1 : 0,
            'sore_wptt'               => $sore_wptt === 'on' ? 1 : 0,
            'malam_wptt'              => $malam_wptt === 'on' ? 1 : 0,
            'updated_at'              => date('Y-m-d H:i:s', time()),
        );
        $status = $this->m_pelayanan->editWaktuPemberianTanggalInfus($data);
        $this->response(array('status' => $status), REST_Controller::HTTP_OK);
    }

    // IWPT
    function hapus_waktu_pemberian_tanggal_infus_delete($id){
        $status = $this->m_pelayanan->deleteWaktuPemberianTanggalInfus($id);
        if ($status) :
            $response = array('status' => $status, 'message' => 'Berhasil menghapus Data!');
        else :
            $response = array('status' => $status, 'message' => 'Gagal menghapus Data!');
        endif;
        $this->response($response, REST_Controller::HTTP_OK);
    }




    // PKN
    function get_data_entri_pemantauan_khusus_neonatus_get(){
        if (!$this->get('id')) :
            $this->response(NULL, REST_Controller::HTTP_BAD_REQUEST); // (400)
        endif;
        $this->load->model('pendaftaran/Pendaftaran_model', 'm_pendaftaran');
        $data = $this->m_pendaftaran->getPendaftaranDetail($this->get('id', true), $this->get('id_layanan', true));
        $data['profil'] = $this->m_pelayanan->getProfilPasien($data['pasien']->id_pasien);
        $data['pengawasan_khusus_neonatus'] = $this->m_pelayanan->getPengawasanKhususNeonatus($this->get('id', true));
        if ($data) :
            $this->response($data, REST_Controller::HTTP_OK); // (200)
        endif;
    }
                
    // PKN
    function simpan_pemantauan_khusus_neonatus_post(){
        $layanan = array('id' => safe_post('id_layanan_pendaftaran'));
        
        $tgl_pkn    = safe_post('tgl_pkn');
        $pencegahan_date_pkn    = safe_post('pencegahan_date_pkn');
        $id_pendaftaran         = safe_post('id_pendaftaran');
        if (!empty($pencegahan_date_pkn)) {
            $pengawasan_khusus_neonatus = array(
                'id_pendaftaran'            => $id_pendaftaran,
                'id_layanan_pendaftaran'    => $layanan['id'],
                'id_user'                   => safe_post('user_pengkajian') !== '' ? safe_post('user_pengkajian') : null,
                'tgl_pkn'                   => safe_post('tgl_pkn') !== '' ? safe_post('tgl_pkn') : null,
                'jam_pkn'                   => safe_post('jam_pkn') !== '' ? safe_post('jam_pkn') : null,
                'bb_pkn'                    => safe_post('bb_pkn') !== '' ? safe_post('bb_pkn') : null,
                'lp_pkn'                    => safe_post('lp_pkn') !== '' ? safe_post('lp_pkn') : null,
                'kesadaran_pkn'             => safe_post('kesadaran_pkn') !== '' ? safe_post('kesadaran_pkn') : null,
                'pasien_pkn'                => safe_post('pasien_pkn') !== '' ? safe_post('pasien_pkn') : null,
                'inkubator_pkn'             => safe_post('inkubator_pkn') !== '' ? safe_post('inkubator_pkn') : null,
                'nadi_pkn'                  => safe_post('nadi_pkn') !== '' ? safe_post('nadi_pkn') : null,
                'rr_pkn'                    => safe_post('rr_pkn') !== '' ? safe_post('rr_pkn') : null,
                'modus_pkn'                 => safe_post('modus_pkn') !== '' ? safe_post('modus_pkn') : null,
                'peep_pkn'                  => safe_post('peep_pkn') !== '' ? safe_post('peep_pkn') : null,
                'buble_pkn'                 => safe_post('buble_pkn') !== '' ? safe_post('buble_pkn') : null,
                'fio2_pkn'                  => safe_post('fio2_pkn') !== '' ? safe_post('fio2_pkn') : null,
                'spo2_pkn'                  => safe_post('spo2_pkn') !== '' ? safe_post('spo2_pkn') : null,
                'flow_pkn'                  => safe_post('flow_pkn') !== '' ? safe_post('flow_pkn') : null,
                'air_pkn'                   => safe_post('air_pkn') !== '' ? safe_post('air_pkn') : null,
                'suhu_pkn'                  => safe_post('suhu_pkn') !== '' ? safe_post('suhu_pkn') : null,
                'line1_pkn'                 => safe_post('line1_pkn') !== '' ? safe_post('line1_pkn') : null,
                'line2_pkn'                 => safe_post('line2_pkn') !== '' ? safe_post('line2_pkn') : null,
                'plebitis_pkn'              => safe_post('plebitis_pkn') !== '' ? safe_post('plebitis_pkn') : null,
                'oral_pkn'                  => safe_post('oral_pkn') !== '' ? safe_post('oral_pkn') : null,
                'jml_pkn'                   => safe_post('jml_pkn') !== '' ? safe_post('jml_pkn') : null,
                'muntah_pkn'                => safe_post('muntah_pkn') !== '' ? safe_post('muntah_pkn') : null,
                'residu_pkn'                => safe_post('residu_pkn') !== '' ? safe_post('residu_pkn') : null,
                'bak_pkn'                   => safe_post('bak_pkn') !== '' ? safe_post('bak_pkn') : null,
                'bab_pkn'                   => safe_post('bab_pkn') !== '' ? safe_post('bab_pkn') : null,
                'foto_therapy_pkn'          => safe_post('foto_therapy_pkn') !== '' ? safe_post('foto_therapy_pkn') : null,
                'obat_pkn'                  => safe_post('obat_pkn') !== '' ? safe_post('obat_pkn') : null,
                'perawat_pkn'               => safe_post('perawat_pkn') !== '' ? safe_post('perawat_pkn') : null,
                'date_created'              => safe_post('pencegahan_date_pkn') !== '' ? safe_post('pencegahan_date_pkn') : null,
            );
            $this->m_pelayanan->insertPengawasanKhususNeonatus($pengawasan_khusus_neonatus);
        }

        if (!empty($respon)) {

            $response = $respon;
        } else {

            $response = null;
        }
        if ($this->db->trans_status() === false) :
            $this->db->trans_rollback();
            $status = false;
        else :
            $this->db->trans_commit();
            $status = true;
        endif;

        $message = array(
            'status' => $status,
            'token'  => $this->security->get_csrf_hash(),
            'id'     => $layanan['id'],
            'respon' => $response,
        );

        $this->response($message, REST_Controller::HTTP_OK);
    }

    // PKN
    function hapus_pengawasan_khusus_neonatus_delete($id){
        $status = $this->m_pelayanan->deletePengawasanKhususNeonatus($id);
        if ($status) :
            $response = array('status' => $status, 'message' => 'Berhasil menghapus Pengawasan Khusus Neonatus!');
        else :
            $response = array('status' => $status, 'message' => 'Gagal menghapus Pengawasan Khusus Neonatus!');
        endif;
        $this->response($response, REST_Controller::HTTP_OK);
    }

    // PKN
    function update_pengawasan_khusus_neonatus_put(){
        if (!$this->put('id', true)) :
            $this->response(array('status' => false), REST_Controller::HTTP_OK);
        endif;
        $tgl_pkn = $this->put('tgl_pkn', true);
        $tgl_pkn = str_replace('/', '-', $tgl_pkn);
        $tgl_pkn = date('Y-m-d', strtotime($tgl_pkn));
        $jam_pkn            = $this->put('jam_pkn', true);
        $bb_pkn             = $this->put('bb_pkn', true);
        $lp_pkn             = $this->put('lp_pkn', true);
        $kesadaran_pkn      = $this->put('kesadaran_pkn', true);
        $pasien_pkn         = $this->put('pasien_pkn', true);
        $inkubator_pkn      = $this->put('inkubator_pkn', true);
        $nadi_pkn           = $this->put('nadi_pkn', true);
        $rr_pkn             = $this->put('rr_pkn', true);
        $modus_pkn          = $this->put('modus_pkn', true);
        $peep_pkn           = $this->put('peep_pkn', true);
        $buble_pkn          = $this->put('buble_pkn', true);
        $fio2_pkn           = $this->put('fio2_pkn', true);
        $spo2_pkn           = $this->put('spo2_pkn', true);
        $flow_pkn           = $this->put('flow_pkn', true);
        $air_pkn            = $this->put('air_pkn', true);
        $suhu_pkn           = $this->put('suhu_pkn', true);
        $line1_pkn          = $this->put('line1_pkn', true);
        $line2_pkn          = $this->put('line2_pkn', true);
        $plebitis_pkn       = $this->put('plebitis_pkn', true);
        $oral_pkn           = $this->put('oral_pkn', true);
        $jml_pkn            = $this->put('jml_pkn', true);
        $muntah_pkn         = $this->put('muntah_pkn', true);
        $residu_pkn         = $this->put('residu_pkn', true);
        $bak_pkn            = $this->put('bak_pkn', true);
        $bab_pkn            = $this->put('bab_pkn', true);
        $foto_therapy_pkn   = $this->put('foto_therapy_pkn', true);
        $obat_pkn           = $this->put('obat_pkn', true);
        $perawat_pkn        = $this->put('perawat_pkn', true);
        $data = array(
            'id'                    => $this->put('id', true),
            'tgl_pkn'               => $tgl_pkn,
            'jam_pkn'               => $jam_pkn !== '' ? $jam_pkn : null,
            'bb_pkn'                => $bb_pkn !== '' ? $bb_pkn : null,
            'lp_pkn'                => $lp_pkn !== '' ? $lp_pkn : null,
            'kesadaran_pkn'         => $kesadaran_pkn !== '' ? $kesadaran_pkn : null,
            'pasien_pkn'            => $pasien_pkn !== '' ? $pasien_pkn : null,
            'inkubator_pkn'         => $inkubator_pkn !== '' ? $inkubator_pkn : null,
            'nadi_pkn'              => $nadi_pkn !== '' ? $nadi_pkn : null,
            'rr_pkn'                => $rr_pkn !== '' ? $rr_pkn : null,
            'modus_pkn'             => $modus_pkn !== '' ? $modus_pkn : null,
            'peep_pkn'              => $peep_pkn !== '' ? $peep_pkn : null,
            'buble_pkn'             => $buble_pkn !== '' ? $buble_pkn : null,
            'fio2_pkn'              => $fio2_pkn !== '' ? $fio2_pkn : null,
            'spo2_pkn'              => $spo2_pkn !== '' ? $spo2_pkn : null,
            'flow_pkn'              => $flow_pkn !== '' ? $flow_pkn : null,
            'air_pkn'               => $air_pkn !== '' ? $air_pkn : null,
            'suhu_pkn'              => $suhu_pkn !== '' ? $suhu_pkn : null,
            'line1_pkn'             => $line1_pkn !== '' ? $line1_pkn : null,
            'line2_pkn'             => $line2_pkn !== '' ? $line2_pkn : null,
            'plebitis_pkn'          => $plebitis_pkn !== '' ? $plebitis_pkn : null,
            'oral_pkn'              => $oral_pkn !== '' ? $oral_pkn : null,
            'jml_pkn'               => $jml_pkn !== '' ? $jml_pkn : null,
            'muntah_pkn'            => $muntah_pkn !== '' ? $muntah_pkn : null,
            'residu_pkn'            => $residu_pkn !== '' ? $residu_pkn : null,
            'bak_pkn'               => $bak_pkn !== '' ? $bak_pkn : null,
            'bab_pkn'               => $bab_pkn !== '' ? $bab_pkn : null,
            'foto_therapy_pkn'      => $foto_therapy_pkn !== '' ? $foto_therapy_pkn : null,
            'obat_pkn'              => $obat_pkn !== '' ? $obat_pkn : null,
            'perawat_pkn'           => $perawat_pkn !== '' ? $perawat_pkn : null,
            'updated_at'            => date('Y-m-d H:i:s', time()),
        );
        $status = $this->m_pelayanan->editPengawasanKhususNeonatus($data);
        $this->response(array('status' => $status), REST_Controller::HTTP_OK);
    }
        
    // PKN
    function get_pengawasan_khusus_neonatus_get(){
        if (!$this->get('id', true)) :
            $this->response(null, REST_Controller::HTTP_BAD_REQUEST);
        endif;
        $data = $this->m_pelayanan->getPengawasanKhususNeonatusByID($this->get('id', true));
        $this->response($data, REST_Controller::HTTP_OK);
    }
    
            
    // UPRJPN
    function get_data_entri_resiko_jatuh_pada_neonatus_get(){
        if (!$this->get('id')) :
            $this->response(NULL, REST_Controller::HTTP_BAD_REQUEST); // (400)
        endif;
        $this->load->model('pendaftaran/Pendaftaran_model', 'm_pendaftaran');
        $data = $this->m_pendaftaran->getPendaftaranDetail($this->get('id', true), $this->get('id_layanan', true));
        $data['profil'] = $this->m_pelayanan->getProfilPasien($data['pasien']->id_pasien);
        $data['upaya_pencegahan_risiko_jatuh_pada_neonatus'] = $this->m_pelayanan->getUpayaPencegahanResikoJatuhPadaNeonatus($this->get('id', true));
        if ($data) :
            $this->response($data, REST_Controller::HTTP_OK); // (200)
        endif;
    }

    // UPRJPN
    function simpan_resiko_jatuh_pada_neonatus_post(){
        $layanan = array('id' => safe_post('id_layanan_pendaftaran'));
        $uprjpn_tanggal_pengkajian = safe_post('uprjpn_tanggal_pengkajian');
        $id_pendaftaran           = safe_post('id_pendaftaran');

        if (!empty($uprjpn_tanggal_pengkajian)) {
            $upaya_pencegahan_resiko_jatuh_neonatus = array(
                'id_pendaftaran'         => $id_pendaftaran,
                'id_layanan_pendaftaran' => $layanan['id'],
                'id_perawat_1'           => safe_post('perawat_1') !== '' ? safe_post('perawat_1') : null,
                'id_perawat_2'           => safe_post('perawat_2') !== '' ? safe_post('perawat_2') : null,
                'id_perawat_3'           => safe_post('perawat_3') !== '' ? safe_post('perawat_3') : null,
                'id_user'                => safe_post('user_pengkajian') !== '' ? safe_post('user_pengkajian') : null,
                'tanggal_pengkajian'     => safe_post('uprjpn_tanggal_pengkajian'),

                // Posisi tanda Risiko  jatuh tetap ada/terpasang
                'terpasang_p_ho'               => safe_post('terpasang_p_ho') !== '' ? safe_post('terpasang_p_ho') : null,
                'terpasang_p_10'               => safe_post('terpasang_p_10') !== '' ? safe_post('terpasang_p_10') : null,
                'terpasang_s_ho'               => safe_post('terpasang_s_ho') !== '' ? safe_post('terpasang_s_ho') : null,
                'terpasang_s_18'               => safe_post('terpasang_s_18') !== '' ? safe_post('terpasang_s_18') : null,
                'terpasang_m_ho'               => safe_post('terpasang_m_ho') !== '' ? safe_post('terpasang_m_ho') : null,
                'terpasang_m_23'               => safe_post('terpasang_m_23') !== '' ? safe_post('terpasang_m_23') : null,
                'terpasang_m_4'                => safe_post('terpasang_m_4') !== '' ? safe_post('terpasang_m_4') : null,

                // Pastikan roda box/incubator pada posisi terkunci
                'terkunci_p_ho'              => safe_post('terkunci_p_ho') !== '' ? safe_post('terkunci_p_ho') : null,
                'terkunci_p_10'              => safe_post('terkunci_p_10') !== '' ? safe_post('terkunci_p_10') : null,
                'terkunci_s_ho'              => safe_post('terkunci_s_ho') !== '' ? safe_post('terkunci_s_ho') : null,
                'terkunci_s_18'              => safe_post('terkunci_s_18') !== '' ? safe_post('terkunci_s_18') : null,
                'terkunci_m_ho'              => safe_post('terkunci_m_ho') !== '' ? safe_post('terkunci_m_ho') : null,
                'terkunci_m_23'              => safe_post('terkunci_m_23') !== '' ? safe_post('terkunci_m_23') : null,
                'terkunci_m_4'               => safe_post('terkunci_m_4') !== '' ? safe_post('terkunci_m_4') : null,

                // Pastikan pintu inkubator tertutup bila tidak ada tindakan
                'tindakan_p_ho'               => safe_post('tindakan_p_ho') !== '' ? safe_post('tindakan_p_ho') : null,
                'tindakan_p_10'               => safe_post('tindakan_p_10') !== '' ? safe_post('tindakan_p_10') : null,
                'tindakan_s_ho'               => safe_post('tindakan_s_ho') !== '' ? safe_post('tindakan_s_ho') : null,
                'tindakan_s_18'               => safe_post('tindakan_s_18') !== '' ? safe_post('tindakan_s_18') : null,
                'tindakan_m_ho'               => safe_post('tindakan_m_ho') !== '' ? safe_post('tindakan_m_ho') : null,
                'tindakan_m_23'               => safe_post('tindakan_m_23') !== '' ? safe_post('tindakan_m_23') : null,
                'tindakan_m_4'                => safe_post('tindakan_m_4') !== '' ? safe_post('tindakan_m_4') : null,

                // Paraf
                'paraff_p_ho'             => safe_post('paraff_p_ho') !== '' ? safe_post('paraff_p_ho') : null,
                'paraff_p_10'             => safe_post('paraff_p_10') !== '' ? safe_post('paraff_p_10') : null,
                'paraff_s_ho'             => safe_post('paraff_s_ho') !== '' ? safe_post('paraff_s_ho') : null,
                'paraff_s_18'             => safe_post('paraff_s_18') !== '' ? safe_post('paraff_s_18') : null,
                'paraff_m_ho'             => safe_post('paraff_m_ho') !== '' ? safe_post('paraff_m_ho') : null,
                'paraff_m_23'             => safe_post('paraff_m_23') !== '' ? safe_post('paraff_m_23') : null,
                'paraff_m_4'              => safe_post('paraff_m_4') !== '' ? safe_post('paraff_m_4') : null,

                'date_created' => safe_post('pencegahan_date_neonatus') !== '' ? safe_post('pencegahan_date_neonatus') : null,
            );
            $this->m_pelayanan->insertUpayaPencegahanResikoJatuhPadaNeonatus($upaya_pencegahan_resiko_jatuh_neonatus);
        }

        if (!empty($respon)) {

            $response = $respon;
        } else {

            $response = null;
        }


        if ($this->db->trans_status() === false) :
            $this->db->trans_rollback();
            $status = false;
        else :
            $this->db->trans_commit();
            $status = true;
        endif;

        $message = array(
            'status' => $status,
            'token'  => $this->security->get_csrf_hash(),
            'id'     => $layanan['id'],
            'respon' => $response,
        );

        $this->response($message, REST_Controller::HTTP_OK);
    }

    // UPRJPN
    function hapus_upaya_pencegahan_risiko_jatuh_pada_neonatus_delete($id){
        $status = $this->m_pelayanan->deleteUpayaPencegahanRisikoJatuhPadaNeonatus($id);
        if ($status) :
            $response = array('status' => $status, 'message' => 'Berhasil menghapus Upaya Pencegahan Risiko Jatuh Pada Neonatus!');
        else :
            $response = array('status' => $status, 'message' => 'Gagal menghapus Upaya Pencegahan Risiko Jatuh Pada Neonatus!');
        endif;
        $this->response($response, REST_Controller::HTTP_OK);
    }

    // UPRJPN 
    function get_upaya_pencegahan_risiko_jatuh_pada_neonatus_get(){
        if (!$this->get('id', true)) :
            $this->response(null, REST_Controller::HTTP_BAD_REQUEST);
        endif;
        $data = $this->m_pelayanan->getUpayaPencegahanResikoJatuhPadaNeonatusByID($this->get('id', true));
        $this->response($data, REST_Controller::HTTP_OK);
    }

    // UPRJPN
    function update_upaya_pencegahan_risiko_jatuh_pada_neonatus_put(){
        if (!$this->put('id', true)) :
            $this->response(array('status' => false), REST_Controller::HTTP_OK);
        endif;

        $tanggal_pengkajian = $this->put('uprjpn_tanggal_pengkajian', true);
        $tanggal_pengkajian = str_replace('/', '-', $tanggal_pengkajian);

        $tanggal_pengkajian = date('Y-m-d', strtotime($tanggal_pengkajian));
        $id_perawat_1       = $this->put('perawat_1', true);
        $id_perawat_2       = $this->put('perawat_2', true);
        $id_perawat_3       = $this->put('perawat_3', true);

        // Posisi tanda Risiko  jatuh tetap ada/terpasang
        $terpasang_p_ho = $this->put('terpasang_p_ho', true);
        $terpasang_p_10 = $this->put('terpasang_p_10', true);
        $terpasang_s_ho = $this->put('terpasang_s_ho', true);
        $terpasang_s_18 = $this->put('terpasang_s_18', true);
        $terpasang_m_ho = $this->put('terpasang_m_ho', true);
        $terpasang_m_23 = $this->put('terpasang_m_23', true);
        $terpasang_m_4  = $this->put('terpasang_m_4', true);

        // Pastikan roda box/incubator pada posisi terkunci
        $terkunci_p_ho = $this->put('terkunci_p_ho', true);
        $terkunci_p_10 = $this->put('terkunci_p_10', true);
        $terkunci_s_ho = $this->put('terkunci_s_ho', true);
        $terkunci_s_18 = $this->put('terkunci_s_18', true);
        $terkunci_m_ho = $this->put('terkunci_m_ho', true);
        $terkunci_m_23 = $this->put('terkunci_m_23', true);
        $terkunci_m_4  = $this->put('terkunci_m_4', true);

        // Pastikan pintu inkubator tertutup bila tidak ada tindakan
        $tindakan_p_ho = $this->put('tindakan_p_ho', true);
        $tindakan_p_10 = $this->put('tindakan_p_10', true);
        $tindakan_s_ho = $this->put('tindakan_s_ho', true);
        $tindakan_s_18 = $this->put('tindakan_s_18', true);
        $tindakan_m_ho = $this->put('tindakan_m_ho', true);
        $tindakan_m_23 = $this->put('tindakan_m_23', true);
        $tindakan_m_4  = $this->put('tindakan_m_4', true);

        // Paraf
        $paraff_p_ho = $this->put('paraff_p_ho', true);
        $paraff_p_10 = $this->put('paraff_p_10', true);
        $paraff_s_ho = $this->put('paraff_s_ho', true);
        $paraff_s_18 = $this->put('paraff_s_18', true);
        $paraff_m_ho = $this->put('paraff_m_ho', true);
        $paraff_m_23 = $this->put('paraff_m_23', true);
        $paraff_m_4  = $this->put('paraff_m_4', true);

        $data = array(
            'id'                 => $this->put('id', true),
            'tanggal_pengkajian' => $tanggal_pengkajian,
            'id_perawat_1'       => $id_perawat_1 !== '' ? $id_perawat_1 : null,
            'id_perawat_2'       => $id_perawat_2 !== '' ? $id_perawat_2 : null,
            'id_perawat_3'       => $id_perawat_3 !== '' ? $id_perawat_3 : null,

            'terpasang_p_ho' => $terpasang_p_ho === 'on' ? 1 : 0,
            'terpasang_p_10' => $terpasang_p_10 === 'on' ? 1 : 0,
            'terpasang_s_ho' => $terpasang_s_ho === 'on' ? 1 : 0,
            'terpasang_s_18' => $terpasang_s_18 === 'on' ? 1 : 0,
            'terpasang_m_ho' => $terpasang_m_ho === 'on' ? 1 : 0,
            'terpasang_m_23' => $terpasang_m_23 === 'on' ? 1 : 0,
            'terpasang_m_4'  => $terpasang_m_4 === 'on' ? 1 : 0,

            'terkunci_p_ho' => $terkunci_p_ho === 'on' ? 1 : 0,
            'terkunci_p_10' => $terkunci_p_10 === 'on' ? 1 : 0,
            'terkunci_s_ho' => $terkunci_s_ho === 'on' ? 1 : 0,
            'terkunci_s_18' => $terkunci_s_18 === 'on' ? 1 : 0,
            'terkunci_m_ho' => $terkunci_m_ho === 'on' ? 1 : 0,
            'terkunci_m_23' => $terkunci_m_23 === 'on' ? 1 : 0,
            'terkunci_m_4'  => $terkunci_m_4 === 'on' ? 1 : 0,

            'tindakan_p_ho' => $tindakan_p_ho === 'on' ? 1 : 0,
            'tindakan_p_10' => $tindakan_p_10 === 'on' ? 1 : 0,
            'tindakan_s_ho' => $tindakan_s_ho === 'on' ? 1 : 0,
            'tindakan_s_18' => $tindakan_s_18 === 'on' ? 1 : 0,
            'tindakan_m_ho' => $tindakan_m_ho === 'on' ? 1 : 0,
            'tindakan_m_23' => $tindakan_m_23 === 'on' ? 1 : 0,
            'tindakan_m_4'  => $tindakan_m_4 === 'on' ? 1 : 0,

            'paraff_p_ho' => $paraff_p_ho === 'on' ? 1 : 0,
            'paraff_p_10' => $paraff_p_10 === 'on' ? 1 : 0,
            'paraff_s_ho' => $paraff_s_ho === 'on' ? 1 : 0,
            'paraff_s_18' => $paraff_s_18 === 'on' ? 1 : 0,
            'paraff_m_ho' => $paraff_m_ho === 'on' ? 1 : 0,
            'paraff_m_23' => $paraff_m_23 === 'on' ? 1 : 0,
            'paraff_m_4'  => $paraff_m_4 === 'on' ? 1 : 0,

            'updated_at' => date('Y-m-d H:i:s', time()),
        );
        $status = $this->m_pelayanan->editUpayaPencegahanRisikoJatuhPadaNeonatus($data);
        $this->response(array('status' => $status), REST_Controller::HTTP_OK);
    }

    // DPJP  
    function get_data_dokter_penangung_jawab_pasien_get(){
        if (!$this->get('id')) :
            $this->response(NULL, REST_Controller::HTTP_BAD_REQUEST); // (400)
        endif;
        $this->load->model('pendaftaran/Pendaftaran_model', 'm_pendaftaran');
        $data = $this->m_pendaftaran->getPendaftaranDetail($this->get('id', true), $this->get('id_layanan', true));
        $data['profil'] = $this->m_pelayanan->getProfilPasien($data['pasien']->id_pasien);        
        $data['daftar_dokter_dpjp']  = $this->m_pelayanan->getDaftarDokterDPJP($this->get('id', true));
        if ($data) :
            $this->response($data, REST_Controller::HTTP_OK); // (200)
        endif;
    }
    
    // DPJP  
    function simpan_data_dokter_penangung_jawab_pasien_post(){
        // Helper function di dalam fungsi utama
        $parse_tanggal_array = function ($tanggal_array) {
            if (empty($tanggal_array) || !is_array($tanggal_array)) {
                return null;
            }

            $parsed = [];
            foreach ($tanggal_array as $key => $value) {
                $var1 = explode("/", $value);
                if (count($var1) === 3) {
                    $var2 = "$var1[2]-$var1[1]-$var1[0]";
                    $date = DateTime::createFromFormat('Y-m-d', $var2);
                    if ($date) {
                        $parsed[$key] = $date->format('Y-m-d');
                    }
                }
            }
            return $parsed;
        };
        
        $id_users = safe_post('id_users');
        $pencegahan_date_dpjp = safe_post('pencegahan_date_dpjp');  
        $id_pendaftaran           = safe_post('id_pendaftaran');  
        $layanan = array('id' => safe_post('id_layanan_pendaftaran'));
        $diagnosis_dokter = safe_post('diagnosis_dokter');
        if (!empty($diagnosis_dokter)) {
            $date_dpjp               = $parse_tanggal_array(safe_post('tanggal_mulai_dpjp'));
            $date_akhir_dpjp         = $parse_tanggal_array(safe_post('tanggal_akhir_dpjp'));
            $date_mulai_dpjp_utama   = $parse_tanggal_array(safe_post('tanggal_mulai_dpjp_utama'));
            $date_akhir_dpjp_utama   = $parse_tanggal_array(safe_post('tanggal_akhir_dpjp_utama'));

            $daftar_dokter_dpjp = array(
                'id_layanan_pendaftaran'    => $layanan['id'],
                'id_pendaftaran'            => $id_pendaftaran,
                'diagnosis_dokter'          => safe_post('diagnosis_dokter') !== '' ? safe_post('diagnosis_dokter') : NULL,
                'keterangan_dpjp'           => safe_post('keterangan_dpjp') !== '' ? safe_post('keterangan_dpjp') : NULL,
                'tanggal_awal_dpjp'         => $date_dpjp, 
                'tanggal_akhir_dpjp'        => $date_akhir_dpjp,
                'tanggal_awal_dpjp_utama'   => $date_mulai_dpjp_utama,
                'tanggal_akhir_dpjp_utama'  => $date_akhir_dpjp_utama,
                'id_dokter_dpjp'            => safe_post('nama_dokter_dpjp') !== '' ? safe_post('nama_dokter_dpjp') : NULL,
                'id_dokter_dpjp_utama'      => safe_post('nama_dokter_dpjp_utama') !== '' ? safe_post('nama_dokter_dpjp_utama') : NULL,
                'id_users'                  => safe_post('user_dokter_dpjp') !== '' ? safe_post('user_dokter_dpjp') : NULL,
                'created_date'              => $this->datetime,
            );

            $this->m_pelayanan->insertDaftarDPJP($daftar_dokter_dpjp);
        }

        $response = isset($respon) ? $respon : null;

        if ($this->db->trans_status() === false) {
            $this->db->trans_rollback();
            $status = false;
        } else {
            $this->db->trans_commit();
            $status = true;
        }

        $message = array(
            'status' => $status,
            'token'  => $this->security->get_csrf_hash(),
            'id'     => $layanan['id'],
            'respon' => $response,
        );

        $this->response($message, REST_Controller::HTTP_OK);
    }

    // DPJP
    function update_data_dokter_penangung_jawab_pasien_put() {
        $this->db->trans_begin();

        $id = $this->put('id', true);
        if (!$id) {
            $this->response(['status' => false], REST_Controller::HTTP_OK);
            return;
        }

        // Ambil data lama untuk log
        $lama = $this->db->get_where('sm_daftar_dokter_dpjp', ['id' => $id])->row_array();
        if ($lama) {
            $log = $lama;
            unset($log['id']); // supaya tidak bentrok dengan auto increment ID logs
            $log['update_date'] = date('Y-m-d H:i:s');
            $log['created_date'] = $lama['created_date']; // ambil dari data lama
            $log['id_users'] = $this->session->userdata('id_translucent'); 
            $log['keterangan'] = 'Update';
            $this->m_pelayanan->insertLogsDaftarDpjp($log);
        }

        $dpjp_tanggal_awal = $this->put('tanggal_mulai_dpjp', true);
        $dpjp_tanggal_awal = str_replace('/', '-', $dpjp_tanggal_awal);
        $dpjp_tanggal_awal = date('Y-m-d', strtotime($dpjp_tanggal_awal));

        $dpjp_tanggal_akhir = $this->put('tanggal_akhir_dpjp', true);
        $dpjp_tanggal_akhir = str_replace('/', '-', $dpjp_tanggal_akhir);
        $dpjp_tanggal_akhir = date('Y-m-d', strtotime($dpjp_tanggal_akhir));

        $dpjp_tanggal_awal_utama = $this->put('tanggal_mulai_dpjp_utama', true);
        $dpjp_tanggal_awal_utama = str_replace('/', '-', $dpjp_tanggal_awal_utama);
        $dpjp_tanggal_awal_utama = date('Y-m-d', strtotime($dpjp_tanggal_awal_utama));

        $dpjp_tanggal_akhir_utama = $this->put('tanggal_akhir_dpjp_utama', true);
        $dpjp_tanggal_akhir_utama = str_replace('/', '-', $dpjp_tanggal_akhir_utama);
        $dpjp_tanggal_akhir_utama = date('Y-m-d', strtotime($dpjp_tanggal_akhir_utama));

        // Update data baru
        $data = [
            'tanggal_awal_dpjp'             => $dpjp_tanggal_awal,
            'tanggal_akhir_dpjp'            => $dpjp_tanggal_akhir,
            'tanggal_awal_dpjp_utama'       => $dpjp_tanggal_awal_utama,
            'tanggal_akhir_dpjp_utama'      => $dpjp_tanggal_akhir_utama,
            'diagnosis_dokter'              => $this->put('diagnosis_dokter', true) ?: null,
            'keterangan_dpjp'               => $this->put('keterangan_dpjp', true) ?: null,
            'id_dokter_dpjp'                => $this->put('nama_dokter_dpjp', true) ?: null,
            'id_dokter_dpjp_utama'          => $this->put('nama_dokter_dpjp_utama', true) ?: null,
            'update_date'                   => date('Y-m-d H:i:s'),
            'id_users'                      => $this->session->userdata('id_translucent'),
        ];

        $this->db->where('id', $id);
        $status = $this->db->update('sm_daftar_dokter_dpjp', $data);

        if ($this->db->trans_status() === false) {
            $this->db->trans_rollback();
            $this->response(['status' => false], REST_Controller::HTTP_OK);
        } else {
            $this->db->trans_commit();
            $this->response(['status' => true], REST_Controller::HTTP_OK);
        }
    }

    // DPJP
    function get_edit_data_dokter_penangung_jawab_pasien_get(){
         if (!$this->get('id', true)) :
             $this->response(null, REST_Controller::HTTP_BAD_REQUEST);
         endif;
         $data = $this->m_pelayanan->getDaftarDokterDPJPByID($this->get('id', true));
         $this->response($data, REST_Controller::HTTP_OK);
    }

    // DPJP
    function hapus_daftar_dokter_dpjp_delete($id){
        $this->db->trans_begin();

        // Ambil data lama sebelum hapus
        $lama = $this->db->get_where('sm_daftar_dokter_dpjp', ['id' => $id])->row_array();
        if ($lama) {
            $log = $lama;
            unset($log['id']); // supaya tidak bentrok ID
            
            $log['update_date'] = date('Y-m-d H:i:s'); // waktu penghapusan

            // Ambil created_date dari data lama (fallback ke null kalau tidak ada)
            if (isset($lama['created_date'])) {
                $log['created_date'] = $lama['created_date'];
            } elseif (isset($lama['created_date'])) {
                $log['created_date'] = $lama['created_date'];
            } else {
                $log['created_date'] = null;
            }

            $log['id_users'] = $this->session->userdata('id_translucent'); // siapa yang hapus
            $log['keterangan'] = 'Delete';

            $this->m_pelayanan->insertLogsDaftarDpjp($log);
        }

        // Lanjut hapus datanya
        $status = $this->m_pelayanan->deleteDaftarDokterDPJP($id);

        if ($this->db->trans_status() === false || !$status) {
            $this->db->trans_rollback();
            $response = array('status' => false, 'message' => 'Gagal menghapus data!');
        } else {
            $this->db->trans_commit();
            $response = array('status' => true, 'message' => 'Berhasil menghapus data!');
        }

        $this->response($response, REST_Controller::HTTP_OK);
    }






    // function get_data_entri_keperawatan_get()
    // {
    //     if (!$this->get('id')) :
    //         $this->response(NULL, REST_Controller::HTTP_BAD_REQUEST); // (400)
    //     endif;

    //     $this->load->model('pendaftaran/Pendaftaran_model', 'm_pendaftaran');
    //     $data = $this->m_pendaftaran->getPendaftaranDetail($this->get('id', true), $this->get('id_layanan', true));
    //     $data['profil'] = $this->m_pelayanan->getProfilPasien($data['pasien']->id_pasien);
    //     $data['daftar_dokter_dpjp']  = $this->m_pelayanan->getDaftarDokterDPJP($this->get('id', true));
    //     if ($data) :
    //         $this->response($data, REST_Controller::HTTP_OK); // (200)
    //     endif;
    // }

    
    // function hapus_daftar_dokter_dpjp_delete($id)
    // {
    //     $status = $this->m_pelayanan->deleteDaftarDokterDPJP($id);
    //     if ($status) :
    //         $response = array('status' => $status, 'message' => 'Berhasil menghapus Daftar Dokter!');
    //     else :
    //         $response = array('status' => $status, 'message' => 'Gagal menghapus Daftar Dokter!');
    //     endif;
    //     $this->response($response, REST_Controller::HTTP_OK);
    // }
	
	function get_data_rujukan_by_no_rujukan_get($no_rujukan)
    {
        $this->response($this->get_rujukan_by_no_rujukan($no_rujukan), REST_Controller::HTTP_OK);
    }
	
	function cek_tanggal_kontrol_get()
    {
        $id_pasien    = $this->get('id_pasien');
        $tgl_rencana  = $this->get('tgl_rencana');
        $tgl_sebelum  = $this->get('tgl_sebelum');
        $data_Booking = $this->m_pelayanan->cekTanggalBooking($id_pasien, $tgl_rencana, $tgl_sebelum);

        if (!empty($data_Booking)) {
            $respon = [
                'status'  => false,
                'message' => 'Booking',
                'data'    => $data_Booking
            ];
        } else {
            $data_Kontrol = $this->m_pelayanan->cekTanggalKontrolDokter($id_pasien, $tgl_rencana, $tgl_sebelum);
            if (!empty($data_Kontrol)) {
                $respon = [
                    'status'  => false,
                    'message' => 'Surat Keterangan Kontrol',
                    'data'    => $data_Kontrol
                ];
            } else {
                $respon = [
                    'status' => true,
                    'message' => 'Tidak ada jadwal kontrol kurang dari 8 hari',
                    'data' => null
                ];
            }
        }

        $this->response($respon, REST_Controller::HTTP_OK);
    }






    // function hapus_kaji_ulang_delete($id)
    // {
    //     $status = $this->m_pelayanan->deleteKajiUlang($id);
    //     if ($status) :
    //         $response = array('status' => $status, 'message' => 'Berhasil menghapus Kaji Ulang!');
    //     else :
    //         $response = array('status' => $status, 'message' => 'Gagal menghapus Kaji Ulang!');
    //     endif;
    //     $this->response($response, REST_Controller::HTTP_OK);
    // }

    // function get_upaya_pencegahan_risiko_jatuh_pasien_dewasa_get()
    // {
    //     if (!$this->get('id', true)) :
    //         $this->response(null, REST_Controller::HTTP_BAD_REQUEST);
    //     endif;

    //     $data = $this->m_pelayanan->getUpayaPencegahanResikoJatuhPasienDewasaByID($this->get('id', true));
    //     $this->response($data, REST_Controller::HTTP_OK);
    // }

    // function update_upaya_pencegahan_risiko_jatuh_pasien_dewasa_put()
    // {
    //     if (!$this->put('id', true)) :
    //         $this->response(array('status' => false), REST_Controller::HTTP_OK);
    //     endif;

    //     $tanggal_pengkajian = $this->put('uprjpd_tanggal_pengkajian', true);
    //     $tanggal_pengkajian = str_replace('/', '-', $tanggal_pengkajian);

    //     $tanggal_pengkajian = date('Y-m-d', strtotime($tanggal_pengkajian));
    //     $id_perawat_p       = $this->put('uprjpd_perawat_p', true);
    //     $id_perawat_s       = $this->put('uprjpd_perawat_s', true);
    //     $id_perawat_m       = $this->put('uprjpd_perawat_m', true);

    //     // Bel berfungsi dan mudah dijangkau
    //     $bel_p_ho = $this->put('uprjpd_bel_p_ho', true);
    //     $bel_p_10 = $this->put('uprjpd_bel_p_10', true);
    //     $bel_s_ho = $this->put('uprjpd_bel_s_ho', true);
    //     $bel_s_18 = $this->put('uprjpd_bel_s_18', true);
    //     $bel_m_ho = $this->put('uprjpd_bel_m_ho', true);
    //     $bel_m_23 = $this->put('uprjpd_bel_m_23', true);
    //     $bel_m_4  = $this->put('uprjpd_bel_m_4', true);

    //     // Roda tempat tidur terkunci
    //     $roda_p_ho = $this->put('uprjpd_roda_p_ho', true);
    //     $roda_p_10 = $this->put('uprjpd_roda_p_10', true);
    //     $roda_s_ho = $this->put('uprjpd_roda_s_ho', true);
    //     $roda_s_18 = $this->put('uprjpd_roda_s_18', true);
    //     $roda_m_ho = $this->put('uprjpd_roda_m_ho', true);
    //     $roda_m_23 = $this->put('uprjpd_roda_m_23', true);
    //     $roda_m_4  = $this->put('uprjpd_roda_m_4', true);

    //     // Posisikan tempat tidur pada posisi terendah
    //     $ptt_p_ho = $this->put('uprjpd_ptt_p_ho', true);
    //     $ptt_p_10 = $this->put('uprjpd_ptt_p_10', true);
    //     $ptt_s_ho = $this->put('uprjpd_ptt_s_ho', true);
    //     $ptt_s_18 = $this->put('uprjpd_ptt_s_18', true);
    //     $ptt_m_ho = $this->put('uprjpd_ptt_m_ho', true);
    //     $ptt_m_23 = $this->put('uprjpd_ptt_m_23', true);
    //     $ptt_m_4  = $this->put('uprjpd_ptt_m_4', true);

    //     // Pagar pengaman tempat tidur dinaikan
    //     $ppt_p_ho = $this->put('uprjpd_ppt_p_ho', true);
    //     $ppt_p_10 = $this->put('uprjpd_ppt_p_10', true);
    //     $ppt_s_ho = $this->put('uprjpd_ppt_s_ho', true);
    //     $ppt_s_18 = $this->put('uprjpd_ppt_s_18', true);
    //     $ppt_m_ho = $this->put('uprjpd_ppt_m_ho', true);
    //     $ppt_m_23 = $this->put('uprjpd_ppt_m_23', true);
    //     $ppt_m_4  = $this->put('uprjpd_ppt_m_4', true);

    //     // Penerang cukup
    //     $penerangan_p_ho = $this->put('uprjpd_penerangan_p_ho', true);
    //     $penerangan_p_10 = $this->put('uprjpd_penerangan_p_10', true);
    //     $penerangan_s_ho = $this->put('uprjpd_penerangan_s_ho', true);
    //     $penerangan_s_18 = $this->put('uprjpd_penerangan_s_18', true);
    //     $penerangan_m_ho = $this->put('uprjpd_penerangan_m_ho', true);
    //     $penerangan_m_23 = $this->put('uprjpd_penerangan_m_23', true);
    //     $penerangan_m_4  = $this->put('uprjpd_penerangan_m_4', true);

    //     // Pastikan alas kaki yang tidak licin untuk pasien yang dapat berjalan
    //     $alas_p_ho = $this->put('uprjpd_alas_p_ho', true);
    //     $alas_p_10 = $this->put('uprjpd_alas_p_10', true);
    //     $alas_s_ho = $this->put('uprjpd_alas_s_ho', true);
    //     $alas_s_18 = $this->put('uprjpd_alas_s_18', true);
    //     $alas_m_ho = $this->put('uprjpd_alas_m_ho', true);
    //     $alas_m_23 = $this->put('uprjpd_alas_m_23', true);
    //     $alas_m_4  = $this->put('uprjpd_alas_m_4', true);

    //     // Lantai kering dan tidak licin
    //     $lantai_p_ho = $this->put('uprjpd_lantai_p_ho', true);
    //     $lantai_p_10 = $this->put('uprjpd_lantai_p_10', true);
    //     $lantai_s_ho = $this->put('uprjpd_lantai_s_ho', true);
    //     $lantai_s_18 = $this->put('uprjpd_lantai_s_18', true);
    //     $lantai_m_ho = $this->put('uprjpd_lantai_m_ho', true);
    //     $lantai_m_23 = $this->put('uprjpd_lantai_m_23', true);
    //     $lantai_m_4  = $this->put('uprjpd_lantai_m_4', true);

    //     // Dekatkan alat-alat pasien
    //     $alat_p_ho = $this->put('uprjpd_alat_p_ho', true);
    //     $alat_p_10 = $this->put('uprjpd_alat_p_10', true);
    //     $alat_s_ho = $this->put('uprjpd_alat_s_ho', true);
    //     $alat_s_18 = $this->put('uprjpd_alat_s_18', true);
    //     $alat_m_ho = $this->put('uprjpd_alat_m_ho', true);
    //     $alat_m_23 = $this->put('uprjpd_alat_m_23', true);
    //     $alat_m_4  = $this->put('uprjpd_alat_m_4', true);

    //     // Edukasi pasien tentang efek samping obat yang diberikan
    //     $edukasi_p_ho = $this->put('uprjpd_edukasi_p_ho', true);
    //     $edukasi_p_10 = $this->put('uprjpd_edukasi_p_10', true);
    //     $edukasi_s_ho = $this->put('uprjpd_edukasi_s_ho', true);
    //     $edukasi_s_18 = $this->put('uprjpd_edukasi_s_18', true);
    //     $edukasi_m_ho = $this->put('uprjpd_edukasi_m_ho', true);
    //     $edukasi_m_23 = $this->put('uprjpd_edukasi_m_23', true);
    //     $edukasi_m_4  = $this->put('uprjpd_edukasi_m_4', true);

    //     // Tidak meninggalkan pasien di kamar mandi saat menggunakan commode
    //     $commode_p_ho = $this->put('uprjpd_commode_p_ho', true);
    //     $commode_p_10 = $this->put('uprjpd_commode_p_10', true);
    //     $commode_s_ho = $this->put('uprjpd_commode_s_ho', true);
    //     $commode_s_18 = $this->put('uprjpd_commode_s_18', true);
    //     $commode_m_ho = $this->put('uprjpd_commode_m_ho', true);
    //     $commode_m_23 = $this->put('uprjpd_commode_m_23', true);
    //     $commode_m_4  = $this->put('uprjpd_commode_m_4', true);

    //     // Pasang gelang khusus
    //     $gelang_p_ho = $this->put('uprjpd_gelang_p_ho', true);
    //     $gelang_p_10 = $this->put('uprjpd_gelang_p_10', true);
    //     $gelang_s_ho = $this->put('uprjpd_gelang_s_ho', true);
    //     $gelang_s_18 = $this->put('uprjpd_gelang_s_18', true);
    //     $gelang_m_ho = $this->put('uprjpd_gelang_m_ho', true);
    //     $gelang_m_23 = $this->put('uprjpd_gelang_m_23', true);
    //     $gelang_m_4  = $this->put('uprjpd_gelang_m_4', true);

    //     // Tempatkan pasien di kamar yang paling dekat dengan Nurse Station
    //     $station_p_ho = $this->put('uprjpd_station_p_ho', true);
    //     $station_p_10 = $this->put('uprjpd_station_p_10', true);
    //     $station_s_ho = $this->put('uprjpd_station_s_ho', true);
    //     $station_s_18 = $this->put('uprjpd_station_s_18', true);
    //     $station_m_ho = $this->put('uprjpd_station_m_ho', true);
    //     $station_m_23 = $this->put('uprjpd_station_m_23', true);
    //     $station_m_4  = $this->put('uprjpd_station_m_4', true);

    //     // Paraf
    //     $paraf_p_ho = $this->put('uprjpd_paraf_p_ho', true);
    //     $paraf_p_10 = $this->put('uprjpd_paraf_p_10', true);
    //     $paraf_s_ho = $this->put('uprjpd_paraf_s_ho', true);
    //     $paraf_s_18 = $this->put('uprjpd_paraf_s_18', true);
    //     $paraf_m_ho = $this->put('uprjpd_paraf_m_ho', true);
    //     $paraf_m_23 = $this->put('uprjpd_paraf_m_23', true);
    //     $paraf_m_4  = $this->put('uprjpd_paraf_m_4', true);

    //     $data = array(
    //         'id'                 => $this->put('id', true),
    //         'tanggal_pengkajian' => $tanggal_pengkajian,
    //         'id_perawat_p'       => $id_perawat_p !== '' ? $id_perawat_p : null,
    //         'id_perawat_s'       => $id_perawat_s !== '' ? $id_perawat_s : null,
    //         'id_perawat_m'       => $id_perawat_m !== '' ? $id_perawat_m : null,

    //         'bel_p_ho' => $bel_p_ho === 'on' ? 1 : 0,
    //         'bel_p_10' => $bel_p_10 === 'on' ? 1 : 0,
    //         'bel_s_ho' => $bel_s_ho === 'on' ? 1 : 0,
    //         'bel_s_18' => $bel_s_18 === 'on' ? 1 : 0,
    //         'bel_m_ho' => $bel_m_ho === 'on' ? 1 : 0,
    //         'bel_m_23' => $bel_m_23 === 'on' ? 1 : 0,
    //         'bel_m_4'  => $bel_m_4 === 'on' ? 1 : 0,

    //         'roda_p_ho' => $roda_p_ho === 'on' ? 1 : 0,
    //         'roda_p_10' => $roda_p_10 === 'on' ? 1 : 0,
    //         'roda_s_ho' => $roda_s_ho === 'on' ? 1 : 0,
    //         'roda_s_18' => $roda_s_18 === 'on' ? 1 : 0,
    //         'roda_m_ho' => $roda_m_ho === 'on' ? 1 : 0,
    //         'roda_m_23' => $roda_m_23 === 'on' ? 1 : 0,
    //         'roda_m_4'  => $roda_m_4 === 'on' ? 1 : 0,

    //         'ptt_p_ho' => $ptt_p_ho === 'on' ? 1 : 0,
    //         'ptt_p_10' => $ptt_p_10 === 'on' ? 1 : 0,
    //         'ptt_s_ho' => $ptt_s_ho === 'on' ? 1 : 0,
    //         'ptt_s_18' => $ptt_s_18 === 'on' ? 1 : 0,
    //         'ptt_m_ho' => $ptt_m_ho === 'on' ? 1 : 0,
    //         'ptt_m_23' => $ptt_m_23 === 'on' ? 1 : 0,
    //         'ptt_m_4'  => $ptt_m_4 === 'on' ? 1 : 0,

    //         'ppt_p_ho' => $ppt_p_ho === 'on' ? 1 : 0,
    //         'ppt_p_10' => $ppt_p_10 === 'on' ? 1 : 0,
    //         'ppt_s_ho' => $ppt_s_ho === 'on' ? 1 : 0,
    //         'ppt_s_18' => $ppt_s_18 === 'on' ? 1 : 0,
    //         'ppt_m_ho' => $ppt_m_ho === 'on' ? 1 : 0,
    //         'ppt_m_23' => $ppt_m_23 === 'on' ? 1 : 0,
    //         'ppt_m_4'  => $ppt_m_4 === 'on' ? 1 : 0,

    //         'penerangan_p_ho' => $penerangan_p_ho === 'on' ? 1 : 0,
    //         'penerangan_p_10' => $penerangan_p_10 === 'on' ? 1 : 0,
    //         'penerangan_s_ho' => $penerangan_s_ho === 'on' ? 1 : 0,
    //         'penerangan_s_18' => $penerangan_s_18 === 'on' ? 1 : 0,
    //         'penerangan_m_ho' => $penerangan_m_ho === 'on' ? 1 : 0,
    //         'penerangan_m_23' => $penerangan_m_23 === 'on' ? 1 : 0,
    //         'penerangan_m_4'  => $penerangan_m_4 === 'on' ? 1 : 0,

    //         'alas_p_ho' => $alas_p_ho === 'on' ? 1 : 0,
    //         'alas_p_10' => $alas_p_10 === 'on' ? 1 : 0,
    //         'alas_s_ho' => $alas_s_ho === 'on' ? 1 : 0,
    //         'alas_s_18' => $alas_s_18 === 'on' ? 1 : 0,
    //         'alas_m_ho' => $alas_m_ho === 'on' ? 1 : 0,
    //         'alas_m_23' => $alas_m_23 === 'on' ? 1 : 0,
    //         'alas_m_4'  => $alas_m_4 === 'on' ? 1 : 0,

    //         'lantai_p_ho' => $lantai_p_ho === 'on' ? 1 : 0,
    //         'lantai_p_10' => $lantai_p_10 === 'on' ? 1 : 0,
    //         'lantai_s_ho' => $lantai_s_ho === 'on' ? 1 : 0,
    //         'lantai_s_18' => $lantai_s_18 === 'on' ? 1 : 0,
    //         'lantai_m_ho' => $lantai_m_ho === 'on' ? 1 : 0,
    //         'lantai_m_23' => $lantai_m_23 === 'on' ? 1 : 0,
    //         'lantai_m_4'  => $lantai_m_4 === 'on' ? 1 : 0,

    //         'alat_p_ho' => $alat_p_ho === 'on' ? 1 : 0,
    //         'alat_p_10' => $alat_p_10 === 'on' ? 1 : 0,
    //         'alat_s_ho' => $alat_s_ho === 'on' ? 1 : 0,
    //         'alat_s_18' => $alat_s_18 === 'on' ? 1 : 0,
    //         'alat_m_ho' => $alat_m_ho === 'on' ? 1 : 0,
    //         'alat_m_23' => $alat_m_23 === 'on' ? 1 : 0,
    //         'alat_m_4'  => $alat_m_4 === 'on' ? 1 : 0,

    //         'edukasi_p_ho' => $edukasi_p_ho === 'on' ? 1 : 0,
    //         'edukasi_p_10' => $edukasi_p_10 === 'on' ? 1 : 0,
    //         'edukasi_s_ho' => $edukasi_s_ho === 'on' ? 1 : 0,
    //         'edukasi_s_18' => $edukasi_s_18 === 'on' ? 1 : 0,
    //         'edukasi_m_ho' => $edukasi_m_ho === 'on' ? 1 : 0,
    //         'edukasi_m_23' => $edukasi_m_23 === 'on' ? 1 : 0,
    //         'edukasi_m_4'  => $edukasi_m_4 === 'on' ? 1 : 0,

    //         'commode_p_ho' => $commode_p_ho === 'on' ? 1 : 0,
    //         'commode_p_10' => $commode_p_10 === 'on' ? 1 : 0,
    //         'commode_s_ho' => $commode_s_ho === 'on' ? 1 : 0,
    //         'commode_s_18' => $commode_s_18 === 'on' ? 1 : 0,
    //         'commode_m_ho' => $commode_m_ho === 'on' ? 1 : 0,
    //         'commode_m_23' => $commode_m_23 === 'on' ? 1 : 0,
    //         'commode_m_4'  => $commode_m_4 === 'on' ? 1 : 0,

    //         'gelang_p_ho' => $gelang_p_ho === 'on' ? 1 : 0,
    //         'gelang_p_10' => $gelang_p_10 === 'on' ? 1 : 0,
    //         'gelang_s_ho' => $gelang_s_ho === 'on' ? 1 : 0,
    //         'gelang_s_18' => $gelang_s_18 === 'on' ? 1 : 0,
    //         'gelang_m_ho' => $gelang_m_ho === 'on' ? 1 : 0,
    //         'gelang_m_23' => $gelang_m_23 === 'on' ? 1 : 0,
    //         'gelang_m_4'  => $gelang_m_4 === 'on' ? 1 : 0,

    //         'station_p_ho' => $station_p_ho === 'on' ? 1 : 0,
    //         'station_p_10' => $station_p_10 === 'on' ? 1 : 0,
    //         'station_s_ho' => $station_s_ho === 'on' ? 1 : 0,
    //         'station_s_18' => $station_s_18 === 'on' ? 1 : 0,
    //         'station_m_ho' => $station_m_ho === 'on' ? 1 : 0,
    //         'station_m_23' => $station_m_23 === 'on' ? 1 : 0,
    //         'station_m_4'  => $station_m_4 === 'on' ? 1 : 0,

    //         'paraf_p_ho' => $paraf_p_ho === 'on' ? 1 : 0,
    //         'paraf_p_10' => $paraf_p_10 === 'on' ? 1 : 0,
    //         'paraf_s_ho' => $paraf_s_ho === 'on' ? 1 : 0,
    //         'paraf_s_18' => $paraf_s_18 === 'on' ? 1 : 0,
    //         'paraf_m_ho' => $paraf_m_ho === 'on' ? 1 : 0,
    //         'paraf_m_23' => $paraf_m_23 === 'on' ? 1 : 0,
    //         'paraf_m_4'  => $paraf_m_4 === 'on' ? 1 : 0,

    //         'updated_at' => date('Y-m-d H:i:s', time()),
    //     );

    //     $status = $this->m_pelayanan->editUpayaPencegahanRisikoJatuhPasienDewasa($data);
    //     $this->response(array('status' => $status), REST_Controller::HTTP_OK);
    // }

    // function hapus_upaya_pencegahan_risiko_jatuh_pasien_dewasa_delete($id)
    // {
    //     $status = $this->m_pelayanan->deleteUpayaPencegahanRisikoJatuhPasienDewasa($id);
    //     if ($status) :
    //         $response = array('status' => $status, 'message' => 'Berhasil menghapus Upaya Pencegahan Risiko Jatuh Pasien Dewasa!');
    //     else :
    //         $response = array('status' => $status, 'message' => 'Gagal menghapus Upaya Pencegahan Risiko Jatuh Pasien Dewasa!');
    //     endif;
    //     $this->response($response, REST_Controller::HTTP_OK);
    // }


    


    // PURJPD // UPRJPD
    function get_data_entri_purjpd_uprjpd_get(){
        if (!$this->get('id')) :
            $this->response(NULL, REST_Controller::HTTP_BAD_REQUEST); // (400)
        endif;
        $this->load->model('pendaftaran/Pendaftaran_model', 'm_pendaftaran');
        $data = $this->m_pendaftaran->getPendaftaranDetail($this->get('id', true), $this->get('id_layanan', true));
        $data['profil'] = $this->m_pelayanan->getProfilPasien($data['pasien']->id_pasien);
        $data['pengkajian_ulang']  = $this->m_pelayanan->getPengkajianUlang($this->get('id', true));
        $data['upaya_pencegahan_risiko_jatuh_pasien_dewasa']  = $this->m_pelayanan->getUpayaPencegahanPasienDewasa($this->get('id', true));
        if ($data) :
            $this->response($data, REST_Controller::HTTP_OK); // (200)
        endif;
    }

    // PURJPD // UPRJPD
    function simpan_purjpd_uprjpd_post(){
        $layanan = array('id' => safe_post('id_layanan_pendaftaran'));
        $id_pendaftaran           = safe_post('id_pendaftaran');
        $tanggal_pengkajian_input = safe_post('tanggal_pengkajian');
        $tanggal_pengkajian_formatted = [];

        if (is_array($tanggal_pengkajian_input)) {
            foreach ($tanggal_pengkajian_input as $tgl) {
                $date = DateTime::createFromFormat('d/m/Y', $tgl);
                $tanggal_pengkajian_formatted[] = $date ? $date->format('Y-m-d') : null;
            }
        } else {
            $date = DateTime::createFromFormat('d/m/Y', $tanggal_pengkajian_input);
            $tanggal_pengkajian_formatted = $date ? $date->format('Y-m-d') : null;
        }
        
        $pengkajian_ulang = array(
            'id_layanan_pendaftaran' => $layanan['id'],
            'id_pendaftaran'         => safe_post('id_pendaftaran'),
            'tanggal_pengkajian'     => $tanggal_pengkajian_formatted,
            'jumlah_skor'            => safe_post('jumlah_skor') !== '' ? safe_post('jumlah_skor') : NULL,
            'riwayat_jatuh'          => safe_post('riwayat_jatuh') !== '' ? safe_post('riwayat_jatuh') : NULL,
            'diagnosis_sekunder'     => safe_post('diagnosis_sekunder') !== '' ? safe_post('diagnosis_sekunder') : NULL,
            'alat_bantu_dua'         => safe_post('alat_bantu_dua') !== '' ? safe_post('alat_bantu_dua') : NULL,
            'infus'                  => safe_post('infus') !== '' ? safe_post('infus') : NULL,
            'cara_berjalan'          => safe_post('cara_berjalan') !== '' ? safe_post('cara_berjalan') : NULL,
            'status_mental'          => safe_post('status_mental') !== '' ? safe_post('status_mental') : NULL,
            'users'                  => safe_post('user_pengkajian') !== '' ? safe_post('user_pengkajian') : NULL,
            'date_created'           => safe_post('pengkajian_date') !== '' ? safe_post('pengkajian_date') : NULL,
            'perawat_purjpd'         => safe_post('perawat_purjpd') !== '' ? safe_post('perawat_purjpd') : NULL,
        );

        $this->m_pelayanan->updatePengkajianUlang($pengkajian_ulang);

        // $id_pendaftaran = safe_post('id_pendaftaran');
        
        $id_users             = safe_post('id_user');
        $layanan              = array('id'=> safe_post('id_layanan_pendaftaran')); 
        $id_pendaftaran       = safe_post('id_pendaftaran');
        $uprjpd_tanggal_pengkajian = safe_post('uprjpd_tanggal_pengkajian');

        if (!empty($uprjpd_tanggal_pengkajian)) {
            $uprjpd_data = array(
                'id_pendaftaran' => $id_pendaftaran,
                'id_layanan_pendaftaran' => $layanan['id'],
                'id_perawat_p' => safe_post('uprjpd_perawat_p') !== '' ? safe_post('uprjpd_perawat_p') : null,
                'id_perawat_s' => safe_post('uprjpd_perawat_s') !== '' ? safe_post('uprjpd_perawat_s') : null,
                'id_perawat_m' => safe_post('uprjpd_perawat_m') !== '' ? safe_post('uprjpd_perawat_m') : null,
                'id_user' => safe_post('user_uprjpd') !== '' ? safe_post('user_uprjpd') : null,
                'tanggal_pengkajian' => safe_post('uprjpd_tanggal_pengkajian'),

                // Bel berfungsi dan mudah dijangkau
                'bel_p_ho' => safe_post('uprjpd_bel_p_ho') !== '' ? safe_post('uprjpd_bel_p_ho') : null,
                'bel_p_10' => safe_post('uprjpd_bel_p_10') !== '' ? safe_post('uprjpd_bel_p_10') : null,
                'bel_s_ho' => safe_post('uprjpd_bel_s_ho') !== '' ? safe_post('uprjpd_bel_s_ho') : null,
                'bel_s_18' => safe_post('uprjpd_bel_s_18') !== '' ? safe_post('uprjpd_bel_s_18') : null,
                'bel_m_ho' => safe_post('uprjpd_bel_m_ho') !== '' ? safe_post('uprjpd_bel_m_ho') : null,
                'bel_m_23' => safe_post('uprjpd_bel_m_23') !== '' ? safe_post('uprjpd_bel_m_23') : null,
                'bel_m_4' => safe_post('uprjpd_bel_m_4') !== '' ? safe_post('uprjpd_bel_m_4') : null,

                // Roda tempat tidur terkunci
                'roda_p_ho' => safe_post('uprjpd_roda_p_ho') !== '' ? safe_post('uprjpd_roda_p_ho') : null,
                'roda_p_10' => safe_post('uprjpd_roda_p_10') !== '' ? safe_post('uprjpd_roda_p_10') : null,
                'roda_s_ho' => safe_post('uprjpd_roda_s_ho') !== '' ? safe_post('uprjpd_roda_s_ho') : null,
                'roda_s_18' => safe_post('uprjpd_roda_s_18') !== '' ? safe_post('uprjpd_roda_s_18') : null,
                'roda_m_ho' => safe_post('uprjpd_roda_m_ho') !== '' ? safe_post('uprjpd_roda_m_ho') : null,
                'roda_m_23' => safe_post('uprjpd_roda_m_23') !== '' ? safe_post('uprjpd_roda_m_23') : null,
                'roda_m_4' => safe_post('uprjpd_roda_m_4') !== '' ? safe_post('uprjpd_roda_m_4') : null,

                // Posisikan tempat tidur pada posisi terendah
                'ptt_p_ho' => safe_post('uprjpd_ptt_p_ho') !== '' ? safe_post('uprjpd_ptt_p_ho') : null,
                'ptt_p_10' => safe_post('uprjpd_ptt_p_10') !== '' ? safe_post('uprjpd_ptt_p_10') : null,
                'ptt_s_ho' => safe_post('uprjpd_ptt_s_ho') !== '' ? safe_post('uprjpd_ptt_s_ho') : null,
                'ptt_s_18' => safe_post('uprjpd_ptt_s_18') !== '' ? safe_post('uprjpd_ptt_s_18') : null,
                'ptt_m_ho' => safe_post('uprjpd_ptt_m_ho') !== '' ? safe_post('uprjpd_ptt_m_ho') : null,
                'ptt_m_23' => safe_post('uprjpd_ptt_m_23') !== '' ? safe_post('uprjpd_ptt_m_23') : null,
                'ptt_m_4' => safe_post('uprjpd_ptt_m_4') !== '' ? safe_post('uprjpd_ptt_m_4') : null,

                // Pagar pengaman tempat tidur dinaikan
                'ppt_p_ho' => safe_post('uprjpd_ppt_p_ho') !== '' ? safe_post('uprjpd_ppt_p_ho') : null,
                'ppt_p_10' => safe_post('uprjpd_ppt_p_10') !== '' ? safe_post('uprjpd_ppt_p_10') : null,
                'ppt_s_ho' => safe_post('uprjpd_ppt_s_ho') !== '' ? safe_post('uprjpd_ppt_s_ho') : null,
                'ppt_s_18' => safe_post('uprjpd_ppt_s_18') !== '' ? safe_post('uprjpd_ppt_s_18') : null,
                'ppt_m_ho' => safe_post('uprjpd_ppt_m_ho') !== '' ? safe_post('uprjpd_ppt_m_ho') : null,
                'ppt_m_23' => safe_post('uprjpd_ppt_m_23') !== '' ? safe_post('uprjpd_ppt_m_23') : null,
                'ppt_m_4' => safe_post('uprjpd_ppt_m_4') !== '' ? safe_post('uprjpd_ppt_m_4') : null,

                // Penerang cukup
                'penerangan_p_ho' => safe_post('uprjpd_penerangan_p_ho') !== '' ? safe_post('uprjpd_penerangan_p_ho') : null,
                'penerangan_p_10' => safe_post('uprjpd_penerangan_p_10') !== '' ? safe_post('uprjpd_penerangan_p_10') : null,
                'penerangan_s_ho' => safe_post('uprjpd_penerangan_s_ho') !== '' ? safe_post('uprjpd_penerangan_s_ho') : null,
                'penerangan_s_18' => safe_post('uprjpd_penerangan_s_18') !== '' ? safe_post('uprjpd_penerangan_s_18') : null,
                'penerangan_m_ho' => safe_post('uprjpd_penerangan_m_ho') !== '' ? safe_post('uprjpd_penerangan_m_ho') : null,
                'penerangan_m_23' => safe_post('uprjpd_penerangan_m_23') !== '' ? safe_post('uprjpd_penerangan_m_23') : null,
                'penerangan_m_4' => safe_post('uprjpd_penerangan_m_4') !== '' ? safe_post('uprjpd_penerangan_m_4') : null,

                // Pastikan alas kaki yang tidak licin untuk pasien yang dapat berjalan
                'alas_p_ho' => safe_post('uprjpd_alas_p_ho') !== '' ? safe_post('uprjpd_alas_p_ho') : null,
                'alas_p_10' => safe_post('uprjpd_alas_p_10') !== '' ? safe_post('uprjpd_alas_p_10') : null,
                'alas_s_ho' => safe_post('uprjpd_alas_s_ho') !== '' ? safe_post('uprjpd_alas_s_ho') : null,
                'alas_s_18' => safe_post('uprjpd_alas_s_18') !== '' ? safe_post('uprjpd_alas_s_18') : null,
                'alas_m_ho' => safe_post('uprjpd_alas_m_ho') !== '' ? safe_post('uprjpd_alas_m_ho') : null,
                'alas_m_23' => safe_post('uprjpd_alas_m_23') !== '' ? safe_post('uprjpd_alas_m_23') : null,
                'alas_m_4' => safe_post('uprjpd_alas_m_4') !== '' ? safe_post('uprjpd_alas_m_4') : null,

                // Lantai kering dan tidak licin
                'lantai_p_ho' => safe_post('uprjpd_lantai_p_ho') !== '' ? safe_post('uprjpd_lantai_p_ho') : null,
                'lantai_p_10' => safe_post('uprjpd_lantai_p_10') !== '' ? safe_post('uprjpd_lantai_p_10') : null,
                'lantai_s_ho' => safe_post('uprjpd_lantai_s_ho') !== '' ? safe_post('uprjpd_lantai_s_ho') : null,
                'lantai_s_18' => safe_post('uprjpd_lantai_s_18') !== '' ? safe_post('uprjpd_lantai_s_18') : null,
                'lantai_m_ho' => safe_post('uprjpd_lantai_m_ho') !== '' ? safe_post('uprjpd_lantai_m_ho') : null,
                'lantai_m_23' => safe_post('uprjpd_lantai_m_23') !== '' ? safe_post('uprjpd_lantai_m_23') : null,
                'lantai_m_4' => safe_post('uprjpd_lantai_m_4') !== '' ? safe_post('uprjpd_lantai_m_4') : null,

                // Dekatkan alat-alat pasien
                'alat_p_ho' => safe_post('uprjpd_alat_p_ho') !== '' ? safe_post('uprjpd_alat_p_ho') : null,
                'alat_p_10' => safe_post('uprjpd_alat_p_10') !== '' ? safe_post('uprjpd_alat_p_10') : null,
                'alat_s_ho' => safe_post('uprjpd_alat_s_ho') !== '' ? safe_post('uprjpd_alat_s_ho') : null,
                'alat_s_18' => safe_post('uprjpd_alat_s_18') !== '' ? safe_post('uprjpd_alat_s_18') : null,
                'alat_m_ho' => safe_post('uprjpd_alat_m_ho') !== '' ? safe_post('uprjpd_alat_m_ho') : null,
                'alat_m_23' => safe_post('uprjpd_alat_m_23') !== '' ? safe_post('uprjpd_alat_m_23') : null,
                'alat_m_4' => safe_post('uprjpd_alat_m_4') !== '' ? safe_post('uprjpd_alat_m_4') : null,

                // Edukasi pasien tentang efek samping obat yang diberikan
                'edukasi_p_ho' => safe_post('uprjpd_edukasi_p_ho') !== '' ? safe_post('uprjpd_edukasi_p_ho') : null,
                'edukasi_p_10' => safe_post('uprjpd_edukasi_p_10') !== '' ? safe_post('uprjpd_edukasi_p_10') : null,
                'edukasi_s_ho' => safe_post('uprjpd_edukasi_s_ho') !== '' ? safe_post('uprjpd_edukasi_s_ho') : null,
                'edukasi_s_18' => safe_post('uprjpd_edukasi_s_18') !== '' ? safe_post('uprjpd_edukasi_s_18') : null,
                'edukasi_m_ho' => safe_post('uprjpd_edukasi_m_ho') !== '' ? safe_post('uprjpd_edukasi_m_ho') : null,
                'edukasi_m_23' => safe_post('uprjpd_edukasi_m_23') !== '' ? safe_post('uprjpd_edukasi_m_23') : null,
                'edukasi_m_4' => safe_post('uprjpd_edukasi_m_4') !== '' ? safe_post('uprjpd_edukasi_m_4') : null,

                // Tidak meninggalkan pasien di kamar mandi saat menggunakan commode
                'commode_p_ho' => safe_post('uprjpd_commode_p_ho') !== '' ? safe_post('uprjpd_commode_p_ho') : null,
                'commode_p_10' => safe_post('uprjpd_commode_p_10') !== '' ? safe_post('uprjpd_commode_p_10') : null,
                'commode_s_ho' => safe_post('uprjpd_commode_s_ho') !== '' ? safe_post('uprjpd_commode_s_ho') : null,
                'commode_s_18' => safe_post('uprjpd_commode_s_18') !== '' ? safe_post('uprjpd_commode_s_18') : null,
                'commode_m_ho' => safe_post('uprjpd_commode_m_ho') !== '' ? safe_post('uprjpd_commode_m_ho') : null,
                'commode_m_23' => safe_post('uprjpd_commode_m_23') !== '' ? safe_post('uprjpd_commode_m_23') : null,
                'commode_m_4' => safe_post('uprjpd_commode_m_4') !== '' ? safe_post('uprjpd_commode_m_4') : null,

                // Pasang gelang khusus
                'gelang_p_ho' => safe_post('uprjpd_gelang_p_ho') !== '' ? safe_post('uprjpd_gelang_p_ho') : null,
                'gelang_p_10' => safe_post('uprjpd_gelang_p_10') !== '' ? safe_post('uprjpd_gelang_p_10') : null,
                'gelang_s_ho' => safe_post('uprjpd_gelang_s_ho') !== '' ? safe_post('uprjpd_gelang_s_ho') : null,
                'gelang_s_18' => safe_post('uprjpd_gelang_s_18') !== '' ? safe_post('uprjpd_gelang_s_18') : null,
                'gelang_m_ho' => safe_post('uprjpd_gelang_m_ho') !== '' ? safe_post('uprjpd_gelang_m_ho') : null,
                'gelang_m_23' => safe_post('uprjpd_gelang_m_23') !== '' ? safe_post('uprjpd_gelang_m_23') : null,
                'gelang_m_4' => safe_post('uprjpd_gelang_m_4') !== '' ? safe_post('uprjpd_gelang_m_4') : null,

                // Tempatkan pasien di kamar yang paling dekat dengan Nurse Station
                'station_p_ho' => safe_post('uprjpd_station_p_ho') !== '' ? safe_post('uprjpd_station_p_ho') : null,
                'station_p_10' => safe_post('uprjpd_station_p_10') !== '' ? safe_post('uprjpd_station_p_10') : null,
                'station_s_ho' => safe_post('uprjpd_station_s_ho') !== '' ? safe_post('uprjpd_station_s_ho') : null,
                'station_s_18' => safe_post('uprjpd_station_s_18') !== '' ? safe_post('uprjpd_station_s_18') : null,
                'station_m_ho' => safe_post('uprjpd_station_m_ho') !== '' ? safe_post('uprjpd_station_m_ho') : null,
                'station_m_23' => safe_post('uprjpd_station_m_23') !== '' ? safe_post('uprjpd_station_m_23') : null,
                'station_m_4' => safe_post('uprjpd_station_m_4') !== '' ? safe_post('uprjpd_station_m_4') : null,

                // Paraf
                'paraf_p_ho' => safe_post('uprjpd_paraf_p_ho') !== '' ? safe_post('uprjpd_paraf_p_ho') : null,
                'paraf_p_10' => safe_post('uprjpd_paraf_p_10') !== '' ? safe_post('uprjpd_paraf_p_10') : null,
                'paraf_s_ho' => safe_post('uprjpd_paraf_s_ho') !== '' ? safe_post('uprjpd_paraf_s_ho') : null,
                'paraf_s_18' => safe_post('uprjpd_paraf_s_18') !== '' ? safe_post('uprjpd_paraf_s_18') : null,
                'paraf_m_ho' => safe_post('uprjpd_paraf_m_ho') !== '' ? safe_post('uprjpd_paraf_m_ho') : null,
                'paraf_m_23' => safe_post('uprjpd_paraf_m_23') !== '' ? safe_post('uprjpd_paraf_m_23') : null,
                'paraf_m_4' => safe_post('uprjpd_paraf_m_4') !== '' ? safe_post('uprjpd_paraf_m_4') : null,

                'date_created' => safe_post('pencegahan_date_dewasa') !== '' ? safe_post('pencegahan_date_dewasa') : null,
            );

            $this->m_pelayanan->insertUpayaPencegahanDewasa($uprjpd_data);
        }

        // END FUNTION
        if (!empty($respon)) {

        $response = $respon;
        } else {

        $response = null;
        }

        if ($this->db->trans_status() === false) :
        $this->db->trans_rollback();
        $status = false;
        else :
        $this->db->trans_commit();
        $status = true;
        endif;

        $message = array(
        'status' => $status,
        'token' => $this->security->get_csrf_hash(),
        'id' => $layanan['id'],
        'respon' => $response,
        );
        $this->response($message, REST_Controller::HTTP_OK);
    }

    // PURJPD
    function hapus_kaji_ulang_delete($id) {
        $method = $this->input->post('_method');
        $deleted_by = $this->input->post('deleted_by'); // now string: nama

        if ($method !== 'DELETE') {
            return $this->response([
                'status' => false,
                'message' => 'Metode tidak diizinkan!'
            ], REST_Controller::HTTP_METHOD_NOT_ALLOWED);
        }

        if (empty($deleted_by)) {
            return $this->response([
                'status' => false,
                'message' => 'User penghapus tidak terdeteksi!'
            ], REST_Controller::HTTP_BAD_REQUEST);
        }

        // Kirim ke model
        $status = $this->m_pelayanan->deleteKajiUlang($id, $deleted_by);

        $response = [
            'status' => $status,
            'message' => $status ? 'Berhasil menghapus Kaji Ulang!' : 'Gagal menghapus Kaji Ulang!'
        ];

        $this->response($response, REST_Controller::HTTP_OK);
    }

    // UPRJPD
    function get_upaya_pencegahan_risiko_jatuh_pasien_dewasa_get(){
        if (!$this->get('id', true)) :
            $this->response(null, REST_Controller::HTTP_BAD_REQUEST);
        endif;
        $data = $this->m_pelayanan->getUpayaPencegahanResikoJatuhPasienDewasaByID($this->get('id', true));
        $this->response($data, REST_Controller::HTTP_OK);
    }

    // UPRJPD
    function update_upaya_pencegahan_risiko_jatuh_pasien_dewasa_post(){

        // if ($this->input->post('_method') !== 'POST') {
        // return $this->response(['status' => false, 'message' => 'Metode tidak valid!'], REST_Controller::HTTP_METHOD_NOT_ALLOWED);
        // }

        // $id = $this->input->post('id', true);
        // if (!$id) {
        //     return $this->response(['status' => false, 'message' => 'ID tidak ditemukan!'], REST_Controller::HTTP_BAD_REQUEST);
        // }
   
        $id = $this->input->post('id', true);
        if (!$id) {
            return $this->response(['status' => false, 'message' => 'ID tidak ditemukan!'], REST_Controller::HTTP_BAD_REQUEST);
        }

        $tanggal_pengkajian = str_replace('/', '-', $this->input->post('uprjpd_tanggal_pengkajian', true));
        $tanggal_pengkajian = date('Y-m-d', strtotime($tanggal_pengkajian));

        $data = [
            'id'                  => $id,
            'tanggal_pengkajian' => $tanggal_pengkajian,
            'id_perawat_p'        => $this->input->post('uprjpd_perawat_p', true) ?: null,
            'id_perawat_s'        => $this->input->post('uprjpd_perawat_s', true) ?: null,
            'id_perawat_m'        => $this->input->post('uprjpd_perawat_m', true) ?: null,
            'updated_at'          => date('Y-m-d H:i:s'),
            'id_user'             => $this->session->userdata('id_translucent'),
            'updated_by'          => $this->input->post('updated_by', true) ?: '-',
        ];

        // Tambahkan semua checkbox
        $checkboxes = [
            'bel_p_ho','bel_p_10','bel_s_ho','bel_s_18','bel_m_ho','bel_m_23','bel_m_4',
            'roda_p_ho','roda_p_10','roda_s_ho','roda_s_18','roda_m_ho','roda_m_23','roda_m_4',
            'ptt_p_ho','ptt_p_10','ptt_s_ho','ptt_s_18','ptt_m_ho','ptt_m_23','ptt_m_4',
            'ppt_p_ho','ppt_p_10','ppt_s_ho','ppt_s_18','ppt_m_ho','ppt_m_23','ppt_m_4',
            'penerangan_p_ho','penerangan_p_10','penerangan_s_ho','penerangan_s_18','penerangan_m_ho','penerangan_m_23','penerangan_m_4',
            'alas_p_ho','alas_p_10','alas_s_ho','alas_s_18','alas_m_ho','alas_m_23','alas_m_4',
            'lantai_p_ho','lantai_p_10','lantai_s_ho','lantai_s_18','lantai_m_ho','lantai_m_23','lantai_m_4',
            'alat_p_ho','alat_p_10','alat_s_ho','alat_s_18','alat_m_ho','alat_m_23','alat_m_4',
            'edukasi_p_ho','edukasi_p_10','edukasi_s_ho','edukasi_s_18','edukasi_m_ho','edukasi_m_23','edukasi_m_4',
            'commode_p_ho','commode_p_10','commode_s_ho','commode_s_18','commode_m_ho','commode_m_23','commode_m_4',
            'gelang_p_ho','gelang_p_10','gelang_s_ho','gelang_s_18','gelang_m_ho','gelang_m_23','gelang_m_4',
            'station_p_ho','station_p_10','station_s_ho','station_s_18','station_m_ho','station_m_23','station_m_4',
            'paraf_p_ho','paraf_p_10','paraf_s_ho','paraf_s_18','paraf_m_ho','paraf_m_23','paraf_m_4',
        ];


        foreach ($checkboxes as $field) {
            $data[$field] = $this->input->post("uprjpd_$field") === 'on' ? 1 : 0;
        }

        $status = $this->m_pelayanan->editUpayaPencegahanRisikoJatuhPasienDewasa($data);
        return $this->response(['status' => $status], REST_Controller::HTTP_OK);
    }

    // UPRJPD
    function hapus_upaya_pencegahan_risiko_jatuh_pasien_dewasa_delete($id) {
        $method = $this->input->post('_method');
        $deleted_by = $this->input->post('deleted_by'); // now string: nama

        if ($method !== 'DELETE') {
            return $this->response([
                'status' => false,
                'message' => 'Metode tidak diizinkan!'
            ], REST_Controller::HTTP_METHOD_NOT_ALLOWED);
        }

        if (empty($deleted_by)) {
            return $this->response([
                'status' => false,
                'message' => 'User penghapus tidak terdeteksi!'
            ], REST_Controller::HTTP_BAD_REQUEST);
        }

        // Kirim ke model
        $status = $this->m_pelayanan->deleteUpayaPencegahanRisikoJatuhPasienDewasa($id, $deleted_by);

        $response = [
            'status' => $status,
            'message' => $status ? 'Berhasil menghapus Data!' : 'Gagal menghapus Data!'
        ];

        $this->response($response, REST_Controller::HTTP_OK);
    }

    public function check_tindakan_dokter_spesialis_get()
    {
        $id_operator = safe_get('id_operator');
        $id_layanan_pendaftaran = safe_get('id_layanan_pendaftaran');
        $id_tindakan = safe_get('id_tindakan');
        $tindakan_data = safe_get('tindakan_data') !== '' ? safe_get('tindakan_data') : [];

        $is_jenis_pemeriksaan_konsultasi = false;

        foreach ($tindakan_data as $data) {
            $id_t = $data['tindakan'];
            $id_o = $data['operator'];

            $sql = "select *
                    from sm_tarif_pelayanan stp
                    join sm_layanan as sl on sl.id = stp.id_layanan
            where stp.id = $id_t
            and sl.id_jenis_pemeriksaan = 16";

            $data = $this->db->query($sql)->row();
            if(!empty($data) && $id_o == $id_operator){
                $is_jenis_pemeriksaan_konsultasi = true;
            }
        }

        $is_current_tindakan_konsultasi = false;
        $sql = "select *
                from sm_tarif_pelayanan stp
                join sm_layanan as sl on sl.id = stp.id_layanan
        where stp.id = $id_tindakan
        and sl.id_jenis_pemeriksaan = 16";
        $data = $this->db->query($sql)->row();
        if(!empty($data) && $is_jenis_pemeriksaan_konsultasi){
            $this->response(['success' => false], REST_Controller::HTTP_OK);
            return;
        }
        if(!empty($data)){
            $is_current_tindakan_konsultasi = true;
        }

        $sql = "select *
                from sm_tarif_tindakan_pasien sttp
                        join sm_tarif_pelayanan stp on sttp.id_tarif_pelayanan = stp.id
                        join sm_layanan as sl on sl.id = stp.id_layanan
                where sttp.id_operator = $id_operator
                and sttp.id_layanan_pendaftaran = $id_layanan_pendaftaran
                and sl.id_jenis_pemeriksaan = 16
                and sttp.tanggal::date = now()::date";

        $check_tindakan = true;
        $data = $this->db->query($sql)->row();
        if(!empty($data) && $is_current_tindakan_konsultasi){
            $check_tindakan = false;
        }

        $this->response(['success' => $check_tindakan], REST_Controller::HTTP_OK);
    }

    public function check_tindakan_operasi_get()
    {
        $id_layanan_pendaftaran = safe_get('id_layanan_pendaftaran');
        $id_tindakan = safe_get('id_tindakan');

        $sql = "select sto.id_tarif
                from sm_jadwal_kamar_operasi sjko
                        join sm_tarif_operasi sto on sto.id_operasi = sjko.id
                where sjko.id_layanan_pendaftaran = $id_layanan_pendaftaran
                and id_nadis is null";
        $data = $this->db->query($sql)->row();

        if(!empty($data) && $data->id_tarif == $id_tindakan){
            $this->response(['success' => false], REST_Controller::HTTP_OK);
            return;
        }

        $this->response(['success' => true], REST_Controller::HTTP_OK);
    }


    // CPTDI
    function get_data_cheklis_persiapan_tindakan_diagnostik_invasif_get(){
        if (!$this->get('id_layanan_pendaftaran')) :
            $this->response(NULL, REST_Controller::HTTP_BAD_REQUEST); // (400)
        endif;
        $this->load->model('pendaftaran/Pendaftaran_model', 'm_pendaftaran'); 
        $this->load->model('pelayanan/Pelayanan_model', 'm_pelayanan');
        $data = $this->m_pendaftaran->getPendaftaranDetail($this->get('id', true), $this->get('id_layanan', true));
        $data['profil'] = $this->m_pelayanan->getProfilPasien($data['pasien']->id_pasien);
        $data['cheklis_persiapan_tindakan_diagnostik_invasif'] = $this->m_pelayanan->getCheklistPersiapanTindakanDiagnostikInvasif($this->get('id', true));
        $data['cheklis_persiapan_tindakan_diagnostik_invasif_logs'] = $this->m_pelayanan->getCheklistPersiapanTindakanDiagnostikInvasifLogs($this->get('id', true));
        $data['grafik_observasi'] = $this->m_pelayanan->getGrafikObservasiInvasif($this->get('id', true), $this->get('id_layanan', true));

        $id = $this->get('id', true); // definisikan $id untuk bagian bawah
        // Diagnosa otomatis & manual (utama & sekunder)
        $data['diagnosa_utama'] = $this->m_pelayanan->getDiagnosa($id) ?? []; // Ambil data diagnosa otomatis utama pasien
        $data['diagnosa_sekunder'] = $this->m_pelayanan->getDiagnosaSekunder($id) ?? []; // Ambil data diagnosa otomatis sekunder pasien
        $data['ds_manual_utama'] = $this->m_pelayanan->getDiagnosaManualUtama($id) ?? []; // Ambil data diagnosa manual utama pasien
        $data['ds_manual_sekunder'] = $this->m_pelayanan->getDiagnosaManualSekunder($id) ?? []; // Ambil data diagnosa manual sekunder pasien
        if ($data) :
            $this->response($data, REST_Controller::HTTP_OK); // (200)
        endif;
    }

    // CPTDI
    function get_history_logs_cheklis_persiapan_tindakan_diagnostik_invasif_get(){
        if (!$this->get('id_layanan_pendaftaran', true)) :
            $this->response(NULL, REST_Controller::HTTP_BAD_REQUEST); // (400)
        endif;
        $id_layanan_pendaftaran = $this->get('id_layanan_pendaftaran', true);
        $data['cheklis_persiapan_tindakan_diagnostik_invasif_logs']       = $this->m_pelayanan->getCheklistPersiapanTindakanDiagnostikInvasifLogs($id_layanan_pendaftaran);
        if ($data) :
            $this->response($data, REST_Controller::HTTP_OK); // (200)
        endif;
    }
    
    // CPTDI
    function simpan_cheklis_persiapan_tindakan_diagnostik_invasif_post(){
        function ambil_data_json($prefix, $jumlah){
            return json_encode(array_reduce(range(1, $jumlah), function ($carry, $i) use ($prefix) {
                $key = "{$prefix}_{$i}";
                $value = safe_post($key);
                $carry[$key] = $value !== '' ? $value : null;
                return $carry;
            }, []));
        }

        if (safe_post('id_layanan_pendaftaran') === '') {
            $this->response(NULL, REST_Controller::HTTP_BAD_REQUEST);
        }

        $id_layanan_pendaftaran = safe_post('id_layanan_pendaftaran');
        $id_pendaftaran         = safe_post('id_pendaftaran');
        $id_cptdi               = safe_post('id_cptdi');
        $id_user_input          = safe_post('id_user'); // user yang input form
        $id_user_editor         = $this->session->userdata('id_translucent'); // user yang login sekarang

        $data_cptdi = array(
            'id_layanan_pendaftaran' => $id_layanan_pendaftaran,
            'id_pendaftaran'         => $id_pendaftaran,

            // hanya diisi saat INSERT, lihat logika di bawah

            'tujuan_cptdi'              => ambil_data_json('tujuan_cptdi', 11),
            'statuspsikologis_cptdi'    => ambil_data_json('statuspsikologis_cptdi', 6), 
            'riwayatpenyakit_cptdi'     => ambil_data_json('riwayatpenyakit_cptdi', 10), 
            'sistempernafasan_cptdi'    => ambil_data_json('sistempernafasan_cptdi', 5), 
            'sistempencernaan_cptdi'    => ambil_data_json('sistempencernaan_cptdi', 5), 
            'sistemkemih_cptdi'         => (safe_post('sistemkemih_cptdi') !== '' ? safe_post('sistemkemih_cptdi') : NULL),
            'riwayatpengob_cptdi'       => ambil_data_json('riwayatpengob_cptdi', 9), 
            'riwayatalergi_cptdi'       => ambil_data_json('riwayatalergi_cptdi', 3), 
            'ttv_cptdi'                 => ambil_data_json('ttv_cptdi', 4), 
            'testalent_cptdi'           => ambil_data_json('testalent_cptdi', 4), 
            'arteridor_cptdi'           => ambil_data_json('arteridor_cptdi', 4), 
            'bb_cptdi'                  => (safe_post('bb_cptdi') !== '' ? safe_post('bb_cptdi') : NULL),
            'tb_cptdi'                  => (safe_post('tb_cptdi') !== '' ? safe_post('tb_cptdi') : NULL),
            'keluhannyeri_cptdi'        => ambil_data_json('keluhannyeri_cptdi', 10), 
            'kebutuhanedu_cptdi'        => ambil_data_json('kebutuhanedu_cptdi', 10), 
            'labroturiem_cptdi'         => ambil_data_json('labroturiem_cptdi', 8), 
            'skrining_cptdi'            => ambil_data_json('skrining_cptdi', 4), 
            'hasilecho_cptdi'           => ambil_data_json('hasilecho_cptdi', 3), 
            'mskep_cptdi'               => ambil_data_json('mskep_cptdi', 6), 
            'rctindkep_cptdi'           => ambil_data_json('rctindkep_cptdi', 6), 
            'perawat_cptdi'             => (safe_post('perawat_cptdi') !== '' ? safe_post('perawat_cptdi') : NULL),
            'tanggaljam_cptdi'          => (safe_post('tanggaljam_cptdi') !== '' ? datetime2mysql(safe_post('tanggaljam_cptdi')) : NULL),
            'pasientiba_cptdi'          => ambil_data_json('pasientiba_cptdi', 3), 
            'terpasang_cptdi'           => ambil_data_json('terpasang_cptdi', 3), 
            'pulsasia_cptdi'            => ambil_data_json('pulsasia_cptdi', 6), 
            'pulsasidor_cptdi'          => ambil_data_json('pulsasidor_cptdi', 6), 
            'alatyt_cptdi'              => ambil_data_json('alatyt_cptdi', 8), 
            'jenisanest_cptdi'          => ambil_data_json('jenisanest_cptdi', 5), 
            'sedasi_cptdi'              => (safe_post('sedasi_cptdi') !== '' ? safe_post('sedasi_cptdi') : NULL),
            'antikoagulan_cptdi'        => ambil_data_json('antikoagulan_cptdi', 5), 
            'hematoma_cptdi'            => ambil_data_json('hematoma_cptdi', 4), 
            'leserasi_cptdi'            => ambil_data_json('leserasi_cptdi', 4), 
            'reaksif_cptdi'             => ambil_data_json('reaksif_cptdi', 3), 
            'intaker_cptdi'             => ambil_data_json('intaker_cptdi', 6), 
            'imobil_cptdi'              => ambil_data_json('imobil_cptdi', 6), 
            'maskeptan_cptdi'           => ambil_data_json('maskeptan_cptdi', 12), 
            'tdmandiri_cptdi'           => ambil_data_json('tdmandiri_cptdi', 12), 
            'saturasy_cptdi'            => ambil_data_json('saturasy_cptdi', 8), 
            'pulsasi_cptdi'             => ambil_data_json('pulsasi_cptdi', 8), 
            'reflek_cptdi'              => ambil_data_json('reflek_cptdi', 8), 
            'tanggaljagm_cptdi'         => (safe_post('tanggaljagm_cptdi') !== '' ? datetime2mysql(safe_post('tanggaljagm_cptdi')) : NULL),
            'perawatobsser_cptdi'       => (safe_post('perawatobsser_cptdi') !== '' ? safe_post('perawatobsser_cptdi') : NULL),
        );

        // Hanya isi id_users saat INSERT
        if (empty($id_cptdi)) {
            $data_cptdi['id_users'] = $id_user_input;
        }

        $this->m_pelayanan->updateCheklisPersiapanTindakanDiagnostikInvasif($data_cptdi, $id_cptdi, $id_user_editor);

        if (!empty($respon)) {
            $response = $respon;
        } else {
            $response = null;
        }

        if ($this->db->trans_status() === false) :
            $this->db->trans_rollback();
            $status = false;
        else :
            $this->db->trans_commit();
            $status = true;
        endif;

        $message = array(
            'status' => $status,
            'token'  => $this->security->get_csrf_hash(),
            'id_pendaftaran' => $id_pendaftaran,
            'id_layanan_pendaftaran' => $id_layanan_pendaftaran,
            'respon' => $response,
        );

        $this->response($message, REST_Controller::HTTP_OK);
    }

    // GRAFIK OBSERVASI
    function simpan_grafik_observasi_post(){
        // Ambil data dari input
        $data = array(
            'id_layanan_pendaftaran' => safe_post('id_layanan_pendaftaran'),
            'id_pendaftaran'         => safe_post('id_pendaftaran'),
            'id_user'                => safe_post('id_user'),
            'bloodpressure_cptdi'    => safe_post('bloodpressure'),
            'nadipulse_cptdi'        => safe_post('nadipulse'),
            'pernafasan_cptdi'       => safe_post('pernafasan'),
            'suhu_cptdi'             => safe_post('suhu'),
            'jamgo_cptdi'            => safe_post('jamgo'),
            'tglgo_cptdi'            => safe_post('tglgo')
        );

        // Simpan data ke database
        $this->m_pelayanan->insertGrafikObservasiInvasif($data);

        // Ambil data yang baru saja disimpan untuk dikembalikan dalam respons
        $data = $this->m_pelayanan->getGrafikObservasiInvasif($data['id_pendaftaran'], $data['id_layanan_pendaftaran']);

        // Kembalikan data dalam respons
        $this->response($data, REST_Controller::HTTP_OK);      
    }

    // GRAFIK OBSERVASI
    function update_grafik_observasi_post(){
        $id = safe_post('id');
        $id_user_login = safe_post('id_user'); // user yang sedang login (editor)

        // Ambil data lama
        $lama = $this->db->get_where('sm_grafik_observasi_intra', ['id' => $id])->row_array();

        // Format tanggal
        $tanggal_input_cptdi = safe_post('edit_tglgo');
        $tglgo_cptdi = null;
        if (!empty($tanggal_input_cptdi)) {
            $tanggal_cptdi = DateTime::createFromFormat('d/m/Y', $tanggal_input_cptdi);
            if ($tanggal_cptdi) {
                $tglgo_cptdi = $tanggal_cptdi->format('Y-m-d');
            }
        }

        // Data baru
        $data_edit = array(
            'id'                    => $id,
            'id_layanan_pendaftaran'=> safe_post('id_layanan_pendaftaran'),
            'id_pendaftaran'        => safe_post('id_pendaftaran'),
            'id_user'               => $lama['id_user'], // tidak berubah!
            'bloodpressure_cptdi'   => safe_post('edit_bloodpressure'),
            'nadipulse_cptdi'       => safe_post('edit_nadipulse'),
            'pernafasan_cptdi'      => safe_post('edit_pernafasan'),
            'suhu_cptdi'            => safe_post('edit_suhu'),
            'jamgo_cptdi'           => safe_post('edit_jamgo'),
            'tglgo_cptdi'           => $tglgo_cptdi,
            'updated_at'            => date('Y-m-d H:i:s'),
        );

        // Logging jika ada perubahan
        if ($lama) {
            $perubahan = false;
            foreach (['bloodpressure_cptdi', 'nadipulse_cptdi', 'pernafasan_cptdi', 'suhu_cptdi', 'jamgo_cptdi', 'tglgo_cptdi'] as $key) {
                if ($lama[$key] != $data_edit[$key]) {
                    $perubahan = true;
                    break;
                }
            }

            if ($perubahan) {
                $log = $lama;
                unset($log['id']);
                $log['created_at'] = date('Y-m-d H:i:s');
                $log['keterangan'] = 'Update';
                $log['updated_by'] = $id_user_login; // user yang melakukan update
                $this->m_pelayanan->insertLogsGrafikObservasiInvasif($log);
            }
        }

        // Update utama
        $this->m_pelayanan->updateGrafikObservasiInvasif($data_edit);
        $updatedData = $this->m_pelayanan->getGrafikObservasiInvasif($data_edit['id_pendaftaran'], $data_edit['id_layanan_pendaftaran']);
        $this->response($updatedData, REST_Controller::HTTP_OK);
    }

    // GRAFIK OBSERVASI LOGS
    function hapus_grafik_observasi_delete($id, $id_layanan_pendaftaran, $id_pendaftaran){
        // Ambil ID user dari query string
        $deleted_by = $this->input->get('id_user'); // dari JavaScript ?id_user=...

        // Ambil data lama sebelum dihapus
        $lama = $this->db->get_where('sm_grafik_observasi_intra', ['id' => $id])->row_array();

        if ($lama) {
            $log = $lama;
            unset($log['id']); // Hindari bentrok PK
            $log['created_at'] = date('Y-m-d H:i:s');
            $log['keterangan'] = 'Delete';
            $log['deleted_by'] = $deleted_by; //  ini ditambahkan biar masuk ke log
            $this->m_pelayanan->insertLogsGrafikObservasiInvasif($log);
        }

        // Hapus data utama
        $this->m_pelayanan->deleteGrafikObservasiInvasif($id);

        // Ambil data terbaru untuk refresh grafik
        $data = $this->m_pelayanan->getGrafikObservasiInvasif($id_pendaftaran, $id_layanan_pendaftaran);

        // Kirim response ke frontend
        $this->response($data, REST_Controller::HTTP_OK);
    }

    // GRAFIK OBSERVASI
    function get_grafik_observasi_by_id_get($id){
        $data = $this->m_pelayanan->getGrafikObservasiInvasifByID($id);
        $this->response($data, REST_Controller::HTTP_OK);
    }


    // LEMBAR OBSERVASI
    function get_data_lembar_observasi_get(){
        if (!$this->get('id')) :
            $this->response(NULL, REST_Controller::HTTP_BAD_REQUEST); // (400)
        endif;
        $this->load->model('pendaftaran/Pendaftaran_model', 'm_pendaftaran');
        $data = $this->m_pendaftaran->getPendaftaranDetail($this->get('id', true), $this->get('id_layanan', true));
        $data['profil'] = $this->m_pelayanan->getProfilPasien($data['pasien']->id_pasien);
        $data['lo'] = $this->m_pelayanan->getLo($this->get('id_layanan'));
        if ($data) :
            $this->response($data, REST_Controller::HTTP_OK); // (200)
        endif;
    }



}
